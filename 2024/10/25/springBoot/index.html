<!DOCTYPE html><html lang="zh" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>springBoot | 欢迎来到小智的blog</title><meta name="author" content="XiaoZhi"><meta name="copyright" content="XiaoZhi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="01	springBoot2入门官网有对应的示例 02	了解自动配置原理1、SpringBoot特点1.1 依赖管理父项目做依赖管理 1234567891011121314&lt;!-- 依赖管理 --&gt;&lt;parent&gt;    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;">
<meta property="og:type" content="article">
<meta property="og:title" content="springBoot">
<meta property="og:url" content="https://dd-xiaozhi.github.io/dd/2024/10/25/springBoot/index.html">
<meta property="og:site_name" content="欢迎来到小智的blog">
<meta property="og:description" content="01	springBoot2入门官网有对应的示例 02	了解自动配置原理1、SpringBoot特点1.1 依赖管理父项目做依赖管理 1234567891011121314&lt;!-- 依赖管理 --&gt;&lt;parent&gt;    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;">
<meta property="og:locale">
<meta property="og:image" content="https://avatars.githubusercontent.com/u/83541888?s=400&u=c1a17f2da2425d5c4214b9d1e0a3c3a6de998d4a&v=4">
<meta property="article:published_time" content="2024-10-24T17:53:53.000Z">
<meta property="article:modified_time" content="2025-08-25T17:33:08.879Z">
<meta property="article:author" content="XiaoZhi">
<meta property="article:tag" content="test">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://avatars.githubusercontent.com/u/83541888?s=400&u=c1a17f2da2425d5c4214b9d1e0a3c3a6de998d4a&v=4"><link rel="shortcut icon" href="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/2025/372132.jpg"><link rel="canonical" href="https://dd-xiaozhi.github.io/dd/2024/10/25/springBoot/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/dd/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        if (name && globalFn[key][name]) return
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/dd/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'medium_zoom',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'springBoot',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-08-26 01:33:08'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://avatars.githubusercontent.com/u/83541888?s=400&amp;u=c1a17f2da2425d5c4214b9d1e0a3c3a6de998d4a&amp;v=4" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/dd/archives/"><div class="headline">Articles</div><div class="length-num">27</div></a><a href="/dd/tags/"><div class="headline">Tags</div><div class="length-num">1</div></a><a href="/dd/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/dd/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/dd/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/dd/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/dd/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/dd/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/dd/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/dd/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/dd/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/dd/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://picsum.photos/id/482/400/400);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/dd/"><img class="site-icon" src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/2025/372132.jpg" alt="Logo"><span class="site-name">欢迎来到小智的blog</span></a><a class="nav-page-title" href="/dd/"><span class="site-name">springBoot</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/dd/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/dd/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/dd/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/dd/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/dd/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/dd/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/dd/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/dd/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/dd/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">springBoot</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-10-24T17:53:53.000Z" title="Created 2024-10-25 01:53:53">2024-10-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-08-25T17:33:08.879Z" title="Updated 2025-08-26 01:33:08">2025-08-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="01springBoot2入门"><a href="#01springBoot2入门" class="headerlink" title="01	springBoot2入门"></a>01	springBoot2入门</h1><p>官网有对应的示例</p>
<h1 id="02了解自动配置原理"><a href="#02了解自动配置原理" class="headerlink" title="02	了解自动配置原理"></a>02	了解自动配置原理</h1><h2 id="1、SpringBoot特点"><a href="#1、SpringBoot特点" class="headerlink" title="1、SpringBoot特点"></a>1、SpringBoot特点</h2><h3 id="1-1-依赖管理"><a href="#1-1-依赖管理" class="headerlink" title="1.1 依赖管理"></a>1.1 依赖管理</h3><p><strong>父项目做依赖管理</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 依赖管理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 依赖管理的父依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 几乎声明了所有开发中常用的依赖的版本号，自动版本仲裁机制，只能使用我设定好的版本 --&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>starter场景启动器</strong></p>
<p>只要引入starter，这个场景的所有常规需要的依赖我们都自动引入</p>
<p>比如我们引入web的场景启动器可以看到常用需要的依赖也一起导入了，我们就可以直接使用了</p>
<p><img src="https://img-blog.csdnimg.cn/2021071715575772.png" alt="在这里插入图片描述"></p>
<p>官方的starter都是以<code>spring-boot-starter</code>开头的，然后接着是他们的场景名</p>
<p>另外还有第三方提供的starter，<code>*-spring-boot-starter</code></p>
<p><strong>版本控制</strong></p>
<p>我们不需要去指定版本，springboot会帮我们控制版本</p>
<p>如果我们想要指定的版本，也可以通过pom.xml文件去配置我们特定的版本</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在当前项目配置文件下添加 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.43<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="1-2-自动配置"><a href="#1-2-自动配置" class="headerlink" title="1.2 自动配置"></a>1.2 自动配置</h3><p>我们只要引入我们对应的场景，springboot就会帮我们自动配好配置文件</p>
<p>比如自动配置tomcat的dispatcherServlet、还有字符编码过滤等等。。。</p>
<p><strong>默认的包结构</strong>：主程序所在的包及其下面的所有子包里面的组件都会默认被扫描进来，不用我们以前的包扫描配置，一切spiingBoot帮我们配好了</p>
<p><strong>修改默认包扫描</strong>：</p>
<p>如果想要修改默认的包扫描路径我们可以修改默认配置</p>
<pre><code> ①`@SpringBootApplication(scanBasePackages = &quot;com.xiaozhi&quot;)`

 ②也可以使用`ComponentScan`指定扫描路径
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210717171703531.png" alt="在这里插入图片描述"></p>
<p>这样的话我们就可以扫描com.xiaozhi下的所有包，而不只是主程序所在包下的所有包</p>
<p><strong>自动配置项</strong></p>
<p>我们在配置文件中进行赋值，最终它会映射到对应的配置类上，然后在容器中创建对象</p>
<p>我们的自动配置类并不是所有都能使用的，只有引入对应的场景才会开启对应的自动配置</p>
<h2 id="2、容器功能"><a href="#2、容器功能" class="headerlink" title="2、容器功能"></a>2、容器功能</h2><h3 id="2-1-组件添加"><a href="#2-1-组件添加" class="headerlink" title="2.1 组件添加"></a>2.1 组件添加</h3><h4 id="1、-Configuration"><a href="#1、-Configuration" class="headerlink" title="1、@Configuration"></a>1、@Configuration</h4><p><strong>Fuill模式与Lite模式</strong></p>
<p>这两个模式的开启对应@Configuration属性proxyBeanMethods值为true和false</p>
<p><img src="https://img-blog.csdnimg.cn/20210717151038621.png" alt="在这里插入图片描述"></p>
<p>true为fuill模式，springBoot每次都会检查容器中是否存在这个bean，有的话就返回现有的，没有的话就创建，确保每个@Bean方法被调用多少次返回的都是单例的</p>
<p>false为lite模式，每个@Bean方法被调多少次返回的组件都是新创建的</p>
<p><strong>注意</strong>：组件依赖必须使用Fill模式</p>
<p><img src="https://img-blog.csdnimg.cn/20210717151048472.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="20210619170206106"></p>
<p>设置为true，那调用的就是为单例的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ConfigurableApplicationContext</span> <span class="variable">run</span> <span class="operator">=</span> SpringApplication.run(Springboot1Application.class, args);</span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> run.getBean(<span class="string">&quot;person&quot;</span>, Person.class);</span><br><span class="line">    <span class="type">Animal</span> <span class="variable">cat</span> <span class="operator">=</span> run.getBean(<span class="string">&quot;animal&quot;</span>, Animal.class);</span><br><span class="line">    <span class="comment">// 判断person中的animal对象和</span></span><br><span class="line">    System.out.println(person.getAnimal());</span><br><span class="line">    System.out.println(<span class="string">&quot;是否单例&quot;</span> + (person.getAnimal() == cat));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>设置为false，每次调用都是新的实例</p>
<p><img src="https://img-blog.csdnimg.cn/20210717151106455.png" alt="20210619170958071"></p>
<h4 id="2、-Component衍生的注解"><a href="#2、-Component衍生的注解" class="headerlink" title="2、@Component衍生的注解"></a>2、@Component衍生的注解</h4><p>@Controller、@Service、@Repository</p>
<h4 id="3、组件扫描"><a href="#3、组件扫描" class="headerlink" title="3、组件扫描"></a>3、组件扫描</h4><p><strong>①@ComponentScan</strong></p>
<p><strong>②Import</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;Person.class, Animal.class&#125;)</span>	<span class="comment">// 在容器中自动创建两个类型的组件，组件名是全类名</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Config</span> &#123;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717151136326.png" alt="20210619172554899"></p>
<h4 id="4、-Conditional"><a href="#4、-Conditional" class="headerlink" title="4、@Conditional"></a>4、@Conditional</h4><p>条件装配：满足Conditional指定的条件，则进行组件注入</p>
<p>它可以作用在配置类上，条件不满足那么这个配置类下的所有bean都不能注册</p>
<p><img src="https://img-blog.csdnimg.cn/20210717151215264.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Animal <span class="title function_">animal</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Animal</span> <span class="variable">animal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&quot;cat&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> animal;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 存在animal这个名字的baen我才创建这个对象</span></span><br><span class="line">    <span class="meta">@ConditionalOnBean(name = &quot;animal&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Person <span class="title function_">person</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;xiaozhi&quot;</span>,<span class="number">18</span>);</span><br><span class="line">        person.setAnimal(animal());</span><br><span class="line">        <span class="keyword">return</span> person;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-2-原生配置文件引入"><a href="#2-2-原生配置文件引入" class="headerlink" title="2.2 原生配置文件引入"></a>2.2 原生配置文件引入</h3><h4 id="①-ImportResource"><a href="#①-ImportResource" class="headerlink" title="① @ImportResource"></a>① @ImportResource</h4><p><strong>注意</strong>：使用这个注解一定要在配置类中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiaozhi.pojo.Person&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;xiaozhi&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;animal&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;animal&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;animal&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiaozhi.pojo.Animal&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;cat&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = true)</span></span><br><span class="line"><span class="meta">@ImportResource(&quot;classpath:bean.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Config</span> &#123;</span><br><span class="line"><span class="comment">//    @Bean</span></span><br><span class="line"><span class="comment">//    public Animal animal() &#123;</span></span><br><span class="line"><span class="comment">//        Animal animal = new Animal(&quot;cat&quot;);</span></span><br><span class="line"><span class="comment">//        return animal;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//    // 匹配的类型要 在它之前创建它才会创建，不然就不会创建</span></span><br><span class="line"><span class="comment">//    @ConditionalOnBean(name = &quot;animal&quot;)</span></span><br><span class="line"><span class="comment">//    @Bean</span></span><br><span class="line"><span class="comment">//    public Person person() &#123;</span></span><br><span class="line"><span class="comment">//        Person person = new Person(&quot;xiaozhi&quot;,18);</span></span><br><span class="line"><span class="comment">//        person.setAnimal(animal());</span></span><br><span class="line"><span class="comment">//        return person;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717151252219.png" alt="20210619180236036"></p>
<h3 id="2-3-配置绑定"><a href="#2-3-配置绑定" class="headerlink" title="2.3 配置绑定"></a>2.3 配置绑定</h3><p>读取properties文件中的内容，并封装到javaBean中</p>
<p>原生的java代码我们需要创建一个Properties对象加载我们的properties文件，然后遍历得到配置文件中的每个名字，然后判断得到我们需要的内容</p>
<p>现在我们可以通过注解来完成读取配置文件的内容</p>
<h4 id="①-ConfigurationProperties"><a href="#①-ConfigurationProperties" class="headerlink" title="① @ConfigurationProperties"></a>① @ConfigurationProperties</h4><p>只有在容器中的组件，才会有springBoot的功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span>		<span class="comment">// 配置文件的前缀</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person.name</span>=<span class="string">major</span></span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/2021071715584136.png" alt="在这里插入图片描述"></p>
<p>② @EnableConfigurationProperties + @ConfigurationProperties</p>
<p> @EnableConfigurationProperties(person.class)的两个功能</p>
<ol>
<li>开启person类的配置功能</li>
<li>把这个person注册到容器中</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigurationProperties(Person.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot1Application</span> &#123;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20210717151313111.png" alt="20210620114305506"></p>
<p><strong>注意</strong>：它的组件名是类名-全类名</p>
<h2 id="3、自动装配原理入门"><a href="#3、自动装配原理入门" class="headerlink" title="3、自动装配原理入门"></a>3、自动装配原理入门</h2><p>我们来看看springBoot帮我们做了什么事</p>
<h3 id="3-1-引导自动加载配置类"><a href="#3-1-引导自动加载配置类" class="headerlink" title="3.1 引导自动加载配置类"></a>3.1 引导自动加载配置类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class="line"><span class="meta">      @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;</span><br></pre></td></tr></table></figure>

<p>我们可以看到除了一些元注解外，有三个注解是@springBoot的主要功能注解</p>
<h4 id="SpringBootConfiguration"><a href="#SpringBootConfiguration" class="headerlink" title="@SpringBootConfiguration"></a>@SpringBootConfiguration</h4><p><img src="https://img-blog.csdnimg.cn/20210717151345918.png"><br>表明它是一个配置类</p>
<h4 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="@ComponentScan"></a>@ComponentScan</h4><p>自定扫描那些</p>
<h4 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h4><p>开启自动装配，主要功能是导入组件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(AutoConfigurationImportSelector.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br></pre></td></tr></table></figure>



<p><strong>1、@AutoConfigurationPackage</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(AutoConfigurationPackages.Registrar.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AutoConfigurationPackage &#123;</span><br></pre></td></tr></table></figure>

<p>我们点进去可以看到它进行了一个批量导入</p>
<p><img src="https://img-blog.csdnimg.cn/20210717151416607.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>启动springBoot它会执行这个方法将我们定义的bean注册到容器中，我们可以debug计算一下</p>
<p><img src="https://img-blog.csdnimg.cn/20210717151429574.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>可以看到我们计算出来的结果就是我们主启动类所在包，也就是说@AutoConfigurationPackage的功能是将主启动类所在包下的所有组件进行注册。</p>
<p><strong>2、@Import(AutoConfigurationImportSelector.class)</strong></p>
<p>导入一系列组件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoConfigurationImportSelector</span> <span class="keyword">implements</span> <span class="title class_">DeferredImportSelector</span>, BeanClassLoaderAware,</span><br><span class="line">		ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered &#123;</span><br><span class="line">            </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeferredImportSelector</span> <span class="keyword">extends</span> <span class="title class_">ImportSelector</span> &#123;</span><br></pre></td></tr></table></figure>

<p>可以看出来AutoConfigurationImportSelector是一个导入选择器，它可以有自己的逻辑实现</p>
<p><img src="https://img-blog.csdnimg.cn/20210717151503594.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>首先它会执行上面这个方法，然后执行getAutoConfigurationEntry(annotationMetadata)方法</p>
<p><img src="https://img-blog.csdnimg.cn/20210717151512716.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>这个方法中主要是getCandidateConfigurations(annotationMetadata, attributes)方法得到我们需要加载组件的名字，其他的操作就是排除一些我们不要的，下面的按需自动开启配置项会讲到</p>
<p><img src="https://img-blog.csdnimg.cn/20210717151523287.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-5UC2mGmJ-1626505674329)(../../Java学习/截图/image-20210620171720147.png)]"><br><img src="https://img-blog.csdnimg.cn/20210717151532938.png"><br><img src="https://img-blog.csdnimg.cn/20210717151559786.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210717151609790.png" alt="在这里插入图片描述"></p>
<p>所以springBoot它会去加载类路径下的META-INF&#x2F;spring.factories文件，然后得到需要导入的组件进行注册<br><img src="https://img-blog.csdnimg.cn/20210717151620521.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>可以看到确实是有的，我们打开这个文件进行查看</p>
<p><img src="https://img-blog.csdnimg.cn/202107171516334.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>一共127个官方的自动配置包</p>
<p>springBoot它是会默认找org.springframework.boot.autoconfigure.EnableAutoConfiguration属性的</p>
<p><img src="https://img-blog.csdnimg.cn/20210717151642245.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>对应前面的getCandidateConfigurations(annotationMetadata, attributes)方法返回结果是一致的<br><img src="https://img-blog.csdnimg.cn/20210717151651142.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>测试</strong></p>
<p>我们导入一个第三方的starter，查看结果</p>
<p>导入mybatis-spring-boot-starter</p>
<p><img src="https://img-blog.csdnimg.cn/20210717151708893.png" alt="在这里插入图片描述"></p>
<p>上面这个是它的spring.factories文件，我们可以看到需要导入的自动配置类有两个，我们debug查看一下是否有变化</p>
<p><img src="https://img-blog.csdnimg.cn/20210717151716666.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>可以看到数量编程了129了</p>
<h3 id="3-2-按需开启配置项"><a href="#3-2-按需开启配置项" class="headerlink" title="3.2 按需开启配置项"></a>3.2 按需开启配置项</h3><p>springBoot并不是将127个全部都导入，它是按需开启的，只有导入对应的starter它才会有效，我们可以看一个案例</p>
<p><img src="https://img-blog.csdnimg.cn/20210717151726362.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>我们可以有@ConditionalOnClass这个注解，这个注解的意思就是，有Advice.class这个类那么AspectJAutoProxyingConfiguration类下的配置才会生效，其他的自动配置类也是类似的，需要达到条件才会开启。</p>
<h3 id="3-3-修改默认配置"><a href="#3-3-修改默认配置" class="headerlink" title="3.3 修改默认配置"></a>3.3 修改默认配置</h3><p>比如我们不需要springBoot默认帮我们配置好的，那么我们可以使用@Bean来配置一个我们自己的，以我们自己的优先</p>
<p>我们这边以字符编码拦截器为例，也就是我们的 <code>HttpEncodingAutoConfiguration</code></p>
<p><img src="https://img-blog.csdnimg.cn/20210717151736460.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> CharacterEncodingFilter <span class="title function_">characterEncodingFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CharacterEncodingFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderedCharacterEncodingFilter</span>();</span><br><span class="line">        filter.setEncoding(<span class="string">&quot;gbk&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> filter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(Person.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot1Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">run</span> <span class="operator">=</span> SpringApplication.run(Springboot1Application.class, args);</span><br><span class="line">        <span class="type">CharacterEncodingFilter</span> <span class="variable">filter</span> <span class="operator">=</span> run.getBean(<span class="string">&quot;characterEncodingFilter&quot;</span>, CharacterEncodingFilter.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;编码类型为：&quot;</span> + filter.getEncoding());   <span class="comment">// 得到编码值</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717151746418.png" alt="在这里插入图片描述"></p>
<p><strong>@ConditionalOnProperty</strong>	<br><img src="https://img-blog.csdnimg.cn/20210717151755628.png" alt="在这里插入图片描述"><br>设置为false就会报错<br><img src="https://img-blog.csdnimg.cn/20210717151803506.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210717151812776.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-pitAv1cS-1626505674337)(../../Java学习/截图/image-20210620185110331.png)]"><br><strong>自我理解</strong>：我查看了源码，没有发现和配置文件绑定的属性，那么它就是根据配置文件的的值来判断是否开启这个功能</p>
<h1 id="03配置文件"><a href="#03配置文件" class="headerlink" title="03	配置文件"></a>03	配置文件</h1><h2 id="1文件类型"><a href="#1文件类型" class="headerlink" title="1	文件类型"></a>1	文件类型</h2><h3 id="1-1-properties"><a href="#1-1-properties" class="headerlink" title="1.1 properties"></a>1.1 properties</h3><p>这个没什么好说的</p>
<h3 id="2-2-yaml"><a href="#2-2-yaml" class="headerlink" title="2.2 yaml"></a>2.2 yaml</h3><h4 id="①简介"><a href="#①简介" class="headerlink" title="①简介"></a>①简介</h4><p>YAML 是 “YAML Ain’t Markup Language”（YAML 不是一种标记语言）的递归缩写。在开发的这种语言时，YAML 的意思其实是：”Yet Another Markup Language”（仍是一种标记语言）。 非常适合用来做以数据为中心的配置文件</p>
<h4 id="②基本用法"><a href="#②基本用法" class="headerlink" title="②基本用法"></a>②基本用法</h4><ul>
<li><p>key: value；kv之间有空格</p>
</li>
<li><p>大小写敏感</p>
</li>
<li><p>使用缩进表示层级关系</p>
</li>
<li><p>缩进的空格数不重要，只要相同层级的元素左对齐即可</p>
</li>
<li><p>‘#’表示注释</p>
</li>
<li><p>字符串无需加引号，如果要加，’’与””表示字符串内容 会被 转义&#x2F;不转义</p>
<ul>
<li>单引号会将转义符以字符串的形式输出</li>
<li>双引号就是转义之后输出</li>
</ul>
</li>
</ul>
<h4 id="③数据类型"><a href="#③数据类型" class="headerlink" title="③数据类型"></a>③数据类型</h4><ul>
<li>字面量：单个的、不可再分的值。date、boolean、string、number、null</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">k:</span> <span class="string">v</span></span><br></pre></td></tr></table></figure>

<ul>
<li>对象：键值对的集合。map、hash、set、object</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">行内写法：</span>  <span class="attr">k:</span> &#123;<span class="string">k1:v1</span>,<span class="string">k2:v2</span>,<span class="string">k3:v3</span>&#125;</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line"><span class="attr">k:</span> </span><br><span class="line">	<span class="attr">k1:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">k2:</span> <span class="string">v2</span></span><br><span class="line">  <span class="attr">k3:</span> <span class="string">v3</span></span><br></pre></td></tr></table></figure>

<ul>
<li>数组：一组按次序排列的值。array、list、queue</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">行内写法：</span>  <span class="attr">k:</span> [<span class="string">v1</span>,<span class="string">v2</span>,<span class="string">v3</span>]</span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line"><span class="attr">k:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">v1</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">v2</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">v3</span></span><br></pre></td></tr></table></figure>



<h4 id="④示例"><a href="#④示例" class="headerlink" title="④示例"></a>④示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span> Pet pet;</span><br><span class="line">    <span class="keyword">private</span> String[] animal;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; hobby;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Pet&gt; map;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Double&gt; salary;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, List&lt;Pet&gt;&gt; allPets;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">user:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">小智</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">18</span></span><br><span class="line">  <span class="attr">birth:</span> <span class="number">2001</span><span class="string">/12/12</span></span><br><span class="line">  <span class="attr">pet:</span> &#123;<span class="attr">name:</span> <span class="string">阿猫</span>, <span class="attr">age:</span> <span class="number">28</span>&#125;</span><br><span class="line">  <span class="attr">animal:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">阿猫</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">阿狗</span></span><br><span class="line">  <span class="attr">hobby:</span> [<span class="string">敲代码</span>, <span class="string">健身</span>]</span><br><span class="line">  <span class="attr">map:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">怀狗:</span> &#123;<span class="attr">name:</span> <span class="string">黑鬼</span>, <span class="attr">age:</span> <span class="number">19</span>&#125;</span><br><span class="line">  <span class="attr">salary:</span> <span class="number">99.99</span></span><br><span class="line">  <span class="attr">all-pets:</span></span><br><span class="line">    <span class="attr">sick:</span></span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">name:</span> <span class="string">heigui</span>, <span class="attr">age:</span> <span class="number">20</span>&#125;</span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">name:</span> <span class="string">tom</span>, <span class="attr">age:</span> <span class="number">19</span>&#125;</span><br><span class="line">    <span class="attr">health:</span> [&#123;<span class="attr">name:</span> <span class="string">mario</span>, <span class="attr">age:</span> <span class="number">29</span>&#125;]</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span> <span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果如下</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;猛男&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;birth&quot;</span><span class="punctuation">:</span><span class="string">&quot;2001-12-11T16:00:00.000+00:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;pet&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;阿猫&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">28</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;animal&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;阿猫&quot;</span><span class="punctuation">,</span><span class="string">&quot;阿狗&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;hobby&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;敲代码&quot;</span><span class="punctuation">,</span><span class="string">&quot;健身&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;map&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;0&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;黑鬼&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">19</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;salary&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">99.99</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;allPets&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;sick&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;heigui&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">20</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                      <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;tom&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">19</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;health&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;mario&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">29</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="2配置提示"><a href="#2配置提示" class="headerlink" title="2	配置提示"></a>2	配置提示</h2><p>自定义的类和配置文件绑定一般没有提示</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>打包的时候不要将它加入打包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h1 id="04Web开发"><a href="#04Web开发" class="headerlink" title="04	Web开发"></a>04	Web开发</h1><h2 id="devtools热部署"><a href="#devtools热部署" class="headerlink" title="devtools热部署"></a>devtools热部署</h2><p>导入对应的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">addResources</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addResources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置热部署，idea配置</p>
<p><img src="E:\学习笔记\图片\image-20230205155558610.png" alt="image-20230205155558610"></p>
<p><strong>使用</strong>：点击锤子或者ctrl+F9</p>
<p><img src="https://img-blog.csdnimg.cn/20210717151854320.png" alt="在这里插入图片描述"></p>
<h2 id="一、SpringMVC自动配置概览"><a href="#一、SpringMVC自动配置概览" class="headerlink" title="一、SpringMVC自动配置概览"></a>一、SpringMVC自动配置概览</h2><p><strong>官网原话</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717151904730.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>翻译</p>
<p>Spring Boot provides auto-configuration for Spring MVC that <strong>works well with most applications.(大多场景我们都无需自定义配置)</strong></p>
<p>The auto-configuration adds the following features on top of Spring’s defaults:</p>
<ul>
<li><p>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</p>
<p>内容协商视图解析器和BeanName视图解析器</p>
</li>
<li><p>Support for serving static resources, including support for WebJars (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-static-content">later in this document</a>)).</p>
<p>静态资源（包括webjars）</p>
</li>
<li><p>Automatic registration of <code>Converter</code>, <code>GenericConverter</code>, and <code>Formatter</code> beans.</p>
<p>自动注册 <code>Converter，GenericConverter，Formatter </code></p>
</li>
<li><p>Support for <code>HttpMessageConverters</code> (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-message-converters">later in this document</a>).</p>
<p>支持 <code>HttpMessageConverters</code> （后来我们配合内容协商理解原理）</p>
</li>
<li><p>Automatic registration of <code>MessageCodesResolver</code> (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-message-codes">later in this document</a>).</p>
<p>自动注册 <code>MessageCodesResolver</code> （国际化用）</p>
</li>
<li><p>Static <code>index.html</code> support.</p>
<p>静态index.html 页支持</p>
</li>
<li><p>Custom <code>Favicon</code> support (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-favicon">later in this document</a>).</p>
<p>自定义 <code>Favicon</code>  </p>
</li>
<li><p>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc-web-binding-initializer">later in this document</a>).</p>
<p>自动使用 <code>ConfigurableWebBindingInitializer</code> ，（DataBinder负责将请求数据绑定到JavaBean上）</p>
</li>
</ul>
<p>If you want to keep those Spring Boot MVC customizations and make more <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.9.RELEASE/spring-framework-reference/web.html#mvc">MVC customizations</a> (interceptors, formatters, view controllers, and other features), you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurer</code> but <strong>without</strong> <code>@EnableWebMvc</code>.</p>
<p><strong>不用@EnableWebMvc注解。使用</strong> <code>**@Configuration**</code> <strong>+</strong> <code>**WebMvcConfigurer**</code> <strong>自定义规则</strong></p>
<p>If you want to provide custom instances of <code>RequestMappingHandlerMapping</code>, <code>RequestMappingHandlerAdapter</code>, or <code>ExceptionHandlerExceptionResolver</code>, and still keep the Spring Boot MVC customizations, you can declare a bean of type <code>WebMvcRegistrations</code> and use it to provide custom instances of those components.</p>
<p><strong>声明</strong> <code>**WebMvcRegistrations**</code> <strong>改变默认底层组件</strong></p>
<p>If you want to take complete control of Spring MVC, you can add your own <code>@Configuration</code> annotated with <code>@EnableWebMvc</code>, or alternatively add your own <code>@Configuration</code>-annotated <code>DelegatingWebMvcConfiguration</code> as described in the Javadoc of <code>@EnableWebMvc</code>.</p>
<p><strong>使用</strong> <code>**@EnableWebMvc+@Configuration+DelegatingWebMvcConfiguration 全面接管SpringMVC**</code></p>
<h2 id="二、简单功能分析"><a href="#二、简单功能分析" class="headerlink" title="二、简单功能分析"></a>二、简单功能分析</h2><h3 id="1-静态资源访问"><a href="#1-静态资源访问" class="headerlink" title="1.静态资源访问"></a>1.静态资源访问</h3><h4 id="①静态资源目录"><a href="#①静态资源目录" class="headerlink" title="①静态资源目录"></a>①静态资源目录</h4><p><img src="https://img-blog.csdnimg.cn/20210717151916917.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70"></p>
<p>静态资源默认放在&#x2F;static、&#x2F;public、&#x2F;resources、&#x2F;META-INF&#x2F;resources目录下都可以访问到</p>
<p>访问路径：当前项目路径 + 资源名</p>
<p><strong>注意</strong>：如果controller中有和资源名一样的访问路径，先给controller进行处理，如果controller不能处理，才到静态资源管理器来进行处理</p>
<p>在static目录下放入名为static.jpg的资源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/static.jpg&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">str</span> <span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717151930242.png" alt="在这里插入图片描述"></p>
<p>可以看到我们访问的是controller</p>
<h4 id="②静态资源访问前缀"><a href="#②静态资源访问前缀" class="headerlink" title="②静态资源访问前缀"></a>②静态资源访问前缀</h4><p>默认无前缀</p>
<p>从官方文档中我们知道默认路径是<code>/**</code>，我们可以通过<code>spring.mvc.static-path-pattern</code>属性来修改默认的映射路径</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">static-path-pattern:</span> <span class="string">/res/**</span></span><br></pre></td></tr></table></figure>

<p><strong>测试</strong><br><img src="https://img-blog.csdnimg.cn/20210717151943239.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>注意</strong>：我们改变默认映射路径后会引发<code>欢迎页</code>支持和<code>自定义Favicon</code>使用不了，在原理讲解的时候会知道为什么用不了</p>
<p><strong>我们还可以修改默认的目录</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">web:</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">static-locations:</span> [<span class="string">classpath:/xiaozhi/</span>]</span><br></pre></td></tr></table></figure>
<p>设置这个之后我们的默认目录就不能使用了，只能使用我们自定义的<br><img src="https://img-blog.csdnimg.cn/20210717151952528.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210717151959670.png" alt="在这里插入图片描述"></p>
<h4 id="③webjar"><a href="#③webjar" class="headerlink" title="③webjar"></a>③webjar</h4><p>自动映射到&#x2F;webjars&#x2F;**</p>
<p><a target="_blank" rel="noopener" href="https://www.webjars.org/">https://www.webjars.org/</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>访问地址</strong>：<a target="_blank" rel="noopener" href="http://localhost:8080/webjars/jquery/3.5.1/jquery.js">http://localhost:8080/webjars/jquery/3.5.1/jquery.js</a></p>
<h3 id="2-欢迎页支持"><a href="#2-欢迎页支持" class="headerlink" title="2.欢迎页支持"></a>2.欢迎页支持</h3><p>在静态资源目录下创建index.html文件，springBoot会自动映射</p>
<p><strong>注意</strong>：如果自定义了资源映射路径，那么就不起作用了，修改默认资源路径不影响欢迎页支持</p>
<h3 id="3-自定义Favicon"><a href="#3-自定义Favicon" class="headerlink" title="3.自定义Favicon"></a>3.自定义Favicon</h3><p>favicon.ico 放在静态资源目录下即可。</p>
<h3 id="4-静态资源配置原理"><a href="#4-静态资源配置原理" class="headerlink" title="4.静态资源配置原理"></a>4.静态资源配置原理</h3><p><strong>我们的自动配置都在xxxAutoConfiguration 类 （自动配置类）中</strong></p>
<p>这个是跟web功能相关的，我们去WebMvcAutoConfiguration查找相应的配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123; DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">		ValidationAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> &#123;</span><br></pre></td></tr></table></figure>

<p><code>@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</code>：没有WebMvcConfigurationSupport类型的bean的时候才生效，也就是说我们可以完全自定义。</p>
<p><strong>给容器配置了什么</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span>	<span class="comment">// 配置类</span></span><br><span class="line"><span class="meta">@Import(EnableWebMvcConfiguration.class)</span>	<span class="comment">// 导入对应的组件</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123; WebMvcProperties.class,	</span></span><br><span class="line"><span class="meta">      org.springframework.boot.autoconfigure.web.ResourceProperties.class, WebProperties.class &#125;)</span></span><br><span class="line"><span class="meta">@Order(0)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfigurationAdapter</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span>, ServletContextAware &#123;</span><br></pre></td></tr></table></figure>

<p>配置文件的相关属性和配置文件进行了绑定：<br><img src="https://img-blog.csdnimg.cn/20210717152023116.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210717152030655.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210717152037780.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-EmK7baXk-1626505674342)(../../Java学习/截图/image-20210621162829287.png)]"></p>
<h4 id="①配置类中只有一个有参构造"><a href="#①配置类中只有一个有参构造" class="headerlink" title="①配置类中只有一个有参构造"></a>①配置类中只有一个有参构造</h4><p>&#x2F;&#x2F; 有参构造所有参数的值都会从容器中找</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resourceProperties	获取配置文件中绑定的值</span></span><br><span class="line"><span class="comment">// webProperties		获取配置文件中绑定的值</span></span><br><span class="line"><span class="comment">// mvcProperties		获取配置文件中绑定的值</span></span><br><span class="line"><span class="comment">// beanFactory			spring的beanFactory</span></span><br><span class="line"><span class="comment">// messageConvertersProvider	找到所有的HttpMessageConverters</span></span><br><span class="line"><span class="comment">// resourceHandlerRegistrationCustomizerProvider	找到资源处理器的自定义器</span></span><br><span class="line"><span class="comment">// dispatcherServletPath</span></span><br><span class="line"><span class="comment">// servletRegistrations		给应用注册Servlet、Filter....</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">WebMvcAutoConfigurationAdapter</span><span class="params">(</span></span><br><span class="line"><span class="params">    org.springframework.boot.autoconfigure.web.ResourceProperties resourceProperties,</span></span><br><span class="line"><span class="params">    WebProperties webProperties, </span></span><br><span class="line"><span class="params">    WebMvcProperties mvcProperties, </span></span><br><span class="line"><span class="params">    ListableBeanFactory beanFactory,</span></span><br><span class="line"><span class="params">    ObjectProvider&lt;HttpMessageConverters&gt; messageConvertersProvider,</span></span><br><span class="line"><span class="params">    ObjectProvider&lt;ResourceHandlerRegistrationCustomizer&gt; resourceHandlerRegistrationCustomizerProvider,</span></span><br><span class="line"><span class="params">    ObjectProvider&lt;DispatcherServletPath&gt; dispatcherServletPath,</span></span><br><span class="line"><span class="params">    ObjectProvider&lt;ServletRegistrationBean&lt;?&gt;&gt; servletRegistrations)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.resourceProperties = resourceProperties.hasBeenCustomized() ? resourceProperties</span><br><span class="line">        : webProperties.getResources();</span><br><span class="line">    <span class="built_in">this</span>.mvcProperties = mvcProperties;</span><br><span class="line">    <span class="built_in">this</span>.beanFactory = beanFactory;</span><br><span class="line">    <span class="built_in">this</span>.messageConvertersProvider = messageConvertersProvider;</span><br><span class="line">    <span class="built_in">this</span>.resourceHandlerRegistrationCustomizer = resourceHandlerRegistrationCustomizerProvider.getIfAvailable();</span><br><span class="line">    <span class="built_in">this</span>.dispatcherServletPath = dispatcherServletPath;</span><br><span class="line">    <span class="built_in">this</span>.servletRegistrations = servletRegistrations;</span><br><span class="line">    <span class="built_in">this</span>.mvcProperties.checkConfiguration();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="②资源处理的默认规则"><a href="#②资源处理的默认规则" class="headerlink" title="②资源处理的默认规则"></a>②资源处理的默认规则</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (!<span class="built_in">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">      logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   addResourceHandler(registry, <span class="string">&quot;/webjars/**&quot;</span>, <span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">   addResourceHandler(registry, <span class="built_in">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;</span><br><span class="line">      registration.addResourceLocations(<span class="built_in">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.servletContext != <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="type">ServletContextResource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextResource</span>(<span class="built_in">this</span>.servletContext, SERVLET_LOCATION);</span><br><span class="line">         registration.addResourceLocations(resource);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个就是处理我们静态资源的方法</p>
<p><img src="https://img-blog.csdnimg.cn/20210717155913222.png" alt="在这里插入图片描述"></p>
<p>&#x3D;&#x3D;也就是说我们把这个值调为true，这个方法就不会执行，也就是禁用了默认的规则&#x3D;&#x3D;</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="comment">#  mvc:</span></span><br><span class="line">  <span class="comment">#    static-path-pattern: /res/**</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">add-mappings:</span> <span class="literal">false</span>	<span class="comment"># 禁用所有静态资源规则</span></span><br></pre></td></tr></table></figure>

<p>dubug进行调试，结果和我们想的一样，它直接结束了方法</p>
<p>我们看一下默认的静态资源规则的运行原理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    addResourceHandler(registry, <span class="string">&quot;/webjars/**&quot;</span>, <span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">    addResourceHandler(registry, <span class="built_in">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;</span><br><span class="line">        registration.addResourceLocations(<span class="built_in">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.servletContext != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">ServletContextResource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextResource</span>(<span class="built_in">this</span>.servletContext, SERVLET_LOCATION);</span><br><span class="line">            registration.addResourceLocations(resource);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行第一个<code>addResourceHandler</code>方法就是设置webjars的访问路径和映射路径</p>
<p><img src="https://img-blog.csdnimg.cn/2021071715205443.png" alt="在这里插入图片描述"></p>
<p>第二个<code>addResourceHandler</code>方法就是设置我们其他的静态资源路径，可以看到有两个属性是绑定了我们的配置文件，我们可以debug来查看一下对应的值</p>
<p><img src="https://img-blog.csdnimg.cn/20210717152105878.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210717152115444.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>我们现在知道了我们默认的访问路径是在WebProperties类下的内部类Resources中的属性<br><img src="https://img-blog.csdnimg.cn/20210717152129617.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210717152136937.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70"></p>
<p>我们再回到我们的配置文件<br><img src="https://img-blog.csdnimg.cn/20210717152153456.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>&#x3D;&#x3D;<strong>拓展一下</strong>&#x3D;&#x3D;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addResourceHandler</span><span class="params">(ResourceHandlerRegistry registry, String pattern,</span></span><br><span class="line"><span class="params">      Consumer&lt;ResourceHandlerRegistration&gt; customizer)</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (registry.hasMappingForPattern(pattern)) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">ResourceHandlerRegistration</span> <span class="variable">registration</span> <span class="operator">=</span> registry.addResourceHandler(pattern);</span><br><span class="line">   customizer.accept(registration);</span><br><span class="line">   registration.setCachePeriod(getSeconds(<span class="built_in">this</span>.resourceProperties.getCache().getPeriod()));</span><br><span class="line">   registration.setCacheControl(<span class="built_in">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl());</span><br><span class="line">   registration.setUseLastModified(<span class="built_in">this</span>.resourceProperties.getCache().isUseLastModified());</span><br><span class="line">   customizeResourceHandlerRegistration(registration);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个方法中有三个set方法，这个就是可以设置静态资源的信息，也都是绑定了我们的配置文件，我们可以通过配置文件来修改对应的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 缓存时间，以s为单位</span></span><br><span class="line">registration.setCachePeriod(getSeconds(<span class="built_in">this</span>.resourceProperties.getCache().getPeriod()));</span><br><span class="line"><span class="comment">// 缓存控制器</span></span><br><span class="line">registration.setCacheControl(<span class="built_in">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl());</span><br><span class="line"><span class="comment">// 是否设置文件(也就是静态资源文件)最后修改的日期和时间 </span></span><br><span class="line">registration.setUseLastModified(<span class="built_in">this</span>.resourceProperties.getCache().isUseLastModified());</span><br></pre></td></tr></table></figure>

<p>我们来验证我们的假设，在配置文件中看看是否存在<br><img src="https://img-blog.csdnimg.cn/20210717152201895.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>我们到浏览器查看一下是否有修改<br><img src="https://img-blog.csdnimg.cn/20210717152211234.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>可以看到确实是可以的！</p>
<h4 id="③欢迎页处理规则"><a href="#③欢迎页处理规则" class="headerlink" title="③欢迎页处理规则"></a>③欢迎页处理规则</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title function_">welcomePageHandlerMapping</span><span class="params">(ApplicationContext applicationContext,</span></span><br><span class="line"><span class="params">                                                           FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider)</span> &#123;</span><br><span class="line">    <span class="type">WelcomePageHandlerMapping</span> <span class="variable">welcomePageHandlerMapping</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WelcomePageHandlerMapping</span>(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">TemplateAvailabilityProviders</span>(applicationContext), applicationContext, getWelcomePage(),</span><br><span class="line">        <span class="built_in">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">    welcomePageHandlerMapping.setInterceptors(getInterceptors(mvcConversionService, mvcResourceUrlProvider));</span><br><span class="line">    welcomePageHandlerMapping.setCorsConfigurations(getCorsConfigurations());</span><br><span class="line">    <span class="keyword">return</span> welcomePageHandlerMapping;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构造器中进行路径校验</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">WelcomePageHandlerMapping(TemplateAvailabilityProviders templateAvailabilityProviders,</span><br><span class="line">			ApplicationContext applicationContext, Resource welcomePage, String staticPathPattern) &#123;</span><br><span class="line">    <span class="keyword">if</span> (welcomePage != <span class="literal">null</span> &amp;&amp; <span class="string">&quot;/**&quot;</span>.equals(staticPathPattern)) &#123;</span><br><span class="line">        <span class="comment">// 满足条件，使用欢迎页</span></span><br><span class="line">        logger.info(<span class="string">&quot;Adding welcome page: &quot;</span> + welcomePage);</span><br><span class="line">        setRootViewName(<span class="string">&quot;forward:index.html&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (welcomeTemplateExists(templateAvailabilityProviders, applicationContext)) &#123;</span><br><span class="line">        <span class="comment">// 调用controller		/index</span></span><br><span class="line">        logger.info(<span class="string">&quot;Adding welcome page template: index&quot;</span>);</span><br><span class="line">        setRootViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>判断是不是在&#x2F;**路径下的，如果你设置了static-locations属性它也是相当于映射到根目录下的，所以当我们设置路径前缀的时候，欢迎页就会使用不了。只有index.html在 <code>/**</code>下才能使用欢迎页</p>
<h4 id="④Favicon"><a href="#④Favicon" class="headerlink" title="④Favicon"></a>④Favicon</h4><p>服务器默认是将&#x2F;**路径下的图标发送给浏览器</p>
<h2 id="三、请求参数处理"><a href="#三、请求参数处理" class="headerlink" title="三、请求参数处理"></a>三、请求参数处理</h2><h3 id="1-请求映射"><a href="#1-请求映射" class="headerlink" title="1.请求映射"></a>1.请求映射</h3><h4 id="①rest使用"><a href="#①rest使用" class="headerlink" title="①rest使用"></a>①rest使用</h4><ul>
<li>格式：@xxxMapping;</li>
<li>rest风格支持（使用HTTP请求方式动词来表示对资源的操作）<ul>
<li><em>以前：</em><em>&#x2F;getUser</em>  <em>获取用户</em>    <em>&#x2F;deleteUser</em> <em>删除用户</em>   <em>&#x2F;editUser</em>  <em>修改用户</em>      <em>&#x2F;saveUser</em> <em>保存用户</em></li>
<li><em>现在： &#x2F;user</em>    *GET-*<em>获取用户</em>    *DELETE-*<em>删除用户</em>     *PUT-*<em>修改用户</em>      *POST-*<em>保存用户</em></li>
</ul>
</li>
<li>使用：表单使用post请求提交，hidden隐藏域中_method&#x3D;put</li>
<li>需要我们手动开启rest风格</li>
</ul>
<p><strong>代码实现</strong></p>
<p>html页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/test&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Post&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/test&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/test&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;put&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;put&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/test&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;delete&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;delete&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>java代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">post</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;post&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;get&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@PutMapping(&quot;test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">put</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;put&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">delete</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;delete&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们还要手动开启rest风格，不开启的话一律当Post请求处理</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">hiddenmethod:</span></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>



<h4 id="②rest原理解析"><a href="#②rest原理解析" class="headerlink" title="②rest原理解析"></a>②rest原理解析</h4><p>在我们的WebMvcAutoConfiguration类下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(HiddenHttpMethodFilter.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc.hiddenmethod.filter&quot;, name = &quot;enabled&quot;)</span></span><br><span class="line"><span class="keyword">public</span> OrderedHiddenHttpMethodFilter <span class="title function_">hiddenHttpMethodFilter</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderedHiddenHttpMethodFilter</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们看到它绑定了配置文件，官方默认是关闭的，所以我们需要手动开启</p>
<p><img src="https://img-blog.csdnimg.cn/20210717152234646.png" alt="在这里插入图片描述"></p>
<p>创建了一个OrderedHiddenHttpMethodFilter对象，它又实现了OrderedFilter，而OrderedFilter又是继承了Filter接口，所以我们它就是一个拦截器，我们通过源码来看一下它的功能是什么</p>
<p>在<code>HiddenHttpMethodFilter</code>类下有一个方法，这个方法就是它的核心方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span></span><br><span class="line">      <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">   <span class="type">HttpServletRequest</span> <span class="variable">requestToUse</span> <span class="operator">=</span> request;</span><br><span class="line">	<span class="comment">// 判断是否是post请求类型，没有发生异常</span></span><br><span class="line">   <span class="keyword">if</span> (<span class="string">&quot;POST&quot;</span>.equals(request.getMethod()) &amp;&amp; request.getAttribute(WebUtils.ERROR_EXCEPTION_ATTRIBUTE) == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// 默认是得到我们隐藏域_method中的参数</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">paramValue</span> <span class="operator">=</span> request.getParameter(<span class="built_in">this</span>.methodParam);</span><br><span class="line">      <span class="keyword">if</span> (StringUtils.hasLength(paramValue)) &#123;</span><br><span class="line">          <span class="comment">// 将得到的值转换成大写的</span></span><br><span class="line">         <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> paramValue.toUpperCase(Locale.ENGLISH);</span><br><span class="line">          <span class="comment">// 判断是否有这个类型的方法</span></span><br><span class="line">         <span class="keyword">if</span> (ALLOWED_METHODS.contains(method)) &#123;</span><br><span class="line">             <span class="comment">// 将得到的方法值进行包装，返回一个HttpServletRequestWrapper对象</span></span><br><span class="line">            requestToUse = <span class="keyword">new</span> <span class="title class_">HttpMethodRequestWrapper</span>(request, method);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">// 过滤器放行，我们用的request对象是我们修改过的，getMethod方法得到的就是我们传入的值</span></span><br><span class="line">   filterChain.doFilter(requestToUse, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>详细展开说明</strong></p>
<p>我们调用<code>this.methodParam</code>就是DEFAULT_METHOD_PARAM常量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_METHOD_PARAM</span> <span class="operator">=</span> <span class="string">&quot;_method&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">methodParam</span> <span class="operator">=</span> DEFAULT_METHOD_PARAM;</span><br></pre></td></tr></table></figure>

<p><code>ALLOWED_METHODS.contains(method)</code>的意思是判断是否包含下面其中的一个</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; ALLOWED_METHODS =</span><br><span class="line">			Collections.unmodifiableList(Arrays.asList(HttpMethod.PUT.name(),</span><br><span class="line">					HttpMethod.DELETE.name(), HttpMethod.PATCH.name()));</span><br></pre></td></tr></table></figure>

<p>创建<code>HttpMethodRequestWrapper</code>对象进行返回</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">HttpMethodRequestWrapper</span> <span class="keyword">extends</span> <span class="title class_">HttpServletRequestWrapper</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> String method;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">HttpMethodRequestWrapper</span><span class="params">(HttpServletRequest request, String method)</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>(request);</span><br><span class="line">      <span class="built_in">this</span>.method = method;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getMethod</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.method;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它的作用就是将method设为我们参数值，然后交给我们的过滤器链放行，我们之后使用getMethod()方法得到的就是我们传入的值</p>
<h4 id="③拓展-修改默认的隐藏域名"><a href="#③拓展-修改默认的隐藏域名" class="headerlink" title="③拓展:修改默认的隐藏域名"></a>③拓展:修改默认的隐藏域名</h4><p>我们可以自己注册一个<code>HiddenHttpMethodFilter</code> 组件来设置我们想要的名字</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HiddenHttpMethodFilter <span class="title function_">hiddenHttpMethodFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">HiddenHttpMethodFilter</span> <span class="variable">hiddenHttpMethodFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HiddenHttpMethodFilter</span>();</span><br><span class="line">        hiddenHttpMethodFilter.setMethodParam(<span class="string">&quot;_h&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> hiddenHttpMethodFilter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20210717152246500.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="2-请求映射原理"><a href="#2-请求映射原理" class="headerlink" title="2.请求映射原理"></a>2.请求映射原理</h3><p><code>DispatcherServlet</code>是处理我们请求映射的，下面是它的结构树</p>
<p><img src="https://img-blog.csdnimg.cn/20210717152255215.png" alt="在这里插入图片描述"></p>
<p>它是一个servlet程序，那么就会有<code>doGet()</code>和<code>doPost()</code>方法，我们最终的请求会执行这两个方法</p>
<p><code>HttpServletBean</code>中并没有这两个方法，我们接着往下找，在FrameworkServlet找到了这两个方法</p>
<p><img src="https://img-blog.csdnimg.cn/20210717152303468.png" alt="在这里插入图片描述"></p>
<p>执行这个方法，我们点进去查看一下</p>
<p>processRequest(request, response);方法中有一个核心方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">doService(request, response);</span><br></pre></td></tr></table></figure>

<p>这个方法的具体实现是在DispatcherServlet类中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br></pre></td></tr></table></figure>

<p>在这个方法中还有一个核心方法，这个方法才是我们的具体实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	doDispatch(request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终调用这个核心方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717152312809.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>我们可以debug计算一下得到的值</p>
<p><img src="https://img-blog.csdnimg.cn/20210717152321686.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>这个方法的作用就是得到处理这个请求的是哪个方法</p>
<p>我们再点进去看一下getHandler(processedRequest)方法的具体实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> HandlerExecutionChain <span class="title function_">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.handlerMappings != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 将映射信息进行遍历</span></span><br><span class="line">        <span class="keyword">for</span> (HandlerMapping mapping : <span class="built_in">this</span>.handlerMappings) &#123;</span><br><span class="line">            <span class="comment">// 判断映射处理器是否可以处理当前请求，可以就返回HandlerExecutionChain对象，不能就返回null</span></span><br><span class="line">            <span class="type">HandlerExecutionChain</span> <span class="variable">handler</span> <span class="operator">=</span> mapping.getHandler(request);</span><br><span class="line">            <span class="keyword">if</span> (handler != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> handler;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20210717152330735.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>&#x3D;&#x3D;这些映射信息是springBoot在启动的时候就已经帮我们封装到HandlerMapping中了&#x3D;&#x3D;</strong></p>
<p><strong><code>RequestMappingHandlerMapping</code>是标注了@RequestMapping 注解的方法的映射</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717152340834.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong><code>WelcomePageHandlerMapping</code>是首页的映射</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717152347287.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70"></p>
<p><strong>&#x3D;&#x3D;继续往下探究，我们看一下<code>mapping.getHandler(request);</code>方法做了那些事&#x3D;&#x3D;</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用了下面这个方法</span></span><br><span class="line">getHandlerInternal(request);</span><br><span class="line"><span class="comment">// 方法返回下面执行的方法</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">super</span>.getHandlerInternal(request);</span><br><span class="line"><span class="comment">// 调用下面的方法得到返回的对象值</span></span><br><span class="line"><span class="type">HandlerMethod</span> <span class="variable">handlerMethod</span> <span class="operator">=</span> lookupHandlerMethod(lookupPath, request);</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20210717152358199.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> HandlerMethod <span class="title function_">lookupHandlerMethod</span><span class="params">(String lookupPath, HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    List&lt;Match&gt; matches = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 得到匹配的路径</span></span><br><span class="line">    List&lt;T&gt; directPathMatches = <span class="built_in">this</span>.mappingRegistry.getMappingsByDirectPath(lookupPath);</span><br><span class="line">    <span class="keyword">if</span> (directPathMatches != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 得到最匹配的那个，然后放入到集合中</span></span><br><span class="line">        addMatchingMappings(directPathMatches, matches, request);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (matches.isEmpty()) &#123;</span><br><span class="line">        addMatchingMappings(<span class="built_in">this</span>.mappingRegistry.getRegistrations().keySet(), matches, request);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!matches.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// 得到集合中的第一个值</span></span><br><span class="line">        <span class="type">Match</span> <span class="variable">bestMatch</span> <span class="operator">=</span> matches.get(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 如果有多个请求匹配，它会报异常</span></span><br><span class="line">        <span class="keyword">if</span> (matches.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            Comparator&lt;Match&gt; comparator = <span class="keyword">new</span> <span class="title class_">MatchComparator</span>(getMappingComparator(request));</span><br></pre></td></tr></table></figure>



<h3 id="3-参数与基本注解"><a href="#3-参数与基本注解" class="headerlink" title="3.参数与基本注解"></a>3.参数与基本注解</h3><h4 id="3-1-注解"><a href="#3-1-注解" class="headerlink" title="3.1 注解"></a>3.1 注解</h4><p>requile属性是判断这个参数是不是必须的，false表示这个参数不是必须的</p>
<p>@PathVariable、@RequestHeader、@ModelAttribute、@RequestParam、@MatrixVariable、@CookieValue、@RequestBody</p>
<h5 id="①-PathVariable"><a href="#①-PathVariable" class="headerlink" title="①@PathVariable"></a>①@PathVariable</h5><p>得到请求路径变量的参数值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/test/&#123;name&#125;/&#123;age&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">pathVariable</span><span class="params">(<span class="meta">@PathVariable</span> String name,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@PathVariable</span> Integer age,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@PathVariable</span> Map&lt;String, String&gt; paramMap)</span> &#123;</span><br><span class="line">    <span class="comment">// 还可以用map&lt;String, String&gt;接收值</span></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">    map.put(<span class="string">&quot;age&quot;</span>, age);</span><br><span class="line">    map.put(<span class="string">&quot;paramMap&quot;</span>, paramMap);</span><br><span class="line">    <span class="keyword">return</span> map; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20210717152408710.png" alt="在这里插入图片描述"></p>
<h5 id="②-RequestHeader"><a href="#②-RequestHeader" class="headerlink" title="②@RequestHeader"></a>②@RequestHeader</h5><p>得到请求头参数的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/test/requestHeader&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">requestHeader</span><span class="params">(<span class="meta">@RequestHeader(&quot;Accept&quot;)</span> String accept,</span></span><br><span class="line"><span class="params">                                         <span class="meta">@RequestHeader</span> Map&lt;String, String&gt; paramMap )</span> &#123;</span><br><span class="line">    <span class="comment">// 使用map集合接收就是全部的请求头信息</span></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;paramMap&quot;</span>, paramMap);</span><br><span class="line">    map.put(<span class="string">&quot;accept&quot;</span>, accept);</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="③-ModelAttribute"><a href="#③-ModelAttribute" class="headerlink" title="③@ModelAttribute"></a>③@ModelAttribute</h5><p>获取请求域中的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/test/request&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">request</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">    request.setAttribute(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;小智&quot;</span>);</span><br><span class="line">    request.setAttribute(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;forward:/test/modelAttribute&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/test/modelAttribute&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">modelAttribute</span><span class="params">(<span class="meta">@ModelAttribute(&quot;name&quot;)</span> String name,</span></span><br><span class="line"><span class="params">                                          <span class="meta">@ModelAttribute(&quot;age&quot;)</span> String age)</span> &#123;</span><br><span class="line">    <span class="comment">// 不能使用map集合去接收参数，参数接收的类型一定是String类型的，不然会报错</span></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">    map.put(<span class="string">&quot;age&quot;</span>, age);</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="④-RequestParam"><a href="#④-RequestParam" class="headerlink" title="④@RequestParam"></a>④@RequestParam</h5><p>得到请求参数值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/test/requestParam&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">requestParam</span><span class="params">(<span class="meta">@RequestParam(&quot;name&quot;)</span> String name,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@RequestParam(&quot;age&quot;)</span> String age,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@RequestParam</span> Map&lt;String, String&gt; paramMap)</span> &#123;</span><br><span class="line">    <span class="comment">// 可以用map&lt;String, String&gt;接收值</span></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">    map.put(<span class="string">&quot;age&quot;</span>, age);</span><br><span class="line">    map.put(<span class="string">&quot;paramMap&quot;</span>, paramMap);</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20210717152416974.png" alt="在这里插入图片描述"></p>
<h5 id="⑤-CookieValue"><a href="#⑤-CookieValue" class="headerlink" title="⑤@CookieValue"></a>⑤@CookieValue</h5><p>得到cookie的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/test/cookie&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">requestParam</span><span class="params">(<span class="meta">@CookieValue(&quot;Idea-4a5d61e4&quot;)</span> String value)</span> &#123;</span><br><span class="line">    <span class="comment">// 可以用map&lt;String, String&gt;接收值</span></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;value&quot;</span>, value);</span><br><span class="line">    <span class="keyword">return</span> map;     <span class="comment">// &#123;&quot;value&quot;:&quot;b6df2f01-c4d7-4866-a9bf-536b81d7af1f&quot;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="⑥-RequestBody"><a href="#⑥-RequestBody" class="headerlink" title="⑥@RequestBody"></a>⑥@RequestBody</h5><p>获得请求体的参数，Post请求才有请求体</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/test/responseBody&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">responseBody</span><span class="params">(<span class="meta">@RequestBody</span> String user)</span> &#123;</span><br><span class="line">    <span class="comment">// 可以用map&lt;String, String&gt;接收值</span></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;user&quot;</span>, user);</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/test/responseBody&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    账号<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">    密码<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;psw&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Post&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717152425458.png" alt="在这里插入图片描述"></p>
<h5 id="⑦-MatrixVariable"><a href="#⑦-MatrixVariable" class="headerlink" title="⑦@MatrixVariable"></a>⑦@MatrixVariable</h5><p>得到路径中矩阵变量</p>
<p><strong>语法</strong>：”；”后面的参数		</p>
<p>eg：&#x2F;cars&#x2F;sell;low&#x3D;34;brand&#x3D;byd,audi,yd		“；”后面的内容就是我们得到的参数值</p>
<ul>
<li>springBoot默认是关闭的，我们需要手动开启，我们源码探究它做了什么<ul>
<li>第一种开启方式：实现WebMvcConfigurer，因为处理矩形变量的方法是在这个类下的</li>
<li>使用@Bean注解直接将WebMvcConfigurer注入到容器中</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="comment">// 配置路径匹配</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (<span class="built_in">this</span>.mvcProperties.getPathmatch()</span><br><span class="line">         .getMatchingStrategy() == WebMvcProperties.MatchingStrategy.PATH_PATTERN_PARSER) &#123;</span><br><span class="line">      configurer.setPatternParser(<span class="keyword">new</span> <span class="title class_">PathPatternParser</span>());</span><br><span class="line">   &#125;</span><br><span class="line">   configurer.setUseSuffixPatternMatch(<span class="built_in">this</span>.mvcProperties.getPathmatch().isUseSuffixPattern());</span><br><span class="line">   configurer.setUseRegisteredSuffixPatternMatch(</span><br><span class="line">         <span class="built_in">this</span>.mvcProperties.getPathmatch().isUseRegisteredSuffixPattern());</span><br><span class="line">   <span class="built_in">this</span>.dispatcherServletPath.ifAvailable((dispatcherPath) -&gt; &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">servletUrlMapping</span> <span class="operator">=</span> dispatcherPath.getServletUrlMapping();</span><br><span class="line">      <span class="keyword">if</span> (servletUrlMapping.equals(<span class="string">&quot;/&quot;</span>) &amp;&amp; singleDispatcherServlet()) &#123;</span><br><span class="line">         <span class="comment">// UrlPathHelper类就是对针对URL进行处理</span></span><br><span class="line">         <span class="type">UrlPathHelper</span> <span class="variable">urlPathHelper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlPathHelper</span>();</span><br><span class="line">         urlPathHelper.setAlwaysUseFullPath(<span class="literal">true</span>);</span><br><span class="line">         configurer.setUrlPathHelper(urlPathHelper);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>UrlPathHelper类下<code>removeSemicolonContent</code>属性就是判断是否移除路径中分号(;)后面的的内容</p>
<ul>
<li>true：就是移除</li>
<li>false：不移除，开启矩形变量功能</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Whether configured to remove &quot;;&quot; (semicolon) content from the request URI.</span></span><br><span class="line"><span class="comment">   是否配置为删除“；”(请求URI中的内容。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">shouldRemoveSemicolonContent</span><span class="params">()</span> &#123;</span><br><span class="line">   checkReadOnly();</span><br><span class="line">   <span class="keyword">return</span> <span class="built_in">this</span>.removeSemicolonContent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>代码实现</strong></p>
<p><strong>开启</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="comment">// 第一种方式</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> &#123;</span><br><span class="line">        <span class="type">UrlPathHelper</span> <span class="variable">urlPathHelper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlPathHelper</span>();</span><br><span class="line">        urlPathHelper.setRemoveSemicolonContent(<span class="literal">false</span>);</span><br><span class="line">        configurer.setUrlPathHelper(urlPathHelper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第二种方式</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> &#123;</span><br><span class="line">                <span class="type">UrlPathHelper</span> <span class="variable">urlPathHelper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlPathHelper</span>();</span><br><span class="line">                urlPathHelper.setRemoveSemicolonContent(<span class="literal">false</span>);</span><br><span class="line">                configurer.setUrlPathHelper(urlPathHelper);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/test/&#123;path&#125;&quot;)</span></span><br><span class="line"><span class="comment">// 必须是在路径变量的后面接上</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">matrixVariable</span><span class="params">(<span class="meta">@MatrixVariable(&quot;cat&quot;)</span> String cat,</span></span><br><span class="line"><span class="params">                                          <span class="meta">@MatrixVariable(&quot;dog&quot;)</span> String dog,</span></span><br><span class="line"><span class="params">                                          <span class="meta">@PathVariable(&quot;path&quot;)</span> String path)</span> &#123;</span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;cat&quot;</span>, cat);</span><br><span class="line">    map.put(<span class="string">&quot;dog&quot;</span>, dog);</span><br><span class="line">    map.put(<span class="string">&quot;path&quot;</span>, path);</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取两个不同的路径变量后面相同的矩形变量值</span></span><br><span class="line">    <span class="comment">// 使用pathVar属性区分是获取哪一个路径变量后面的值</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/boss/&#123;bossId&#125;/&#123;empId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">matrixVariable2</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@MatrixVariable(value = &quot;age&quot;,pathVar = &quot;bossId&quot;)</span> String bossAge,</span></span><br><span class="line"><span class="params">        <span class="meta">@MatrixVariable(value = &quot;age&quot;,pathVar = &quot;empId&quot;)</span> String empAge,</span></span><br><span class="line"><span class="params">        <span class="meta">@PathVariable(&quot;bossId&quot;)</span> String bossId,</span></span><br><span class="line"><span class="params">        <span class="meta">@PathVariable(&quot;empId&quot;)</span> String empId)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;bossAge&quot;</span>, bossAge);</span><br><span class="line">        map.put(<span class="string">&quot;empAge&quot;</span>, empAge);</span><br><span class="line">        map.put(<span class="string">&quot;bossId&quot;</span>, bossId);</span><br><span class="line">        map.put(<span class="string">&quot;empId&quot;</span>, empId);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717152437259.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210717152445369.png" alt="在这里插入图片描述"></p>
<p>&#x3D;&#x3D;<strong>发现一个坑</strong>：<code>@GetMapping(&quot;/test/&#123;bossId&#125;/&#123;empId&#125;&quot;)</code>和<code>@GetMapping(&quot;/test/&#123;path&#125;&quot;)</code>两个同时存在会报错，我们修改一下第一个路径为<code>/boss/&#123;bossId&#125;/&#123;empId&#125;</code>就又可以正常访问了，如果非要使用&#x2F;test前缀的话也可以在两个路径变量中间再加一个值，例如：<code>/test/&#123;bossId&#125;/test/&#123;empId&#125;</code>即可&#x3D;&#x3D;</p>
<h4 id="3-2-注解原理"><a href="#3-2-注解原理" class="headerlink" title="3.2 注解原理"></a>3.2 注解原理</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/test/RequestHeader&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">RequestHeader</span><span class="params">(<span class="meta">@RequestHeader(&quot;Accept&quot;)</span> String accept,</span></span><br><span class="line"><span class="params">                                         <span class="meta">@RequestHeader</span> Map&lt;String, String&gt; paramMap )</span> &#123;</span><br><span class="line">    <span class="comment">// 使用map集合接收就是全部的请求头信息</span></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;paramMap&quot;</span>, paramMap);</span><br><span class="line">    map.put(<span class="string">&quot;accept&quot;</span>, accept);</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们之前说过mappedHandler是映射处理器，找到对应处理请求的方法，将方法的信息进行封装</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HandlerAdapter</span> <span class="variable">ha</span> <span class="operator">=</span> getHandlerAdapter(mappedHandler.getHandler());</span><br></pre></td></tr></table></figure>

<ul>
<li>HandlerAdapter（处理程序适配器）是一个接口<ul>
<li>supports方法判断有没有分解器可以处理这个参数，有就true</li>
<li>handle方法处理</li>
</ul>
</li>
</ul>
<p>调用HandlerAdapter中的handle()方法来执行方法，debug看它做了什么</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> ModelAndView <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class="line">      <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> handleInternal(request, response, (HandlerMethod) handler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用方法得到返回值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mav = invokeHandlerMethod(request, response, handlerMethod);	<span class="comment">// 核心方法</span></span><br><span class="line"><span class="comment">// invokeHandlerMethod中的核心方法</span></span><br><span class="line">invocableMethod.invokeAndHandle(webRequest, mavContainer);</span><br><span class="line"><span class="comment">// 最终来到真正执行方法的方法</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span> invokeForRequest(webRequest, mavContainer, providedArgs);</span><br><span class="line"><span class="comment">// invokeForRequest方法中的核心方法，得到参数值</span></span><br><span class="line">Object[] args = getMethodArgumentValues(request, mavContainer, providedArgs);</span><br><span class="line"><span class="comment">// 这个方法它是在一个循环里面的，循环的次数就是我们参数的个数，它会匹配能解析这个参数的参数解析器，然后进行解析得到匹配的值</span></span><br><span class="line">args[i] = <span class="built_in">this</span>.resolvers.resolveArgument(parameter, mavContainer, request, <span class="built_in">this</span>.dataBinderFactory);</span><br></pre></td></tr></table></figure>

<p>往下执行这个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> HandlerMethodArgumentResolver <span class="title function_">getArgumentResolver</span><span class="params">(MethodParameter parameter)</span> &#123;</span><br><span class="line">    <span class="comment">// 得到缓存中的参数解析器</span></span><br><span class="line">   <span class="type">HandlerMethodArgumentResolver</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.argumentResolverCache.get(parameter);</span><br><span class="line">    <span class="comment">// 第一次为空</span></span><br><span class="line">   <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (HandlerMethodArgumentResolver resolver : <span class="built_in">this</span>.argumentResolvers) &#123;</span><br><span class="line">          <span class="comment">// 遍历能够处理方法参数的参数解析器</span></span><br><span class="line">         <span class="keyword">if</span> (resolver.supportsParameter(parameter)) &#123;</span><br><span class="line">             <span class="comment">// 可以处理，那么就结束</span></span><br><span class="line">            result = resolver;</span><br><span class="line">             <span class="comment">// 放入到缓存中，下次就可以直接使用缓存中的参数解析器了</span></span><br><span class="line">            <span class="built_in">this</span>.argumentResolverCache.put(parameter, result);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717152456537.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-5sLxcXVU-1626505674356)(../../Java学习/截图/image-20210623214257091.png)]"><br>每个参数解析器都有对应的规则，这个可以debug进行查看它的执行规则<br><img src="https://img-blog.csdnimg.cn/20210717152509646.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70"><br>得到参数后就可以执行方法了</p>
<p><img src="https://img-blog.csdnimg.cn/20210717152525138.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="4-ServletApi"><a href="#4-ServletApi" class="headerlink" title="4.ServletApi"></a>4.ServletApi</h4><p>WebRequest、ServletRequest、MultipartRequest、 HttpSession、javax.servlet.http.PushBuilder、Principal、InputStream、Reader、HttpMethod、Locale、TimeZone、ZoneId</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsParameter</span><span class="params">(MethodParameter parameter)</span> &#123;</span><br><span class="line">    Class&lt;?&gt; paramType = parameter.getParameterType();</span><br><span class="line">    <span class="keyword">return</span> (WebRequest.class.isAssignableFrom(paramType) ||</span><br><span class="line">        ServletRequest.class.isAssignableFrom(paramType) ||</span><br><span class="line">        MultipartRequest.class.isAssignableFrom(paramType) ||</span><br><span class="line">        HttpSession.class.isAssignableFrom(paramType) ||</span><br><span class="line">        (pushBuilder != <span class="literal">null</span> &amp;&amp; pushBuilder.isAssignableFrom(paramType)) ||</span><br><span class="line">        Principal.class.isAssignableFrom(paramType) ||</span><br><span class="line">        InputStream.class.isAssignableFrom(paramType) ||</span><br><span class="line">        Reader.class.isAssignableFrom(paramType) ||</span><br><span class="line">        HttpMethod.class == paramType ||</span><br><span class="line">        Locale.class == paramType ||</span><br><span class="line">        TimeZone.class == paramType ||</span><br><span class="line">        ZoneId.class == paramType);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h4 id="5-复杂参数"><a href="#5-复杂参数" class="headerlink" title="5.复杂参数"></a>5.复杂参数</h4><p><strong>Map</strong>、<strong>Model（map、model里面的数据会被放在request的请求域  request.setAttribute）、</strong>Errors&#x2F;BindingResult、<strong>RedirectAttributes（ 重定向携带数据）</strong>、<strong>ServletResponse（response）</strong>、SessionStatus、UriComponentsBuilder、ServletUriComponentsBuilder</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,Object&gt; map,  Model model, HttpServletRequest request 都是可以给request域中放数据request.getAttribute();</span><br></pre></td></tr></table></figure>







<h4 id="6-自定义类型参数-封装POJO"><a href="#6-自定义类型参数-封装POJO" class="headerlink" title="6.自定义类型参数 封装POJO"></a>6.自定义类型参数 封装POJO</h4><p>将数据封装到pojo中</p>
<p><strong>ServletModelAttributeMethodProcessor  这个参数处理器支持</strong></p>
<p> <strong>是否为简单类型。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isSimpleValueType</span><span class="params">(Class&lt;?&gt; type)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (Void.class != type &amp;&amp; <span class="keyword">void</span>.class != type &amp;&amp;</span><br><span class="line">        (ClassUtils.isPrimitiveOrWrapper(type) ||</span><br><span class="line">        Enum.class.isAssignableFrom(type) ||</span><br><span class="line">        CharSequence.class.isAssignableFrom(type) ||</span><br><span class="line">        Number.class.isAssignableFrom(type) ||</span><br><span class="line">        Date.class.isAssignableFrom(type) ||</span><br><span class="line">        Temporal.class.isAssignableFrom(type) ||</span><br><span class="line">        URI.class == type ||</span><br><span class="line">        URL.class == type ||</span><br><span class="line">        Locale.class == type ||</span><br><span class="line">        Class.class == type));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>我们来看看它是怎么将我们的数据封装到我们自定义的对象中的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">resolveArgument</span><span class="params">(MethodParameter parameter, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,</span></span><br><span class="line"><span class="params">      NativeWebRequest webRequest, <span class="meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">   Assert.state(mavContainer != <span class="literal">null</span>, <span class="string">&quot;ModelAttributeMethodProcessor requires ModelAndViewContainer&quot;</span>);</span><br><span class="line">   Assert.state(binderFactory != <span class="literal">null</span>, <span class="string">&quot;ModelAttributeMethodProcessor requires WebDataBinderFactory&quot;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> ModelFactory.getNameForParameter(parameter);</span><br><span class="line">   <span class="type">ModelAttribute</span> <span class="variable">ann</span> <span class="operator">=</span> parameter.getParameterAnnotation(ModelAttribute.class);</span><br><span class="line">   <span class="keyword">if</span> (ann != <span class="literal">null</span>) &#123;</span><br><span class="line">      mavContainer.setBinding(name, ann.binding());</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="type">Object</span> <span class="variable">attribute</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="type">BindingResult</span> <span class="variable">bindingResult</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (mavContainer.containsAttribute(name)) &#123;</span><br><span class="line">      attribute = mavContainer.getModel().get(name);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// Create attribute instance</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         attribute = createAttribute(name, parameter, binderFactory, webRequest);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (BindException ex) &#123;</span><br><span class="line">         <span class="keyword">if</span> (isBindExceptionRequired(parameter)) &#123;</span><br><span class="line">            <span class="comment">// No BindingResult parameter -&gt; fail with BindException</span></span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">// Otherwise, expose null/empty value and associated BindingResult</span></span><br><span class="line">         <span class="keyword">if</span> (parameter.getParameterType() == Optional.class) &#123;</span><br><span class="line">            attribute = Optional.empty();</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> &#123;</span><br><span class="line">            attribute = ex.getTarget();</span><br><span class="line">         &#125;</span><br><span class="line">         bindingResult = ex.getBindingResult();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (bindingResult == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// Bean property binding and validation;</span></span><br><span class="line">      <span class="comment">// skipped in case of binding failure on construction.</span></span><br><span class="line">      <span class="type">WebDataBinder</span> <span class="variable">binder</span> <span class="operator">=</span> binderFactory.createBinder(webRequest, attribute, name);</span><br><span class="line">      <span class="keyword">if</span> (binder.getTarget() != <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">if</span> (!mavContainer.isBindingDisabled(name)) &#123;</span><br><span class="line">            bindRequestParameters(binder, webRequest);</span><br><span class="line">         &#125;</span><br><span class="line">         validateIfApplicable(binder, parameter);</span><br><span class="line">         <span class="keyword">if</span> (binder.getBindingResult().hasErrors() &amp;&amp; isBindExceptionRequired(binder, parameter)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BindException</span>(binder.getBindingResult());</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// Value type adaptation, also covering java.util.Optional</span></span><br><span class="line">      <span class="keyword">if</span> (!parameter.getParameterType().isInstance(attribute)) &#123;</span><br><span class="line">         attribute = binder.convertIfNecessary(binder.getTarget(), parameter.getParameterType(), parameter);</span><br><span class="line">      &#125;</span><br><span class="line">      bindingResult = binder.getBindingResult();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Add resolved attribute and BindingResult at the end of the model</span></span><br><span class="line">   Map&lt;String, Object&gt; bindingResultModel = bindingResult.getModel();</span><br><span class="line">   mavContainer.removeAttributes(bindingResultModel);</span><br><span class="line">   mavContainer.addAllAttributes(bindingResultModel);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> attribute;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个就是它的核心处理方法了！</p>
<p><strong>WebDataBinder binder &#x3D; binderFactory.createBinder(webRequest, attribute, name);</strong></p>
<p>WebDataBinder 数据绑定器，将请求参数的值绑定到指定的javaBean中</p>
<p>bindRequestParameters(binder, webRequest);这个才是真正的将数据设置给javaBean</p>
<p><img src="https://img-blog.csdnimg.cn/20210717152540303.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>我们也可以自定义自己的converters</p>
<p>@FunctionalInterface<strong>public interface</strong> Converter&lt;S, T&gt;	函数式接口，String类型转换成我们对象类型</p>
<h4 id="7-自定义converters"><a href="#7-自定义converters" class="headerlink" title="7.自定义converters"></a>7.自定义converters</h4><p><strong>第一种方式</strong>：在WebMvcConfigurer中添加转换器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFormatters</span><span class="params">(FormatterRegistry registry)</span> &#123;</span><br><span class="line">            registry.addConverter(<span class="keyword">new</span> <span class="title class_">Converter</span>&lt;String, Person&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> Person <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">                    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">                    <span class="comment">// 定义自己的规则</span></span><br><span class="line">                    String[] str = source.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                    person.setName(str[<span class="number">0</span>]);</span><br><span class="line">                    person.setAge(Integer.parseInt(str[<span class="number">1</span>]));</span><br><span class="line">                    <span class="keyword">return</span> person;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717152549308.png" alt="在这里插入图片描述"></p>
<p><strong>第二种方式</strong>：直接创建一个转换器的bean</p>
<ol>
<li>实现Converter&lt;c1, c2&gt;接口，c1为前端接收类型，c2为参数类型</li>
<li>重写convert方法，里面写转换的逻辑</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求路径url中的参数进行时间日期类型的转换，字符串-&gt;日期Date</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DateConverterConfig</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;String, Date&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; formatterList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        formatterList.add(<span class="string">&quot;yyyy-MM&quot;</span>);</span><br><span class="line">        formatterList.add(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        formatterList.add(<span class="string">&quot;yyyy-MM-dd hh:mm&quot;</span>);</span><br><span class="line">        formatterList.add(<span class="string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> source.trim();</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;&quot;</span>.equals(value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(source.matches(<span class="string">&quot;^\\d&#123;4&#125;-\\d&#123;1,2&#125;$&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> parseDate(source, formatterList.get(<span class="number">0</span>));</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(source.matches(<span class="string">&quot;^\\d&#123;4&#125;-\\d&#123;1,2&#125;-\\d&#123;1,2&#125;$&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> parseDate(source, formatterList.get(<span class="number">1</span>));</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(source.matches(<span class="string">&quot;^\\d&#123;4&#125;-\\d&#123;1,2&#125;-\\d&#123;1,2&#125; &#123;1&#125;\\d&#123;1,2&#125;:\\d&#123;1,2&#125;$&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> parseDate(source, formatterList.get(<span class="number">2</span>));</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(source.matches(<span class="string">&quot;^\\d&#123;4&#125;-\\d&#123;1,2&#125;-\\d&#123;1,2&#125; &#123;1&#125;\\d&#123;1,2&#125;:\\d&#123;1,2&#125;:\\d&#123;1,2&#125;$&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> parseDate(source, formatterList.get(<span class="number">3</span>));</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            GraceException.display(ResponseStatusEnum.SYSTEM_DATE_PARSER_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日期转换方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dateStr</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> formatter</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">parseDate</span><span class="params">(String dateStr, String formatter)</span> &#123;</span><br><span class="line">        Date date=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">DateFormat</span> <span class="variable">dateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(formatter);</span><br><span class="line">            date = dateFormat.parse(dateStr);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="4-参数校验"><a href="#4-参数校验" class="headerlink" title="4.参数校验"></a>4.参数校验</h3><h4 id="3-1-引入参数校验的start"><a href="#3-1-引入参数校验的start" class="headerlink" title="3.1 引入参数校验的start"></a>3.1 引入参数校验的start</h4><p> spring-boot-starter-web 会⼀并依赖spring-boot-starter-validation 到项⽬中，所以引入web场景的话就不需要再引入</p>
<h4 id="3-2-接收参数的BO或DTO"><a href="#3-2-接收参数的BO或DTO" class="headerlink" title="3.2 接收参数的BO或DTO"></a>3.2 接收参数的BO或DTO</h4><p>这里我以登录为例子，接收用户名和密码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDto</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;用戶名不能為空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;用戶名不能為空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在controller中使用<code>@Valid</code>或<code>@Validated</code>来标注需要进行参数校验的参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">test</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Valid</span> UserDto userDto)</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>然后通过全局异常捕获进行处理，这样我们就不需要进行多余的判断了</p>
<h4 id="3-3-校验注解的属性"><a href="#3-3-校验注解的属性" class="headerlink" title="3.3 校验注解的属性"></a>3.3 校验注解的属性</h4><p>在<code>@NotBlank</code>中有三个属性</p>
<p><strong>message</strong></p>
<p>这个属性是参数校验不通过抛出的异常信息</p>
<p><strong>groups</strong></p>
<p>数组类型的参数，可以放入多个校验类，根据不同的功能去调用不同的校验方法</p>
<p>比如一个参数在插入的时候需要插入判断，在更新的时候需要进行更新判断，那么这个时候就需要我们写两个不同的校验类，对应不同的参数进行不同的校验</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NotNull(message = &quot;id不能为空&quot;, groups = &#123;Insert.class, update.class&#125;)</span></span><br><span class="line"><span class="keyword">private</span> Long id;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(<span class="meta">@Valid(Insert.class)</span> User user)</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3-4-自定义参数校验注解"><a href="#3-4-自定义参数校验注解" class="headerlink" title="3.4 自定义参数校验注解"></a>3.4 自定义参数校验注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 校验注解</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="comment">// 标注这个注解就是表示它是一个参数校验注解，同时需要告诉它由哪个校验类来进行校验</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy = CheckUrlValidate.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CheckUrl &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验不通过信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;Url不正确&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Payload</span>&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 校验类，需要实现ConstraintValidator&lt;校验注解, 校验类型&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckUrlValidate</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span>&lt;CheckUrl, String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在这个方法中写入校验逻辑true表示通过，false表示不通过</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String url, ConstraintValidatorContext context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> UrlUtil.verifyUrl(url.trim());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h2 id="四、数据响应和内容协商"><a href="#四、数据响应和内容协商" class="headerlink" title="四、数据响应和内容协商"></a>四、数据响应和内容协商</h2><h3 id="1-响应json"><a href="#1-响应json" class="headerlink" title="1.响应json"></a>1.响应json</h3><h4 id="1、jackson-Response注解"><a href="#1、jackson-Response注解" class="headerlink" title="1、jackson + @Response注解"></a>1、jackson + @Response注解</h4><p>引入对应的依赖</p>
<p>web场景已经帮我们引入了json场景</p>
<p>上面我们说了我们参数处理器的原理，那么接下来就是返回值处理器了，看一下我们底层做了什么转换<br><img src="https://img-blog.csdnimg.cn/20210717152558454.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="①返回值处理器"><a href="#①返回值处理器" class="headerlink" title="①返回值处理器"></a>①返回值处理器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// doDispatch中的核心方法</span></span><br><span class="line">mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line"><span class="comment">// 往下调方法</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理返回值的核心方法</span></span><br><span class="line"><span class="comment">// public void invokeAndHandle</span></span><br><span class="line"><span class="built_in">this</span>.returnValueHandlers.handleReturnValue(</span><br><span class="line">					returnValue, getReturnValueType(returnValue), mavContainer, webRequest);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span></span><br><span class="line"><span class="params">      ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// 方法返回值处理器</span></span><br><span class="line">   <span class="type">HandlerMethodReturnValueHandler</span> <span class="variable">handler</span> <span class="operator">=</span> selectHandler(returnValue, returnType);</span><br><span class="line">   <span class="keyword">if</span> (handler == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unknown return value type: &quot;</span> + returnType.getParameterType().getName());</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">// 调用处理方法</span></span><br><span class="line">   handler.handleReturnValue(returnValue, returnType, mavContainer, webRequest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span></span><br><span class="line"><span class="params">      ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span></span><br><span class="line">      <span class="keyword">throws</span> IOException, HttpMediaTypeNotAcceptableException, HttpMessageNotWritableException &#123;</span><br><span class="line">	</span><br><span class="line">   mavContainer.setRequestHandled(<span class="literal">true</span>);</span><br><span class="line">   <span class="type">ServletServerHttpRequest</span> <span class="variable">inputMessage</span> <span class="operator">=</span> createInputMessage(webRequest);</span><br><span class="line">   <span class="type">ServletServerHttpResponse</span> <span class="variable">outputMessage</span> <span class="operator">=</span> createOutputMessage(webRequest);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 使用消息转换器进行写出，最终写到response中</span></span><br><span class="line">   writeWithMessageConverters(returnValue, returnType, inputMessage, outputMessage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="②返回值处理器原理"><a href="#②返回值处理器原理" class="headerlink" title="②返回值处理器原理"></a>②返回值处理器原理</h5><p><strong>1.获取对应的处理器</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717152608924.png" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个方法是得到我们能够处理返回值的返回值处理器</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> HandlerMethodReturnValueHandler <span class="title function_">selectHandler</span><span class="params">(<span class="meta">@Nullable</span> Object value, MethodParameter returnType)</span> &#123;</span><br><span class="line">   <span class="type">boolean</span> <span class="variable">isAsyncValue</span> <span class="operator">=</span> isAsyncReturnValue(value, returnType);</span><br><span class="line">    <span class="comment">// 挨个遍历所有的返回值处理器</span></span><br><span class="line">   <span class="keyword">for</span> (HandlerMethodReturnValueHandler handler : <span class="built_in">this</span>.returnValueHandlers) &#123;</span><br><span class="line">       <span class="comment">// 处理异步的</span></span><br><span class="line">      <span class="keyword">if</span> (isAsyncValue &amp;&amp; !(handler <span class="keyword">instanceof</span> AsyncHandlerMethodReturnValueHandler)) &#123;</span><br><span class="line">         <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">       <span class="comment">// 判断是否可以处理返回值</span></span><br><span class="line">      <span class="keyword">if</span> (handler.supportsReturnType(returnType)) &#123;</span><br><span class="line">          <span class="comment">// 可以就就行返回</span></span><br><span class="line">         <span class="keyword">return</span> handler;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>eg:RequestResponseBodyMethodProcessor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsReturnType</span><span class="params">(MethodParameter returnType)</span> &#123;</span><br><span class="line">    <span class="comment">// 判断有没有标准件@ResponseBody注解,有的话就使用这个返回值处理器</span></span><br><span class="line">   <span class="keyword">return</span> (AnnotatedElementUtils.hasAnnotation(returnType.getContainingClass(), ResponseBody.class) ||</span><br><span class="line">         returnType.hasMethodAnnotation(ResponseBody.class));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其他的处理器有它自己的判断，判断是否符合条件</p>
<p><img src="https://img-blog.csdnimg.cn/20210717152619294.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>2.处理器执行处理方法</strong></p>
<ul>
<li>writeWithMessageConverters(returnValue, returnType, inputMessage, outputMessage);<ul>
<li>①内容协商(浏览器默认会以请求头的方式告诉服务器它可以接收的数据类型)<ul>
<li>acceptableTypes &#x3D; getAcceptableMediaTypes(request);	得到浏览器可以接收的类型</li>
</ul>
</li>
<li>②服务器根据自己自身的能力，决定服务器端可以生产出什么类型的数据<ul>
<li>List<MediaType> producibleTypes &#x3D; getProducibleMediaTypes(request, valueType, targetType);</li>
</ul>
</li>
<li>③springMvc挨个遍历所有容器的HttpMessageConverter，然后将数据写出去<ul>
<li>genericConverter.write(body, targetType, selectedMediaType, outputMessage);</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20210717152628693.png" alt="在这里插入图片描述"></p>
<h4 id="2-springMVC支持的返回值"><a href="#2-springMVC支持的返回值" class="headerlink" title="2.springMVC支持的返回值"></a>2.springMVC支持的返回值</h4><p>这个是根据返回值处理器得出的</p>
<p><img src="https://img-blog.csdnimg.cn/20210717152641904.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ModelAndView</span><br><span class="line">Model</span><br><span class="line">View</span><br><span class="line">ResponseEntity </span><br><span class="line">ResponseBodyEmitter</span><br><span class="line">StreamingResponseBody</span><br><span class="line">HttpEntity</span><br><span class="line">HttpHeaders</span><br><span class="line">Callable</span><br><span class="line">DeferredResult</span><br><span class="line">ListenableFuture</span><br><span class="line">CompletionStage</span><br><span class="line">WebAsyncTask</span><br><span class="line">有 <span class="meta">@ModelAttribute</span> 且为对象类型的</span><br><span class="line"><span class="meta">@ResponseBody</span> 注解 ---&gt; RequestResponseBodyMethodProcessor；</span><br></pre></td></tr></table></figure>



<h4 id="3-HTTPMessageConverter消息转换器原理"><a href="#3-HTTPMessageConverter消息转换器原理" class="headerlink" title="3.HTTPMessageConverter消息转换器原理"></a>3.HTTPMessageConverter消息转换器原理</h4><p><strong>1、MessageConverter规范</strong><br><img src="https://img-blog.csdnimg.cn/20210717152655305.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>HttpMessageConverter: 看是否支持将 此 Class类型的对象，转为MediaType类型的数据。</p>
<p>eg：Person对象转为JSON。或者 JSON转为Person</p>
<p><strong>2、得到支持的媒体类型</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> List&lt;MediaType&gt; <span class="title function_">getProducibleMediaTypes</span><span class="params">(</span></span><br><span class="line"><span class="params">      HttpServletRequest request, Class&lt;?&gt; valueClass, <span class="meta">@Nullable</span> Type targetType)</span> &#123;</span><br><span class="line"></span><br><span class="line">   Set&lt;MediaType&gt; mediaTypes =</span><br><span class="line">         (Set&lt;MediaType&gt;) request.getAttribute(HandlerMapping.PRODUCIBLE_MEDIA_TYPES_ATTRIBUTE);</span><br><span class="line">   <span class="keyword">if</span> (!CollectionUtils.isEmpty(mediaTypes)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(mediaTypes);</span><br><span class="line">   &#125;</span><br><span class="line">   List&lt;MediaType&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 挨个遍历消息转换器，看谁能处理我们的转换</span></span><br><span class="line">   <span class="keyword">for</span> (HttpMessageConverter&lt;?&gt; converter : <span class="built_in">this</span>.messageConverters) &#123;</span><br><span class="line">      <span class="keyword">if</span> (converter <span class="keyword">instanceof</span> GenericHttpMessageConverter &amp;&amp; targetType != <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="comment">// 进行判断，是否可以写出</span></span><br><span class="line">         <span class="keyword">if</span> (((GenericHttpMessageConverter&lt;?&gt;) converter).canWrite(targetType, valueClass, <span class="literal">null</span>)) &#123;</span><br><span class="line">             <span class="comment">// 将支持的媒体类型放入到集合中</span></span><br><span class="line">            result.addAll(converter.getSupportedMediaTypes(valueClass));</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (converter.canWrite(valueClass, <span class="literal">null</span>)) &#123;</span><br><span class="line">         result.addAll(converter.getSupportedMediaTypes(valueClass));</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> (result.isEmpty() ? Collections.singletonList(MediaType.ALL) : result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20210717152708194.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> - 只支持Byte类型的</span><br><span class="line"><span class="number">1</span> - String</span><br><span class="line"><span class="number">2</span> - String</span><br><span class="line"><span class="number">3</span> - Resource</span><br><span class="line"><span class="number">4</span> - ResourceRegion</span><br><span class="line"><span class="number">5</span> - DOMSource.class \ SAXSource.class) \ StAXSource.class \StreamSource.class \Source.class</span><br><span class="line"><span class="number">6</span> - MultiValueMap</span><br><span class="line"><span class="number">7</span> - <span class="literal">true</span> </span><br><span class="line"><span class="number">8</span> - <span class="literal">true</span></span><br><span class="line"><span class="number">9</span> - 支持注解方式xml处理的。</span><br></pre></td></tr></table></figure>





<h3 id="2-内容协商"><a href="#2-内容协商" class="headerlink" title="2.内容协商"></a>2.内容协商</h3><p>根据客户端接收能力不同，返回不同媒体类型的数据。</p>
<h4 id="①引入xml依赖"><a href="#①引入xml依赖" class="headerlink" title="①引入xml依赖"></a>①引入xml依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们引入解析xml的包后，浏览器默认返回的就是我们xml的类型，因为xml的权重比json的高</p>
<p><img src="https://img-blog.csdnimg.cn/20210717152717605.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="②postman分别测试返回json和xml"><a href="#②postman分别测试返回json和xml" class="headerlink" title="②postman分别测试返回json和xml"></a>②postman分别测试返回json和xml</h4><p><img src="https://img-blog.csdnimg.cn/20210717152726358.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/2021071715273430.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="③开启浏览器参数方式内容协商"><a href="#③开启浏览器参数方式内容协商" class="headerlink" title="③开启浏览器参数方式内容协商"></a>③开启浏览器参数方式内容协商</h4><p>为了方便内容协商，开启基于请求参数的内容协商功能。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">contentnegotiation:</span></span><br><span class="line">      <span class="attr">favor-parameter:</span> <span class="literal">true</span>  <span class="comment">#开启请求参数内容协商模式</span></span><br></pre></td></tr></table></figure>

<p>开启了这个模式就会多出一个参数内容协商策略器来得到我们需要返回的媒体类型</p>
<p><img src="https://img-blog.csdnimg.cn/20210717152743634.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>通过传递<code>format</code>参数来得到我们想要返回的数据类型</p>
<p><img src="https://img-blog.csdnimg.cn/20210717152752740.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210717152800697.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="④内容协商原理"><a href="#④内容协商原理" class="headerlink" title="④内容协商原理"></a>④内容协商原理</h4><ol>
<li><p>判断当前响应头中是否已经有确定的媒体类型</p>
<p>writeWithMessageConverters方法</p>
<p>MediaType contentType &#x3D; outputMessage.getHeaders().getContentType();</p>
</li>
<li><p>获取请求头中可以接收的媒体类型</p>
<p>acceptableTypes &#x3D; getAcceptableMediaTypes(request);</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;MediaType&gt; <span class="title function_">resolveMediaTypes</span><span class="params">(NativeWebRequest request)</span> <span class="keyword">throws</span> HttpMediaTypeNotAcceptableException &#123;</span><br><span class="line">    <span class="comment">// 遍历得到内容协商策略器，获取支持的媒体类型</span></span><br><span class="line">   <span class="keyword">for</span> (ContentNegotiationStrategy strategy : <span class="built_in">this</span>.strategies) &#123;</span><br><span class="line">      List&lt;MediaType&gt; mediaTypes = strategy.resolveMediaTypes(request);</span><br><span class="line">      <span class="keyword">if</span> (mediaTypes.equals(MEDIA_TYPE_ALL_LIST)) &#123;</span><br><span class="line">         <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> mediaTypes;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> MEDIA_TYPE_ALL_LIST;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717155925868.png" alt="在这里插入图片描述"></p>
<p>123</p>
</li>
<li><p>遍历得到系统中所有的messageConverter，看谁支持操作这个对象（Person）</p>
</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717152810143.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>导入了jackson处理xml的包，xml的converter就会自动进来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">WebMvcConfigurationSupport</span></span><br><span class="line"><span class="variable">jackson2XmlPresent</span> <span class="operator">=</span> ClassUtils.isPresent(<span class="string">&quot;com.fasterxml.jackson.dataformat.xml.XmlMapper&quot;</span>, classLoader);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (jackson2XmlPresent) &#123;</span><br><span class="line">    <span class="type">Jackson2ObjectMapperBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> Jackson2ObjectMapperBuilder.xml();</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.applicationContext != <span class="literal">null</span>) &#123;</span><br><span class="line">        builder.applicationContext(<span class="built_in">this</span>.applicationContext);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 导入了这个类它就会帮我们添加到所有的messageConverter</span></span><br><span class="line">    messageConverters.add(<span class="keyword">new</span> <span class="title class_">MappingJackson2XmlHttpMessageConverter</span>(builder.build()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>​    </p>
<ol start="4">
<li><p>统计支持操作Person的Converter，把converter支持的媒体类型统计出来</p>
</li>
<li><p>客户端需要xml。服务端支持的（10种，json，xml）</p>
</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717152820901.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>​    </p>
<ol start="6">
<li><p>进行内容协商的最佳匹配</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (MediaType requestedType : acceptableTypes) &#123;</span><br><span class="line">   <span class="keyword">for</span> (MediaType producibleType : producibleTypes) &#123;</span><br><span class="line">      <span class="keyword">if</span> (requestedType.isCompatibleWith(producibleType)) &#123;</span><br><span class="line">         mediaTypesToUse.add(getMostSpecificMediaType(requestedType, producibleType));</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (MediaType mediaType : mediaTypesToUse) &#123;</span><br><span class="line">    <span class="keyword">if</span> (mediaType.isConcrete()) &#123;</span><br><span class="line">        selectedMediaType = mediaType;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (mediaType.isPresentIn(ALL_APPLICATION_MEDIA_TYPES)) &#123;</span><br><span class="line">        selectedMediaType = MediaType.APPLICATION_OCTET_STREAM;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>最后进行转换，然后调用方法进行输出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (selectedMediaType != <span class="literal">null</span>) &#123;</span><br><span class="line">   selectedMediaType = selectedMediaType.removeQualityValue();</span><br><span class="line">    <span class="comment">// 挨个遍历消息转换器</span></span><br><span class="line">   <span class="keyword">for</span> (HttpMessageConverter&lt;?&gt; converter : <span class="built_in">this</span>.messageConverters) &#123;</span><br><span class="line">      <span class="type">GenericHttpMessageConverter</span> <span class="variable">genericConverter</span> <span class="operator">=</span> (converter <span class="keyword">instanceof</span> GenericHttpMessageConverter ?</span><br><span class="line">            (GenericHttpMessageConverter&lt;?&gt;) converter : <span class="literal">null</span>);</span><br><span class="line">      <span class="comment">// 多从判断，判断是否支持操作这个数据，判断是否可以将数据转为我们想要的媒体类型</span></span><br><span class="line">       <span class="keyword">if</span> (genericConverter != <span class="literal">null</span> ?</span><br><span class="line">            ((GenericHttpMessageConverter) converter).canWrite(targetType, valueType, selectedMediaType) :</span><br><span class="line">            converter.canWrite(valueType, selectedMediaType)) &#123;</span><br><span class="line">          <span class="comment">// 得到要输出的内容</span></span><br><span class="line">         body = getAdvice().beforeBodyWrite(body, returnType, selectedMediaType,</span><br><span class="line">               (Class&lt;? <span class="keyword">extends</span> <span class="title class_">HttpMessageConverter</span>&lt;?&gt;&gt;) converter.getClass(),</span><br><span class="line">               inputMessage, outputMessage);</span><br><span class="line">         <span class="keyword">if</span> (body != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">theBody</span> <span class="operator">=</span> body;</span><br><span class="line">            LogFormatUtils.traceDebug(logger, traceOn -&gt;</span><br><span class="line">                  <span class="string">&quot;Writing [&quot;</span> + LogFormatUtils.formatValue(theBody, !traceOn) + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">            addContentDispositionHeader(inputMessage, outputMessage);</span><br><span class="line">            <span class="keyword">if</span> (genericConverter != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 调用方法进行写出操作</span></span><br><span class="line">               genericConverter.write(body, targetType, selectedMediaType, outputMessage);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">               ((HttpMessageConverter) converter).write(body, selectedMediaType, outputMessage);</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">               logger.debug(<span class="string">&quot;Nothing to write: null body&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="⑤自定义MessageConverter"><a href="#⑤自定义MessageConverter" class="headerlink" title="⑤自定义MessageConverter"></a>⑤自定义MessageConverter</h4><p>实现多数据兼容。json、xml、zhi</p>
<p>1、**@ResponseBody** 响应数据出去 调用 <strong>RequestResponseBodyMethodProcessor</strong> 处理</p>
<p>2、Processor 处理方法返回值。通过 <strong>MessageConverter</strong> 处理</p>
<p>3、所有 <strong>MessageConverter</strong> 合起来可以支持各种媒体类型数据的操作（读、写）</p>
<p>4、内容协商找到最终的 <strong>messageConverter</strong>；</p>
<p>springMVC的什么功能。一个入口容器中添加WebMvcConfigurer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="comment">// 将默认的覆盖掉</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 扩展功能</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们使用扩展的来添加我们自己的MessageConverter</p>
<p>首先自定义我们MessageConverter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ZhiMessageConverter</span> <span class="keyword">implements</span> <span class="title class_">HttpMessageConverter</span>&lt;Person&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canRead</span><span class="params">(Class&lt;?&gt; clazz, MediaType mediaType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canWrite</span><span class="params">(Class&lt;?&gt; clazz, MediaType mediaType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> clazz.isAssignableFrom(Person.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 服务器要统计所有的messageConverter都能写出那些内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;MediaType&gt; <span class="title function_">getSupportedMediaTypes</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 转为我们自定的类型</span></span><br><span class="line">        <span class="keyword">return</span> MediaType.parseMediaTypes(<span class="string">&quot;application/zhi&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Person <span class="title function_">read</span><span class="params">(Class&lt;? extends Person&gt; clazz, HttpInputMessage inputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotReadableException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(Person person, MediaType contentType, HttpOutputMessage outputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotWritableException &#123;</span><br><span class="line">        <span class="comment">// 自定义协议的写出</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> person.getName() + <span class="string">&quot;;&quot;</span> + person.getAge();</span><br><span class="line">        <span class="comment">// 写出去</span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">body</span> <span class="operator">=</span> outputMessage.getBody();</span><br><span class="line">        body.write(data.getBytes());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加到系统中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">        converters.add(<span class="keyword">new</span> <span class="title class_">ZhiMessageConverter</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717152832975.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70"></p>
<p><strong>debug分析</strong></p>
<ol>
<li>得到客户端需要的到的内容</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717152843221.png" alt="在这里插入图片描述"></p>
<p>​    </p>
<ol start="2">
<li>得到服务器可以生产的媒体类型</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717152852544.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ol start="3">
<li><p>进行内容协商匹配</p>
</li>
<li><p>进行输出</p>
</li>
</ol>
<h4 id="⑥浏览器请求自定义数据"><a href="#⑥浏览器请求自定义数据" class="headerlink" title="⑥浏览器请求自定义数据"></a>⑥浏览器请求自定义数据</h4><p>我们知道了参数内容协商策略只支持json和xml</p>
<p>所以我们要自己自定义一个我们自己的参数内容协商策略</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*  自定义内容策略</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureContentNegotiation</span><span class="params">(ContentNegotiationConfigurer configurer)</span> &#123;</span><br><span class="line">    Map&lt;String, MediaType&gt; mediaTypes = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    mediaTypes.put(<span class="string">&quot;json&quot;</span>,MediaType.APPLICATION_JSON);</span><br><span class="line">    mediaTypes.put(<span class="string">&quot;xml&quot;</span>,MediaType.APPLICATION_XML);</span><br><span class="line">    <span class="comment">// 我们自定义的类型</span></span><br><span class="line">    mediaTypes.put(<span class="string">&quot;zhi&quot;</span>,MediaType.parseMediaType(<span class="string">&quot;application/zhi&quot;</span>));</span><br><span class="line">    <span class="comment">// 自定义的内容协商策略，指定那些参数对应那些媒体类型</span></span><br><span class="line">    <span class="type">ParameterContentNegotiationStrategy</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ParameterContentNegotiationStrategy</span>(mediaTypes);</span><br><span class="line">    configurer.strategies(Arrays.asList(strategy));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717152903427.png" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20210717152911273.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70"></p>
<p>&#x3D;&#x3D;但是，这会造成一个问题，我们再次使用postman使用请求头的方式请求数据的时候返回的都是返回json类型的数据&#x3D;&#x3D;</p>
<p><img src="https://img-blog.csdnimg.cn/20210717152919395.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>因为我们自定义了我们自己的，所以默认请求头的就被我们覆盖了，我们在自定义的策略中添加上就可以了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureContentNegotiation</span><span class="params">(ContentNegotiationConfigurer configurer)</span> &#123;</span><br><span class="line">    Map&lt;String, MediaType&gt; mediaTypes = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    mediaTypes.put(<span class="string">&quot;json&quot;</span>,MediaType.APPLICATION_JSON);</span><br><span class="line">    mediaTypes.put(<span class="string">&quot;xml&quot;</span>,MediaType.APPLICATION_XML);</span><br><span class="line">    <span class="comment">// 我们自定义的类型</span></span><br><span class="line">    mediaTypes.put(<span class="string">&quot;zhi&quot;</span>,MediaType.parseMediaType(<span class="string">&quot;application/zhi&quot;</span>));</span><br><span class="line">    <span class="comment">// 自定义的内容协商策略，指定那些参数对应那些媒体类型</span></span><br><span class="line">    <span class="type">ParameterContentNegotiationStrategy</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ParameterContentNegotiationStrategy</span>(mediaTypes);</span><br><span class="line">    <span class="comment">// 自定义参数名，默认是format</span></span><br><span class="line">    strategy.setParameterName(<span class="string">&quot;ss&quot;</span>);</span><br><span class="line">    <span class="comment">// 默认的请求头策略</span></span><br><span class="line">    <span class="type">HeaderContentNegotiationStrategy</span> <span class="variable">headerStrategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeaderContentNegotiationStrategy</span>();</span><br><span class="line">    configurer.strategies(Arrays.asList(strategy, headerStrategy));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们还可以自定义我们想要的接收参数</p>
<p><img src="https://img-blog.csdnimg.cn/20210717152927934.png" alt="在这里插入图片描述"></p>
<p><strong>有可能我们添加的自定义的功能会覆盖默认很多功能，导致一些默认的功能失效。</strong></p>
<p><strong>SpringBoot有为我们提供基于配置文件的快速修改媒体类型功能</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717152934244.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70"></p>
<h2 id="五、模板引擎与视图解析"><a href="#五、模板引擎与视图解析" class="headerlink" title="五、模板引擎与视图解析"></a>五、模板引擎与视图解析</h2><p>视图解析：<strong>SpringBoot默认不支持 JSP，需要引入第三方模板引擎技术实现页面渲染。</strong></p>
<h3 id="1模板引擎-Thymeleaf"><a href="#1模板引擎-Thymeleaf" class="headerlink" title="1	模板引擎-Thymeleaf"></a>1	模板引擎-Thymeleaf</h3><p>官方文档：<a target="_blank" rel="noopener" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html</a></p>
<h4 id="1-基本语法"><a href="#1-基本语法" class="headerlink" title="1.基本语法"></a>1.基本语法</h4><h5 id="①表达式"><a href="#①表达式" class="headerlink" title="①表达式"></a>①表达式</h5><table>
<thead>
<tr>
<th>表达式名字</th>
<th>语法</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>变量取值</td>
<td>${…}</td>
<td>获取请求域、session域、对象等值</td>
</tr>
<tr>
<td>选择变量</td>
<td>*{…}</td>
<td>获取上下文对象值</td>
</tr>
<tr>
<td>消息</td>
<td>#{…}</td>
<td>获取国际化等值</td>
</tr>
<tr>
<td>链接</td>
<td>@{…}</td>
<td>生成链接</td>
</tr>
<tr>
<td>片段表达式</td>
<td>~{…}</td>
<td>jsp:include 作用，引入公共页面片段</td>
</tr>
</tbody></table>
<h5 id="②字面量"><a href="#②字面量" class="headerlink" title="②字面量"></a>②字面量</h5><p>文本值: <strong>‘one text’</strong> <strong>,</strong> <strong>‘Another one!’</strong> <strong>,…</strong>数字: <strong>0</strong> <strong>,</strong> <strong>34</strong> <strong>,</strong> <strong>3.0</strong> <strong>,</strong> <strong>12.3</strong> <strong>,…</strong>布尔值: <strong>true</strong> <strong>,</strong> <strong>false</strong></p>
<p>空值: <strong>null</strong></p>
<p>变量： one，two，…. 变量不能有空格</p>
<h5 id="③文本操作"><a href="#③文本操作" class="headerlink" title="③文本操作"></a>③文本操作</h5><p>字符串拼接: <strong>+</strong></p>
<p>变量替换: <strong>|The name is ${name}|</strong> </p>
<h5 id="④数学运算"><a href="#④数学运算" class="headerlink" title="④数学运算"></a>④数学运算</h5><p>运算符: + , - , * , &#x2F; , %</p>
<h5 id="⑤布尔运算"><a href="#⑤布尔运算" class="headerlink" title="⑤布尔运算"></a>⑤布尔运算</h5><p>运算符:  <strong>and</strong> <strong>,</strong> <strong>or</strong></p>
<p>一元运算: <strong>!</strong> <strong>,</strong> <strong>not</strong> </p>
<h5 id="⑥比较运算"><a href="#⑥比较运算" class="headerlink" title="⑥比较运算"></a>⑥比较运算</h5><p>比较: <strong>&gt;</strong> <strong>,</strong> <strong>&lt;** **,** **&gt;&#x3D;</strong> <strong>,</strong> <strong>&lt;&#x3D;</strong> <strong>(</strong> <strong>gt</strong> <strong>,</strong> <strong>lt</strong> <strong>,</strong> <strong>ge</strong> <strong>,</strong> <strong>le</strong> **)**等式: <strong>&#x3D;&#x3D;</strong> <strong>,</strong> <strong>!&#x3D;</strong> <strong>(</strong> <strong>eq</strong> <strong>,</strong> <strong>ne</strong> <strong>)</strong> </p>
<h5 id="⑦条件运算"><a href="#⑦条件运算" class="headerlink" title="⑦条件运算"></a>⑦条件运算</h5><p>If-then: <strong>(if) ? (then)</strong></p>
<p>If-then-else: <strong>(if) ? (then) : (else)</strong></p>
<p>Default: (value) <strong>?: (defaultvalue)</strong> </p>
<h5 id="⑧特殊操作"><a href="#⑧特殊操作" class="headerlink" title="⑧特殊操作"></a>⑧特殊操作</h5><p>无操作： _</p>
<h4 id="2设置属性值-th-attr"><a href="#2设置属性值-th-attr" class="headerlink" title="2设置属性值-th:attr"></a>2设置属性值-th:attr</h4><p>设置单个值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;subscribe.html&quot;</span> <span class="attr">th:attr</span>=<span class="string">&quot;action=@&#123;/subscribe&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Subscribe!&quot;</span> <span class="attr">th:attr</span>=<span class="string">&quot;value=#&#123;subscribe.submit&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>设置多个值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../../images/gtvglogo.png&quot;</span>  <span class="attr">th:attr</span>=<span class="string">&quot;src=@&#123;/images/gtvglogo.png&#125;,title=#&#123;logo&#125;,alt=#&#123;logo&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>



<p>以上两个的代替写法 th:xxxx</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Subscribe!&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;#&#123;subscribe.submit&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;subscribe.html&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/subscribe&#125;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>所有h5兼容的标签写法</p>
<p><a target="_blank" rel="noopener" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-value-to-specific-attributes">https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-value-to-specific-attributes</a></p>
<h4 id="3-迭代"><a href="#3-迭代" class="headerlink" title="3.迭代"></a>3.迭代</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;prod : $&#123;prods&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.name&#125;&quot;</span>&gt;</span>Onions<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.price&#125;&quot;</span>&gt;</span>2.41<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.inStock&#125;? #&#123;true&#125; : #&#123;false&#125;&quot;</span>&gt;</span>yes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;prod,iterStat : $&#123;prods&#125;&quot;</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;iterStat.odd&#125;? &#x27;odd&#x27;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.name&#125;&quot;</span>&gt;</span>Onions<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.price&#125;&quot;</span>&gt;</span>2.41<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.inStock&#125;? #&#123;true&#125; : #&#123;false&#125;&quot;</span>&gt;</span>yes<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="4-条件运算"><a href="#4-条件运算" class="headerlink" title="4.条件运算"></a>4.条件运算</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;comments.html&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">th:href</span>=<span class="string">&quot;@&#123;/product/comments(prodId=$&#123;prod.id&#125;)&#125;&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #lists.isEmpty(prod.comments)&#125;&quot;</span>&gt;</span>view<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:switch</span>=<span class="string">&quot;$&#123;user.role&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;&#x27;admin&#x27;&quot;</span>&gt;</span>User is an administrator<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;#&#123;roles.manager&#125;&quot;</span>&gt;</span>User is a manager<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:case</span>=<span class="string">&quot;*&quot;</span>&gt;</span>User is some other thing<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="5-属性优先级"><a href="#5-属性优先级" class="headerlink" title="5.属性优先级"></a>5.属性优先级</h4><p><img src="https://img-blog.csdnimg.cn/img_convert/9f6b7f4cb446cc92ec4650bedcaf3f4b.png" alt="img"></p>
<h3 id="2thymeleaf使用"><a href="#2thymeleaf使用" class="headerlink" title="2	thymeleaf使用"></a>2	thymeleaf使用</h3><h4 id="1-引入stater"><a href="#1-引入stater" class="headerlink" title="1.引入stater"></a>1.引入stater</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="2-自动配置好了thymeleaf"><a href="#2-自动配置好了thymeleaf" class="headerlink" title="2.自动配置好了thymeleaf"></a>2.自动配置好了thymeleaf</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(ThymeleafProperties.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; TemplateMode.class, SpringTemplateEngine.class &#125;)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123; WebMvcAutoConfiguration.class, WebFluxAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThymeleafAutoConfiguration</span> &#123;</span><br></pre></td></tr></table></figure>

<p><strong>自动配置策略</strong></p>
<ol>
<li><strong>绑定了ThymeleafProperties配置类</strong></li>
<li><strong>配置好了SpringTemplateEngine模板引擎</strong></li>
<li><strong>配好了thymeleafViewResolver(模板视图解析器)</strong></li>
</ol>
<h3 id="3构建后台管理系统"><a href="#3构建后台管理系统" class="headerlink" title="3	构建后台管理系统"></a>3	构建后台管理系统</h3><h4 id="1、项目创建"><a href="#1、项目创建" class="headerlink" title="1、项目创建"></a>1、项目创建</h4><p>thymeleaf、web-starter、devtools、lombok</p>
<h4 id="2、静态资源处理"><a href="#2、静态资源处理" class="headerlink" title="2、静态资源处理"></a>2、静态资源处理</h4><p>自动配置好，我们只需要把所有静态资源放到 static 文件夹下</p>
<p><img src="https://img-blog.csdnimg.cn/2021071715295672.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="3、路径构建"><a href="#3、路径构建" class="headerlink" title="3、路径构建"></a>3、路径构建</h4><p>th:action&#x3D;”@{&#x2F;login}”</p>
<h4 id="4、模板抽取"><a href="#4、模板抽取" class="headerlink" title="4、模板抽取"></a>4、模板抽取</h4><p>th:insert&#x2F;replace&#x2F;include</p>
<h4 id="5、页面跳转"><a href="#5、页面跳转" class="headerlink" title="5、页面跳转"></a>5、页面跳转</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">main</span><span class="params">(User user, HttpSession session, Model model)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(StringUtils.hasLength(user.getUserName()) &amp;&amp; <span class="string">&quot;123456&quot;</span>.equals(user.getPassword()))&#123;</span><br><span class="line">        <span class="comment">//把登陆成功的用户保存起来</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;loginUser&quot;</span>,user);</span><br><span class="line">        <span class="comment">//登录成功重定向到main.html;  重定向防止表单重复提交</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/main.html&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;账号密码错误&quot;</span>);</span><br><span class="line">        <span class="comment">//回到登录页面</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6、数据渲染"><a href="#6、数据渲染" class="headerlink" title="6、数据渲染"></a>6、数据渲染</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/dynamic_table&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">dynamic_table</span><span class="params">(Model model)</span>&#123;</span><br><span class="line">    <span class="comment">//表格内容的遍历</span></span><br><span class="line">    List&lt;User&gt; users = Arrays.asList(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;zhangsan&quot;</span>, <span class="string">&quot;123456&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;lisi&quot;</span>, <span class="string">&quot;123444&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;haha&quot;</span>, <span class="string">&quot;aaaaa&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;hehe &quot;</span>, <span class="string">&quot;aaddd&quot;</span>));</span><br><span class="line">    model.addAttribute(<span class="string">&quot;users&quot;</span>,users);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;table/dynamic_table&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;display table table-bordered&quot;</span> <span class="attr">id</span>=<span class="string">&quot;hidden-table-info&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>#<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;gradeX&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;user,stats:$&#123;users&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;stats.count&#125;&quot;</span>&gt;</span>Trident<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.userName&#125;&quot;</span>&gt;</span>Internet<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> &gt;</span>[[$&#123;user.password&#125;]]<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h3 id="4视图解析原理"><a href="#4视图解析原理" class="headerlink" title="4	视图解析原理"></a>4	视图解析原理</h3><h4 id="1、重定向原理"><a href="#1、重定向原理" class="headerlink" title="1、重定向原理"></a>1、重定向原理</h4><ol>
<li><strong>得到它的返回值处理器<code>ViewNameMethodReturnValueHandler</code></strong></li>
</ol>
<p> <img src="https://img-blog.csdnimg.cn/20210717153006253.png" alt="在这里插入图片描述"></p>
<ol start="2">
<li><strong>执行方法</strong></li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717153014261.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<pre><code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isRedirectViewName</span><span class="params">(String viewName)</span> &#123;</span><br><span class="line">    <span class="comment">// 判断名字是否匹配这个正则表达式或者是不是以redirect:开头的</span></span><br><span class="line">   <span class="keyword">return</span> (PatternMatchUtils.simpleMatch(<span class="built_in">this</span>.redirectPatterns, viewName) || viewName.startsWith(<span class="string">&quot;redirect:&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
<ol start="3">
<li><strong>处理完成之后，返回一个ModelAndView对象，里面存放我们的数据和视图地址</strong></li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717153023999.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<pre><code>![在这里插入图片描述](https://img-blog.csdnimg.cn/2021071715593716.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70)
</code></pre>
<ol start="4">
<li><strong>得到数据和视图之后就要将他们进行输出给客户端进行展示</strong></li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717153031627.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ol start="5">
<li><strong>处理派发结果</strong></li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717153039185.png" alt="在这里插入图片描述"></p>
<ol start="6">
<li><strong>得到<code>View</code>视图对象</strong></li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717153050262.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<pre><code>**render	--&gt;	resolveViewName**

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> View <span class="title function_">resolveViewName</span><span class="params">(String viewName, <span class="meta">@Nullable</span> Map&lt;String, Object&gt; model,</span></span><br><span class="line"><span class="params">      Locale locale, HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (<span class="built_in">this</span>.viewResolvers != <span class="literal">null</span>) &#123;</span><br><span class="line">       <span class="comment">// 遍历系统中所有的视图解析器，看谁能解析这个视图</span></span><br><span class="line">      <span class="keyword">for</span> (ViewResolver viewResolver : <span class="built_in">this</span>.viewResolvers) &#123;</span><br><span class="line">         <span class="type">View</span> <span class="variable">view</span> <span class="operator">=</span> viewResolver.resolveViewName(viewName, locale);</span><br><span class="line">         <span class="keyword">if</span> (view != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> view;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210717155950255.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70)
</code></pre>
<ol start="7">
<li><p><strong>最后重定向</strong></p>
<p><code>view.render(mv.getModelInternal(), request, response);</code></p>
</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717153100448.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2、请求转发原理"><a href="#2、请求转发原理" class="headerlink" title="2、请求转发原理"></a>2、请求转发原理</h4><p>和重定向原理基本一致，最后也是调用了原生的请求转发forward方法</p>
<h4 id="3、视图渲染"><a href="#3、视图渲染" class="headerlink" title="3、视图渲染"></a>3、视图渲染</h4><p>过程和重定向的差不多，重定向调用的是<code>ContentNegotiatingViewResolver</code>内容协商视图解析器，我们的视图是有我们导入进来的<code>ThymeleafViewResolver</code>视图解析器进行解析</p>
<p>我们来看看它是怎么进行解析的</p>
<ol>
<li><p><strong>来到DispatcherServlet中的render方法</strong></p>
<p>view &#x3D; resolveViewName(viewName, mv.getModelInternal(), locale, request)</p>
</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717153108937.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ol start="2">
<li><p>view调用render方法</p>
<p><code>view.render(mv.getModelInternal(), request, response);</code></p>
<p>ThymeleafView: renderFragment()</p>
<p>&#x3D;&#x3D;设置一些列东西后，得到我们的视图内容，视图模板引擎调<code>viewTemplateEngine</code>用<code>process</code>方法进行输出&#x3D;&#x3D;</p>
</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717153122628.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<pre><code>因为我们会使用thymeleaf中的语法获取值，处理和分析就是为了将我们的值渲染到视图上
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210717153132912.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<pre><code>最终调用flush 方法进行输出，到此我们就完成了我们的页面渲染
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210717153143736.png" alt="在这里插入图片描述"></p>
<p>​    </p>
<p>​    </p>
<h2 id="六、拦截器"><a href="#六、拦截器" class="headerlink" title="六、拦截器"></a>六、拦截器</h2><h3 id="1、HandlerInterceptor接口"><a href="#1、HandlerInterceptor接口" class="headerlink" title="1、HandlerInterceptor接口"></a>1、HandlerInterceptor接口</h3><p><img src="https://img-blog.csdnimg.cn/20210717153152495.png" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拦截之前执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 判断是否登录，登录了才能进行操作</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) session.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 跳转到登录页面</span></span><br><span class="line">            request.setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;请先登录&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/&quot;</span>).forward(request, response);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 目标方法完成之后执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> modelAndView</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 页面渲染之后执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ex</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2、配置拦截器"><a href="#2、配置拦截器" class="headerlink" title="2、配置拦截器"></a>2、配置拦截器</h3><p>将我么自定义的拦截器放入到容器中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">MyInterceptor</span>())</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                <span class="comment">// 一定要注意不要将静态资源也拦截了</span></span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/login&quot;</span>,<span class="string">&quot;/css/**&quot;</span>,<span class="string">&quot;/js/**&quot;</span>,<span class="string">&quot;/fonts/**&quot;</span>,<span class="string">&quot;/images/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3、拦截器原理"><a href="#3、拦截器原理" class="headerlink" title="3、拦截器原理"></a>3、拦截器原理</h3><ol>
<li>首先还是在DispatcherServlet下的doDispatch()方法中</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717153203629.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<pre><code>映射处理器中有我们所有的拦截器
</code></pre>
<ol start="2">
<li><p>在执行方法之前，它会去调用拦截器进行判断，如果全部拦截器都为true，那么就执行目标方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="title function_">applyPreHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// 遍历循环得到每个拦截器</span></span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="built_in">this</span>.interceptorList.size(); i++) &#123;</span><br><span class="line">      <span class="type">HandlerInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="built_in">this</span>.interceptorList.get(i);</span><br><span class="line">       <span class="comment">// 调用拦截器的preHandle方法，返回true就是放行</span></span><br><span class="line">      <span class="keyword">if</span> (!interceptor.preHandle(request, response, <span class="built_in">this</span>.handler)) &#123;</span><br><span class="line">         triggerAfterCompletion(request, response, <span class="literal">null</span>);</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">       <span class="comment">// 执行了拦截器的索引</span></span><br><span class="line">      <span class="built_in">this</span>.interceptorIndex = i;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行完目标方法返回modelAndView对象之后，mappedHandler执行<code>applyPostHandle</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">applyPostHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, <span class="meta">@Nullable</span> ModelAndView mv)</span></span><br><span class="line">      <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// 反序遍历我们执行成功的拦截器</span></span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="built_in">this</span>.interceptorList.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">      <span class="type">HandlerInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="built_in">this</span>.interceptorList.get(i);</span><br><span class="line">       <span class="comment">// 执行postHandle方法</span></span><br><span class="line">      interceptor.postHandle(request, response, <span class="built_in">this</span>.handler, mv);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>我们上面的所有操作如果有发生异常的都会触发<code>triggerAfterCompletion</code>方法，这个方法就是执行我们的每个拦截器的<code>afterCompletion</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">triggerAfterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, <span class="meta">@Nullable</span> Exception ex)</span> &#123;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="built_in">this</span>.interceptorIndex; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">      <span class="type">HandlerInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="built_in">this</span>.interceptorList.get(i);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         interceptor.afterCompletion(request, response, <span class="built_in">this</span>.handler, ex);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (Throwable ex2) &#123;</span><br><span class="line">         logger.error(<span class="string">&quot;HandlerInterceptor.afterCompletion threw exception&quot;</span>, ex2);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果开启了异步并发，那么它会执行异步拦截器中的<code>afterConcurrentHandlingStarted</code>方法</p>
<p><img src="https://img-blog.csdnimg.cn/20210717153213137.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70"></p>
</li>
</ol>
<h2 id="七、文件上传"><a href="#七、文件上传" class="headerlink" title="七、文件上传"></a>七、文件上传</h2><h3 id="1-页面代码"><a href="#1-页面代码" class="headerlink" title="1.页面代码"></a>1.页面代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;form role=<span class="string">&quot;form&quot;</span> th:action=<span class="string">&quot;@&#123;/upload&#125;&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    &lt;div class=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">        &lt;label <span class="keyword">for</span>=<span class="string">&quot;exampleInputEmail1&quot;</span>&gt;邮箱&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;email&quot;</span> name=<span class="string">&quot;email&quot;</span> class=<span class="string">&quot;form-control&quot;</span> id=<span class="string">&quot;exampleInputEmail1&quot;</span> placeholder=<span class="string">&quot;Enter email&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">        &lt;label <span class="keyword">for</span>=<span class="string">&quot;exampleInputPassword1&quot;</span>&gt;名字&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> class=<span class="string">&quot;form-control&quot;</span> id=<span class="string">&quot;exampleInputPassword1&quot;</span> placeholder=<span class="string">&quot;Password&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">        &lt;label <span class="keyword">for</span>=<span class="string">&quot;exampleInputFile&quot;</span>&gt;头像&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;headerImg&quot;</span> id=<span class="string">&quot;exampleInputFile&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">        &lt;label <span class="keyword">for</span>=<span class="string">&quot;exampleInputFile&quot;</span>&gt;生活照&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;photos&quot;</span> multiple&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=<span class="string">&quot;checkbox&quot;</span>&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;checkbox&quot;</span>&gt; Check me out</span><br><span class="line">        &lt;/label&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;button type=<span class="string">&quot;submit&quot;</span> class=<span class="string">&quot;btn btn-primary&quot;</span>&gt;提交&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>两个要注意的点：</p>
<ol>
<li>上传文件form元素中一定要有编码类型：<code>enctype=&quot;multipart/form-data&quot;</code></li>
<li><code>&lt;input type=&quot;file&quot; name=&quot;photos&quot; multiple&gt;</code>添加multiple属性可以同时上传多个文件</li>
</ol>
<h3 id="2-文件上传的controller"><a href="#2-文件上传的controller" class="headerlink" title="2.文件上传的controller"></a>2.文件上传的controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FormController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/form_layouts&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">form_layouts</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/form/form_layouts&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam</span> String email,</span></span><br><span class="line"><span class="params">                         <span class="meta">@RequestParam</span> String username,</span></span><br><span class="line"><span class="params">                         // 可以不要注解，建议加上</span></span><br><span class="line"><span class="params">                         <span class="meta">@RequestPart(&quot;headerImg&quot;)</span> MultipartFile headerImg,</span></span><br><span class="line"><span class="params">                         <span class="meta">@RequestPart(&quot;photos&quot;)</span> MultipartFile[] photos)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        log.info(<span class="string">&quot;上传的信息：email=&#123;&#125;，username=&#123;&#125;，headerImg=&#123;&#125;，photos=&#123;&#125;&quot;</span>,</span><br><span class="line">                email,username,headerImg.getSize(),photos.length);</span><br><span class="line">        <span class="keyword">if</span> (!headerImg.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// 保存到文件服务器，oss对象存储服务器，在这里我们保存到本地硬盘</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> headerImg.getOriginalFilename();</span><br><span class="line">            headerImg.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;F:\\testUpload\\&quot;</span> + filename));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (photos.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 遍历进行保存</span></span><br><span class="line">            <span class="keyword">for</span> (MultipartFile photo : photos) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!photo.isEmpty()) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> photo.getOriginalFilename();</span><br><span class="line">                    photo.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;F:\\testUpload\\&quot;</span> + filename));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;main&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-文件上传原理"><a href="#3-文件上传原理" class="headerlink" title="3.文件上传原理"></a>3.文件上传原理</h3><p>原理和之前不一样的就是得到的解析器不同</p>
<ol>
<li><strong>在得到解析器之前，它会进行检查，判断这个请求是否有文件上传</strong></li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717153225300.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20210717153233270.png" alt="在这里插入图片描述"></p>
<p>​    </p>
<ol start="2">
<li><strong>有的话就将当前的request对象进行封装，封装成<code>MultipartHttpServletRequest</code>，它是继承了HttpServletRequest的</strong></li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717153241536.png" alt="在这里插入图片描述"></p>
<p>​    </p>
<ol start="3">
<li><p><strong>接下来就是执行目标方法，处理参数环节</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getMethodArgumentValues方法</span><br><span class="line"><span class="comment">// 确定参数值</span></span><br><span class="line">args[i] = <span class="built_in">this</span>.resolvers.resolveArgument(parameter, mavContainer, request, <span class="built_in">this</span>.dataBinderFactory);</span><br></pre></td></tr></table></figure></li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717153256858.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<pre><code>遍历参数处理器，看那个可以处理当前这个参数
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210717153306767.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20210717153314228.png" alt="在这里插入图片描述"></p>
<ol start="4">
<li><p>调用方法参数解析器中的<code>resolveArgument</code>来解析参数</p>
<p><strong>RequestPartMethodArgumentResolver	–&gt;	resolveArgument</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">mpArg</span> <span class="operator">=</span> MultipartResolutionDelegate.resolveMultipartArgument(name, parameter, servletRequest);</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717153326840.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70"></p>
</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717153338974.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<pre><code>**因为我们debug的是多个文件的那个参数，所以执行完上面的就直接返回了**
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/2021071715334818.png" alt="在这里插入图片描述"></p>
<pre><code>**最后调用最终的方法进行返回**

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> adaptArgumentIfNecessary(arg, parameter);</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> Object <span class="title function_">adaptArgumentIfNecessary</span><span class="params">(<span class="meta">@Nullable</span> Object arg, MethodParameter parameter)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (parameter.getParameterType() == Optional.class) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arg == <span class="literal">null</span> || (arg <span class="keyword">instanceof</span> Collection &amp;&amp; ((Collection&lt;?&gt;) arg).isEmpty()) ||</span><br><span class="line">            (arg <span class="keyword">instanceof</span> Object[] &amp;&amp; ((Object[]) arg).length == <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Optional.empty();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Optional.of(arg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
<ol start="5">
<li><p>最后返回结果</p>
<p><img src="https://img-blog.csdnimg.cn/20210717153440526.png" alt="在这里插入图片描述"></p>
</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717153448542.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="八、异常处理"><a href="#八、异常处理" class="headerlink" title="八、异常处理"></a>八、异常处理</h2><h3 id="1、默认规则"><a href="#1、默认规则" class="headerlink" title="1、默认规则"></a>1、默认规则</h3><p>我们服务器出现异常后，springBoot默认会找我们templates&#x2F;error下的错误页面，命名是4xx、5xx或者可以具体到404错误</p>
<p>客户端和浏览器是有区别的：</p>
<ul>
<li>浏览器返回的是页面</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20210717153458634.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ul>
<li>客户端返回的是json数据</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20210717153506889.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>他们返回的信息都是一样的，只是展示出来的不一样而已，信息可以通过${}取出来，eg:${status}取出状态码</p>
<h3 id="2、定义错误页面处理逻辑"><a href="#2、定义错误页面处理逻辑" class="headerlink" title="2、定义错误页面处理逻辑"></a>2、定义错误页面处理逻辑</h3><ul>
<li><p>自定义错误页</p>
<ol>
<li><p><strong>error&#x2F;404.html	error&#x2F;5xx.html;</strong>	有精确的错误状态码页面就匹配精确， 没有的话就找4xx.html，如果都没有就返回系统默认的错误页面</p>
</li>
<li><p><strong>@ControllerAdvice + @ExceptionHandler处理全局异常</strong>    底层是<strong>ExceptionHandlerExceptionResolver</strong>专门处理标有 @ExceptionHandler注解的异常</p>
</li>
</ol>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   处理整个web controller的异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span>  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(&#123;ArithmeticException.class,NullPointerException.class&#125;)</span>   <span class="comment">// 处理异常</span></span><br><span class="line">    <span class="comment">// 返回值也可以是ModelAndView对象</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handlerArithException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;异常:&#123;&#125;&quot;</span> ,e);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>; <span class="comment">// 视图地址</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        </p>
<ol start="3">
<li><strong>@ResponseStatus + 自定义异常</strong>   <strong>ResponseStatusExceptionResolver</strong>处理标注@ResponseStatus注解的异常类</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210717153521834.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><em>调用底层的response.sendError(statusCode); tomcat发&#x2F;error请求</em>*</p>
<p><img src="https://img-blog.csdnimg.cn/20210717153539885.png" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseStatus(value = HttpStatus.FORBIDDEN, reason = &quot;用户数量太多&quot;)</span>    <span class="comment">// reason为原因</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserTooManyException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserTooManyException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        </p>
<ol start="4">
<li><p><strong>spring底层的异常，如参数转换异常</strong>  </p>
<pre><code>**DefaultHandlerExceptionResolver 处理框架底层的异常**
</code></pre>
<p>   它的底层<strong>调用底层的response.sendError(HttpServletResponse.SC BAD_ REQUEST, ex.getMessage(); tomcat发&#x2F;error请求</strong></p>
</li>
</ol>
<pre><code>5.  **自定义实现HandlerExceptionResolver异常，可以作为默认的全局异常处理规则**

    <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义处理异常解析器</span></span><br><span class="line"><span class="meta">@Order(Ordered.HIGHEST_PRECEDENCE)</span>  <span class="comment">// 值越小，优先级越高</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerHandlerExceptionResolver</span> <span class="keyword">implements</span> <span class="title class_">HandlerExceptionResolver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">resolveException</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                                         HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                         Object handler, Exception ex)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response.sendError(<span class="number">511</span>, <span class="string">&quot;自定义的解析器&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20210717153645804.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>​        </p>
<ol start="6">
<li><strong>ErrorViewResolver实现自定义处理异常</strong></li>
</ol>
<ul>
<li>没有能处理这个异常的解析器，tomcat就会发送**&#x2F;error<strong>请求，然后被</strong>BasicErrorControler**处理</li>
<li>底层<strong>response.sendError</strong>也是发送**&#x2F;error<strong>给</strong>BasicErrorControler**处理</li>
<li><strong>BasicErrorControler</strong>要跳转到那个错误页是由<strong>ErrorViewResolver</strong>来解析的，所以我们也可以自定义<strong>ErrorViewResolver</strong>的逻辑来处理跳转的错误页</li>
</ul>
<p>&#x3D;&#x3D;<strong>这些页面处理逻辑都有对应的一个处理异常错误解析器</strong>&#x3D;&#x3D;</p>
<h3 id="3、异常处理自动配置原理"><a href="#3、异常处理自动配置原理" class="headerlink" title="3、异常处理自动配置原理"></a>3、异常处理自动配置原理</h3><ul>
<li><p>ErrorMvcAutoConfiguration		自动配置异常处理规则</p>
<ol>
<li><p>组件：<strong>DefaultErrorAttributes</strong>	id：<strong>errorAttributes</strong></p>
<ul>
<li><p>public class DefaultErrorAttributes implements <strong>ErrorAttributes</strong>, <strong>HandlerExceptionResolver</strong></p>
</li>
<li><p>定义错误页面可以包含哪些数据</p>
<p><img src="https://img-blog.csdnimg.cn/20210717160000832.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<p>​        </p>
<pre><code>2.  组件：**BasicErrorController**     id：**basicErrorController**   它是controller，我们没有自定义错误页面逻辑，那么就它会发送/error请求，这个就是负责跳转到默认&quot;/error&quot;的controller
</code></pre>
<p>   <img src="https://img-blog.csdnimg.cn/20210717153732286.png" alt="在这里插入图片描述"><br>        -   返回页面的处理方法<br><img src="https://img-blog.csdnimg.cn/20210717153759264.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<pre><code>        返回json字符串
</code></pre>
<p><img src="E:\学习笔记\img\img01\watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70.png" alt="在这里插入图片描述"></p>
<pre><code>-   容器中有组件： **View**    id:error
    它返回系统默认的视图，调用**render**方法进行渲染
</code></pre>
<p>​            <img src="E:\学习笔记\img\img01\watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70-16875880883303.png" alt="在这里插入图片描述"></p>
<pre><code>-   容器中放组件：**BeanNameViewResolver**  id：beanNameViewResolver 
 **视图解析器**：按照返回的视图名作为组件id去容器中找View对象

4.  组件：**DefaultErrorViewResolver**    **id：conventionErrorViewResolver**

    -   发生错误，它会根据出现错误的状态码找到对应的视图
</code></pre>
<p>​        <img src="E:\学习笔记\img\img01\watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70-16875881017526.png" alt="在这里插入图片描述"></p>
<h3 id="4、异常处理原理解析"><a href="#4、异常处理原理解析" class="headerlink" title="4、异常处理原理解析"></a>4、异常处理原理解析</h3><p>我们给它制造一个算数异常 int i &#x3D; 1&#x2F;0;</p>
<p>1.拿到适配器，然后执行目标方法，一旦发生错误，异常就会被捕捉</p>
<p><img src="https://img-blog.csdnimg.cn/2021071715390419.png" alt="在这里插入图片描述"></p>
<p>2.处理派发结果	<strong>processDispatchResult()</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717153912323.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>3.<strong>processDispatchResult  –&gt;  processHandlerException</strong>	遍历所有的处理异常解析器，看谁能处理这个异常，如果不能，它就会继续往上抛异常</p>
<p><img src="https://img-blog.csdnimg.cn/20210717153920976.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ol>
<li><strong>DefaultErrorAttributes</strong>：它就是将错误信息保存到请求域中，返回为null</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/2021071715392890.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ol start="2">
<li><p>还有一个是<strong>组合</strong>的处理异常解析器，它里面还会进行遍历每个解析器，他们都有自己的规则</p>
<p><img src="https://img-blog.csdnimg.cn/20210717154026713.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
</ol>
<p>4.如果这个异常没有任何一个能处理，那么底层就会发送&#x2F;error请求，会被底层的<strong>BasicErrorController</strong>处理</p>
<ol>
<li><p>经过内容协商，找到适合的处理方法</p>
</li>
<li><p>将保存在请求域中的数据拿出来</p>
</li>
<li><p>来遍历所有的错误视图解析器，看谁能解析这个错误页面，默认的就是springBoot帮我们配好的那个</p>
<p><img src="https://img-blog.csdnimg.cn/20210717154042387.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
</ol>
<p>默认的解析器的作用就是将我们的错误状态码作为错误页的名字</p>
<p>​        <img src="E:\学习笔记\img\img01\watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70-16875881516489.png" alt="在这里插入图片描述"></p>
<ol start="4">
<li>最终就会响应erroe&#x2F;5xx这个页面</li>
</ol>
<h2 id="九、web原生组件注入（Servlet、Filter、Listener）"><a href="#九、web原生组件注入（Servlet、Filter、Listener）" class="headerlink" title="九、web原生组件注入（Servlet、Filter、Listener）"></a>九、web原生组件注入（Servlet、Filter、Listener）</h2><h3 id="1、使用ServletApI"><a href="#1、使用ServletApI" class="headerlink" title="1、使用Servlet	ApI"></a>1、使用Servlet	ApI</h3><p>&#x3D;&#x3D;<strong>推荐使用这种方式</strong>&#x3D;&#x3D;</p>
<p><strong>@ServletComponentScan</strong>(basePackages &#x3D; <strong>“com.atguigu.admin”</strong>) :指定原生Servlet组件都放在那里</p>
<p><strong>@WebServlet</strong>(urlPatterns &#x3D; <strong>“&#x2F;my”</strong>)：效果：直接响应，<strong>没有经过Spring的拦截器？</strong></p>
<pre><code>因为spring的拦截器拦截的是它的DispatcherServlet，我们并没有定义拦截器拦截我们自定义的Serlvet

它是一个优先匹配原则，比如同样都是处理/my下的请求，那么如果有确定的就是映射到确定的

**eg:	①/my	②/my/aa	那么就会精准匹配②**
</code></pre>
<p><strong>@WebFilter</strong>(urlPatterns&#x3D;{<strong>“&#x2F;css&#x2F;*“</strong>,<strong>“&#x2F;images&#x2F;*“</strong>})</p>
<p><strong>@WebListene</strong></p>
<p><strong>代码实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;/my&quot;)</span>	<span class="comment">// 处理请求路径</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        resp.getWriter().write(<span class="string">&quot;666&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@WebFilter(urlPatterns = &#123;&quot;/css/**&quot;,&quot;/js/**&quot;&#125;)</span>	<span class="comment">// 拦截路径</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        log.info(<span class="string">&quot;过滤器初始化&quot;</span>);  </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">        log.info(<span class="string">&quot;过滤器正在工作&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;过滤器销毁&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServletContextListener</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;监听初始化完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;监听到销毁&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>还要扫描原生的组件，不然是不会生效的</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ServletComponentScan(basePackages = &quot;com.xiaozhi.admin&quot;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717154108609.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210717154115380.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210717154123372.png" alt="在这里插入图片描述"></p>
<h3 id="2、使用RegistrationBean"><a href="#2、使用RegistrationBean" class="headerlink" title="2、使用RegistrationBean"></a>2、使用RegistrationBean</h3><p>ServletRegistrationBean<code>, </code>FilterRegistrationBean<code>, and </code>ServletListenerRegistrationBean</p>
<p><strong>代码实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">myServlet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 对象后面就是路径映射</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(<span class="keyword">new</span> <span class="title class_">MyServlet</span>(), <span class="string">&quot;/my&quot;</span>, <span class="string">&quot;you&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean <span class="title function_">myFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">FilterRegistrationBean</span> <span class="variable">filterRegistrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>(<span class="keyword">new</span> <span class="title class_">MyFilter</span>());</span><br><span class="line">        <span class="comment">// 设置拦截的路径</span></span><br><span class="line">        filterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/my&quot;</span>,<span class="string">&quot;/css/*&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> filterRegistrationBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletListenerRegistrationBean <span class="title function_">myServletListener</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MyServletContextListener</span> <span class="variable">myServletContextListener</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyServletContextListener</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServletListenerRegistrationBean</span>(myServletContextListener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="十、嵌入式Servlet容器"><a href="#十、嵌入式Servlet容器" class="headerlink" title="十、嵌入式Servlet容器"></a>十、嵌入式Servlet容器</h2><h3 id="1-切换嵌入式Servlet容器"><a href="#1-切换嵌入式Servlet容器" class="headerlink" title="1.切换嵌入式Servlet容器"></a>1.切换嵌入式Servlet容器</h3><p>springBoot不用配置服务器是因为它已经将服务器内嵌进来了</p>
<p>默认支持的webServer</p>
<ul>
<li><code>Tomcat</code>, <code>Jetty</code>,  <code>Undertow</code></li>
<li>ServletWebServerApplicationContext 容器启动寻找ServletWebServerFactory 并引导创建服务器</li>
<li>默认是tomcat服务器，我们也可以手动切换服务器</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20210717154132928.png" alt="在这里插入图片描述"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!--移除tomcat--&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--替换tomcat--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>原理</strong>：</p>
<ul>
<li><p>我们先找到自动配置类，我们看它给我们做了什么</p>
</li>
<li><p><code>ServletWebServerFactoryAutoConfiguration</code>（web服务工厂  –&gt; 生产web服务的）</p>
<ul>
<li><img src="https://img-blog.csdnimg.cn/20210717154147164.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
</li>
<li><p><code>ServletWebServerFactoryConfiguration</code>服务器的配置类，动态使用不同的服务器</p>
<p><img src="https://img-blog.csdnimg.cn/20210717154208500.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210717154225697.png" alt="在这里插入图片描述"></p>
</li>
</ul>
<p>只有导入对应的包才能使用对应的服务器，默认是导入tomcat的包</p>
<p><img src="E:\学习笔记\img\img01\20210717154250242.png" alt="在这里插入图片描述"></p>
<ul>
<li><p>导入了tomcat的包，那么它就会有  <code>TomcatServletWebServerFactory</code>（tomcat的服务器工厂）</p>
</li>
<li><p><code>TomcatServletWebServerFactory</code>创建出Tomcat服务器并启动；</p>
<ul>
<li><p><strong>TomcatWebServer 的构造器拥有初始化方法initialize—this.tomcat.start();</strong></p>
</li>
<li><p><img src="https://img-blog.csdnimg.cn/20210717154300697.png" alt="在这里插入图片描述"></p>
</li>
<li><p><img src="https://img-blog.csdnimg.cn/20210717154312470.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ul>
<li><p><img src="https://img-blog.csdnimg.cn/20210717154323802.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p><img src="https://img-blog.csdnimg.cn/20210717154332996.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p><img src="https://img-blog.csdnimg.cn/20210717154343175.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p><img src="https://img-blog.csdnimg.cn/20210717154351953.png" alt="在这里插入图片描述"></p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>内嵌服务器就是手动来执行它的代码，设置它的一些配置</p>
</li>
</ul>
<h3 id="2-定制Servlet容器"><a href="#2-定制Servlet容器" class="headerlink" title="2.定制Servlet容器"></a>2.定制Servlet容器</h3><ul>
<li>修改配置文件server.xxx</li>
<li>实现<code>WebServerFactoryCustomizer&lt;ConfigurableServletWebServerFactory&gt;</code><ul>
<li>将配置文件的值和ServletWebServerFactory进行绑定</li>
</ul>
</li>
<li>自定义ConfigurableServletWebServerFactory</li>
</ul>
<p><strong>xxxxCustomizer：定制化器，可以改变xxxx的默认规则</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717154403386.png" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWebServerFactoryCustomizer</span> <span class="keyword">implements</span> <span class="title class_">WebServerFactoryCustomizer</span>&lt;ConfigurableServletWebServerFactory&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(ConfigurableServletWebServerFactory server)</span> &#123;</span><br><span class="line">        server.setPort(<span class="number">9000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h2 id="十一、定制化原理"><a href="#十一、定制化原理" class="headerlink" title="十一、定制化原理"></a>十一、定制化原理</h2><h3 id="1、定制化的常见方式"><a href="#1、定制化的常见方式" class="headerlink" title="1、定制化的常见方式"></a>1、定制化的常见方式</h3><ul>
<li><p>修改配置文件；</p>
</li>
<li><p><strong>xxxxxCustomizer；</strong></p>
</li>
<li><p><strong>编写自定义的配置类   xxxConfiguration；+</strong> <strong>@Bean替换、增加容器中默认组件；视图解析器</strong> </p>
</li>
<li><p><strong>Web应用 编写一个配置类实现</strong> <strong>WebMvcConfigurer 即可定制化web功能；+ @Bean给容器中再扩展一些组件</strong></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminWebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span></span><br></pre></td></tr></table></figure>

<ul>
<li>@EnableWebMvc + WebMvcConfigurer —— @Bean  可以全面接管SpringMVC，所有规则全部自己重新配置； 实现定制和扩展功能</li>
</ul>
<p><strong>原理</strong></p>
<ul>
<li><p>1、WebMvcAutoConfiguration  默认的SpringMVC的自动配置功能类。静态资源、欢迎页…..</p>
</li>
<li><p>2、一旦使用 @EnableWebMvc 、。会 @Import(DelegatingWebMvcConfiguration.<strong>class</strong>)</p>
</li>
<li><p>3、<strong>DelegatingWebMvcConfiguration</strong> 的 作用，只保证SpringMVC最基本的使用</p>
</li>
<li><p>把所有系统中的 WebMvcConfigurer 拿过来。所有功能的定制都是这些 WebMvcConfigurer  合起来一起生效</p>
</li>
<li><p>自动配置了一些非常底层的组件。<strong>RequestMappingHandlerMapping</strong>、这些组件依赖的组件都是从容器中获取</p>
</li>
<li><p><strong>public class</strong> DelegatingWebMvcConfiguration <strong>extends</strong> <strong>WebMvcConfigurationSupport</strong></p>
</li>
<li><p>4、<strong>WebMvcAutoConfiguration</strong> 里面的配置要能生效 必须  @ConditionalOnMissingBean(<strong>WebMvcConfigurationSupport</strong>.<strong>class</strong>)</p>
</li>
<li><p>5、@EnableWebMvc  导致了 <strong>WebMvcAutoConfiguration  没有生效。****慎用</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717154438942.png" alt="在这里插入图片描述"></p>
</li>
</ul>
<p><img src="D:\学习笔记\img\img01\20210717154448306.png" alt="在这里插入图片描述"></p>
<p><img src="D:\学习笔记\img\img01\20210717154458310.png" alt="在这里插入图片描述"></p>
<ul>
<li>… …</li>
</ul>
<h3 id="2、原理分析套路"><a href="#2、原理分析套路" class="headerlink" title="2、原理分析套路"></a>2、原理分析套路</h3><p><strong>场景starter</strong> <strong>- xxxxAutoConfiguration - 导入xxx组件 - 绑定xxxProperties –</strong> <strong>绑定配置文件项</strong></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><strong>请求处理完整流程</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717154633403.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>拦截器流程</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717154612676.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="05-数据访问"><a href="#05-数据访问" class="headerlink" title="05 数据访问"></a>05 数据访问</h1><h2 id="一、SQL"><a href="#一、SQL" class="headerlink" title="一、SQL"></a>一、SQL</h2><h3 id="1、数据源的自动配置"><a href="#1、数据源的自动配置" class="headerlink" title="1、数据源的自动配置"></a>1、数据源的自动配置</h3><h4 id="1-导入JDBC场景"><a href="#1-导入JDBC场景" class="headerlink" title="1.导入JDBC场景"></a>1.导入JDBC场景</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717154643947.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>数据库驱动</strong></p>
<p>官方没有导入驱动，因为官方不知道我们要操作什么数据库，所以需要我们自己手动导入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--官方给我们的数据库驱动做了版本仲裁，默认是8版本的--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.25<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--需要我们自己来修改版本--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--第一种方式：直接引入--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.49<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--第二种方式：重新声明版本--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.49<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="2-分析自动配置"><a href="#2-分析自动配置" class="headerlink" title="2.分析自动配置"></a>2.分析自动配置</h4><p><strong>DataSourceAutoConfiguration</strong>：数据源的自动配置</p>
<ul>
<li><p>修改数据源相关的配置：spring.datasource</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProperties</span> <span class="keyword">implements</span> <span class="title class_">BeanClassLoaderAware</span>, InitializingBean &#123;</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据库连接池的配置，容器中没有数据源它才会配置</p>
<p><img src="https://img-blog.csdnimg.cn/20210717154657624.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p>因此我们默认使用的就是springBoot给我们配置好的。<strong>HikariDataSource</strong>，因为引入jdbc场景的时候就引入了它的包</p>
</li>
</ul>
<p><strong>DataSourceTransactionManagerAutoConfiguration</strong>：事物管理器的自动配置</p>
<p><strong>JdbcTemplateAutoConfiguration</strong>：JDBC模板的自动配置，它可以对数据库crud</p>
<p><strong>JndiDataSourceAutoConfiguration</strong>：Jndi的自动配置</p>
<p><strong>XADataSourceAutoConfiguration</strong>：分布式事物相关的自动配置</p>
<h4 id="3、修改配置项"><a href="#3、修改配置项" class="headerlink" title="3、修改配置项"></a>3、修改配置项</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db4?studyserverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>



<h4 id="4、测试"><a href="#4、测试" class="headerlink" title="4、测试"></a>4、测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdminApplicationTests</span> &#123;</span><br><span class="line">    <span class="comment">// springBoot帮我们自动引入了</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select count(*) from stu&quot;</span>;</span><br><span class="line">        System.out.println(jdbcTemplate.queryForObject(sql, Integer.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="2、使用Druid数据源"><a href="#2、使用Druid数据源" class="headerlink" title="2、使用Druid数据源"></a>2、使用Druid数据源</h3><p><strong>druid官方github地址</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/druid">https://github.com/alibaba/druid</a></p>
<p><strong>整合第三方技术的两种方式</strong>：</p>
<ul>
<li>自定义</li>
<li>官方starter</li>
</ul>
<h4 id="1-自定义方式"><a href="#1-自定义方式" class="headerlink" title="1.自定义方式"></a>1.自定义方式</h4><p><strong>中文文档</strong>：<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">https://github.com/alibaba/druid/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98</a></p>
<h5 id="①引入依赖"><a href="#①引入依赖" class="headerlink" title="①引入依赖"></a>①引入依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="②创建数据源注入到容器中"><a href="#②创建数据源注入到容器中" class="headerlink" title="②创建数据源注入到容器中"></a>②创建数据源注入到容器中</h5><p>可以使用xml文件的方式去配置，在这里使用配置类的方式配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定配置文件之后，我们只需要修改配置文件中的就可以了</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line"><span class="comment">//        dataSource.setUsername(&quot;root&quot;);     // 设置用户名</span></span><br><span class="line"><span class="comment">//        dataSource.setPassword(&quot;root&quot;);     // 设置密码</span></span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">DataSource dataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(dataSource.getClass());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717154712109.png" alt="在这里插入图片描述"></p>
<h5 id="③StatViewServlet"><a href="#③StatViewServlet" class="headerlink" title="③StatViewServlet"></a>③StatViewServlet</h5><p>StatViewServlet的用途包括：</p>
<ul>
<li>提供监控信息展示的html页面</li>
<li>提供监控信息的JSON API</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置druid监控页功能</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ServletRegistrationBean <span class="title function_">statViewServlet</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">StatViewServlet</span> <span class="variable">statViewServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StatViewServlet</span>();</span><br><span class="line">    ServletRegistrationBean&lt;Servlet&gt; servletServletRegistrationBean =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>&lt;&gt;(statViewServlet,<span class="string">&quot;/druid/*&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> servletServletRegistrationBean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输入网址访问http://localhost:8080/druid/datasource.html</span></span><br></pre></td></tr></table></figure>



<h5 id="④监控统计功能"><a href="#④监控统计功能" class="headerlink" title="④监控统计功能"></a>④监控统计功能</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绑定配置文件之后，我们只需要修改配置文件中的就可以了</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    <span class="comment">//        dataSource.setUsername(&quot;root&quot;);     // 设置用户名</span></span><br><span class="line">    <span class="comment">//        dataSource.setPassword(&quot;root&quot;);     // 设置密码</span></span><br><span class="line">    dataSource.setFilters(<span class="string">&quot;stat&quot;</span>);  <span class="comment">// 开启监控功能</span></span><br><span class="line">    <span class="keyword">return</span> dataSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以使用配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">filters:</span> <span class="string">&#x27;stat&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>结果显示</strong><br><img src="https://img-blog.csdnimg.cn/20210717154721109.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="⑤web和spring关联监控"><a href="#⑤web和spring关联监控" class="headerlink" title="⑤web和spring关联监控"></a>⑤web和spring关联监控</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * web关联监控</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> FilterRegistrationBean <span class="title function_">webStatFilter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">WebStatFilter</span> <span class="variable">webStatFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebStatFilter</span>();</span><br><span class="line">    FilterRegistrationBean&lt;Filter&gt; filterFilterRegistrationBean =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>(webStatFilter);</span><br><span class="line">    filterFilterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/*&quot;</span>));</span><br><span class="line">  filterFilterRegistrationBean.addInitParameter(<span class="string">&quot;exclusions&quot;</span>,<span class="string">&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> filterFilterRegistrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="⑥设置登录账号和密码"><a href="#⑥设置登录账号和密码" class="headerlink" title="⑥设置登录账号和密码"></a>⑥设置登录账号和密码</h5><p><img src="https://img-blog.csdnimg.cn/20210717154732893.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210717154740340.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="⑦不懂看官网，有教程"><a href="#⑦不懂看官网，有教程" class="headerlink" title="⑦不懂看官网，有教程"></a>⑦不懂看官网，有教程</h5><h4 id="2-官方starter"><a href="#2-官方starter" class="headerlink" title="2.官方starter"></a>2.官方starter</h4><p><strong>官方文档</strong>：<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter">https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter</a></p>
<h5 id="①引入官方的stater"><a href="#①引入官方的stater" class="headerlink" title="①引入官方的stater"></a>①引入官方的stater</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="②Druid自动配置"><a href="#②Druid自动配置" class="headerlink" title="②Druid自动配置"></a>②Druid自动配置</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(DruidDataSource.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureBefore(DataSourceAutoConfiguration.class)</span>	<span class="comment">// 它要在spring默认的数据源启动前启动</span></span><br><span class="line"><span class="comment">// 和配合文件进行绑定</span></span><br><span class="line"><span class="comment">// DruidStatProperties	spring.datasource.druid</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;DruidStatProperties.class, DataSourceProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;DruidSpringAopConfiguration.class,</span></span><br><span class="line"><span class="meta">    DruidStatViewServletConfiguration.class,</span></span><br><span class="line"><span class="meta">    DruidWebStatFilterConfiguration.class,</span></span><br><span class="line"><span class="meta">    DruidFilterConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidDataSourceAutoConfigure</span> &#123;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>DruidSpringAopConfiguration</strong>	aop相关的</li>
<li><strong>DruidStatViewServletConfiguration</strong>    监控页的配置，默认开启</li>
<li><strong>DruidWebStatFilterConfiguration</strong>    监控配置，默认开启</li>
<li><strong>DruidFilterConfiguration</strong>    Druid自己的Filter配置<ul>
<li><img src="https://img-blog.csdnimg.cn/20210717154753750.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
</li>
</ul>
<p><strong>代码实现</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db4?studyserverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">5</span>   <span class="comment"># 初始数</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">10</span>    <span class="comment"># 最大活动数</span></span><br><span class="line">      <span class="attr">aop-patterns:</span> <span class="string">com.xiaozhi.admin.*</span>  <span class="comment"># 监控SpringBean</span></span><br><span class="line">      <span class="attr">filters:</span> <span class="string">stat,wall</span>     <span class="comment"># 底层开启功能，stat（sql监控），wall（防火墙）</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">stat-view-servlet:</span>  <span class="comment"># 配置监控页功能</span></span><br><span class="line">        <span class="attr">login-username:</span> <span class="string">admin</span></span><br><span class="line">        <span class="attr">login-password:</span> <span class="string">admin</span></span><br><span class="line">        <span class="attr">url-pattern:</span> <span class="string">/druid/*</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">web-stat-filter:</span>  <span class="comment"># 监控web</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">exclusions:</span> <span class="string">&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span></span><br><span class="line">        <span class="attr">url-pattern:</span> <span class="string">/*</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">stat:</span>   <span class="comment"># 对上面filters里面的stat的详细配置</span></span><br><span class="line">          <span class="attr">slow-sql-millis:</span> <span class="number">1000</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">wall:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">config:</span></span><br><span class="line">            <span class="attr">drop-table-allow:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>





<h3 id="3、整合mybatis操作"><a href="#3、整合mybatis操作" class="headerlink" title="3、整合mybatis操作"></a>3、整合mybatis操作</h3><p><a target="_blank" rel="noopener" href="https://github.com/mybatis">https://github.com/mybatis</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717154803355.png" alt="在这里插入图片描述"></p>
<h4 id="1-配置模式"><a href="#1-配置模式" class="headerlink" title="1.配置模式"></a>1.配置模式</h4><ul>
<li><p>全局配置文件</p>
</li>
<li><p><strong>SqlSessionFactory</strong>    自动配好了</p>
</li>
<li><p><strong>SqlSessionTemplate</strong>   自动配好了</p>
</li>
<li><p><strong>@EnableConfigurationProperties(MybatisProperties.class)</strong>     绑定了配置文件 mybatis.xxxx</p>
</li>
<li><pre><code class="java">@org.springframework.context.annotation.Configuration
// 扫描标注有@Mapper注解的接口
@Import(AutoConfiguredMapperScannerRegistrar.class)
@ConditionalOnMissingBean(&#123; MapperFactoryBean.class, MapperScannerConfigurer.class &#125;)
public static class MapperScannerRegistrarNotFoundConfiguration implements InitializingBean &#123;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**注意**：一定要给mapper接口标注@Mapper注解，要不然就使用@MapperScan()注解扫描进去，不然会识别不了</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### 配置方式</span><br><span class="line"></span><br><span class="line">```yml</span><br><span class="line">mybatis:</span><br><span class="line">  config-location: classpath:mybatis/mybatis-config.xml  # 全局配置文件位置</span><br><span class="line">  mapper-locations: classpath:mybatis/mapper/*.xml  #sql映射文件位置</span><br><span class="line">  type-aliases-package: com.xiaozhi.admin.pojo  # 开启类别名</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<p>也可以使用全部都是配置文件的方式</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="comment"># 如果使用configuration配置项，那么就不需要全局配置文件了，两个只能存在一个，同时存在会报错</span></span><br><span class="line">  <span class="comment">#  config-location: classpath:mybatis/mybatis-config.xml  # 全局配置文件位置</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span>  <span class="comment">#sql映射文件位置</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.xiaozhi.admin.pojo</span>  <span class="comment"># 开启类别名</span></span><br><span class="line">  <span class="attr">configuration:</span>  <span class="comment"># 相当于全局配置文件的配置项</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span>  <span class="comment"># 开启驼峰命名</span></span><br></pre></td></tr></table></figure>



<h5 id="测试"><a href="#测试" class="headerlink" title="测试"></a><strong>测试</strong></h5><p><strong>sql语句</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> city</span><br><span class="line">(</span><br><span class="line">  id      <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">  NAME    <span class="type">VARCHAR</span>(<span class="number">30</span>) ,</span><br><span class="line">  state   <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">  country <span class="type">VARCHAR</span>(<span class="number">30</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>实体类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">City</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line">    <span class="keyword">private</span> String country;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Mapper接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CityMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(City city)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.xaiozhi.admin.mapper&quot;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>编写映射文件</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.xiaozhi.admin.mapper.CityMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span>&gt;</span></span><br><span class="line">       INSERT INTO city (name, state, country) VALUES(#&#123;name&#125;, #&#123;state&#125;, #&#123;country&#125;)</span><br><span class="line">   <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test2</span><span class="params">()</span>&#123;</span><br><span class="line">    cityMapper.insert(<span class="keyword">new</span> <span class="title class_">City</span>(<span class="literal">null</span>, <span class="string">&quot;111&quot;</span>, <span class="string">&quot;222&quot;</span>, <span class="string">&quot;333&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test3</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(cityMapper.findById(<span class="number">1L</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h4 id="2-注解模式"><a href="#2-注解模式" class="headerlink" title="2.注解模式"></a>2.注解模式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CityMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from city where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(City city)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert(&quot;INSERT INTO city (name, state, country) VALUES(#&#123;name&#125;, #&#123;state&#125;, #&#123;country&#125;)&quot;)</span></span><br><span class="line">    City <span class="title function_">findById</span><span class="params">(<span class="type">long</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h5><p>注解也可以进行一些较复杂的动作</p>
<p>编写一个完整的开发流程</p>
<p><strong>service</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CityServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CityService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CityMapper cityMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveCity</span><span class="params">(City city)</span> &#123;</span><br><span class="line">        cityMapper.insert(city);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>controller</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CityController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CityService cityService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/city&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> City <span class="title function_">city</span><span class="params">(City city)</span> &#123;</span><br><span class="line">        cityService.saveCity(city);</span><br><span class="line">        <span class="keyword">return</span> city;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用postman进行测试</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717154818404.png" alt="在这里插入图片描述"></p>
<p>返回的id是为null的，我们想要插入的同时也要设置我们的id值，我们可以这样做</p>
<p><strong>配置文件的形式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=<span class="string">&quot;insert&quot;</span> useGeneratedKeys=<span class="string">&quot;true&quot;</span> keyProperty=<span class="string">&quot;id&quot;</span>&gt;</span><br><span class="line">    INSERT INTO <span class="title function_">city</span> <span class="params">(name, state, country)</span> VALUES(#&#123;name&#125;, #&#123;state&#125;, #&#123;country&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>

<p><strong>使用注解</strong></p>
<p>使用@Options注解放我们其他的功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;INSERT INTO city (name, state, country) VALUES(#&#123;name&#125;, #&#123;state&#125;, #&#123;country&#125;)&quot;)</span></span><br><span class="line"><span class="meta">@Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(City city)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>结果显示</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717154827758.png" alt="在这里插入图片描述"></p>
<h4 id="3-混合模式"><a href="#3-混合模式" class="headerlink" title="3.混合模式"></a>3.混合模式</h4><p>混合模式就是注解 + xml映射文件</p>
<p>简单的sql语句我们可以使用注解</p>
<p>复杂的语句我们可以使用映射文件来处理</p>
<h3 id="4、整合Mybatis-Plus完成CRUD"><a href="#4、整合Mybatis-Plus完成CRUD" class="headerlink" title="4、整合Mybatis-Plus完成CRUD"></a>4、整合Mybatis-Plus完成CRUD</h3><p><a target="_blank" rel="noopener" href="https://mp.baomidou.com/">https://mp.baomidou.com/</a></p>
<h5 id="1-引入stater-1"><a href="#1-引入stater-1" class="headerlink" title="1.引入stater"></a>1.引入stater</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>它引入了mybatis的整合包，所以引入它就可以有mybatis的全部功能了</p>
<p>&#x3D;&#x3D;<strong>注意</strong>：它和配置文件绑定的前缀是mybatis-plus&#x3D;&#x3D;</p>
<p><img src="https://img-blog.csdnimg.cn/20210717154836843.png" alt="在这里插入图片描述"></p>
<h5 id="2-按照官方的文档来学习"><a href="#2-按照官方的文档来学习" class="headerlink" title="2.按照官方的文档来学习"></a>2.按照官方的文档来学习</h5><h2 id="二、NoSQL"><a href="#二、NoSQL" class="headerlink" title="二、NoSQL"></a>二、NoSQL</h2><p>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、<strong>缓存</strong>和消息中间件。 它支持多种类型的数据结构，如 <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#strings">字符串（strings）</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#hashes">散列（hashes）</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#lists">列表（lists）</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#sets">集合（sets）</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#sorted-sets">有序集合（sorted sets）</a> 与范围查询， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#bitmaps">bitmaps</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#hyperloglogs">hyperloglogs</a> 和 <a target="_blank" rel="noopener" href="http://www.redis.cn/commands/geoadd.html">地理空间（geospatial）</a> 索引半径查询。 Redis 内置了 <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/replication.html">复制（replication）</a>，<a target="_blank" rel="noopener" href="http://www.redis.cn/commands/eval.html">LUA脚本（Lua scripting）</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/lru-cache.html">LRU驱动事件（LRU eviction）</a>，<a target="_blank" rel="noopener" href="http://www.redis.cn/topics/transactions.html">事务（transactions）</a> 和不同级别的 <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/persistence.html">磁盘持久化（persistence）</a>， 并通过 <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/sentinel.html">Redis哨兵（Sentinel）</a>和自动 <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/cluster-tutorial.html">分区（Cluster）</a>提供高可用性（high availability）。</p>
<h3 id="1、reids自动配置"><a href="#1、reids自动配置" class="headerlink" title="1、reids自动配置"></a>1、reids自动配置</h3><h4 id="①引入starter"><a href="#①引入starter" class="headerlink" title="①引入starter"></a>①引入starter</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717154854442.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>默认导入的是kettuce客户端，需要jedis的需要导入jedis的包，还需要手动开启</p>
<h4 id="②自动配置"><a href="#②自动配置" class="headerlink" title="②自动配置"></a>②自动配置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(RedisOperations.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(RedisProperties.class)</span></span><br><span class="line"><span class="meta">@Import(&#123; LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisAutoConfiguration</span> &#123;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>绑定了配置文件  <strong>spring.redis.xxxx</strong></p>
</li>
<li><p>@Import({ <strong>LettuceConnectionConfiguration</strong>.class, <strong>JedisConnectionConfiguration</strong>.class })    支持的两个客户端</p>
<p><img src="https://img-blog.csdnimg.cn/20210717154907409.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>如果想要使用jedis就需要导入jedis的包，还需要手动修改客户端类型</p>
</li>
</ul>
<p>​    </p>
<ul>
<li><p><strong>RedisTemplate&lt;Object, Object&gt;</strong>    自动配好了</p>
</li>
<li><p><strong>StringRedisTemplate</strong>    自动配好了</p>
</li>
<li><p>我们使用RedisTemplate和 <strong>StringRedisTemplate</strong>    操作redis数据库就可以了</p>
</li>
</ul>
<h3 id="2、RedisTemplate与Lettuce"><a href="#2、RedisTemplate与Lettuce" class="headerlink" title="2、RedisTemplate与Lettuce"></a>2、RedisTemplate与Lettuce</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis配置</span></span><br><span class="line"><span class="string">spring</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.6</span><span class="number">.156</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="comment"># 有密码的要加上密码</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test4</span><span class="params">()</span>&#123;</span><br><span class="line">    ValueOperations&lt;String, String&gt; operations = redisTemplate.opsForValue();</span><br><span class="line">    operations.set(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">hello</span> <span class="operator">=</span> operations.get(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    System.out.println(hello);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h3 id="3、切换到jedis"><a href="#3、切换到jedis" class="headerlink" title="3、切换到jedis"></a>3、切换到jedis</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导入jedis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment"># redis配置</span></span><br><span class="line"><span class="string">spring</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.6</span><span class="number">.156</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="comment"># 有密码的要加上密码</span></span><br><span class="line">    <span class="attr">client-type:</span> <span class="string">jedis</span>    <span class="comment"># 修改客户端为jedis</span></span><br><span class="line">    <span class="comment"># 修改jedis客户端的配置</span></span><br><span class="line">    <span class="attr">jedis:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">1s</span></span><br></pre></td></tr></table></figure>



<h3 id="4、使用redis来记录访问次数"><a href="#4、使用redis来记录访问次数" class="headerlink" title="4、使用redis来记录访问次数"></a>4、使用redis来记录访问次数</h3><p><strong>使用拦截器来处理</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">        System.out.println(uri);</span><br><span class="line">        redisTemplate.opsForValue().increment(uri); <span class="comment">// 每次访问 + 1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisInterceptor redisInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(redisInterceptor)</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/*&quot;</span>)</span><br><span class="line">                <span class="comment">// 放行所有的静态资源</span></span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/login&quot;</span>,<span class="string">&quot;/css/**&quot;</span>,<span class="string">&quot;/js/**&quot;</span>,<span class="string">&quot;/fonts/**&quot;</span>,<span class="string">&quot;/images/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h2 id="三、事物处理"><a href="#三、事物处理" class="headerlink" title="三、事物处理"></a>三、事物处理</h2><h3 id="1、Sql事物"><a href="#1、Sql事物" class="headerlink" title="1、Sql事物"></a>1、Sql事物</h3><h3 id="2、NoSql事物"><a href="#2、NoSql事物" class="headerlink" title="2、NoSql事物"></a>2、NoSql事物</h3><h1 id="06单元测试"><a href="#06单元测试" class="headerlink" title="06	单元测试"></a>06	单元测试</h1><h2 id="1-JUnit5变化"><a href="#1-JUnit5变化" class="headerlink" title="1.JUnit5变化"></a>1.JUnit5变化</h2><p>springBoot2.2版本开始引入JUnit5作为单元测试默认库</p>
<p>作为最新版本的JUnit框架，JUnit5与之前版本的Junit框架有很大的不同。由三个不同子项目的几个不同模块组成。</p>
<p><strong>JUnit 5 &#x3D; JUnit Platform + JUnit Jupiter + JUnit Vintage</strong></p>
<p><strong>JUnit Platform</strong>: Junit Platform是在JVM上启动测试框架的基础，不仅支持Junit自制的测试引擎，其他测试引擎也都可以接入。</p>
<p><strong>JUnit Jupiter</strong>: JUnit Jupiter提供了JUnit5的新的编程模型，是JUnit5新特性的核心。内部 包含了一个<strong>测试引擎</strong>，用于在Junit Platform上运行。</p>
<p><strong>JUnit Vintage</strong>: 由于JUint已经发展多年，为了照顾老的项目，JUnit Vintage提供了兼容JUnit4.x,Junit3.x的测试引擎。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/234bb64a1accdc1cae6161ec4bbb199b.png" alt="img"></p>
<p><strong>注意</strong>：</p>
<p>springBoot2.4版本开始移除了对Vintage的依赖，如果需要使用JUnit4需要自行引入</p>
<p>我们只需要引入单元测试的starter就可以使用对应的功能了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>SpringBoot整合Junit以后</strong></p>
<ul>
<li>编写测试方法：@Test标注（注意需要使用junit5版本的注解）</li>
<li>Junit类具有Spring的功能，@Autowired、比如 @Transactional 标注测试方法，测试完成后自动回滚</li>
</ul>
<h2 id="2-JUnit5常用注解"><a href="#2-JUnit5常用注解" class="headerlink" title="2.JUnit5常用注解"></a>2.JUnit5常用注解</h2><p>JUnit5的注解与JUnit4的注解有所变化</p>
<p><a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations">https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations</a></p>
<ul>
<li><p>**@Test :**表示方法是测试方法。但是与JUnit4的@Test不同，他的职责非常单一不能声明任何属性，拓展的测试将会由Jupiter提供额外测试</p>
</li>
<li><p>**@ParameterizedTest :**表示方法是参数化测试，下方会有详细介绍</p>
</li>
<li><p>**@RepeatedTest :**表示方法可重复执行，下方会有详细介绍</p>
</li>
<li><p>**@DisplayName :**为测试类或者测试方法设置展示名称</p>
</li>
<li><p>**@BeforeEach :**表示在每个单元测试之前执行</p>
</li>
<li><p>**@AfterEach :**表示在每个单元测试之后执行</p>
</li>
<li><p>**@BeforeAll :**表示在所有单元测试之前执行</p>
</li>
<li><p>**@AfterAll :**表示在所有单元测试之后执行</p>
</li>
<li><p>**@Tag :**表示单元测试类别，类似于JUnit4中的@Categories</p>
</li>
<li><p>**@Disabled :**表示测试类或测试方法不执行，类似于JUnit4中的@Ignore</p>
</li>
<li><p>**@Timeout :**表示测试方法运行如果超过了指定时间将会返回错误</p>
</li>
<li><p>**@ExtendWith :**为测试类或测试方法提供扩展类引用</p>
</li>
</ul>
<p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;测试JUnit5&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JUnit5Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span> <span class="comment">// 方法执行前执行</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeEach</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;测试方法执行前执行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Test</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;所有测试之前执行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test2</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试Disabled&quot;)</span></span><br><span class="line">    <span class="meta">@Disabled</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test3</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是不会执行的&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span>  <span class="comment">// 测试方法执行后执行</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test4</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;测试方法执行完成后执行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行之间超过400毫秒报错</span></span><br><span class="line">    <span class="meta">@Timeout(value = 400, unit = TimeUnit.MILLISECONDS)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test5</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-断言-assertions"><a href="#3-断言-assertions" class="headerlink" title="3.断言(assertions)"></a>3.断言(assertions)</h2><p><strong>断言就是断定会怎么怎么样，如果不是，就不成功或者报错</strong></p>
<p>断言（assertions）是测试方法中的核心部分，用来对测试需要满足的条件进行验证。<strong>这些断言方法都是 org.junit.jupiter.api.Assertions 的静态方法</strong>。JUnit 5 内置的断言可以分成如下几个类别：</p>
<p><strong>检查业务逻辑返回的数据是否合理。</strong></p>
<p><strong>所有的测试运行结束以后，会有一个详细的测试报告；</strong></p>
<h3 id="①简单断言"><a href="#①简单断言" class="headerlink" title="①简单断言"></a>①简单断言</h3><p>用来对单个值进行简单的验证。如：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>assertEquals</td>
<td>判断两个对象或两个原始类型是否相等</td>
</tr>
<tr>
<td>assertNotEquals</td>
<td>判断两个对象或两个原始类型是否不相等</td>
</tr>
<tr>
<td>assertSame</td>
<td>判断两个对象引用是否指向同一个对象</td>
</tr>
<tr>
<td>assertNotSame</td>
<td>判断两个对象引用是否指向不同的对象</td>
</tr>
<tr>
<td>assertTrue</td>
<td>判断给定的布尔值是否为 true</td>
</tr>
<tr>
<td>assertFalse</td>
<td>判断给定的布尔值是否为 false</td>
</tr>
<tr>
<td>assertNull</td>
<td>判断给定的对象引用是否为 null</td>
</tr>
<tr>
<td>assertNotNull</td>
<td>判断给定的对象引用是否不为 null</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;简单断言&quot;)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 第三个参数就是报错给出的消息，跟异常的message一样</span></span><br><span class="line">    assertEquals(<span class="number">1</span>,<span class="number">1</span>,<span class="string">&quot;两个数字不相等&quot;</span>);    <span class="comment">// 比较值</span></span><br><span class="line">    <span class="comment">// 判断两个对象是否一致</span></span><br><span class="line">    assertSame(<span class="keyword">new</span> <span class="title class_">Object</span>(), <span class="keyword">new</span> <span class="title class_">Object</span>(), <span class="string">&quot;两个对象不相等&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="②数组断言"><a href="#②数组断言" class="headerlink" title="②数组断言"></a>②数组断言</h3><p>通过 assertArrayEquals 方法来判断两个对象或原始类型的数组是否相等</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;数组断言&quot;)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test2</span><span class="params">()</span>&#123;</span><br><span class="line">    assertArrayEquals(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>&#125;, <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>&#125;, <span class="string">&quot;两个数组不相等&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="③组合断言"><a href="#③组合断言" class="headerlink" title="③组合断言"></a>③组合断言</h3><p>assertAll 方法接受多个 org.junit.jupiter.api.Executable 函数式接口的实例作为要验证的断言，可以通过 lambda 表达式很容易的提供这些断言</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;组合断言&quot;)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test3</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="type">Object</span> <span class="variable">o1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    assertAll(<span class="string">&quot;Math&quot;</span>,</span><br><span class="line">            () -&gt; assertEquals(<span class="number">2</span>, <span class="number">2</span>, <span class="string">&quot;两个值不相等&quot;</span>),</span><br><span class="line">            () -&gt; assertTrue(<span class="number">1</span> &gt; <span class="number">0</span>),</span><br><span class="line">            () -&gt; assertSame(o, o1, <span class="string">&quot;不是同一个对象&quot;</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="④异常断言"><a href="#④异常断言" class="headerlink" title="④异常断言"></a>④异常断言</h3><p>在JUnit4时期，想要测试方法的异常情况时，需要用**@Rule<strong>注解的ExpectedException变量还是比较麻烦的。而JUnit5提供了一种新的断言方式</strong>Assertions.assertThrows()** ,配合函数式编程就可以进行使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;异常测试&quot;)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test4</span><span class="params">()</span>&#123;</span><br><span class="line">    assertThrows(</span><br><span class="line">            <span class="comment">// 抛出断言异常，没抛出就是没有成功</span></span><br><span class="line">            ArithmeticException.class,</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="number">1</span> / <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="⑤超时断言"><a href="#⑤超时断言" class="headerlink" title="⑤超时断言"></a>⑤超时断言</h3><p>Junit5还提供了<strong>Assertions.assertTimeout()</strong> 为测试方法设置了超时时间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;超时断言&quot;)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 测试方法执行事件超过1s就会报错</span></span><br><span class="line">    assertTimeout(Duration.ofMillis(<span class="number">1000</span>), () -&gt; &#123;Thread.sleep(<span class="number">500</span>);&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="⑥快速失败"><a href="#⑥快速失败" class="headerlink" title="⑥快速失败"></a>⑥快速失败</h3><p>通过 fail 方法直接使得测试失败</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;快速失败&quot;)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test6</span><span class="params">()</span>&#123;</span><br><span class="line">    fail(<span class="string">&quot;快速失败&quot;</span>);   <span class="comment">// 提示信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="4-前置条件（assumptions）"><a href="#4-前置条件（assumptions）" class="headerlink" title="4.前置条件（assumptions）"></a>4.前置条件（assumptions）</h2><p>JUnit 5 中的前置条件（<strong>assumptions【假设】</strong>）类似于断言，不同之处在于<strong>不满足的断言会使得测试方法失败</strong>，而不满足的<strong>前置条件只会使得测试方法的执行终止</strong>。前置条件可以看成是测试方法执行的前提，当该前提不满足时，就没有继续执行的必要。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;测试前置条件&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestAssumptions</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">environment</span> <span class="operator">=</span> <span class="string">&quot;DEV&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DisplayName(&quot;simple&quot;)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// assumeTrue和assumeFalse确保给定条件为true或false，不满足条件会使得测试停止</span></span><br><span class="line">        assumeTrue(Objects.equals(<span class="built_in">this</span>.environment, <span class="string">&quot;DEV&quot;</span>));</span><br><span class="line">        assumeFalse(() -&gt; Objects.equals(<span class="built_in">this</span>.environment, <span class="string">&quot;PROD&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DisplayName(&quot;assume then do&quot;)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// assumingThat 的参数是表示条件的布尔值和对应的 Executable 接口的实现对象。</span></span><br><span class="line">        <span class="comment">// 只有条件满足时，Executable 对象才会被执行；当条件不满足时，测试执行并不会终止。</span></span><br><span class="line">        assumingThat(</span><br><span class="line">                Objects.equals(<span class="built_in">this</span>.environment, <span class="string">&quot;DEV&quot;</span>),</span><br><span class="line">                () -&gt; System.out.println(<span class="string">&quot;In DEV&quot;</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="5-嵌套测试"><a href="#5-嵌套测试" class="headerlink" title="5.嵌套测试"></a>5.嵌套测试</h2><p>JUnit 5 可以通过 Java 中的内部类和@Nested 注解实现嵌套测试，从而可以更好的把相关的测试方法组织在一起。在内部类中可以使用@BeforeEach 和@AfterEach 注解，而且嵌套的层次没有限制。</p>
<p>外面的不能使用里面的@Before和@after中的测试方法，内嵌的可以使用外部的@Before和@After的测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;测试嵌套测试&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestNested</span> &#123;</span><br><span class="line"></span><br><span class="line">    Stack&lt;Object&gt; stack;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;is instantiated with new Stack()&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">isInstantiatedWithNew</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不能使用内嵌的before，所以对象为null，会报错</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test</span><span class="params">()</span>&#123;</span><br><span class="line">        assertNotNull(stack, <span class="string">&quot;对象为null&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nested</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;when new&quot;)</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">WhenNew</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@BeforeEach</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">createNewStack</span><span class="params">()</span> &#123;</span><br><span class="line">            stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;is empty&quot;)</span></span><br><span class="line">          <span class="keyword">void</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">            assertTrue(stack.isEmpty());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;throws EmptyStackException when popped&quot;)</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">throwsExceptionWhenPopped</span><span class="params">()</span> &#123;</span><br><span class="line">            assertThrows(EmptyStackException.class, stack::pop);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;throws EmptyStackException when peeked&quot;)</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">throwsExceptionWhenPeeked</span><span class="params">()</span> &#123;</span><br><span class="line">            assertThrows(EmptyStackException.class, stack::peek);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Nested</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;after pushing an element&quot;)</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">AfterPushing</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">anElement</span> <span class="operator">=</span> <span class="string">&quot;an element&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@BeforeEach</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">pushAnElement</span><span class="params">()</span> &#123;</span><br><span class="line">                stack.push(anElement);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;it is no longer empty&quot;)</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">isNotEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">                assertFalse(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;returns the element when popped and is empty&quot;)</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">returnElementWhenPopped</span><span class="params">()</span> &#123;</span><br><span class="line">                assertEquals(anElement, stack.pop());</span><br><span class="line">                assertTrue(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;returns the element when peeked but remains not empty&quot;)</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">returnElementWhenPeeked</span><span class="params">()</span> &#123;</span><br><span class="line">                assertEquals(anElement, stack.peek());</span><br><span class="line">                assertFalse(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="6-参数化测试"><a href="#6-参数化测试" class="headerlink" title="6.参数化测试"></a>6.参数化测试</h2><p>参数化测试是JUnit5很重要的一个新特性，它使得用不同的参数多次运行测试成为了可能，也为我们的单元测试带来许多便利。</p>
<p>利用**@ValueSource**等注解，指定入参，我们将可以使用不同的参数进行多次单元测试，而不需要每新增一个参数就新增一个单元测试，省去了很多冗余代码。</p>
<p><strong>@ValueSource</strong>: 为参数化测试指定入参来源，支持八大基础类以及String类型,Class类型</p>
<p><strong>@NullSource</strong>: 表示为参数化测试提供一个null的入参</p>
<p><strong>@EnumSource</strong>: 表示为参数化测试提供一个枚举入参</p>
<p><strong>@CsvFileSource</strong>：表示读取指定CSV文件内容作为参数化测试入参</p>
<p><strong>@MethodSource</strong>：表示读取指定方法的返回值作为参数化测试入参(注意方法返回需要是一个流)</p>
<p>当然如果参数化测试仅仅只能做到指定普通的入参还达不到让我觉得惊艳的地步。让我真正感到他的强大之处的地方在于他可以支持外部的各类入参。如:CSV,YML,JSON 文件甚至方法的返回值也可以作为入参。只需要去实现<strong>ArgumentsProvider</strong>接口，任何外部文件都可以作为它的入参。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;测试参数化测试&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSource</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@ValueSource(strings = &#123;&quot;one&quot;, &quot;two&quot;, &quot;three&quot;&#125;)</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;参数化测试&quot;)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test1</span><span class="params">(String string)</span>&#123;</span><br><span class="line">        System.out.println(string);</span><br><span class="line">        assertTrue(StringUtils.isNotBlank(string));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@MethodSource(&quot;method&quot;)</span>     <span class="comment">// 指定方法名</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;方法来源参数&quot;)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Test2</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        assertNotNull(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 必须是static的</span></span><br><span class="line">    <span class="keyword">static</span> Stream&lt;String&gt; <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Stream.of(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="7-不会参考官方文档"><a href="#7-不会参考官方文档" class="headerlink" title="7.不会参考官方文档"></a>7.不会参考官方文档</h2><p><a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests">https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests</a></p>
<h1 id="07指标监控"><a href="#07指标监控" class="headerlink" title="07	指标监控"></a>07	指标监控</h1><h2 id="1-SpringBoot-Actuator"><a href="#1-SpringBoot-Actuator" class="headerlink" title="1.SpringBoot Actuator"></a>1.SpringBoot Actuator</h2><h3 id="①简介-1"><a href="#①简介-1" class="headerlink" title="①简介"></a>①简介</h3><p>未来每一个微服务在云上部署以后，我们都需要对其进行监控、追踪、审计、控制等。SpringBoot就抽取了Actuator场景，使得我们每个微服务快速引用即可获得生产级别的应用监控、审计等功能。</p>
<h3 id="②1-x与2-x的不同"><a href="#②1-x与2-x的不同" class="headerlink" title="②1.x与2.x的不同"></a>②1.x与2.x的不同</h3><p><img src="https://img-blog.csdnimg.cn/img_convert/88d6c142bde6fd8b22723e7ecfade0c5.png" alt="img"></p>
<h3 id="③如何使用"><a href="#③如何使用" class="headerlink" title="③如何使用"></a>③如何使用</h3><p><strong>引入指标监控的stater</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>只要引入场景我们就可以使用指标监控功能了</p>
<ul>
<li><p>访问 <a target="_blank" rel="noopener" href="http://localhost:8080/actuator/**%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%9A%B4%E9%9C%B2%E8%BF%99%E5%87%A0%E4%B8%AA%E7%AB%AF%E7%82%B9">http://localhost:8080/actuator/**，默认暴露这几个端点</a></p>
</li>
<li><p><img src="https://img-blog.csdnimg.cn/20210717154941863.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p>默认是开启了health和info的web展示</p>
</li>
<li><p>暴露所有监控信息为http</p>
</li>
<li><pre><code class="yml">management:
  endpoints:  # 所有的端点配置
    enabled-by-default: true  # 暴露所有端点
    web:
      exposure:
        include: &#39;*&#39;  # 以web的方式暴露
  endpoint:   # 使用单个的端点配置
    health:
      show-details: always    # 总是展示详细信息
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**测试**</span><br><span class="line"></span><br><span class="line">![在这里插入图片描述](https://img-blog.csdnimg.cn/20210717154950965.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![在这里插入图片描述](https://img-blog.csdnimg.cn/20210717154959565.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**cmd输入jconsole打开java的指标监控功能，原生的JMX**</span><br><span class="line"></span><br><span class="line">![在这里插入图片描述](https://img-blog.csdnimg.cn/20210717155007994.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 2.Actuator Endpoint</span><br><span class="line"></span><br><span class="line">### ①最常使用的端点</span><br><span class="line"></span><br><span class="line">| ID                 | 描述                                                         |</span><br><span class="line">| ------------------ | ------------------------------------------------------------ |</span><br><span class="line">| `auditevents`      | 暴露当前应用程序的审核事件信息。需要一个`AuditEventRepository组件`。 |</span><br><span class="line">| `beans`            | 显示应用程序中所有Spring Bean的完整列表。                    |</span><br><span class="line">| `caches`           | 暴露可用的缓存。                                             |</span><br><span class="line">| `conditions`       | 显示自动配置的所有条件信息，包括匹配或不匹配的原因。         |</span><br><span class="line">| `configprops`      | 显示所有`@ConfigurationProperties`。                         |</span><br><span class="line">| `env`              | 暴露Spring的属性`ConfigurableEnvironment`                    |</span><br><span class="line">| `flyway`           | 显示已应用的所有Flyway数据库迁移。 需要一个或多个`Flyway`组件。 |</span><br><span class="line">| `health`           | 显示应用程序运行状况信息。                                   |</span><br><span class="line">| `httptrace`        | 显示HTTP跟踪信息（默认情况下，最近100个HTTP请求-响应）。需要一个`HttpTraceRepository`组件。 |</span><br><span class="line">| `info`             | 显示应用程序信息。                                           |</span><br><span class="line">| `integrationgraph` | 显示Spring `integrationgraph` 。需要依赖`spring-integration-core`。 |</span><br><span class="line">| `loggers`          | 显示和修改应用程序中日志的配置。                             |</span><br><span class="line">| `liquibase`        | 显示已应用的所有Liquibase数据库迁移。需要一个或多个`Liquibase`组件。 |</span><br><span class="line">| `metrics`          | 显示当前应用程序的“指标”信息。                               |</span><br><span class="line">| `mappings`         | 显示所有`@RequestMapping`路径列表。                          |</span><br><span class="line">| `scheduledtasks`   | 显示应用程序中的计划任务。                                   |</span><br><span class="line">| `sessions`         | 允许从Spring Session支持的会话存储中检索和删除用户会话。需要使用Spring Session的基于Servlet的Web应用程序。 |</span><br><span class="line">| `shutdown`         | 使应用程序正常关闭。默认禁用。                               |</span><br><span class="line">| `startup`          | 显示由`ApplicationStartup`收集的启动步骤数据。需要使用`SpringApplication`进行配置`BufferingApplicationStartup`。 |</span><br><span class="line">| `threaddump`       | 执行线程转储。                                               |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">如果您的应用程序是Web应用程序（Spring MVC，Spring WebFlux或Jersey），则可以使用以下附加端点：</span><br><span class="line"></span><br><span class="line">| ID           | 描述                                                         |</span><br><span class="line">| ------------ | ------------------------------------------------------------ |</span><br><span class="line">| `heapdump`   | 返回`hprof`堆转储文件。                                      |</span><br><span class="line">| `jolokia`    | 通过HTTP暴露JMX bean（需要引入Jolokia，不适用于WebFlux）。需要引入依赖`jolokia-core`。 |</span><br><span class="line">| `logfile`    | 返回日志文件的内容（如果已设置`logging.file.name`或`logging.file.path`属性）。支持使用HTTP`Range`标头来检索部分日志文件的内容。 |</span><br><span class="line">| `prometheus` | 以Prometheus服务器可以抓取的格式公开指标。需要依赖`micrometer-registry-prometheus`。 |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">最常用的Endpoint</span><br><span class="line"></span><br><span class="line">-   **Health：监控状况**</span><br><span class="line">-   **Metrics：运行时指标**</span><br><span class="line"></span><br><span class="line">-   **Loggers：日志记录**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### ②Health Endpoint</span><br><span class="line"></span><br><span class="line">健康检查端点，我们一般用于在云平台，平台会定时的检查应用的健康状况，我们就需要Health Endpoint可以为平台返回当前应用的一系列组件健康状况的集合。</span><br><span class="line"></span><br><span class="line">重要的几点：</span><br><span class="line"></span><br><span class="line">-   health endpoint返回的结果，应该是一系列健康检查后的一个汇总报告</span><br><span class="line">-   很多的健康检查默认已经自动配置好了，比如：数据库、redis等</span><br><span class="line"></span><br><span class="line">-   可以很容易的添加自定义的健康检查机制</span><br><span class="line"></span><br><span class="line">![img](https://img-blog.csdnimg.cn/img_convert/375e6b2d4b0dcaa76b8b12e4ea2cadd7.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### ③Metrics Endpoint</span><br><span class="line"></span><br><span class="line">提供详细的、层级的、空间指标信息，这些信息可以被pull（主动推送）或者push（被动获取）方式得到；</span><br><span class="line"></span><br><span class="line">-   通过Metrics对接多种监控系统</span><br><span class="line">-   简化核心Metrics开发</span><br><span class="line"></span><br><span class="line">-   添加自定义Metrics或者扩展已有Metrics</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### ④管理Endpoions</span><br><span class="line"></span><br><span class="line">#### 1.开启与禁用Endpoions</span><br><span class="line"></span><br><span class="line">-   默认开启所有的Endpoint都是开启的（除了shutdown）</span><br><span class="line"></span><br><span class="line">-   需要开启或者禁用某个Endpoint。可以是用单个endpoint来开启或者禁用</span><br><span class="line"></span><br><span class="line">    -   ```yml</span><br><span class="line">        management:</span><br><span class="line">          endpoint:</span><br><span class="line">            beans:</span><br><span class="line">              enabled: true		# false就是禁用</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<h4 id="2-暴露Endpoints"><a href="#2-暴露Endpoints" class="headerlink" title="2.暴露Endpoints"></a>2.暴露Endpoints</h4><p><strong>支持的暴露方式</strong></p>
<ul>
<li><p>HTTP：默认只暴露<strong>health</strong>和<strong>info</strong> Endpoint</p>
</li>
<li><p><strong>JMX</strong>：默认暴露所有Endpoint</p>
</li>
<li><p>除过health和info，剩下的Endpoint都应该进行保护访问。如果引入SpringSecurity，则会默认配置安全访问规则</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>ID</th>
<th>JMX</th>
<th>Web</th>
</tr>
</thead>
<tbody><tr>
<td><code>auditevents</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>beans</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>caches</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>conditions</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>configprops</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>env</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>flyway</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>health</code></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><code>heapdump</code></td>
<td>N&#x2F;A</td>
<td>No</td>
</tr>
<tr>
<td><code>httptrace</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>info</code></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><code>integrationgraph</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>jolokia</code></td>
<td>N&#x2F;A</td>
<td>No</td>
</tr>
<tr>
<td><code>logfile</code></td>
<td>N&#x2F;A</td>
<td>No</td>
</tr>
<tr>
<td><code>loggers</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>liquibase</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>metrics</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>mappings</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>prometheus</code></td>
<td>N&#x2F;A</td>
<td>No</td>
</tr>
<tr>
<td><code>scheduledtasks</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>sessions</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>shutdown</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>startup</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>threaddump</code></td>
<td>Yes</td>
<td>No</td>
</tr>
</tbody></table>
<h2 id="3-定制-Endpoint"><a href="#3-定制-Endpoint" class="headerlink" title="3.定制 Endpoint"></a>3.定制 Endpoint</h2><h3 id="①定制Health"><a href="#①定制Health" class="headerlink" title="①定制Health"></a>①定制Health</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>  <span class="comment">// 放入到容器中</span></span><br><span class="line"><span class="comment">// 类名后面一定是HealthIndicator，规范</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyHealthIndicator</span> <span class="keyword">extends</span> <span class="title class_">AbstractHealthIndicator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 真实的检查方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> builder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doHealthCheck</span><span class="params">(Health.Builder builder)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 创建map来存放我们想要展示的数据</span></span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span> == <span class="number">1</span>)&#123;</span><br><span class="line"><span class="comment">//            builder.up();   // up就是健康的</span></span><br><span class="line">            builder.status(Status.UP);</span><br><span class="line">            map.put(<span class="string">&quot;count&quot;</span>, <span class="number">1</span>);</span><br><span class="line">            map.put(<span class="string">&quot;ms&quot;</span>, <span class="number">500</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//            builder.down(); // down就是不健康的</span></span><br><span class="line">            builder.status(Status.DOWN);</span><br><span class="line">            map.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;连接超时&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 详细信息</span></span><br><span class="line">        builder.withDetail(<span class="string">&quot;code&quot;</span>, <span class="number">100</span>);</span><br><span class="line">        <span class="comment">// 传入一个map，里面是我们想要展示的详细信息</span></span><br><span class="line">        builder.withDetails(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果显示</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717155023765.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>这个监控的名字就是我们的类名（除了HealthIndicator）</strong></p>
<h3 id="②定制info信息"><a href="#②定制info信息" class="headerlink" title="②定制info信息"></a>②定制info信息</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleInfoContributor</span> <span class="keyword">implements</span> <span class="title class_">InfoContributor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contribute</span><span class="params">(Info.Builder builder)</span> &#123;</span><br><span class="line">        <span class="comment">// 用法和之前的一样</span></span><br><span class="line">        builder.withDetail(<span class="string">&quot;example&quot;</span>, Collections.singletonMap(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">appName:</span> <span class="string">boot-admin</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span></span><br><span class="line">  <span class="attr">mavenProjectName:</span> <span class="string">@project.artifactId@</span>    <span class="comment"># 使用@@可以获取maven的pom文本值</span></span><br><span class="line">  <span class="attr">mavenProjectVersion:</span> <span class="string">@project.version@</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717155033950.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="③定制Metrics信息"><a href="#③定制Metrics信息" class="headerlink" title="③定制Metrics信息"></a>③定制Metrics信息</h3><h4 id="1-SpringBoot支持自动适配的Metrics"><a href="#1-SpringBoot支持自动适配的Metrics" class="headerlink" title="1.SpringBoot支持自动适配的Metrics"></a>1.SpringBoot支持自动适配的Metrics</h4><ul>
<li><p>JVM metrics, report utilization of:</p>
</li>
<li><p>Various memory and buffer pools</p>
</li>
<li><p>Statistics related to garbage collection</p>
</li>
<li><p>Threads utilization</p>
</li>
<li><p>Number of classes loaded&#x2F;unloaded</p>
</li>
<li><p>CPU metrics</p>
</li>
<li><p>File descriptor metrics</p>
</li>
<li><p>Kafka consumer and producer metrics</p>
</li>
<li><p>Log4j2 metrics: record the number of events logged to Log4j2 at each level</p>
</li>
<li><p>Logback metrics: record the number of events logged to Logback at each level</p>
</li>
<li><p>Uptime metrics: report a gauge for uptime and a fixed gauge representing the application’s absolute start time</p>
</li>
<li><p>Tomcat metrics (<code>server.tomcat.mbeanregistry.enabled</code> must be set to <code>true</code> for all Tomcat metrics to be registered)</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-integration/docs/5.4.1/reference/html/system-management.html#micrometer-integration">Spring Integration</a> metrics</p>
</li>
</ul>
<h4 id="2、增加定制Metrics"><a href="#2、增加定制Metrics" class="headerlink" title="2、增加定制Metrics"></a>2、增加定制Metrics</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CityController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CityService cityService;</span><br><span class="line"></span><br><span class="line">    Counter counter;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CityController</span><span class="params">(MeterRegistry meterRegistry)</span> &#123;</span><br><span class="line">        counter = meterRegistry.counter(<span class="string">&quot;myservice.saveCity.count&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/city&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> City <span class="title function_">saveCity</span><span class="params">(City city)</span> &#123;</span><br><span class="line">        cityService.saveCity(city);</span><br><span class="line">        counter.increment();    <span class="comment">// 调用一次就+1</span></span><br><span class="line">        System.out.println(counter.count());    <span class="comment">// 打印记录的次数</span></span><br><span class="line">        <span class="keyword">return</span> city;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果显示</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717155045620.png" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/2021071715505330.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>也可以使用@Bean注解注入到容器中</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">MeterBinder <span class="title function_">queueSize</span><span class="params">(Queue queue)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (registry) -&gt; Gauge.builder(<span class="string">&quot;queueSize&quot;</span>, queue::size).register(registry);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210717155101665.png" alt="在这里插入图片描述"></p>
<h3 id="④定制Endpoint"><a href="#④定制Endpoint" class="headerlink" title="④定制Endpoint"></a>④定制Endpoint</h3><p>在类上标注@Endpoint注解就表示这个类是一个端点类</p>
<p><strong>@ReadOperation</strong>是它的读方法，也就是展示需要读取的数据</p>
<p><strong>@WriteOperation</strong>写方法，它可以用来改变或者停止我们线上的功能</p>
<p><strong>代码实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Endpoint(id = &quot;container&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DockerEndpoint</span>  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ReadOperation</span></span><br><span class="line">    <span class="keyword">public</span> Map <span class="title function_">getDockerInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.singletonMap(<span class="string">&quot;info&quot;</span>, <span class="string">&quot;docker started...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@WriteOperation</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stopDocker</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;docker stop....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717155111274.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20210717155120671.png" alt="在这里插入图片描述"></p>
<p><strong>获取@ReadOperation标注的方法的返回值展示给我们</strong></p>
<p>打开jconsole，原生的JMX来执行 @WriteOperation标注的方法</p>
<p><img src="https://img-blog.csdnimg.cn/20210717155130711.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210717155139687.png" alt="在这里插入图片描述"></p>
<p>场景：开发<strong>ReadinessEndpoint</strong>来管理程序是否就绪，或者<strong>Liveness****Endpoint</strong>来管理程序是否存活；</p>
<p>当然，这个也可以直接使用 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-kubernetes-probes">https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-kubernetes-probes</a></p>
<h2 id="4-可视化"><a href="#4-可视化" class="headerlink" title="4.可视化"></a>4.可视化</h2><p><a target="_blank" rel="noopener" href="https://github.com/codecentric/spring-boot-admin">https://github.com/codecentric/spring-boot-admin</a></p>
<h3 id="①设置springBoot管理器"><a href="#①设置springBoot管理器" class="headerlink" title="①设置springBoot管理器"></a>①设置springBoot管理器</h3><p>官方文档：<a target="_blank" rel="noopener" href="https://codecentric.github.io/spring-boot-admin/2.3.1/#getting-started">https://codecentric.github.io/spring-boot-admin/2.3.1/#getting-started</a></p>
<p><strong>创建一个新的项目</strong></p>
<p><strong>引入依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>开启功能</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAdminServer</span>	<span class="comment">// 开启服务</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ServiceApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>修改端口号</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8888</span></span><br></pre></td></tr></table></figure>

<p><strong>进行访问：<a target="_blank" rel="noopener" href="http://localhost:8888/applications">http://localhost:8888/applications</a></strong><br><img src="https://img-blog.csdnimg.cn/20210717155152693.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="②注册客户端应用程序"><a href="#②注册客户端应用程序" class="headerlink" title="②注册客户端应用程序"></a>②注册客户端应用程序</h3><p><strong>引入依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--暂时不需要--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>配置应用属性</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.boot.admin.client.url</span>=<span class="string">http://localhost:8888  # 服务端口号</span></span><br><span class="line"><span class="attr">management.endpoints.web.exposure.include</span>=<span class="string">*  # web形式暴露所有端口</span></span><br></pre></td></tr></table></figure>



<p><strong>查看是否注册成功</strong></p>
<p><img src="https://img-blog.csdnimg.cn/202107171552048.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20210717155211286.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>使用它我们就可以监控我们所有的端点了</strong></p>
<h1 id="08高级特性"><a href="#08高级特性" class="headerlink" title="08	高级特性"></a>08	高级特性</h1><h2 id="1-Profile功能"><a href="#1-Profile功能" class="headerlink" title="1.Profile功能"></a>1.Profile功能</h2><h3 id="①application-profile功能"><a href="#①application-profile功能" class="headerlink" title="①application-profile功能"></a>①application-profile功能</h3><ul>
<li><p>默认配置文件 application.yaml	一定会加载</p>
</li>
<li><p>指定环境配置文件 aaplication-{env}.yml</p>
</li>
<li><p>激活指定环境</p>
<ul>
<li><p>配置文件激活     </p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span>		<span class="comment"># 激活指定的环境</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># active: dev, druid 指定多个环境</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>命令行激活：<strong>java -jar xxx.jar –spring.profile.active&#x3D;dev –person.name&#x3D;major</strong></p>
</li>
<li><p>修改配置文件任意值，命令行优先</p>
</li>
</ul>
</li>
<li><p>默认配置与环境配置同时生效</p>
</li>
<li><p>同名配置项，profile配置优先，默认配置会别覆盖</p>
</li>
</ul>
<p><strong>测试</strong></p>
<p>在类路径下创建两个文件，生产环境和测试环境</p>
<p><img src="https://img-blog.csdnimg.cn/2021071715522464.png" alt="在这里插入图片描述"></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span>  <span class="comment"># 默认配置</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span>  <span class="comment"># 生产配置</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8002</span>  <span class="comment"># 测试配置</span></span><br></pre></td></tr></table></figure>

<p><strong>使用默认配置来指定环境</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">test</span></span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/2021071715523317.png" alt="在这里插入图片描述"></p>
<h3 id="②-Profile条件装配功能"><a href="#②-Profile条件装配功能" class="headerlink" title="②@Profile条件装配功能"></a>②@Profile条件装配功能</h3><p>@Profile注解功能就是只有当前是指定环境的时候，这个类的的功能才会生效</p>
<h4 id="1-标注在类上"><a href="#1-标注在类上" class="headerlink" title="1.标注在类上"></a>1.标注在类上</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line">    Integer <span class="title function_">getAge</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Profile(&quot;test&quot;)</span>    <span class="comment">// 测试配置下生效</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;person&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Boss</span> <span class="keyword">implements</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Profile(&quot;pro&quot;)</span>    <span class="comment">// 生产配置有效</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;person&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Worker</span> <span class="keyword">implements</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>controller编写</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersonController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Person person;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/person&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">person</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> person.getName() + <span class="string">&quot;和&quot;</span> + person.getAge();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>配置文件编写</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">test</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 生产环境</span></span><br><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">员工</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">19</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试环境</span></span><br><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">老板</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">40</span></span><br></pre></td></tr></table></figure>

<p><strong>结果显示</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717155243530.png" alt="在这里插入图片描述"></p>
<h4 id="2-标注在方法上"><a href="#2-标注在方法上" class="headerlink" title="2.标注在方法上"></a>2.标注在方法上</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Color</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Profile(&quot;test&quot;)</span>	<span class="comment">// test下有效</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Color <span class="title function_">color</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Color</span> <span class="variable">color</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Color</span>();</span><br><span class="line">        color.setName(<span class="string">&quot;red&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Profile(&quot;pro&quot;)</span>		<span class="comment">// pro下有效</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Color <span class="title function_">color2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Color</span> <span class="variable">color</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Color</span>();</span><br><span class="line">        color.setName(<span class="string">&quot;blue&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/202107171553056.png" alt="在这里插入图片描述"></p>
<h2 id="2-外部话配置"><a href="#2-外部话配置" class="headerlink" title="2.外部话配置"></a>2.外部话配置</h2><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config">https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config</a></p>
<h3 id="①外部配置源"><a href="#①外部配置源" class="headerlink" title="①外部配置源"></a>①外部配置源</h3><p>外部配置源常用：<strong>properties文件</strong>、<strong>YAML文件</strong>、<strong>环境变量</strong>、<strong>命令行参数</strong>；</p>
<h3 id="②配置文件查找位置"><a href="#②配置文件查找位置" class="headerlink" title="②配置文件查找位置"></a>②配置文件查找位置</h3><p>(1) classpath 根路径</p>
<p>(2) classpath 根路径下config目录</p>
<p>(3) jar包当前目录</p>
<p>(4) jar包当前目录的config目录</p>
<p>(5) &#x2F;config子目录的直接子目录</p>
<h3 id="③配置文件加载顺序"><a href="#③配置文件加载顺序" class="headerlink" title="③配置文件加载顺序"></a>③配置文件加载顺序</h3><ol>
<li>当前jar包内部的application.properties和application.yml</li>
<li>当前jar包内部的application-{profile}.properties 和 application-{profile}.yml</li>
<li>引用的外部jar包的application.properties和application.yml</li>
<li>引用的外部jar包的application-{profile}.properties 和 application-{profile}.yml</li>
</ol>
<h3 id="④指定环境优先，外部优先，后面的可以覆盖前面的同名配置项"><a href="#④指定环境优先，外部优先，后面的可以覆盖前面的同名配置项" class="headerlink" title="④指定环境优先，外部优先，后面的可以覆盖前面的同名配置项"></a>④指定环境优先，外部优先，后面的可以覆盖前面的同名配置项</h3><h2 id="3-自定义starter"><a href="#3-自定义starter" class="headerlink" title="3.自定义starter"></a>3.自定义starter</h2><p>①创建一个空的java项目 <strong>customer-starter</strong></p>
<p>②在空的java项目中创建一个空的的maven项目和一个SpringBoot项目（名字随你起）</p>
<p>maven：<strong>xiaozhi-hello-spring-boot-starte（启动器）</strong></p>
<p>springBoot项目：<strong>xiaozhi-hello-spring-boot-starter-autoconfigure（自动配置包）</strong></p>
<p>③空的maven项目将springBoot项目引入进来，maven项目的主要作用就是引用我们的springBoot项目</p>
<p>④在springBoot项目中编写我们的starter代码</p>
<ul>
<li>可以仿照springBoot的来做</li>
</ul>
<p><strong>代码实现</strong></p>
<h3 id="1-创建项目并引入依赖"><a href="#1-创建项目并引入依赖" class="headerlink" title="1.创建项目并引入依赖"></a>1.创建项目并引入依赖</h3><p>①创建springBoot项目，只留下启动器就好了</p>
<p><img src="https://img-blog.csdnimg.cn/20210717155337818.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>②创建maven项目，并引入springBoot项目的依赖</p>
<p><img src="https://img-blog.csdnimg.cn/20210717155350654.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="2-在springBoot项目中编写代码"><a href="#2-在springBoot项目中编写代码" class="headerlink" title="2.在springBoot项目中编写代码"></a>2.在springBoot项目中编写代码</h3><h4 id="①创建配置类"><a href="#①创建配置类" class="headerlink" title="①创建配置类"></a>①创建配置类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(&quot;xiaozhi.name&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String prefix;</span><br><span class="line">    <span class="keyword">private</span> String suffix;</span><br><span class="line"></span><br><span class="line">	get和set方法。。。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="②编写功能类"><a href="#②编写功能类" class="headerlink" title="②编写功能类"></a>②编写功能类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> helloProperties.getPrefix() + username + helloProperties.getSuffix();</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="③编写配置类"><a href="#③编写配置类" class="headerlink" title="③编写配置类"></a>③编写配置类</h4><p>编写配置类，然后将功能类注入到容器中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(HelloProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServiceAutoConfiguration</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注入写好的功能类</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(HelloService.class)</span>   <span class="comment">// 没有这个类型的组件注入</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HelloService <span class="title function_">helloService</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HelloService</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="④创建spring-factories文件"><a href="#④创建spring-factories文件" class="headerlink" title="④创建spring.factories文件"></a>④创建spring.factories文件</h4><p>在类路径下创建META-INF文件，再创建spring.factories文件，内容是我们需要到入的xxxAutoConfiguration类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">com.xiaozhi.hello.auto.HelloServiceAutoConfiguration</span><br></pre></td></tr></table></figure>

<h4 id="⑤下载到本地仓库"><a href="#⑤下载到本地仓库" class="headerlink" title="⑤下载到本地仓库"></a>⑤下载到本地仓库</h4><p>先将自动配置包clear再install下载到本地maven仓库，再将启动器clear再install</p>
<h3 id="3-测试"><a href="#3-测试" class="headerlink" title="3.测试"></a>3.测试</h3><h4 id="①引入我们自定义的starter"><a href="#①引入我们自定义的starter" class="headerlink" title="①引入我们自定义的starter"></a>①引入我们自定义的starter</h4><p><img src="https://img-blog.csdnimg.cn/20210717155408593.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="②编写业务代码"><a href="#②编写业务代码" class="headerlink" title="②编写业务代码"></a>②编写业务代码</h4><p><strong>controller</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloService helloService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">xiaozhi</span> <span class="operator">=</span> helloService.getName(<span class="string">&quot;小智&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> xiaozhi;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>配置文件</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">xiaozhi:</span></span><br><span class="line">  <span class="attr">name:</span></span><br><span class="line">    <span class="attr">prefix:</span> <span class="string">中国的</span></span><br><span class="line">    <span class="attr">suffix:</span> <span class="string">是最帅的</span></span><br></pre></td></tr></table></figure>

<p><strong>结果</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717155430214.png" alt="在这里插入图片描述"></p>
<h1 id="09原理解析"><a href="#09原理解析" class="headerlink" title="09	原理解析"></a>09	原理解析</h1><h2 id="1-springBoot启动过程"><a href="#1-springBoot启动过程" class="headerlink" title="1.springBoot启动过程"></a>1.springBoot启动过程</h2><p><img src="https://img-blog.csdnimg.cn/20210717155438298.png" alt="在这里插入图片描述"></p>
<p>可以拆分成两个部分，一个是<strong>创建SpringApplication</strong>和<strong>运行SpringApplication</strong></p>
<h3 id="①创建SpringApplication"><a href="#①创建SpringApplication" class="headerlink" title="①创建SpringApplication"></a>①创建SpringApplication</h3><ol>
<li><p>创建一个集合，放入我们的主启动类</p>
</li>
<li><p>判断当前应用的类型（servlet类型）</p>
<ul>
<li>ClassUtils.isPresent（）方法判断</li>
</ul>
</li>
<li><p><strong>bootstrappers</strong>：初始启动引导器。 去<strong>spring.factories</strong>文件中找<strong>org.springframework.boot.Bootstrapper</strong></p>
<p>&#x3D;&#x3D;getSpringFactoriesInstances(Class<T> type, Class&lt;?&gt;[] parameterTypes, Object… args)&#x3D;&#x3D;</p>
<ul>
<li><p>往下执行到<strong>getSpringFactoriesInstances</strong>方法中通过<strong>loadFactoryNames</strong>方法得到需要导入的类名</p>
</li>
<li><p><strong>loadFactoryNames</strong>方法调用<strong>loadSpringFactories</strong>方法来<strong>加载spring.factories文件</strong>得到需要的类名</p>
<ol>
<li><p>首先它会从缓存中拿取数据，第一次是没有数据的</p>
</li>
<li><p>第一次它会加载<strong>spring.factories</strong>文件，然后通过Properties去加载得到kv键值对，value是List类型</p>
<p><img src="https://img-blog.csdnimg.cn/2021071716001214.png" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20210717160020358.png" alt="在这里插入图片描述"></p>
</li>
<li><p>将加载的信息放到缓存中，下次来就不需要加载spring.factories文件了</p>
</li>
<li><p>最终返回一个Map&lt;String, List<String>&gt;集</p>
</li>
</ol>
</li>
<li><p>遍历得到的类名，创建它的实例</p>
</li>
</ul>
</li>
<li><p><strong>ApplicationContextInitializer</strong>；去spring.factories找 <strong>ApplicationContextInitializer</strong></p>
<ul>
<li>List&lt;ApplicationContextInitializer&lt;?&gt;&gt; <strong>initializers</strong></li>
</ul>
</li>
<li><p><strong>找</strong> <strong>ApplicationListener  ；应用监听器。</strong>去<strong>spring.factories****找</strong> <strong>ApplicationListener</strong></p>
<ul>
<li>List&lt;ApplicationListener&lt;?&gt;&gt; <strong>listeners</strong></li>
</ul>
</li>
</ol>
<h3 id="②运行SpringApplication"><a href="#②运行SpringApplication" class="headerlink" title="②运行SpringApplication"></a>②运行SpringApplication</h3><ol>
<li><p><strong>stopWatch.start();</strong>	开始时间</p>
</li>
<li><p><strong>createBootstrapContext()</strong>    创建引导环境（context环境）</p>
<ul>
<li><p>用之前得到的<strong>bootstrappers</strong>遍历得到每个<strong>bootstrapper</strong>来调用<strong>intitialize方法</strong>设置引导器上下文环境设置</p>
<p><img src="https://img-blog.csdnimg.cn/20210717155448928.png" alt="在这里插入图片描述"></p>
</li>
</ul>
</li>
<li></li>
<li><p><strong>configureHeadlessProperty();</strong>    让当前应用进入<strong>headless</strong>模式。<strong>java.awt.headless</strong></p>
</li>
<li><p>获取所有的<strong>RunListener（运行时监听器）</strong>，方便所有的listener进行事件感知</p>
<p><img src="https://img-blog.csdnimg.cn/20210717155459351.png" alt="在这里插入图片描述"></p>
</li>
<li><p>遍历 <strong>SpringApplicationRunListener</strong> 调用 <strong>starting</strong> 方法；</p>
<p><img src="https://img-blog.csdnimg.cn/20210717160144553.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ul>
<li><strong>相当于通知所有感兴趣系统正在启动过程的人，项目正在 starting。</strong></li>
</ul>
</li>
<li><p><strong>applicationArguments</strong>      保存命令行参数</p>
</li>
<li><p><strong>prepareEnvironment(…)</strong>    准备环境</p>
<ol>
<li><p>返回或者创建基础环境信息对象。<strong>StandardServletEnvironment</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717155508862.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p>配置环境信息</p>
<ul>
<li><p><strong>读取所有的配置源的配置属性值。</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717155519257.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
</ul>
</li>
<li><p><strong>ConfigurationPropertySources.attach(environment);</strong>    绑定环境信息</p>
</li>
<li><p>监听器调用 <strong>listener.environmentPrepared()；</strong>通知所有的监听器当前环境准备完成</p>
</li>
</ol>
</li>
<li><p><strong>createApplicationContext()</strong>    创建IOC容器</p>
<ul>
<li><p>根据当前应用类型创建容器，当前是servlet应用</p>
<p><img src="https://img-blog.csdnimg.cn/20210717155527302.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
</ul>
</li>
<li><p><strong>prepareContext(…)</strong>    准备容器的基本信息</p>
<ol>
<li>设置环境信息</li>
<li>IOC容器的后置处理流程</li>
<li>应用初始化器<ul>
<li>遍历所有的<strong>ApplicationContextInitializer</strong>调用**initialize(…)**方法，来对容器进行初始化扩展功能</li>
</ul>
</li>
<li>注册<strong>springApplicationArguments</strong>和<strong>springBootBanner</strong>组件</li>
<li><strong>所有的监听器 调用</strong> <strong>contextLoaded。通知所有的监听器</strong> <strong>contextLoaded；</strong></li>
</ol>
</li>
<li><p><strong>refreshContext(context);</strong>    刷新IOC容器</p>
<ul>
<li>创建容器中的所有组件（Spring注解）</li>
</ul>
</li>
<li><p><strong>afterRefresh(context, applicationArguments);</strong>    容器刷新后工作，默认什么都没做</p>
</li>
<li><p><strong>stopWatch.stop();</strong>    结束时间</p>
</li>
<li><p><strong>listeners.started(context);</strong>   通知所有监听器started</p>
</li>
<li><p><strong>callRunners(context, applicationArguments);</strong>    调用所有<strong>runners</strong></p>
<ul>
<li><p><strong>获取容器中的</strong> <strong>ApplicationRunner</strong> </p>
</li>
<li><p><strong>获取容器中的</strong>  <strong>CommandLineRunner</strong></p>
</li>
<li><p><strong>合并所有runner并且按照@Order进行排序</strong></p>
</li>
<li><p><strong>遍历所有的runner。调用 run</strong> <strong>方法</strong></p>
</li>
</ul>
</li>
<li><p>如果有异常</p>
<ul>
<li><p><strong>调用Listener 的 failed</strong></p>
</li>
<li><p><strong>调用所有监听器的 running 方法</strong>  listeners.running(context); <strong>通知所有的监听器</strong> <strong>running</strong> </p>
</li>
<li><p><strong>running如果有问题。继续通知 failed 。****调用所有 Listener 的</strong> <strong>failed；****通知所有的监听器</strong> <strong>failed</strong></p>
</li>
</ul>
</li>
</ol>
<h2 id="2-Application-Events-and-Listeners"><a href="#2-Application-Events-and-Listeners" class="headerlink" title="2.Application Events and Listeners"></a>2.Application Events and Listeners</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplicationContextInitializer</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextInitializer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(ConfigurableApplicationContext applicationContext)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyApplicationContextInitializer...initialize...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplicationListener</span> <span class="keyword">implements</span> <span class="title class_">ApplicationListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(ApplicationEvent event)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyApplicationListener...onApplicationEvent...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySpringApplicationRunListener</span> <span class="keyword">implements</span> <span class="title class_">SpringApplicationRunListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">starting</span><span class="params">(ConfigurableBootstrapContext bootstrapContext)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MySpringApplicationRunListener...starting...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">environmentPrepared</span><span class="params">(ConfigurableBootstrapContext bootstrapContext, ConfigurableEnvironment environment)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MySpringApplicationRunListener...environmentPrepared...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextPrepared</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MySpringApplicationRunListener...contextPrepared...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextLoaded</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MySpringApplicationRunListener...contextLoaded...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">started</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MySpringApplicationRunListener...started...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">running</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MySpringApplicationRunListener...running...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">failed</span><span class="params">(ConfigurableApplicationContext context, Throwable exception)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MySpringApplicationRunListener...failed...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>spring.factories写入</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.context.ApplicationContextInitializer</span>=<span class="string">\</span></span><br><span class="line"><span class="string">  com.xiaozhi.springbootnull.listener.MyApplicationContextInitializer</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.context.ApplicationListener</span>=<span class="string">\</span></span><br><span class="line"><span class="string">  com.xiaozhi.springbootnull.listener.MyApplicationListener</span></span><br></pre></td></tr></table></figure>



<h2 id="3-ApplicationRunner-与-CommandLineRunner"><a href="#3-ApplicationRunner-与-CommandLineRunner" class="headerlink" title="3.ApplicationRunner 与 CommandLineRunner"></a>3.ApplicationRunner 与 CommandLineRunner</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplicationRunner</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyApplicationRunner...run...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCommandLineRunner</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyCommandLineRunner...run...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>spring.factories写入</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.context.SpringApplicationRunListener</span>=<span class="string">\</span></span><br><span class="line"><span class="string">  com.xiaozhi.springbootnull.listener.MySpringApplicationRunListener</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>首先它会从缓存中拿取数据，第一次是没有数据的</p>
<ol start="2">
<li><p>第一次它会加载<strong>spring.factories</strong>文件，然后通过Properties去加载得到kv键值对，value是List类型</p>
<p><img src="https://img-blog.csdnimg.cn/20210717160235512.png" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20210717160257768.png" alt="在这里插入图片描述"></p>
</li>
<li><p>将加载的信息放到缓存中，下次来就不需要加载spring.factories文件了</p>
</li>
<li><p>最终返回一个Map&lt;String, List<String>&gt;集</p>
</li>
</ol>
</li>
</ol>
<pre><code>-   遍历得到的类名，创建它的实例
</code></pre>
<ol start="4">
<li><p><strong>ApplicationContextInitializer</strong>；去spring.factories找 <strong>ApplicationContextInitializer</strong></p>
<ul>
<li>List&lt;ApplicationContextInitializer&lt;?&gt;&gt; <strong>initializers</strong></li>
</ul>
</li>
<li><p><strong>找</strong> <strong>ApplicationListener  ；应用监听器。</strong>去<strong>spring.factories****找</strong> <strong>ApplicationListener</strong></p>
<ul>
<li>List&lt;ApplicationListener&lt;?&gt;&gt; <strong>listeners</strong></li>
</ul>
</li>
</ol>
<h3 id="②运行SpringApplication-1"><a href="#②运行SpringApplication-1" class="headerlink" title="②运行SpringApplication"></a>②运行SpringApplication</h3><ol>
<li><p><strong>stopWatch.start();</strong>	开始时间</p>
</li>
<li><p><strong>createBootstrapContext()</strong>    创建引导环境（context环境）</p>
<ul>
<li><p>用之前得到的<strong>bootstrappers</strong>遍历得到每个<strong>bootstrapper</strong>来调用<strong>intitialize方法</strong>设置引导器上下文环境设置</p>
<p><img src="https://img-blog.csdnimg.cn/20210717160325315.png" alt="在这里插入图片描述"></p>
</li>
</ul>
</li>
<li></li>
<li><p><strong>configureHeadlessProperty();</strong>    让当前应用进入<strong>headless</strong>模式。<strong>java.awt.headless</strong></p>
</li>
<li><p>获取所有的<strong>RunListener（运行时监听器）</strong>，方便所有的listener进行事件感知</p>
<p><img src="https://img-blog.csdnimg.cn/20210717160351331.png" alt="在这里插入图片描述"></p>
</li>
<li><p>遍历 <strong>SpringApplicationRunListener</strong> 调用 <strong>starting</strong> 方法；</p>
<p><img src="https://img-blog.csdnimg.cn/20210717160404994.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ul>
<li><strong>相当于通知所有感兴趣系统正在启动过程的人，项目正在 starting。</strong></li>
</ul>
</li>
<li><p><strong>applicationArguments</strong>      保存命令行参数</p>
</li>
<li><p><strong>prepareEnvironment(…)</strong>    准备环境</p>
<ol>
<li><p>返回或者创建基础环境信息对象。<strong>StandardServletEnvironment</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717160432943.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p>配置环境信息</p>
<ul>
<li><p><strong>读取所有的配置源的配置属性值。</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210717160503195.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
</ul>
</li>
<li><p><strong>ConfigurationPropertySources.attach(environment);</strong>    绑定环境信息</p>
</li>
<li><p>监听器调用 <strong>listener.environmentPrepared()；</strong>通知所有的监听器当前环境准备完成</p>
</li>
</ol>
</li>
<li><p><strong>createApplicationContext()</strong>    创建IOC容器</p>
<ul>
<li><p>根据当前应用类型创建容器，当前是servlet应用</p>
<p><img src="https://img-blog.csdnimg.cn/20210717160521357.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjkyMzAxNA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
</ul>
</li>
<li><p><strong>prepareContext(…)</strong>    准备容器的基本信息</p>
<ol>
<li>设置环境信息</li>
<li>IOC容器的后置处理流程</li>
<li>应用初始化器<ul>
<li>遍历所有的<strong>ApplicationContextInitializer</strong>调用**initialize(…)**方法，来对容器进行初始化扩展功能</li>
</ul>
</li>
<li>注册<strong>springApplicationArguments</strong>和<strong>springBootBanner</strong>组件</li>
<li><strong>所有的监听器 调用</strong> <strong>contextLoaded。通知所有的监听器</strong> <strong>contextLoaded；</strong></li>
</ol>
</li>
<li><p><strong>refreshContext(context);</strong>    刷新IOC容器</p>
<ul>
<li>创建容器中的所有组件（Spring注解）</li>
</ul>
</li>
<li><p><strong>afterRefresh(context, applicationArguments);</strong>    容器刷新后工作，默认什么都没做</p>
</li>
<li><p><strong>stopWatch.stop();</strong>    结束时间</p>
</li>
<li><p><strong>listeners.started(context);</strong>   通知所有监听器started</p>
</li>
<li><p><strong>callRunners(context, applicationArguments);</strong>    调用所有<strong>runners</strong></p>
<ul>
<li><p><strong>获取容器中的</strong> <strong>ApplicationRunner</strong> </p>
</li>
<li><p><strong>获取容器中的</strong>  <strong>CommandLineRunner</strong></p>
</li>
<li><p><strong>合并所有runner并且按照@Order进行排序</strong></p>
</li>
<li><p><strong>遍历所有的runner。调用 run</strong> <strong>方法</strong></p>
</li>
</ul>
</li>
<li><p>如果有异常</p>
<ul>
<li><p><strong>调用Listener 的 failed</strong></p>
</li>
<li><p><strong>调用所有监听器的 running 方法</strong>  listeners.running(context); <strong>通知所有的监听器</strong> <strong>running</strong> </p>
</li>
<li><p><strong>running如果有问题。继续通知 failed 。****调用所有 Listener 的</strong> <strong>failed；****通知所有的监听器</strong> <strong>failed</strong></p>
</li>
</ul>
</li>
</ol>
<h2 id="2-Application-Events-and-Listeners-1"><a href="#2-Application-Events-and-Listeners-1" class="headerlink" title="2.Application Events and Listeners"></a>2.Application Events and Listeners</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplicationContextInitializer</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextInitializer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(ConfigurableApplicationContext applicationContext)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyApplicationContextInitializer...initialize...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplicationListener</span> <span class="keyword">implements</span> <span class="title class_">ApplicationListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(ApplicationEvent event)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyApplicationListener...onApplicationEvent...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySpringApplicationRunListener</span> <span class="keyword">implements</span> <span class="title class_">SpringApplicationRunListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">starting</span><span class="params">(ConfigurableBootstrapContext bootstrapContext)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MySpringApplicationRunListener...starting...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">environmentPrepared</span><span class="params">(ConfigurableBootstrapContext bootstrapContext, ConfigurableEnvironment environment)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MySpringApplicationRunListener...environmentPrepared...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextPrepared</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MySpringApplicationRunListener...contextPrepared...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextLoaded</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MySpringApplicationRunListener...contextLoaded...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">started</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MySpringApplicationRunListener...started...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">running</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MySpringApplicationRunListener...running...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">failed</span><span class="params">(ConfigurableApplicationContext context, Throwable exception)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MySpringApplicationRunListener...failed...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>spring.factories写入</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.context.ApplicationContextInitializer</span>=<span class="string">\</span></span><br><span class="line"><span class="string">  com.xiaozhi.springbootnull.listener.MyApplicationContextInitializer</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.context.ApplicationListener</span>=<span class="string">\</span></span><br><span class="line"><span class="string">  com.xiaozhi.springbootnull.listener.MyApplicationListener</span></span><br></pre></td></tr></table></figure>



<h2 id="3-ApplicationRunner-与-CommandLineRunner-1"><a href="#3-ApplicationRunner-与-CommandLineRunner-1" class="headerlink" title="3.ApplicationRunner 与 CommandLineRunner"></a>3.ApplicationRunner 与 CommandLineRunner</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  com.xiaozhi.springbootnull.listener.MySpringApplicationRunListener<span class="meta">@Order(1)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplicationRunner</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyApplicationRunner...run...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCommandLineRunner</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyCommandLineRunner...run...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>spring.factories写入</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.context.SpringApplicationRunListener</span>=<span class="string">\</span></span><br><span class="line"><span class="string">  com.xiaozhi.springbootnull.listener.MySpringApplicationRunListener</span></span><br></pre></td></tr></table></figure>

</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/dd/tags/test/">test</a></div><div class="post-share"><div class="social-share" data-image="https://avatars.githubusercontent.com/u/83541888?s=400&amp;u=c1a17f2da2425d5c4214b9d1e0a3c3a6de998d4a&amp;v=4" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/dd/2024/10/25/SpringMVC/" title="SpringMVC"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">SpringMVC</div></div><div class="info-2"><div class="info-item-1">1	MVC1.1、什么是MVC MVC是模型(Model)、视图(View)、控制器(Controller)的简写，是一种软件设计规范。 是将业务逻辑、数据、显示分离的方法来组织代码。 MVC主要作用是降低了视图与业务逻辑间的双向偶合。 MVC不是一种设计模式，MVC是一种架构模式。当然不同的MVC存在差异。  Model（模型）：数据模型，提供要展示的数据，因此包含数据和行为，可以认为是领域模型或JavaBean组件（包含数据和行为），不过现在一般都分离开来：Value Object（数据Dao） 和 服务层（行为Service）。也就是模型提供了模型数据查询和模型数据的状态更新等功能，包括数据和业务。 View（视图）：负责进行模型的展示，一般就是我们见到的用户界面，客户想看到的东西。 Controller（控制器）：接收用户请求，委托给模型进行处理（状态改变），处理完毕后把返回的模型数据返回给视图，由视图负责展示。也就是说控制器做了个调度员的工作。 最典型的MVC就是JSP + servlet +...</div></div></div></a><a class="pagination-related" href="/dd/2024/10/25/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" title="项目总结"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">项目总结</div></div><div class="info-2"><div class="info-item-1">解决问题技巧数据安全 - 线程问题使用ThreadLocal解决数据安全问题在服务器中，我们的请求和响应是在并发环境下的，所以我们在保存和取出数据的时候要保证数据的安全性，保证数据一致性，所以的话我们可以使用ThreadLocal去存储值，保证在同一个线程中取出的值是一致的 1、在拦截器中的使用拦截器中的三个方法在执行的时候是在同一个线程中的，所以可以使用ThreadLocal存储凭据，然后在其他方法中取出凭据进行校验 定义一个ThreadLocal的工具类 1234567891011121314151617@Componentpublic class HostHolder &#123;    private ThreadLocal&lt;User&gt; users = new ThreadLocal&lt;&gt;();    public void setUser(User user) &#123;        users.set(user);    &#125;    public User getUser() &#123;        return...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/dd/2024/10/25/Dubbo/" title="Dubbo"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-25</div><div class="info-item-2">Dubbo</div></div><div class="info-2"><div class="info-item-1">一、基础知识1、分布式基础理论1.1 什么是分布式系统分布式系统就是由多个计算机提供服务组成的系统 随着互联网的发展，网站应用的规模不断扩大，常规的垂直应用架构已经无法应付，分布式架构与流动计算架构势在必行，还需一个治理系统来对应用进行管理 1.2...</div></div></div></a><a class="pagination-related no-desc" href="/dd/2024/10/25/JVM/" title="JVM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-25</div><div class="info-item-2">JVM</div></div></div></a><a class="pagination-related" href="/dd/2024/10/25/IDEA/" title="IDEA"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-25</div><div class="info-item-2">IDEA</div></div><div class="info-2"><div class="info-item-1">快捷键使用系统快捷键   ctrl + alt + 空格 提示信息    ctrl + alt + v 相当于Ecelipse里面的ctr+1，显示左边的内容   alt + n 抛异常   ctrl + o 查看关系   ctrl + shift + T 查看文档   ctrl + alt + T 包起来   ctrl + alt + L 格式化   alt + ins 自动生成get和set方法等   ctrl + r 搜索关键字、替换   ctrl + f 搜索关键字   ctrl +   H 显示出Hierarchy（继承树）   ctrl + shift + u 转换大小写   ctrl + shift + I 预览某个类、某个方法、某个字段、某个变量的代码   ctrl + alt + B 或 ctrl + alt + 鼠标左键 跳转实现类   F11 添加书签   TODO 待完成   ctrl + alt + shift + U 查看依赖关系   ctrl + alt + U 查看依赖关系（只有查看功能）   ctrl + F12 查看类的所有方法   ctrl...</div></div></div></a><a class="pagination-related" href="/dd/2024/10/25/Git&GitHub&Gitee/" title="Git&amp;GitHub&amp;Gitee"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-25</div><div class="info-item-2">Git&amp;GitHub&amp;Gitee</div></div><div class="info-2"><div class="info-item-1">git概述Git 是一个免费的、开源的分布式版本控制系统，可以快速高效地处理从小型到大型的各种项目。Git 易于学习，占地面积小，性能极快。 它具有廉价的本地库，方便的暂存区域和多个工作流分支等特性。 其性能优于 Subversion、 CVS、 Perforce 和 ClearCase 等版本控制工具。 什么是版本控制？版本控制是一种记录文件内容变化，以便将来查阅特定版本修订情况的系统。版本控制其实最重要的是可以记录文件修改历史记录，从而让用户能够查看历史版本，方便版本切换。   为什么需要版本控制我们从个人过度到团队，团队之间进行协作  比如两个人来进行合作，第一个人上传了一个版本，我们第二个人就是要在第一个版本来进行修改形成第二个版本，这样的话就可以进行更好的合作 版本控制工具集中式版本控制工具   集中化的版本控制系统诸如 CVS、 SVN 等 ...</div></div></div></a><a class="pagination-related" href="/dd/2024/10/25/Maven/" title="Maven"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-25</div><div class="info-item-2">Maven</div></div><div class="info-2"><div class="info-item-1">一、Maven概述和安装1、概述​	是一个工具，项目架构管理工具 目前阶段：自动导入jar包，解决导jar包的工作 核心思想：约定大于配置  有约束，不要去违反  Maven会规定好如何去编写我们的java代码，必须按照这个规范来； 2、安装官网：https://maven.apache.org/  下载文件后解压即可 目录结构bin：可执行文件 boot：需要启动的一些选项，jar包 conf：配置文件 lib：依赖 配置环境变量 M2_HOME			maven目录下的bin目录 MAVEN_HOME     maven的目录 在系统的path中呢配置 %MAVEN_HOME%\bin  说明：为什么要创建两个，按照规范来 通过mvn...</div></div></div></a><a class="pagination-related" href="/dd/2024/10/25/MyBatis/" title="MyBatis"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-25</div><div class="info-item-2">MyBatis</div></div><div class="info-2"><div class="info-item-1">MyBatis简介环境说明 jdk 8 + MySQL 5.7.19 maven-3.6.1 IDEA  学习前需要掌握：  JDBC MySQL Java 基础 Maven Junit  什么是MyBatis MyBatis 是一款优秀的持久层框架 MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集的过程 MyBatis 可以使用简单的 XML 或注解来配置和映射原生信息，将接口和 Java 的 实体类 【Plain Old Java Objects,普通的 Java对象】映射成数据库中的记录。 MyBatis 本是apache的一个开源项目ibatis, 2010年这个项目由apache 迁移到了google code，并且改名为MyBatis 。 2013年11月迁移到Github . Mybatis官方文档 : http://www.mybatis.org/mybatis-3/zh/index.html GitHub :...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://avatars.githubusercontent.com/u/83541888?s=400&amp;u=c1a17f2da2425d5c4214b9d1e0a3c3a6de998d4a&amp;v=4" onerror="this.onerror=null;this.src='/dd/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">XiaoZhi</div><div class="author-info-description">孤独患者</div><div class="site-data"><a href="/dd/archives/"><div class="headline">Articles</div><div class="length-num">27</div></a><a href="/dd/tags/"><div class="headline">Tags</div><div class="length-num">1</div></a><a href="/dd/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/xxxxx" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #000000;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#01springBoot2%E5%85%A5%E9%97%A8"><span class="toc-number">1.</span> <span class="toc-text">01	springBoot2入门</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#02%E4%BA%86%E8%A7%A3%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">02	了解自动配置原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81SpringBoot%E7%89%B9%E7%82%B9"><span class="toc-number">2.1.</span> <span class="toc-text">1、SpringBoot特点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.1 依赖管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">2.1.2.</span> <span class="toc-text">1.2 自动配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%AE%B9%E5%99%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">2.2.</span> <span class="toc-text">2、容器功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E7%BB%84%E4%BB%B6%E6%B7%BB%E5%8A%A0"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.1 组件添加</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81-Configuration"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">1、@Configuration</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81-Component%E8%A1%8D%E7%94%9F%E7%9A%84%E6%B3%A8%E8%A7%A3"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">2、@Component衍生的注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E7%BB%84%E4%BB%B6%E6%89%AB%E6%8F%8F"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">3、组件扫描</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81-Conditional"><span class="toc-number">2.2.1.4.</span> <span class="toc-text">4、@Conditional</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%8E%9F%E7%94%9F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%BC%95%E5%85%A5"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2 原生配置文件引入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0-ImportResource"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">① @ImportResource</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E9%85%8D%E7%BD%AE%E7%BB%91%E5%AE%9A"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.3 配置绑定</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0-ConfigurationProperties"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">① @ConfigurationProperties</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86%E5%85%A5%E9%97%A8"><span class="toc-number">2.3.</span> <span class="toc-text">3、自动装配原理入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%BC%95%E5%AF%BC%E8%87%AA%E5%8A%A8%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.1 引导自动加载配置类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SpringBootConfiguration"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">@SpringBootConfiguration</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ComponentScan"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">@ComponentScan</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EnableAutoConfiguration"><span class="toc-number">2.3.1.3.</span> <span class="toc-text">@EnableAutoConfiguration</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%8C%89%E9%9C%80%E5%BC%80%E5%90%AF%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-number">2.3.2.</span> <span class="toc-text">3.2 按需开启配置项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">2.3.3.</span> <span class="toc-text">3.3 修改默认配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#03%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">03	配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.1.</span> <span class="toc-text">1	文件类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-properties"><span class="toc-number">3.1.1.</span> <span class="toc-text">1.1 properties</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-yaml"><span class="toc-number">3.1.2.</span> <span class="toc-text">2.2 yaml</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E7%AE%80%E4%BB%8B"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">①简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">3.1.2.2.</span> <span class="toc-text">②基本用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.1.2.3.</span> <span class="toc-text">③数据类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A3%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.1.2.4.</span> <span class="toc-text">④示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E9%85%8D%E7%BD%AE%E6%8F%90%E7%A4%BA"><span class="toc-number">3.2.</span> <span class="toc-text">2	配置提示</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#04Web%E5%BC%80%E5%8F%91"><span class="toc-number">4.</span> <span class="toc-text">04	Web开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#devtools%E7%83%AD%E9%83%A8%E7%BD%B2"><span class="toc-number">4.1.</span> <span class="toc-text">devtools热部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81SpringMVC%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%A6%82%E8%A7%88"><span class="toc-number">4.2.</span> <span class="toc-text">一、SpringMVC自动配置概览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%AE%80%E5%8D%95%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-number">4.3.</span> <span class="toc-text">二、简单功能分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE"><span class="toc-number">4.3.1.</span> <span class="toc-text">1.静态资源访问</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9B%AE%E5%BD%95"><span class="toc-number">4.3.1.1.</span> <span class="toc-text">①静态资源目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E5%89%8D%E7%BC%80"><span class="toc-number">4.3.1.2.</span> <span class="toc-text">②静态资源访问前缀</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2webjar"><span class="toc-number">4.3.1.3.</span> <span class="toc-text">③webjar</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%AC%A2%E8%BF%8E%E9%A1%B5%E6%94%AF%E6%8C%81"><span class="toc-number">4.3.2.</span> <span class="toc-text">2.欢迎页支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%87%AA%E5%AE%9A%E4%B9%89Favicon"><span class="toc-number">4.3.3.</span> <span class="toc-text">3.自定义Favicon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-number">4.3.4.</span> <span class="toc-text">4.静态资源配置原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E9%85%8D%E7%BD%AE%E7%B1%BB%E4%B8%AD%E5%8F%AA%E6%9C%89%E4%B8%80%E4%B8%AA%E6%9C%89%E5%8F%82%E6%9E%84%E9%80%A0"><span class="toc-number">4.3.4.1.</span> <span class="toc-text">①配置类中只有一个有参构造</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E8%B5%84%E6%BA%90%E5%A4%84%E7%90%86%E7%9A%84%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99"><span class="toc-number">4.3.4.2.</span> <span class="toc-text">②资源处理的默认规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2%E6%AC%A2%E8%BF%8E%E9%A1%B5%E5%A4%84%E7%90%86%E8%A7%84%E5%88%99"><span class="toc-number">4.3.4.3.</span> <span class="toc-text">③欢迎页处理规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A3Favicon"><span class="toc-number">4.3.4.4.</span> <span class="toc-text">④Favicon</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86"><span class="toc-number">4.4.</span> <span class="toc-text">三、请求参数处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84"><span class="toc-number">4.4.1.</span> <span class="toc-text">1.请求映射</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0rest%E4%BD%BF%E7%94%A8"><span class="toc-number">4.4.1.1.</span> <span class="toc-text">①rest使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1rest%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="toc-number">4.4.1.2.</span> <span class="toc-text">②rest原理解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2%E6%8B%93%E5%B1%95-%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E7%9A%84%E9%9A%90%E8%97%8F%E5%9F%9F%E5%90%8D"><span class="toc-number">4.4.1.3.</span> <span class="toc-text">③拓展:修改默认的隐藏域名</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84%E5%8E%9F%E7%90%86"><span class="toc-number">4.4.2.</span> <span class="toc-text">2.请求映射原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%8F%82%E6%95%B0%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%B3%A8%E8%A7%A3"><span class="toc-number">4.4.3.</span> <span class="toc-text">3.参数与基本注解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E6%B3%A8%E8%A7%A3"><span class="toc-number">4.4.3.1.</span> <span class="toc-text">3.1 注解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A0-PathVariable"><span class="toc-number">4.4.3.1.1.</span> <span class="toc-text">①@PathVariable</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A1-RequestHeader"><span class="toc-number">4.4.3.1.2.</span> <span class="toc-text">②@RequestHeader</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A2-ModelAttribute"><span class="toc-number">4.4.3.1.3.</span> <span class="toc-text">③@ModelAttribute</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A3-RequestParam"><span class="toc-number">4.4.3.1.4.</span> <span class="toc-text">④@RequestParam</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A4-CookieValue"><span class="toc-number">4.4.3.1.5.</span> <span class="toc-text">⑤@CookieValue</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A5-RequestBody"><span class="toc-number">4.4.3.1.6.</span> <span class="toc-text">⑥@RequestBody</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A6-MatrixVariable"><span class="toc-number">4.4.3.1.7.</span> <span class="toc-text">⑦@MatrixVariable</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E6%B3%A8%E8%A7%A3%E5%8E%9F%E7%90%86"><span class="toc-number">4.4.3.2.</span> <span class="toc-text">3.2 注解原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-ServletApi"><span class="toc-number">4.4.3.3.</span> <span class="toc-text">4.ServletApi</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%A4%8D%E6%9D%82%E5%8F%82%E6%95%B0"><span class="toc-number">4.4.3.4.</span> <span class="toc-text">5.复杂参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E5%8F%82%E6%95%B0-%E5%B0%81%E8%A3%85POJO"><span class="toc-number">4.4.3.5.</span> <span class="toc-text">6.自定义类型参数 封装POJO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E8%87%AA%E5%AE%9A%E4%B9%89converters"><span class="toc-number">4.4.3.6.</span> <span class="toc-text">7.自定义converters</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C"><span class="toc-number">4.4.4.</span> <span class="toc-text">4.参数校验</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%BC%95%E5%85%A5%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C%E7%9A%84start"><span class="toc-number">4.4.4.1.</span> <span class="toc-text">3.1 引入参数校验的start</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E6%8E%A5%E6%94%B6%E5%8F%82%E6%95%B0%E7%9A%84BO%E6%88%96DTO"><span class="toc-number">4.4.4.2.</span> <span class="toc-text">3.2 接收参数的BO或DTO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">4.4.4.3.</span> <span class="toc-text">3.3 校验注解的属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3"><span class="toc-number">4.4.4.4.</span> <span class="toc-text">3.4 自定义参数校验注解</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%95%B0%E6%8D%AE%E5%93%8D%E5%BA%94%E5%92%8C%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="toc-number">4.5.</span> <span class="toc-text">四、数据响应和内容协商</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%93%8D%E5%BA%94json"><span class="toc-number">4.5.1.</span> <span class="toc-text">1.响应json</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81jackson-Response%E6%B3%A8%E8%A7%A3"><span class="toc-number">4.5.1.1.</span> <span class="toc-text">1、jackson + @Response注解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A0%E8%BF%94%E5%9B%9E%E5%80%BC%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">4.5.1.1.1.</span> <span class="toc-text">①返回值处理器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A1%E8%BF%94%E5%9B%9E%E5%80%BC%E5%A4%84%E7%90%86%E5%99%A8%E5%8E%9F%E7%90%86"><span class="toc-number">4.5.1.1.2.</span> <span class="toc-text">②返回值处理器原理</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-springMVC%E6%94%AF%E6%8C%81%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">4.5.1.2.</span> <span class="toc-text">2.springMVC支持的返回值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-HTTPMessageConverter%E6%B6%88%E6%81%AF%E8%BD%AC%E6%8D%A2%E5%99%A8%E5%8E%9F%E7%90%86"><span class="toc-number">4.5.1.3.</span> <span class="toc-text">3.HTTPMessageConverter消息转换器原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="toc-number">4.5.2.</span> <span class="toc-text">2.内容协商</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E5%BC%95%E5%85%A5xml%E4%BE%9D%E8%B5%96"><span class="toc-number">4.5.2.1.</span> <span class="toc-text">①引入xml依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1postman%E5%88%86%E5%88%AB%E6%B5%8B%E8%AF%95%E8%BF%94%E5%9B%9Ejson%E5%92%8Cxml"><span class="toc-number">4.5.2.2.</span> <span class="toc-text">②postman分别测试返回json和xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2%E5%BC%80%E5%90%AF%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8F%82%E6%95%B0%E6%96%B9%E5%BC%8F%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="toc-number">4.5.2.3.</span> <span class="toc-text">③开启浏览器参数方式内容协商</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A3%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%8E%9F%E7%90%86"><span class="toc-number">4.5.2.4.</span> <span class="toc-text">④内容协商原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A4%E8%87%AA%E5%AE%9A%E4%B9%89MessageConverter"><span class="toc-number">4.5.2.5.</span> <span class="toc-text">⑤自定义MessageConverter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A5%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AF%B7%E6%B1%82%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE"><span class="toc-number">4.5.2.6.</span> <span class="toc-text">⑥浏览器请求自定义数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E4%B8%8E%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90"><span class="toc-number">4.6.</span> <span class="toc-text">五、模板引擎与视图解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E-Thymeleaf"><span class="toc-number">4.6.1.</span> <span class="toc-text">1	模板引擎-Thymeleaf</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">4.6.1.1.</span> <span class="toc-text">1.基本语法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A0%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">4.6.1.1.1.</span> <span class="toc-text">①表达式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A1%E5%AD%97%E9%9D%A2%E9%87%8F"><span class="toc-number">4.6.1.1.2.</span> <span class="toc-text">②字面量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A2%E6%96%87%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">4.6.1.1.3.</span> <span class="toc-text">③文本操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A3%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97"><span class="toc-number">4.6.1.1.4.</span> <span class="toc-text">④数学运算</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A4%E5%B8%83%E5%B0%94%E8%BF%90%E7%AE%97"><span class="toc-number">4.6.1.1.5.</span> <span class="toc-text">⑤布尔运算</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A5%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97"><span class="toc-number">4.6.1.1.6.</span> <span class="toc-text">⑥比较运算</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A6%E6%9D%A1%E4%BB%B6%E8%BF%90%E7%AE%97"><span class="toc-number">4.6.1.1.7.</span> <span class="toc-text">⑦条件运算</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A7%E7%89%B9%E6%AE%8A%E6%93%8D%E4%BD%9C"><span class="toc-number">4.6.1.1.8.</span> <span class="toc-text">⑧特殊操作</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E8%AE%BE%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%80%BC-th-attr"><span class="toc-number">4.6.1.2.</span> <span class="toc-text">2设置属性值-th:attr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E8%BF%AD%E4%BB%A3"><span class="toc-number">4.6.1.3.</span> <span class="toc-text">3.迭代</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%9D%A1%E4%BB%B6%E8%BF%90%E7%AE%97"><span class="toc-number">4.6.1.4.</span> <span class="toc-text">4.条件运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%B1%9E%E6%80%A7%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">4.6.1.5.</span> <span class="toc-text">5.属性优先级</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2thymeleaf%E4%BD%BF%E7%94%A8"><span class="toc-number">4.6.2.</span> <span class="toc-text">2	thymeleaf使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%BC%95%E5%85%A5stater"><span class="toc-number">4.6.2.1.</span> <span class="toc-text">1.引入stater</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%A5%BD%E4%BA%86thymeleaf"><span class="toc-number">4.6.2.2.</span> <span class="toc-text">2.自动配置好了thymeleaf</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E6%9E%84%E5%BB%BA%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="toc-number">4.6.3.</span> <span class="toc-text">3	构建后台管理系统</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA"><span class="toc-number">4.6.3.1.</span> <span class="toc-text">1、项目创建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%A4%84%E7%90%86"><span class="toc-number">4.6.3.2.</span> <span class="toc-text">2、静态资源处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E8%B7%AF%E5%BE%84%E6%9E%84%E5%BB%BA"><span class="toc-number">4.6.3.3.</span> <span class="toc-text">3、路径构建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E6%A8%A1%E6%9D%BF%E6%8A%BD%E5%8F%96"><span class="toc-number">4.6.3.4.</span> <span class="toc-text">4、模板抽取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC"><span class="toc-number">4.6.3.5.</span> <span class="toc-text">5、页面跳转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E6%95%B0%E6%8D%AE%E6%B8%B2%E6%9F%93"><span class="toc-number">4.6.3.6.</span> <span class="toc-text">6、数据渲染</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86"><span class="toc-number">4.6.4.</span> <span class="toc-text">4	视图解析原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E9%87%8D%E5%AE%9A%E5%90%91%E5%8E%9F%E7%90%86"><span class="toc-number">4.6.4.1.</span> <span class="toc-text">1、重定向原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91%E5%8E%9F%E7%90%86"><span class="toc-number">4.6.4.2.</span> <span class="toc-text">2、请求转发原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E8%A7%86%E5%9B%BE%E6%B8%B2%E6%9F%93"><span class="toc-number">4.6.4.3.</span> <span class="toc-text">3、视图渲染</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">4.7.</span> <span class="toc-text">六、拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81HandlerInterceptor%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.7.1.</span> <span class="toc-text">1、HandlerInterceptor接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AE%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">4.7.2.</span> <span class="toc-text">2、配置拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%8B%A6%E6%88%AA%E5%99%A8%E5%8E%9F%E7%90%86"><span class="toc-number">4.7.3.</span> <span class="toc-text">3、拦截器原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">4.8.</span> <span class="toc-text">七、文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%A1%B5%E9%9D%A2%E4%BB%A3%E7%A0%81"><span class="toc-number">4.8.1.</span> <span class="toc-text">1.页面代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84controller"><span class="toc-number">4.8.2.</span> <span class="toc-text">2.文件上传的controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8E%9F%E7%90%86"><span class="toc-number">4.8.3.</span> <span class="toc-text">3.文件上传原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">4.9.</span> <span class="toc-text">八、异常处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99"><span class="toc-number">4.9.1.</span> <span class="toc-text">1、默认规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2%E5%A4%84%E7%90%86%E9%80%BB%E8%BE%91"><span class="toc-number">4.9.2.</span> <span class="toc-text">2、定义错误页面处理逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-number">4.9.3.</span> <span class="toc-text">3、异常处理自动配置原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="toc-number">4.9.4.</span> <span class="toc-text">4、异常处理原理解析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81web%E5%8E%9F%E7%94%9F%E7%BB%84%E4%BB%B6%E6%B3%A8%E5%85%A5%EF%BC%88Servlet%E3%80%81Filter%E3%80%81Listener%EF%BC%89"><span class="toc-number">4.10.</span> <span class="toc-text">九、web原生组件注入（Servlet、Filter、Listener）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BD%BF%E7%94%A8ServletApI"><span class="toc-number">4.10.1.</span> <span class="toc-text">1、使用Servlet	ApI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%BD%BF%E7%94%A8RegistrationBean"><span class="toc-number">4.10.2.</span> <span class="toc-text">2、使用RegistrationBean</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8"><span class="toc-number">4.11.</span> <span class="toc-text">十、嵌入式Servlet容器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%87%E6%8D%A2%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8"><span class="toc-number">4.11.1.</span> <span class="toc-text">1.切换嵌入式Servlet容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%9A%E5%88%B6Servlet%E5%AE%B9%E5%99%A8"><span class="toc-number">4.11.2.</span> <span class="toc-text">2.定制Servlet容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E5%AE%9A%E5%88%B6%E5%8C%96%E5%8E%9F%E7%90%86"><span class="toc-number">4.12.</span> <span class="toc-text">十一、定制化原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AE%9A%E5%88%B6%E5%8C%96%E7%9A%84%E5%B8%B8%E8%A7%81%E6%96%B9%E5%BC%8F"><span class="toc-number">4.12.1.</span> <span class="toc-text">1、定制化的常见方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E5%A5%97%E8%B7%AF"><span class="toc-number">4.12.2.</span> <span class="toc-text">2、原理分析套路</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.13.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#05-%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE"><span class="toc-number">5.</span> <span class="toc-text">05 数据访问</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81SQL"><span class="toc-number">5.1.</span> <span class="toc-text">一、SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%95%B0%E6%8D%AE%E6%BA%90%E7%9A%84%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.1.</span> <span class="toc-text">1、数据源的自动配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AF%BC%E5%85%A5JDBC%E5%9C%BA%E6%99%AF"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">1.导入JDBC场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%86%E6%9E%90%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.1.2.</span> <span class="toc-text">2.分析自动配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-number">5.1.1.3.</span> <span class="toc-text">3、修改配置项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-number">5.1.1.4.</span> <span class="toc-text">4、测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%BD%BF%E7%94%A8Druid%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">5.1.2.</span> <span class="toc-text">2、使用Druid数据源</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E5%BC%8F"><span class="toc-number">5.1.2.1.</span> <span class="toc-text">1.自定义方式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A0%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">5.1.2.1.1.</span> <span class="toc-text">①引入依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A1%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E6%BA%90%E6%B3%A8%E5%85%A5%E5%88%B0%E5%AE%B9%E5%99%A8%E4%B8%AD"><span class="toc-number">5.1.2.1.2.</span> <span class="toc-text">②创建数据源注入到容器中</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A2StatViewServlet"><span class="toc-number">5.1.2.1.3.</span> <span class="toc-text">③StatViewServlet</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A3%E7%9B%91%E6%8E%A7%E7%BB%9F%E8%AE%A1%E5%8A%9F%E8%83%BD"><span class="toc-number">5.1.2.1.4.</span> <span class="toc-text">④监控统计功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A4web%E5%92%8Cspring%E5%85%B3%E8%81%94%E7%9B%91%E6%8E%A7"><span class="toc-number">5.1.2.1.5.</span> <span class="toc-text">⑤web和spring关联监控</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A5%E8%AE%BE%E7%BD%AE%E7%99%BB%E5%BD%95%E8%B4%A6%E5%8F%B7%E5%92%8C%E5%AF%86%E7%A0%81"><span class="toc-number">5.1.2.1.6.</span> <span class="toc-text">⑥设置登录账号和密码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A6%E4%B8%8D%E6%87%82%E7%9C%8B%E5%AE%98%E7%BD%91%EF%BC%8C%E6%9C%89%E6%95%99%E7%A8%8B"><span class="toc-number">5.1.2.1.7.</span> <span class="toc-text">⑦不懂看官网，有教程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%AE%98%E6%96%B9starter"><span class="toc-number">5.1.2.2.</span> <span class="toc-text">2.官方starter</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A0%E5%BC%95%E5%85%A5%E5%AE%98%E6%96%B9%E7%9A%84stater"><span class="toc-number">5.1.2.2.1.</span> <span class="toc-text">①引入官方的stater</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A1Druid%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.2.2.2.</span> <span class="toc-text">②Druid自动配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%95%B4%E5%90%88mybatis%E6%93%8D%E4%BD%9C"><span class="toc-number">5.1.3.</span> <span class="toc-text">3、整合mybatis操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.1.3.1.</span> <span class="toc-text">1.配置模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">5.1.3.1.1.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%B3%A8%E8%A7%A3%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.1.3.2.</span> <span class="toc-text">2.注解模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A9%E5%B1%95"><span class="toc-number">5.1.3.2.1.</span> <span class="toc-text">扩展</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%B7%B7%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.1.3.3.</span> <span class="toc-text">3.混合模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%95%B4%E5%90%88Mybatis-Plus%E5%AE%8C%E6%88%90CRUD"><span class="toc-number">5.1.4.</span> <span class="toc-text">4、整合Mybatis-Plus完成CRUD</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%BC%95%E5%85%A5stater-1"><span class="toc-number">5.1.4.0.1.</span> <span class="toc-text">1.引入stater</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%8C%89%E7%85%A7%E5%AE%98%E6%96%B9%E7%9A%84%E6%96%87%E6%A1%A3%E6%9D%A5%E5%AD%A6%E4%B9%A0"><span class="toc-number">5.1.4.0.2.</span> <span class="toc-text">2.按照官方的文档来学习</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81NoSQL"><span class="toc-number">5.2.</span> <span class="toc-text">二、NoSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81reids%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">5.2.1.</span> <span class="toc-text">1、reids自动配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E5%BC%95%E5%85%A5starter"><span class="toc-number">5.2.1.1.</span> <span class="toc-text">①引入starter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">5.2.1.2.</span> <span class="toc-text">②自动配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81RedisTemplate%E4%B8%8ELettuce"><span class="toc-number">5.2.2.</span> <span class="toc-text">2、RedisTemplate与Lettuce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%88%87%E6%8D%A2%E5%88%B0jedis"><span class="toc-number">5.2.3.</span> <span class="toc-text">3、切换到jedis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E4%BD%BF%E7%94%A8redis%E6%9D%A5%E8%AE%B0%E5%BD%95%E8%AE%BF%E9%97%AE%E6%AC%A1%E6%95%B0"><span class="toc-number">5.2.4.</span> <span class="toc-text">4、使用redis来记录访问次数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%BA%8B%E7%89%A9%E5%A4%84%E7%90%86"><span class="toc-number">5.3.</span> <span class="toc-text">三、事物处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81Sql%E4%BA%8B%E7%89%A9"><span class="toc-number">5.3.1.</span> <span class="toc-text">1、Sql事物</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81NoSql%E4%BA%8B%E7%89%A9"><span class="toc-number">5.3.2.</span> <span class="toc-text">2、NoSql事物</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#06%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">6.</span> <span class="toc-text">06	单元测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-JUnit5%E5%8F%98%E5%8C%96"><span class="toc-number">6.1.</span> <span class="toc-text">1.JUnit5变化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-JUnit5%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-number">6.2.</span> <span class="toc-text">2.JUnit5常用注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%96%AD%E8%A8%80-assertions"><span class="toc-number">6.3.</span> <span class="toc-text">3.断言(assertions)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A0%E7%AE%80%E5%8D%95%E6%96%AD%E8%A8%80"><span class="toc-number">6.3.1.</span> <span class="toc-text">①简单断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A1%E6%95%B0%E7%BB%84%E6%96%AD%E8%A8%80"><span class="toc-number">6.3.2.</span> <span class="toc-text">②数组断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A2%E7%BB%84%E5%90%88%E6%96%AD%E8%A8%80"><span class="toc-number">6.3.3.</span> <span class="toc-text">③组合断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A3%E5%BC%82%E5%B8%B8%E6%96%AD%E8%A8%80"><span class="toc-number">6.3.4.</span> <span class="toc-text">④异常断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A4%E8%B6%85%E6%97%B6%E6%96%AD%E8%A8%80"><span class="toc-number">6.3.5.</span> <span class="toc-text">⑤超时断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A5%E5%BF%AB%E9%80%9F%E5%A4%B1%E8%B4%A5"><span class="toc-number">6.3.6.</span> <span class="toc-text">⑥快速失败</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%EF%BC%88assumptions%EF%BC%89"><span class="toc-number">6.4.</span> <span class="toc-text">4.前置条件（assumptions）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%B5%8C%E5%A5%97%E6%B5%8B%E8%AF%95"><span class="toc-number">6.5.</span> <span class="toc-text">5.嵌套测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95"><span class="toc-number">6.6.</span> <span class="toc-text">6.参数化测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E4%B8%8D%E4%BC%9A%E5%8F%82%E8%80%83%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3"><span class="toc-number">6.7.</span> <span class="toc-text">7.不会参考官方文档</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#07%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7"><span class="toc-number">7.</span> <span class="toc-text">07	指标监控</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-SpringBoot-Actuator"><span class="toc-number">7.1.</span> <span class="toc-text">1.SpringBoot Actuator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A0%E7%AE%80%E4%BB%8B-1"><span class="toc-number">7.1.1.</span> <span class="toc-text">①简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A11-x%E4%B8%8E2-x%E7%9A%84%E4%B8%8D%E5%90%8C"><span class="toc-number">7.1.2.</span> <span class="toc-text">②1.x与2.x的不同</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A2%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="toc-number">7.1.3.</span> <span class="toc-text">③如何使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%9A%B4%E9%9C%B2Endpoints"><span class="toc-number">7.1.3.1.</span> <span class="toc-text">2.暴露Endpoints</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AE%9A%E5%88%B6-Endpoint"><span class="toc-number">7.2.</span> <span class="toc-text">3.定制 Endpoint</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A0%E5%AE%9A%E5%88%B6Health"><span class="toc-number">7.2.1.</span> <span class="toc-text">①定制Health</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A1%E5%AE%9A%E5%88%B6info%E4%BF%A1%E6%81%AF"><span class="toc-number">7.2.2.</span> <span class="toc-text">②定制info信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A2%E5%AE%9A%E5%88%B6Metrics%E4%BF%A1%E6%81%AF"><span class="toc-number">7.2.3.</span> <span class="toc-text">③定制Metrics信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-SpringBoot%E6%94%AF%E6%8C%81%E8%87%AA%E5%8A%A8%E9%80%82%E9%85%8D%E7%9A%84Metrics"><span class="toc-number">7.2.3.1.</span> <span class="toc-text">1.SpringBoot支持自动适配的Metrics</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%A2%9E%E5%8A%A0%E5%AE%9A%E5%88%B6Metrics"><span class="toc-number">7.2.3.2.</span> <span class="toc-text">2、增加定制Metrics</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A3%E5%AE%9A%E5%88%B6Endpoint"><span class="toc-number">7.2.4.</span> <span class="toc-text">④定制Endpoint</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">7.3.</span> <span class="toc-text">4.可视化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A0%E8%AE%BE%E7%BD%AEspringBoot%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">7.3.1.</span> <span class="toc-text">①设置springBoot管理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A1%E6%B3%A8%E5%86%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="toc-number">7.3.2.</span> <span class="toc-text">②注册客户端应用程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#08%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="toc-number">8.</span> <span class="toc-text">08	高级特性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Profile%E5%8A%9F%E8%83%BD"><span class="toc-number">8.1.</span> <span class="toc-text">1.Profile功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A0application-profile%E5%8A%9F%E8%83%BD"><span class="toc-number">8.1.1.</span> <span class="toc-text">①application-profile功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A1-Profile%E6%9D%A1%E4%BB%B6%E8%A3%85%E9%85%8D%E5%8A%9F%E8%83%BD"><span class="toc-number">8.1.2.</span> <span class="toc-text">②@Profile条件装配功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%A0%87%E6%B3%A8%E5%9C%A8%E7%B1%BB%E4%B8%8A"><span class="toc-number">8.1.2.1.</span> <span class="toc-text">1.标注在类上</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%A0%87%E6%B3%A8%E5%9C%A8%E6%96%B9%E6%B3%95%E4%B8%8A"><span class="toc-number">8.1.2.2.</span> <span class="toc-text">2.标注在方法上</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%A4%96%E9%83%A8%E8%AF%9D%E9%85%8D%E7%BD%AE"><span class="toc-number">8.2.</span> <span class="toc-text">2.外部话配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A0%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE%E6%BA%90"><span class="toc-number">8.2.1.</span> <span class="toc-text">①外部配置源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A1%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE%E4%BD%8D%E7%BD%AE"><span class="toc-number">8.2.2.</span> <span class="toc-text">②配置文件查找位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A2%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F"><span class="toc-number">8.2.3.</span> <span class="toc-text">③配置文件加载顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A3%E6%8C%87%E5%AE%9A%E7%8E%AF%E5%A2%83%E4%BC%98%E5%85%88%EF%BC%8C%E5%A4%96%E9%83%A8%E4%BC%98%E5%85%88%EF%BC%8C%E5%90%8E%E9%9D%A2%E7%9A%84%E5%8F%AF%E4%BB%A5%E8%A6%86%E7%9B%96%E5%89%8D%E9%9D%A2%E7%9A%84%E5%90%8C%E5%90%8D%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-number">8.2.4.</span> <span class="toc-text">④指定环境优先，外部优先，后面的可以覆盖前面的同名配置项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%87%AA%E5%AE%9A%E4%B9%89starter"><span class="toc-number">8.3.</span> <span class="toc-text">3.自定义starter</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%B9%B6%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">8.3.1.</span> <span class="toc-text">1.创建项目并引入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%9C%A8springBoot%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81"><span class="toc-number">8.3.2.</span> <span class="toc-text">2.在springBoot项目中编写代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-number">8.3.2.1.</span> <span class="toc-text">①创建配置类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E7%BC%96%E5%86%99%E5%8A%9F%E8%83%BD%E7%B1%BB"><span class="toc-number">8.3.2.2.</span> <span class="toc-text">②编写功能类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-number">8.3.2.3.</span> <span class="toc-text">③编写配置类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A3%E5%88%9B%E5%BB%BAspring-factories%E6%96%87%E4%BB%B6"><span class="toc-number">8.3.2.4.</span> <span class="toc-text">④创建spring.factories文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A4%E4%B8%8B%E8%BD%BD%E5%88%B0%E6%9C%AC%E5%9C%B0%E4%BB%93%E5%BA%93"><span class="toc-number">8.3.2.5.</span> <span class="toc-text">⑤下载到本地仓库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B5%8B%E8%AF%95"><span class="toc-number">8.3.3.</span> <span class="toc-text">3.测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E5%BC%95%E5%85%A5%E6%88%91%E4%BB%AC%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84starter"><span class="toc-number">8.3.3.1.</span> <span class="toc-text">①引入我们自定义的starter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E7%BC%96%E5%86%99%E4%B8%9A%E5%8A%A1%E4%BB%A3%E7%A0%81"><span class="toc-number">8.3.3.2.</span> <span class="toc-text">②编写业务代码</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#09%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="toc-number">9.</span> <span class="toc-text">09	原理解析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-springBoot%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">9.1.</span> <span class="toc-text">1.springBoot启动过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A0%E5%88%9B%E5%BB%BASpringApplication"><span class="toc-number">9.1.1.</span> <span class="toc-text">①创建SpringApplication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A1%E8%BF%90%E8%A1%8CSpringApplication"><span class="toc-number">9.1.2.</span> <span class="toc-text">②运行SpringApplication</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Application-Events-and-Listeners"><span class="toc-number">9.2.</span> <span class="toc-text">2.Application Events and Listeners</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-ApplicationRunner-%E4%B8%8E-CommandLineRunner"><span class="toc-number">9.3.</span> <span class="toc-text">3.ApplicationRunner 与 CommandLineRunner</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%91%A1%E8%BF%90%E8%A1%8CSpringApplication-1"><span class="toc-number">9.3.1.</span> <span class="toc-text">②运行SpringApplication</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Application-Events-and-Listeners-1"><span class="toc-number">9.4.</span> <span class="toc-text">2.Application Events and Listeners</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-ApplicationRunner-%E4%B8%8E-CommandLineRunner-1"><span class="toc-number">9.5.</span> <span class="toc-text">3.ApplicationRunner 与 CommandLineRunner</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/dd/2024/10/25/Dubbo/" title="Dubbo">Dubbo</a><time datetime="2024-10-24T17:53:53.000Z" title="Created 2024-10-25 01:53:53">2024-10-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/dd/2024/10/25/JVM/" title="JVM">JVM</a><time datetime="2024-10-24T17:53:53.000Z" title="Created 2024-10-25 01:53:53">2024-10-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/dd/2024/10/25/IDEA/" title="IDEA">IDEA</a><time datetime="2024-10-24T17:53:53.000Z" title="Created 2024-10-25 01:53:53">2024-10-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/dd/2024/10/25/Git&amp;GitHub&amp;Gitee/" title="Git&amp;GitHub&amp;Gitee">Git&amp;GitHub&amp;Gitee</a><time datetime="2024-10-24T17:53:53.000Z" title="Created 2024-10-25 01:53:53">2024-10-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/dd/2024/10/25/Maven/" title="Maven">Maven</a><time datetime="2024-10-24T17:53:53.000Z" title="Created 2024-10-25 01:53:53">2024-10-25</time></div></div></div></div></div></div></main><footer id="footer" style="background: linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347);"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By XiaoZhi</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/dd/js/utils.js"></script><script src="/dd/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>