<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Spring Cloud Alibaba | Hexo</title><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ä¸€ã€æ¦‚è¿°1.1 Spring Cloud Alibabaä¸ºä»€ä¹ˆå‡ºç°ç”±äºSpring Cloud Netflixé¡¹ç›®è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼ŒSpring Cloudå®˜æ–¹å’ŒAlibabaåˆä½œæå‡ºä¸€å¥—æ¥æ›¿æ¢Netflixçš„å„ä¸ªæŠ€æœ¯  è¿›å…¥ç»´æŠ¤æ¨¡å¼æ„å‘³ç€Spring Cloud Netflix å°†ä¸å†å¼€å‘æ–°çš„ç»„ä»¶ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“Spring Cloud ç‰ˆæœ¬è¿­ä»£ç®—æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œå› è€Œå‡ºç°äº†å¾ˆå¤šé‡å¤§ISSUEéƒ½è¿˜æ¥ä¸åŠFix">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Cloud Alibaba">
<meta property="og:url" content="https://dd-xiaozhi.github.io/dd/2024/10/25/Spring%20Cloud%20Alibaba/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="ä¸€ã€æ¦‚è¿°1.1 Spring Cloud Alibabaä¸ºä»€ä¹ˆå‡ºç°ç”±äºSpring Cloud Netflixé¡¹ç›®è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼ŒSpring Cloudå®˜æ–¹å’ŒAlibabaåˆä½œæå‡ºä¸€å¥—æ¥æ›¿æ¢Netflixçš„å„ä¸ªæŠ€æœ¯  è¿›å…¥ç»´æŠ¤æ¨¡å¼æ„å‘³ç€Spring Cloud Netflix å°†ä¸å†å¼€å‘æ–°çš„ç»„ä»¶ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“Spring Cloud ç‰ˆæœ¬è¿­ä»£ç®—æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œå› è€Œå‡ºç°äº†å¾ˆå¤šé‡å¤§ISSUEéƒ½è¿˜æ¥ä¸åŠFix">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://dd-xiaozhi.github.io/dd/img/butterfly-icon.png">
<meta property="article:published_time" content="2024-10-24T17:53:53.000Z">
<meta property="article:modified_time" content="2025-08-25T17:33:08.843Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="test">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dd-xiaozhi.github.io/dd/img/butterfly-icon.png"><link rel="shortcut icon" href="/dd/img/favicon.png"><link rel="canonical" href="https://dd-xiaozhi.github.io/dd/2024/10/25/Spring%20Cloud%20Alibaba/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/dd/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        if (name && globalFn[key][name]) return
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/dd/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Spring Cloud Alibaba',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-08-26 01:33:08'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://picsum.photos/id/397/400/400);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/dd/"><span class="site-name">Hexo</span></a><a class="nav-page-title" href="/dd/"><span class="site-name">Spring Cloud Alibaba</span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">Spring Cloud Alibaba</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-10-24T17:53:53.000Z" title="Created 2024-10-25 01:53:53">2024-10-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-08-25T17:33:08.843Z" title="Updated 2025-08-26 01:33:08">2025-08-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h1><h2 id="1-1-Spring-Cloud-Alibabaä¸ºä»€ä¹ˆå‡ºç°"><a href="#1-1-Spring-Cloud-Alibabaä¸ºä»€ä¹ˆå‡ºç°" class="headerlink" title="1.1 Spring Cloud Alibabaä¸ºä»€ä¹ˆå‡ºç°"></a>1.1 Spring Cloud Alibabaä¸ºä»€ä¹ˆå‡ºç°</h2><p>ç”±äº<code>Spring Cloud Netflix</code>é¡¹ç›®è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼Œ<code>Spring Cloud</code>å®˜æ–¹å’Œ<code>Alibaba</code>åˆä½œæå‡ºä¸€å¥—æ¥æ›¿æ¢<code>Netflix</code>çš„å„ä¸ªæŠ€æœ¯</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230221210223336.png" alt="image-20230221210223336"></p>
<p>è¿›å…¥ç»´æŠ¤æ¨¡å¼æ„å‘³ç€Spring Cloud Netflix å°†ä¸å†å¼€å‘æ–°çš„ç»„ä»¶ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“Spring Cloud ç‰ˆæœ¬è¿­ä»£ç®—æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œå› è€Œå‡ºç°äº†å¾ˆå¤šé‡å¤§ISSUEéƒ½è¿˜æ¥ä¸åŠFixå°±åˆæ¨å¦ä¸€ä¸ªReleaseäº†ã€‚è¿›å…¥ç»´æŠ¤æ¨¡å¼æ„æ€å°±æ˜¯ç›®å‰ä¸€ç›´ä»¥åä¸€æ®µæ—¶é—´Spring Cloud Netflixæä¾›çš„æœåŠ¡å’ŒåŠŸèƒ½å°±è¿™ä¹ˆå¤šäº†ï¼Œä¸åœ¨å¼€å‘æ–°çš„ç»„ä»¶å’ŒåŠŸèƒ½äº†ã€‚ä»¥åå°†ä»¥ç»´æŠ¤å’ŒMergeåˆ†æ”¯Full Requestä¸ºä¸»ï¼Œæ‰€ä»¥æ–°ç»„ä»¶åŠŸèƒ½å°†ä»¥å…¶ä»–æ›¿ä»£å¹³ä»£æ›¿çš„æ–¹å¼å®ç°ã€‚</p>
<h2 id="1-2-æ˜¯ä»€ä¹ˆ"><a href="#1-2-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1.2 æ˜¯ä»€ä¹ˆ"></a>1.2 æ˜¯ä»€ä¹ˆ</h2><p>å®˜ç½‘ï¼š<code>https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md</code></p>
<p>è¯ç”Ÿï¼š2018.10.31ï¼ŒSpring Cloud Alibaba æ­£å¼å…¥é©»äº† Spring Cloud å®˜æ–¹å­µåŒ–å™¨ï¼Œå¹¶åœ¨ Maven ä¸­å¤®åº“å‘å¸ƒäº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬ã€‚</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230221210453424.png" alt="image-20230221210453424"></p>
<h3 id="1-2-1-ä¸»è¦åŠŸèƒ½"><a href="#1-2-1-ä¸»è¦åŠŸèƒ½" class="headerlink" title="1.2.1 ä¸»è¦åŠŸèƒ½*"></a>1.2.1 ä¸»è¦åŠŸèƒ½*</h3><ul>
<li><strong>æœåŠ¡é™æµé™çº§</strong>ï¼šé»˜è®¤æ”¯æŒ WebServletã€WebFluxã€OpenFeignã€RestTemplateã€Spring Cloud Gatewayã€Zuulã€Dubbo å’Œ RocketMQ é™æµé™çº§åŠŸèƒ½çš„æ¥å…¥ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡æ§åˆ¶å°å®æ—¶ä¿®æ”¹é™æµé™çº§è§„åˆ™ï¼Œè¿˜æ”¯æŒæŸ¥çœ‹é™æµé™çº§ Metrics ç›‘æ§ã€‚</li>
<li><strong>æœåŠ¡æ³¨å†Œä¸å‘ç°</strong>ï¼šé€‚é… Spring Cloud æœåŠ¡æ³¨å†Œä¸å‘ç°æ ‡å‡†ï¼Œé»˜è®¤é›†æˆäº† Ribbon çš„æ”¯æŒã€‚</li>
<li><strong>åˆ†å¸ƒå¼é…ç½®ç®¡ç†</strong>ï¼šæ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨åŒ–é…ç½®ï¼Œé…ç½®æ›´æ”¹æ—¶è‡ªåŠ¨åˆ·æ–°ã€‚</li>
<li><strong>æ¶ˆæ¯é©±åŠ¨èƒ½åŠ›</strong>ï¼šåŸºäº Spring Cloud Stream ä¸ºå¾®æœåŠ¡åº”ç”¨æ„å»ºæ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ã€‚</li>
<li><strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼šä½¿ç”¨ @GlobalTransactional æ³¨è§£ï¼Œ é«˜æ•ˆå¹¶ä¸”å¯¹ä¸šåŠ¡é›¶ä¾µå…¥åœ°è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚</li>
<li><strong>é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨</strong>ï¼šé˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æ”¯æŒåœ¨ä»»ä½•åº”ç”¨ã€ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹å­˜å‚¨å’Œè®¿é—®ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</li>
<li><strong>åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦</strong>ï¼šæä¾›ç§’çº§ã€ç²¾å‡†ã€é«˜å¯é ã€é«˜å¯ç”¨çš„å®šæ—¶ï¼ˆåŸºäº Cron è¡¨è¾¾å¼ï¼‰ä»»åŠ¡è°ƒåº¦æœåŠ¡ã€‚åŒæ—¶æä¾›åˆ†å¸ƒå¼çš„ä»»åŠ¡æ‰§è¡Œæ¨¡å‹ï¼Œå¦‚ç½‘æ ¼ä»»åŠ¡ã€‚ç½‘æ ¼ä»»åŠ¡æ”¯æŒæµ·é‡å­ä»»åŠ¡å‡åŒ€åˆ†é…åˆ°æ‰€æœ‰ Workerï¼ˆschedulerx-clientï¼‰ä¸Šæ‰§è¡Œã€‚</li>
<li><strong>é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡</strong>ï¼šè¦†ç›–å…¨çƒçš„çŸ­ä¿¡æœåŠ¡ï¼Œå‹å¥½ã€é«˜æ•ˆã€æ™ºèƒ½çš„äº’è”åŒ–é€šè®¯èƒ½åŠ›ï¼Œå¸®åŠ©ä¼ä¸šè¿…é€Ÿæ­å»ºå®¢æˆ·è§¦è¾¾é€šé“ã€‚</li>
</ul>
<h3 id="1-2-2-ç»„ä»¶"><a href="#1-2-2-ç»„ä»¶" class="headerlink" title="1.2.2 ç»„ä»¶"></a>1.2.2 ç»„ä»¶</h3><p>**<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel">Sentinel</a>**ï¼šæŠŠæµé‡ä½œä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p>
<p>**<a target="_blank" rel="noopener" href="https://github.com/alibaba/Nacos">Nacos</a>**ï¼šä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°ã€‚</p>
<p>**<a target="_blank" rel="noopener" href="https://rocketmq.apache.org/">RocketMQ</a>**ï¼šä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿï¼ŒåŸºäºé«˜å¯ç”¨åˆ†å¸ƒå¼é›†ç¾¤æŠ€æœ¯ï¼Œæä¾›ä½å»¶æ—¶çš„ã€é«˜å¯é çš„æ¶ˆæ¯å‘å¸ƒä¸è®¢é˜…æœåŠ¡ã€‚</p>
<p>**<a target="_blank" rel="noopener" href="https://github.com/seata/seata">Seata</a>**ï¼šé˜¿é‡Œå·´å·´å¼€æºäº§å“ï¼Œä¸€ä¸ªæ˜“äºä½¿ç”¨çš„é«˜æ€§èƒ½å¾®æœåŠ¡åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚</p>
<p><strong><a target="_blank" rel="noopener" href="https://www.aliyun.com/product/oss">Alibaba Cloud OSS</a></strong>: é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼ˆObject Storage Serviceï¼Œç®€ç§° OSSï¼‰ï¼Œæ˜¯é˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æ‚¨å¯ä»¥åœ¨ä»»ä½•åº”ç”¨ã€ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹å­˜å‚¨å’Œè®¿é—®ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</p>
<p><strong><a target="_blank" rel="noopener" href="https://cn.aliyun.com/aliware/schedulerx">Alibaba Cloud SchedulerX</a></strong>: é˜¿é‡Œä¸­é—´ä»¶å›¢é˜Ÿå¼€å‘çš„ä¸€æ¬¾åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦äº§å“ï¼Œæä¾›ç§’çº§ã€ç²¾å‡†ã€é«˜å¯é ã€é«˜å¯ç”¨çš„å®šæ—¶ï¼ˆåŸºäº Cron è¡¨è¾¾å¼ï¼‰ä»»åŠ¡è°ƒåº¦æœåŠ¡ã€‚</p>
<p><strong><a target="_blank" rel="noopener" href="https://www.aliyun.com/product/sms">Alibaba Cloud SMS</a></strong>: è¦†ç›–å…¨çƒçš„çŸ­ä¿¡æœåŠ¡ï¼Œå‹å¥½ã€é«˜æ•ˆã€æ™ºèƒ½çš„äº’è”åŒ–é€šè®¯èƒ½åŠ›ï¼Œå¸®åŠ©ä¼ä¸šè¿…é€Ÿæ­å»ºå®¢æˆ·è§¦è¾¾é€šé“ã€‚</p>
<h3 id="1-2-3-æ–‡æ¡£"><a href="#1-2-3-æ–‡æ¡£" class="headerlink" title="1.2.3 æ–‡æ¡£"></a>1.2.3 æ–‡æ¡£</h3><ul>
<li>å®˜ç½‘ï¼š<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud-alibaba#overview">https://spring.io/projects/spring-cloud-alibaba#overview</a></li>
<li>è‹±æ–‡ï¼š<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba">https://github.com/alibaba/spring-cloud-alibaba</a></li>
<li><a target="_blank" rel="noopener" href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html</a></li>
</ul>
</li>
<li>ä¸­æ–‡ï¼š<a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md">https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md</a></li>
</ul>
<h1 id="äºŒã€Nacos"><a href="#äºŒã€Nacos" class="headerlink" title="äºŒã€Nacos"></a>äºŒã€Nacos</h1><h2 id="2-1-æ¦‚è¿°å’Œå®‰è£…"><a href="#2-1-æ¦‚è¿°å’Œå®‰è£…" class="headerlink" title="2.1 æ¦‚è¿°å’Œå®‰è£…"></a>2.1 æ¦‚è¿°å’Œå®‰è£…</h2><h3 id="2-1-1-æ¦‚è¿°"><a href="#2-1-1-æ¦‚è¿°" class="headerlink" title="2.1.1 æ¦‚è¿°"></a>2.1.1 æ¦‚è¿°</h3><p><strong>Nacos</strong>: <code>Dynamic Naming and Configuration Service(åŠ¨æ€å‘½åå’Œé…ç½®æœåŠ¡)</code></p>
<p>Nacoså°±æ˜¯æ³¨å†Œä¸­å¿ƒ + é…ç½®ä¸­å¿ƒçš„ç»„åˆï¼Œç­‰ä»·äº<code>Eureka+Config +Bus</code>ï¼Œå®ƒæ›¿æ¢Eurekaåšä¸ºæ³¨å†Œä¸­å¿ƒï¼Œæ›¿æ¢Configåšé…ç½®ä¸­å¿ƒï¼Œåæ­£å°±æ˜¯ç‰›é€¼~~~ã€‚</p>
<p><strong>Nacoså®˜ç½‘</strong></p>
<ul>
<li>Githubå®˜ç½‘ï¼š<code>https://github.com/alibaba/Nacos</code></li>
<li>Nacoså®˜ç½‘ï¼š<code>https://nacos.io/zh-cn/index.html</code></li>
<li>Spring Cloudå®˜ç½‘ï¼š<code>https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery</code></li>
</ul>
<p><strong>Nacosçš„å…¨æ™¯å›¾</strong></p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/1533045871534-e64b8031-008c-4dfc-b6e8-12a597a003fb.png" alt="nacos_landscape.png"></p>
<p>éå¸¸æœ‰é‡å¿ƒ~~~</p>
<h3 id="2-1-2-å®‰è£…"><a href="#2-1-2-å®‰è£…" class="headerlink" title="2.1.2 å®‰è£…"></a>2.1.2 å®‰è£…</h3><p>å®˜ç½‘ä¸‹è½½å³å¯ï¼Œè¿™é‡Œç»™å‡ºä¸‹è½½åœ°å€ï¼š<code>https://github.com/alibaba/nacos/releases</code></p>
<p>ä¸‹è½½å®Œè§£å‹ï¼Œæ‰“å¼€cmdï¼Œåœ¨binç›®å½•è¾“å‡º<code>startup.cmd</code>å¯åŠ¨</p>
<p>å¯åŠ¨å®Œæˆåè®¿é—®<code>http://localhost:8848/nacos</code>ï¼Œé»˜è®¤è´¦å·å’Œå¯†ç æ˜¯<code>nacos</code></p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230222162250461.png" alt="image-20230222162250461"></p>
<p>æˆåŠŸ~~~ğŸ˜ˆğŸ˜ˆğŸ˜ˆ</p>
<h2 id="2-2-æœåŠ¡æ³¨å†Œä¸­å¿ƒ"><a href="#2-2-æœåŠ¡æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="2.2 æœåŠ¡æ³¨å†Œä¸­å¿ƒ"></a>2.2 æœåŠ¡æ³¨å†Œä¸­å¿ƒ</h2><h3 id="2-2-1-æœåŠ¡æä¾›è€…"><a href="#2-2-1-æœåŠ¡æä¾›è€…" class="headerlink" title="2.2.1 æœåŠ¡æä¾›è€…"></a>2.2.1 æœåŠ¡æä¾›è€…</h3><p>åˆ›å»ºä¸€ä¸ª9001å·¥ç¨‹å’Œ<strong>9011å·¥ç¨‹çš„ç«¯å£æ˜ å°„å·¥ç¨‹</strong></p>
<p><strong>9001å·¥ç¨‹</strong></p>
<ol>
<li><p>åˆ›å»º<code>cloud-alibaba-provider-payment9001</code></p>
</li>
<li><p>POM</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>YAML</p>
<p>é…ç½®Nacosåœ°å€ï¼Œæš´éœ²ç«¯å£</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#é…ç½®Nacosåœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸»å¯åŠ¨</p>
<p>æ ‡æ³¨<code>@EnableDiscoveryClient</code>å¼€å¯æœåŠ¡å‘ç°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain9001</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain9001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸šåŠ¡ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;nacos registry, serverPort: &quot;</span>+ serverPort+<span class="string">&quot;\t id&quot;</span>+id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>åˆ›å»ºç«¯å£æ˜ å°„å·¥ç¨‹</strong></p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230222164755995.png" alt="image-20230222164755995"></p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230222165034779.png" alt="image-20230222165034779"></p>
<p><strong>æµ‹è¯•</strong></p>
<p>å¯åŠ¨9001å’Œ9011å·¥ç¨‹ï¼Œè§‚å¯ŸNacosæ§åˆ¶å°çš„æœåŠ¡åˆ—è¡¨</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230222165254764.png" alt="image-20230222165254764"></p>
<p>æˆåŠŸ~~~ğŸ˜ˆğŸ˜ˆğŸ˜ˆ</p>
<h3 id="2-2-2-æœåŠ¡æ¶ˆè´¹è€…"><a href="#2-2-2-æœåŠ¡æ¶ˆè´¹è€…" class="headerlink" title="2.2.2 æœåŠ¡æ¶ˆè´¹è€…"></a>2.2.2 æœåŠ¡æ¶ˆè´¹è€…</h3><h4 id="æ¶ˆè´¹è€…å·¥ç¨‹"><a href="#æ¶ˆè´¹è€…å·¥ç¨‹" class="headerlink" title="æ¶ˆè´¹è€…å·¥ç¨‹"></a>æ¶ˆè´¹è€…å·¥ç¨‹</h4><p>ç«¯å£83</p>
<ol>
<li><p>åˆ›å»º<code>cloud-alibaba-consumer-nacos-order83</code>æ¨¡å—</p>
</li>
<li><p>POM</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>YAML</p>
<p>é…ç½®Nacosåœ°å€</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">83</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-order-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°(æ³¨å†ŒæˆåŠŸè¿›nacosçš„å¾®æœåŠ¡æä¾›è€…)ï¼ˆè‡ªå®šä¹‰ï¼‰</span></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line">  <span class="attr">nacos-user-service:</span> <span class="string">http://nacos-payment-provider</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸»å¯åŠ¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span>	<span class="comment">// å¼€å¯æœåŠ¡å‘ç°</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderNacosMain83</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderNacosMain83.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸šåŠ¡ç±»</p>
<ul>
<li><p>config</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextBean</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span>   <span class="comment">// å¼€å¯è´Ÿè½½å‡è¡¡</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderNacosController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;service-url.nacos-user-service&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverURL;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(serverURL+<span class="string">&quot;/payment/nacos/&quot;</span>+id,String.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<p><strong>å¯åŠ¨æµ‹è¯•</strong></p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230222170017238.png" alt="image-20230222170017238"></p>
<p>webæ§åˆ¶å°æŸ¥çœ‹æ²¡é—®é¢˜</p>
<p>è®¿é—®<code>http://localhost:83/consumer/payment/nacos/1</code></p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230222170124564.png" alt="image-20230222170124564"></p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230222170845225.png" alt="image-20230222170845225"></p>
<p>nice~~~</p>
<h4 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h4><p>Nacosè‡ªå¸¦è´Ÿè½½å‡è¡¡</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230222171031349.png" alt="image-20230222171031349"></p>
<p>å¯ä»¥çœ‹åˆ°å®ƒçš„ä¾èµ–ä¸­é›†æˆäº†<code>ribbon</code></p>
<p>æ›¿æ¢è´Ÿè½½è§„åˆ™ï¼Œå°†é»˜è®¤çš„æ›¿æ¢æ‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> IRule <span class="title function_">myRule</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// é»˜è®¤è§„åˆ™</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="2-2-3-å„å¤§æ³¨å†Œä¸­å¿ƒçš„æ¯”è¾ƒ"><a href="#2-2-3-å„å¤§æ³¨å†Œä¸­å¿ƒçš„æ¯”è¾ƒ" class="headerlink" title="2.2.3 å„å¤§æ³¨å†Œä¸­å¿ƒçš„æ¯”è¾ƒ"></a>2.2.3 å„å¤§æ³¨å†Œä¸­å¿ƒçš„æ¯”è¾ƒ</h3><p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230222161651663.png" alt="image-20230222161651663"></p>
<p>Cæ˜¯æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼›è€ŒAçš„å®šä¹‰æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šæ”¶åˆ°å“åº”ã€‚</p>
<p>ä½•æ—¶é€‰æ‹©ä½¿ç”¨ä½•ç§æ¨¡å¼ï¼Ÿ<br>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸éœ€è¦å­˜å‚¨æœåŠ¡çº§åˆ«çš„ä¿¡æ¯ä¸”æœåŠ¡å®ä¾‹æ˜¯é€šè¿‡nacos-clientæ³¨å†Œï¼Œå¹¶èƒ½å¤Ÿä¿æŒå¿ƒè·³ä¸ŠæŠ¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€‰æ‹©APæ¨¡å¼ã€‚å½“å‰ä¸»æµçš„æœåŠ¡å¦‚ Spring cloud å’Œ Dubbo æœåŠ¡ï¼Œéƒ½é€‚ç”¨äºAPæ¨¡å¼ï¼ŒAPæ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯ç”¨æ€§è€Œå‡å¼±äº†ä¸€è‡´æ€§ï¼Œå› æ­¤APæ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ã€‚</p>
<p>å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–è€…å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆ CP æ˜¯å¿…é¡»ï¼ŒK8SæœåŠ¡å’ŒDNSæœåŠ¡åˆ™é€‚ç”¨äºCPæ¨¡å¼ã€‚<br>CPæ¨¡å¼ä¸‹åˆ™æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼Œæ­¤æ—¶åˆ™æ˜¯ä»¥ Raft åè®®ä¸ºé›†ç¾¤è¿è¡Œæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹æ³¨å†Œå®ä¾‹ä¹‹å‰å¿…é¡»å…ˆæ³¨å†ŒæœåŠ¡ï¼Œå¦‚æœæœåŠ¡ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè¿”å›é”™è¯¯ã€‚</p>
<p>&#x3D;&#x3D;<strong>Nacosæ”¯æŒAPå’ŒCPæ¨¡å¼çš„è½¬æ¢</strong>&#x3D;&#x3D;</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT <span class="string">&#x27;$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode&amp;value=CP&#x27;</span></span><br></pre></td></tr></table></figure>





<h2 id="2-3-æœåŠ¡é…ç½®ä¸­å¿ƒ"><a href="#2-3-æœåŠ¡é…ç½®ä¸­å¿ƒ" class="headerlink" title="2.3 æœåŠ¡é…ç½®ä¸­å¿ƒ"></a>2.3 æœåŠ¡é…ç½®ä¸­å¿ƒ</h2><h3 id="2-3-1-å·¥ç¨‹æ­å»º"><a href="#2-3-1-å·¥ç¨‹æ­å»º" class="headerlink" title="2.3.1 å·¥ç¨‹æ­å»º"></a>2.3.1 å·¥ç¨‹æ­å»º</h3><ol>
<li><p><code>cloudalibaba-config-nacos-client3377</code></p>
</li>
<li><p>POM</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--nacos-config--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--nacos-discovery--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web + actuator--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€èˆ¬åŸºç¡€é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>YAML</p>
<p>bootstrap.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3377</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config-client</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#æŒ‡å®šyamlæ ¼å¼çš„é…ç½®</span></span><br></pre></td></tr></table></figure>

<p>application.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># è¡¨ç¤ºå¼€å‘ç¯å¢ƒ</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸»å¯åŠ¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosConfigClientMain3377</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">            SpringApplication.run(NacosConfigClientMain3377.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸šåŠ¡ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span> <span class="comment">// åœ¨æ§åˆ¶å™¨ç±»åŠ å…¥@RefreshScopeæ³¨è§£ä½¿å½“å‰ç±»ä¸‹çš„é…ç½®æ”¯æŒNacosçš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/config/info&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConfigInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>å¯åŠ¨æŸ¥çœ‹nacosæœåŠ¡åˆ—è¡¨ï¼Œæœ‰è¡¨ç¤ºæˆåŠŸ~~~</p>
<h3 id="2-3-2-é…ç½®æ–‡ä»¶åŒ¹é…è§„åˆ™"><a href="#2-3-2-é…ç½®æ–‡ä»¶åŒ¹é…è§„åˆ™" class="headerlink" title="2.3.2 é…ç½®æ–‡ä»¶åŒ¹é…è§„åˆ™"></a>2.3.2 é…ç½®æ–‡ä»¶åŒ¹é…è§„åˆ™</h3><p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230223160434807.png" alt="image-20230223160434807"></p>
<p>æ‰€ä»¥å½“å‰æ¨¡å—çš„dataIdä¸ºï¼š</p>
<ul>
<li>å¼€å‘ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼š<code>nacos-config-client-dev.yaml</code></li>
<li>æµ‹è¯•ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼š<code>nacos-config-client-test.yaml</code></li>
<li>â€¦â€¦</li>
</ul>
<p>&#x3D;&#x3D;å®ƒçš„åŒ¹é…è§„åˆ™ä¸æ­¢åªæœ‰dataIdä¸€ç§ï¼Œä¸‹ä¸€ç« ä¼šè®²è§£å¦å¤–ä¸¤ç§æ–¹å¼&#x3D;&#x3D;</p>
<p><strong>æµ‹è¯•</strong></p>
<p>æ·»åŠ é…ç½®æ–‡ä»¶ï¼Œç„¶åè®¿é—®<code>http://localhost:3377/config/info</code></p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230223160921130.png" alt="image-20230223160921130"></p>
<p>ç‚¹å‡»åŠ å·æ·»åŠ </p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230223161055146.png" alt="image-20230223161055146"></p>
<p>åœ¨ç®¡ç†ç•Œé¢å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ·»åŠ çš„é…ç½®æ–‡ä»¶</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230223161123107.png" alt="image-20230223161123107"></p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230223161215723.png" alt="image-20230223161215723"></p>
<p>æˆåŠŸè·å–æœ€æ–°é…ç½®ï¼ŒæˆåŠŸ~~~ğŸ˜ˆğŸ˜ˆğŸ˜ˆ</p>
<p>&#x3D;&#x3D;é…ç½®ä¼šè‡ªåŠ¨åˆ·æ–°ï¼Œä¸éœ€è¦æˆ‘ä»¬å‘é€åˆ·æ–°è¯·æ±‚&#x3D;&#x3D;</p>
<h3 id="2-3-3-ä¸‰ç§æ–¹å¼åŠ è½½é…ç½®"><a href="#2-3-3-ä¸‰ç§æ–¹å¼åŠ è½½é…ç½®" class="headerlink" title="2.3.3 ä¸‰ç§æ–¹å¼åŠ è½½é…ç½®"></a>2.3.3 ä¸‰ç§æ–¹å¼åŠ è½½é…ç½®</h3><h4 id="Data-Id"><a href="#Data-Id" class="headerlink" title="Data Id"></a>Data Id</h4><p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230223160434807.png" alt="image-20230223160434807"></p>
<p>è®¾ç½®æˆè§„å®šæ ¼å¼å³å¯</p>
<h4 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h4><p>åˆ†ç»„ï¼Œé€šè¿‡ç»„æ¥åˆ’åˆ†ç¯å¢ƒæˆ–è€…æœåŠ¡</p>
<ol>
<li><p>åˆ›å»ºåˆ†ç»„</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230226105457582.png" alt="image-20230226105457582"></p>
<p>ç›´æ¥å¡«å†™ç»„å³å¯</p>
</li>
<li><p>YAMLæ–‡ä»¶ä¸­æŒ‡å®šå¯¹åº”çš„ç»„</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">DEV_GROUP</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>æ¡ˆä¾‹</strong></p>
<p>åˆ›å»ºä¸‰ä¸ªç›¸åŒåå­—çš„æ–‡ä»¶ï¼Œä½†æ˜¯ç»„ä¸åŒ</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230226105717782.png" alt="image-20230226105717782"></p>
<p>æŒ‡å®šç»„</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230226105748966.png" alt="image-20230226105748966"></p>
<p>é‡æ–°å¯åŠ¨æŸ¥çœ‹ç»“æœ</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230226105812244.png" alt="image-20230226105812244"></p>
<p>æ²¡é—®é¢˜~~~</p>
<h4 id="Namespace"><a href="#Namespace" class="headerlink" title="Namespace"></a>Namespace</h4><p>å‘½åç©ºé—´ï¼Œå¯ä»¥ç”¨ä½œæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„åŒºåˆ†</p>
<p>é»˜è®¤çš„å‘½åç©ºé—´æ˜¯<code>public</code>ï¼Œä¸å¯åˆ é™¤</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230226105911258.png" alt="image-20230226105911258"></p>
<p>æ–°å»ºå‘½åç©ºé—´</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230226105941897.png" alt="image-20230226105941897"></p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230226110116772.png" alt="image-20230226110116772"></p>
<p>å‘½åç©ºé—´IDåœ¨æŒ‡å®šå‘½åç©ºé—´çš„æ—¶å€™éœ€è¦å¡«å†™</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230226110427164.png" alt="image-20230226110427164"></p>
<p><code>bootstrap.yaml</code>æŒ‡å®šå‘½åç©ºé—´</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">      	<span class="comment"># æŒ‡å®šå‘½åç©ºé—´</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="comment"># å‘½åç©ºé—´ID</span></span><br></pre></td></tr></table></figure>





<p><strong>æ¡ˆä¾‹</strong></p>
<p>åˆ›å»ºä¸€ä¸ªä»¥<code>user-service</code>å‘½åçš„å‘½åç©ºé—´ï¼Œå¹¶æŒ‡å®šå®ƒ</p>
<p><code>bootstrap.yaml</code>ä¸­æŒ‡å®šå‘½åç©ºé—´</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230226110602107.png" alt="image-20230226110602107"></p>
<p>å¯åŠ¨æµ‹è¯•</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230226125039397.png" alt="image-20230226125039397"></p>
<p>æˆåŠŸ~~~</p>
<h2 id="2-4-é›†ç¾¤ä¸æŒä¹…åŒ–"><a href="#2-4-é›†ç¾¤ä¸æŒä¹…åŒ–" class="headerlink" title="2.4 é›†ç¾¤ä¸æŒä¹…åŒ–"></a>2.4 é›†ç¾¤ä¸æŒä¹…åŒ–</h2><h3 id="2-4-1-å®˜æ–¹æ–‡æ¡£"><a href="#2-4-1-å®˜æ–¹æ–‡æ¡£" class="headerlink" title="2.4.1 å®˜æ–¹æ–‡æ¡£"></a>2.4.1 å®˜æ–¹æ–‡æ¡£</h3><p>é›†ç¾¤æ­å»ºå®˜æ–¹æ–‡æ¡£ï¼š<code>https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html</code></p>
<p>å®˜ç½‘æ¶æ„å›¾</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/deployDnsVipMode.jpg" alt="deployDnsVipMode.jpg"></p>
<p>SLBï¼šè´Ÿè½½å‡è¡¡å±‚ï¼Œä¸€èˆ¬ç”¨nginxæ¥åšè´Ÿè½½</p>
<p>çœŸå®éƒ¨ç½²æƒ…å†µ</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230226163948896.png" alt="image-20230226163948896"></p>
<h3 id="2-4-2-nacosæŒä¹…åŒ–"><a href="#2-4-2-nacosæŒä¹…åŒ–" class="headerlink" title="2.4.2 nacosæŒä¹…åŒ–"></a>2.4.2 nacosæŒä¹…åŒ–</h3><p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230226164457969.png" alt="image-20230226164457969"></p>
<p>é»˜è®¤å•å‡»ä½¿ç”¨çš„æ˜¯åä¸º<code>derby</code>çš„åµŒå…¥å¼æ•°æ®åº“ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨MySQLæ¥æ›¿æ¢ã€‚</p>
<p>åœ¨nacosçš„é¡¹ç›®POMä¸­å¯ä»¥çœ‹åˆ°ä¾èµ–ä¸­æœ‰<code>derby</code>çš„ä¾èµ–</p>
<p><code>https://github.com/alibaba/nacos/blob/develop/config/pom.xml</code></p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230226165012019.png" alt="image-20230226165012019"></p>
<p><strong>å¦‚ä½•æ›¿æ¢ï¼Ÿ</strong></p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230226164844235.png" alt="image-20230226164844235"></p>
<ol>
<li><p>åˆå§‹åŒ–æ•°æ®åº“	</p>
<p><code>https://github.com/alibaba/nacos/blob/master/distribution/conf/mysql-schema.sql</code></p>
</li>
<li><p>ä¿®æ”¹nacosçš„é…ç½®ç¯å¢ƒ</p>
<p><img src="https://xiaozhi-blog.oss-cn-guangzhou.aliyuncs.com/img/image-20230226165351401.png" alt="image-20230226165351401"></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Count of DB:</span></span><br><span class="line"><span class="comment"># db.num=1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### Connect URL of DB:</span></span><br><span class="line"><span class="comment"># db.url.0=jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="comment"># db.user.0=nacos</span></span><br><span class="line"><span class="comment"># db.password.0=nacos</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-4-3-ç”Ÿäº§ç¯å¢ƒé›†ç¾¤æ­å»º"><a href="#2-4-3-ç”Ÿäº§ç¯å¢ƒé›†ç¾¤æ­å»º" class="headerlink" title="2.4.3 ç”Ÿäº§ç¯å¢ƒé›†ç¾¤æ­å»º"></a>2.4.3 ç”Ÿäº§ç¯å¢ƒé›†ç¾¤æ­å»º</h3><p>åœ¨linuxç¯å¢ƒä¸‹æ­å»ºé›†ç¾¤</p>
<p>éœ€è¦å¯åŠ¨çš„æœåŠ¡</p>
<ul>
<li>ä¸‰å° nacos -&gt; æ­å»ºé›†ç¾¤</li>
<li>ä¸€å° nginx -&gt; è½¬å‘</li>
<li>ä¸€å° mysql -&gt; æŒä¹…åŒ–</li>
</ul>
<p>Linuxä¸‹å®‰è£…nacosï¼Œç›´æ¥è§£å‹ï¼Œnacosçš„binç›®å½•ä¸‹è¾“å…¥ä¸€ä¸‹å‘½ä»¤å¯åŠ¨æˆ–å…³é—­æœåŠ¡</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230312152045657.png" alt="image-20230312152045657"></p>
<h4 id="â‘ ä¿®æ”¹nacosé…ç½®"><a href="#â‘ ä¿®æ”¹nacosé…ç½®" class="headerlink" title="â‘ ä¿®æ”¹nacosé…ç½®"></a>â‘ ä¿®æ”¹nacosé…ç½®</h4><ol>
<li><p>ä¿®æ”¹<code>application.properties</code>æ–‡ä»¶ -&gt; é…ç½®å¤–éƒ¨æ•°æ®æº</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### If user MySQL as datasource:</span></span><br><span class="line"><span class="attr">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"><span class="comment">### Count of DB:</span></span><br><span class="line"><span class="attr">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="comment">### Connect URL of DB:</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹æˆæˆ‘ä»¬è‡ªå·±çš„æ•°æ®åº“åœ°å€å’Œé…ç½®</span></span><br><span class="line"><span class="attr">db.url.0</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">db.user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">db.password</span>=<span class="string">abc123</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>é…ç½®é›†ç¾¤é…ç½®æ–‡ä»¶</p>
<p>åœ¨nacosçš„è§£å‹ç›®å½•nacos&#x2F;çš„confç›®å½•ä¸‹ï¼Œæœ‰é…ç½®æ–‡ä»¶cluster.confï¼Œè¯·æ¯è¡Œé…ç½®æˆip:portã€‚ï¼ˆè¯·é…ç½®3ä¸ªæˆ–3ä¸ªä»¥ä¸ŠèŠ‚ç‚¹ï¼‰</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example</span></span><br><span class="line">192.168.10.10:3333</span><br><span class="line">192.168.10.10:4444</span><br><span class="line">192.168.10.10:5555</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹å¯åŠ¨è„šæœ¬ï¼Œæˆ‘ä»¬è¦å¯åŠ¨ä¸‰å°nacosï¼Œæ‰€ä»¥éœ€è¦åœ¨ä¸åŒçš„ç«¯å£å¯åŠ¨ï¼Œè„šæœ¬ä¿®æ”¹æˆå¯æŒ‡å®šç«¯å£å·å¯åŠ¨</p>
<p>ä¿®æ”¹binç›®å½•ä¸‹çš„<code>startup.sh</code>å¯åŠ¨è„šæœ¬ï¼ˆè®°å¾—å¤‡ä»½ï¼Œé˜²æ­¢åäº†åˆé‡æ–°å®‰è£…ï¼‰</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230312231022976.png" alt="image-20230312231022976"></p>
<p>æ·»åŠ è™šæ‹Ÿæœºå‚æ•°ï¼Œè®¾ç½®ç«¯å£å·ä¸ºæˆ‘ä»¬å¯åŠ¨æ—¶æ ‡æ³¨çš„ç«¯å£å·</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230312231135790.png" alt="image-20230312231135790"></p>
<p><strong>æ³¨æ„</strong>ğŸ˜®ï¼šè¦æ”¾åœ¨ç¬¬ä¸€è¡Œçš„ä½ç½®ï¼Œæ”¾åœ¨æœ€åé¢ä¼šå¯åŠ¨å¤±è´¥ï¼ˆæµ‹è¯•è¿‡~~~ï¼‰</p>
</li>
</ol>
<h4 id="â‘¡åˆ›å»ºæ•°æ®åº“è¡¨"><a href="#â‘¡åˆ›å»ºæ•°æ®åº“è¡¨" class="headerlink" title="â‘¡åˆ›å»ºæ•°æ®åº“è¡¨"></a>â‘¡åˆ›å»ºæ•°æ®åº“è¡¨</h4><p>åˆ›å»ºæ•°æ®åº“<code>nacos</code></p>
<p>sqlæ–‡ä»¶åœ¨<code>https://github.com/alibaba/nacos/blob/master/distribution/conf/mysql-schema.sql</code>å’Œ<code>/nacos/conf</code>ä¸‹éƒ½å¯ä»¥è·å–ï¼Œè·å–æ‰§è¡Œå³å¯ã€‚</p>
<h4 id="â‘¢ä¿®æ”¹nginxé…ç½®"><a href="#â‘¢ä¿®æ”¹nginxé…ç½®" class="headerlink" title="â‘¢ä¿®æ”¹nginxé…ç½®"></a>â‘¢ä¿®æ”¹nginxé…ç½®</h4><p>é…ç½®nginxåšè´Ÿè½½å‡è¡¡</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line">upstream cluster &#123;</span><br><span class="line">    server 127.0.0.1:3333;</span><br><span class="line">    server 127.0.0.1:4444;</span><br><span class="line">    server 127.0.0.1:5555;</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">	listen       1111;</span><br><span class="line">	server_name  localhost;</span><br><span class="line"></span><br><span class="line">	<span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line">	<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">###############  Nacosé›†ç¾¤é…ç½®   #########################</span></span><br><span class="line">	location / &#123;</span><br><span class="line"></span><br><span class="line">		proxy_pass http://cluster;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="â‘£æµ‹è¯•"><a href="#â‘£æµ‹è¯•" class="headerlink" title="â‘£æµ‹è¯•"></a>â‘£æµ‹è¯•</h4><p><strong>å¯åŠ¨nacosé›†ç¾¤</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@xiaozhi bin]# ./startup.sh -n 3333	<span class="comment"># è¿™ä¸ª-næ˜¯æˆ‘ä»¬å®šä¹‰çš„</span></span><br><span class="line">[root@xiaozhi bin]# ./startup.sh -n 4444</span><br><span class="line">[root@xiaozhi bin]# ./startup.sh -n 5555</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;<strong>ğŸ˜…æ³¨æ„</strong>ï¼šè¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘çš„è™šæ‹Ÿæœºæ˜¯2Gçš„å†…å­˜ï¼Œncaosçš„åˆå§‹å†…å­˜æ˜¯2gï¼Œæ‰€ä»¥ä¸‰å°åŒæ—¶å¯åŠ¨çš„è¯ä¼šæŠŠå†…å­˜æ’‘çˆ†ï¼Œå¯¼è‡´æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å®ƒçš„è™šæ‹Ÿæœºå‚æ•°è¿›è¡Œä¿®æ”¹&#x3D;&#x3D;</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230312230915474.png" alt="image-20230312230915474"></p>
<p>è®¾ç½®å®Œæˆåå†æ¬¡å¯åŠ¨</p>
<p>è®¿é—®<code>ä¸»æœºæˆ–IP:1111/nacos</code>ï¼Œå‡ºç°ç•Œé¢è¯´æ˜å¯åŠ¨æˆåŠŸ</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230312225950897.png" alt="image-20230312225950897"></p>
<p>æŸ¥çœ‹ä¸‰å°nacosæœåŠ¡çš„çŠ¶æ€</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230312230055242.png" alt="image-20230312230055242"></p>
<p>nice~~~ğŸ˜‹ğŸ˜‹ğŸ˜‹</p>
<p><strong>æ³¨å†ŒæœåŠ¡</strong></p>
<p>éšä¾¿æ‰¾ä¸€ä¸ªå¾®æœåŠ¡æ³¨å†Œåˆ°nacosä¸­ï¼ŒæŸ¥çœ‹æ§åˆ¶å°ï¼Œæœ‰è¯¥æœåŠ¡åˆ™æˆ‘ä»¬çš„é›†ç¾¤æ­å»ºæˆåŠŸ</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230312231554336.png" alt="image-20230312231554336"></p>
<p>æ¼‚äº®O(âˆ©_âˆ©)Oå“ˆå“ˆ~ğŸ˜™ğŸ˜™ğŸ˜™</p>
<h1 id="ä¸‰ã€Sentinel"><a href="#ä¸‰ã€Sentinel" class="headerlink" title="ä¸‰ã€Sentinel"></a>ä¸‰ã€Sentinel</h1><h2 id="3-1-Sentinelä»‹ç»"><a href="#3-1-Sentinelä»‹ç»" class="headerlink" title="3.1 Sentinelä»‹ç»"></a>3.1 Sentinelä»‹ç»</h2><h3 id="3-1-1-å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#3-1-1-å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="3.1.1 å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ"></a>3.1.1 å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>éšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Sentinel æ˜¯é¢å‘åˆ†å¸ƒå¼ã€å¤šè¯­è¨€å¼‚æ„åŒ–æœåŠ¡æ¶æ„çš„æµé‡æ²»ç†ç»„ä»¶ï¼Œä¸»è¦ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡è·¯ç”±ã€æµé‡æ§åˆ¶ã€æµé‡æ•´å½¢ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè‡ªé€‚åº”è¿‡è½½ä¿æŠ¤ã€çƒ­ç‚¹æµé‡é˜²æŠ¤ç­‰å¤šä¸ªç»´åº¦æ¥å¸®åŠ©å¼€å‘è€…ä¿éšœå¾®æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p>
<p>å®ƒæ˜¯alibabaå¾®æœåŠ¡ä½“ç³»çš„<code>hystrix</code>ï¼Œä½†æ˜¯å®ƒæ¯”<code>Hystrix</code>æ›´åŠ å¥½ç”¨ï¼Œå¯ä»¥é€šè¿‡webç•Œé¢æ¥å¯¹æœåŠ¡è¿›è¡Œé…ç½®ï¼Œä»¥æ­¤æ¥è¾¾åˆ°ä¿æŠ¤æœåŠ¡çš„æ•ˆæœã€‚</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230314113750794.png" alt="image-20230314113750794"></p>
<h3 id="3-1-2-Sentinel-åŸºæœ¬æ¦‚å¿µ"><a href="#3-1-2-Sentinel-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="3.1.2 Sentinel åŸºæœ¬æ¦‚å¿µ"></a>3.1.2 Sentinel åŸºæœ¬æ¦‚å¿µ</h3><p><strong>èµ„æº</strong></p>
<p>èµ„æºæ˜¯ Sentinel çš„å…³é”®æ¦‚å¿µã€‚å®ƒå¯ä»¥æ˜¯ Java åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•å†…å®¹ï¼Œä¾‹å¦‚ï¼Œç”±åº”ç”¨ç¨‹åºæä¾›çš„æœåŠ¡ï¼Œæˆ–ç”±åº”ç”¨ç¨‹åºè°ƒç”¨çš„å…¶å®ƒåº”ç”¨æä¾›çš„æœåŠ¡ï¼Œç”šè‡³å¯ä»¥æ˜¯ä¸€æ®µä»£ç ã€‚åœ¨æ¥ä¸‹æ¥çš„æ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šç”¨èµ„æºæ¥æè¿°ä»£ç å—ã€‚</p>
<p>åªè¦é€šè¿‡ Sentinel API å®šä¹‰çš„ä»£ç ï¼Œå°±æ˜¯èµ„æºï¼Œèƒ½å¤Ÿè¢« Sentinel ä¿æŠ¤èµ·æ¥ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³•ç­¾åï¼ŒURLï¼Œç”šè‡³æœåŠ¡åç§°ä½œä¸ºèµ„æºåæ¥æ ‡ç¤ºèµ„æºã€‚</p>
<p><strong>è§„åˆ™</strong></p>
<p>å›´ç»•èµ„æºçš„å®æ—¶çŠ¶æ€è®¾å®šçš„è§„åˆ™ï¼Œå¯ä»¥åŒ…æ‹¬æµé‡æ§åˆ¶è§„åˆ™ã€ç†”æ–­é™çº§è§„åˆ™ä»¥åŠç³»ç»Ÿä¿æŠ¤è§„åˆ™ã€‚æ‰€æœ‰è§„åˆ™å¯ä»¥åŠ¨æ€å®æ—¶è°ƒæ•´ã€‚è¿™äº›è§„åˆ™å¯ä»¥é€šè¿‡webæ§åˆ¶å°æ¥è¿›è¡Œé…ç½®ã€‚</p>
<h2 id="3-2-Sentinelå…¥é—¨"><a href="#3-2-Sentinelå…¥é—¨" class="headerlink" title="3.2 Sentinelå…¥é—¨"></a>3.2 Sentinelå…¥é—¨</h2><p>Sentinelå®ƒåˆ†å‰å°å’Œåå°ï¼Œå‰å°å°±æ˜¯å®ƒçš„æ§åˆ¶å°ï¼Œé€šè¿‡æ§åˆ¶å°å¯ä»¥å¯¹æœåŠ¡è¿›è¡ŒåŠ¨æ€é…ç½®æ¥å®ç°æµé‡æ§åˆ¶ã€æœåŠ¡é™çº§ã€ç†”æ–­é™çº§ç­‰ä¿æŠ¤æœºåˆ¶ã€‚</p>
<h3 id="3-2-1-å®‰è£…Sentinelæ§åˆ¶å°"><a href="#3-2-1-å®‰è£…Sentinelæ§åˆ¶å°" class="headerlink" title="3.2.1 å®‰è£…Sentinelæ§åˆ¶å°"></a>3.2.1 å®‰è£…Sentinelæ§åˆ¶å°</h3><p><strong>ä¸‹è½½åœ°å€</strong>ï¼š<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/releases">https://github.com/alibaba/Sentinel/releases</a></p>
<p><strong>è¿è¡Œ</strong>ï¼šjava -jar ç›´æ¥è¿è¡Œ</p>
<p>è®¿é—® <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a> æ‰“å¼€æ§åˆ¶å°</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230314113145802.png" alt="image-20230314113145802"></p>
<h3 id="3-2-2-æµ‹è¯•å·¥ç¨‹"><a href="#3-2-2-æµ‹è¯•å·¥ç¨‹" class="headerlink" title="3.2.2 æµ‹è¯•å·¥ç¨‹"></a>3.2.2 æµ‹è¯•å·¥ç¨‹</h3><h4 id="â‘ æ­å»º"><a href="#â‘ æ­å»º" class="headerlink" title="â‘ æ­å»º"></a>â‘ æ­å»º</h4><ol>
<li><p>åˆ›å»º<code>cloudalibaba-sentinel-service8401</code>æ¨¡å—</p>
</li>
<li><p>POM</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos åç»­åšæŒä¹…åŒ–ç”¨åˆ°--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba sentinel --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶+actuator --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.6.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>YAML</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8401</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloudalibaba-sentinel-service</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="comment"># sentinel webç›‘æ§å°åœ°å€</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span></span><br><span class="line">        <span class="comment"># sentinelåå°çš„å¯åŠ¨ç«¯å£ï¼Œé»˜è®¤8719ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ,ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸»å¯åŠ¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApp8401</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MainApp8401.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸šåŠ¡ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlowLimitController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testA&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;-------TestA------&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testB&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testB</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;-------TestB------&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="â‘¡æµ‹è¯•"><a href="#â‘¡æµ‹è¯•" class="headerlink" title="â‘¡æµ‹è¯•"></a>â‘¡æµ‹è¯•</h4><p>å¯åŠ¨nacosæœåŠ¡</p>
<p><strong>æ³¨æ„</strong>ï¼šsentinelé‡‡ç”¨çš„æ˜¯æ‡’åŠ è½½æœºåˆ¶ï¼Œåªæœ‰æœåŠ¡è¢«è¯·æ±‚äº†æ‰ä¼šå‡ºç°åœ¨æ§åˆ¶å°ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆè®¿é—®æœåŠ¡ï¼Œå†å»æŸ¥çœ‹æ§åˆ¶å°å˜åŒ–</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230314120121496.png" alt="image-20230314120121496"></p>
<p>æˆåŠŸç›‘æ§åˆ°äº†æœåŠ¡</p>
<p>è®¿é—®å¤šæ¬¡<code>/testA</code>å’Œ<code>/testB</code>ï¼Œå¯ä»¥çœ‹åˆ°ç›‘æ§å‘ç”Ÿçš„å˜åŒ–</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230314120230007.png" alt="image-20230314120230007"></p>
<p>æˆåŠŸ~~~</p>
<h2 id="3-3-æµé‡æ§åˆ¶"><a href="#3-3-æµé‡æ§åˆ¶" class="headerlink" title="3.3 æµé‡æ§åˆ¶"></a>3.3 æµé‡æ§åˆ¶</h2><h3 id="3-3-1-æ¦‚è¿°"><a href="#3-3-1-æ¦‚è¿°" class="headerlink" title="3.3.1 æ¦‚è¿°"></a>3.3.1 æ¦‚è¿°</h3><p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230315150850016.png" alt="image-20230315150850016"></p>
<p><strong>æ³¨æ„</strong>ï¼šçº¿ç¨‹æ²¡æœ‰æµæ§æ•ˆæœï¼Œåªæœ‰æµæ§æ¨¡å¼</p>
<p>webæ§åˆ¶é¡µé¢</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230315150915997.png" alt="image-20230315150915997"></p>
<h3 id="3-3-2-æµæ§æ¨¡å¼"><a href="#3-3-2-æµæ§æ¨¡å¼" class="headerlink" title="3.3.2 æµæ§æ¨¡å¼"></a>3.3.2 æµæ§æ¨¡å¼</h3><h4 id="â‘ ç›´æ¥"><a href="#â‘ ç›´æ¥" class="headerlink" title="â‘ ç›´æ¥"></a>â‘ ç›´æ¥</h4><p>æµé‡è¶…è¿‡äº†è®¾å®šçš„QPSæˆ–è€…æ‰§è¡Œçš„çº¿ç¨‹æ•°ï¼Œå°±ä¼šç›´æ¥æŠ¥é”™</p>
<h4 id="â‘¡å…³è”"><a href="#â‘¡å…³è”" class="headerlink" title="â‘¡å…³è”"></a>â‘¡å…³è”</h4><p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230315151244904.png" alt="image-20230315151244904"></p>
<p>Aèµ„æºå…³è”Bèµ„æºï¼Œå½“Bèµ„æºè¾¾åˆ°è®¾ç½®çš„é˜ˆå€¼æ—¶ï¼ŒAå°±ä¼šè¢«é™æµï¼Œè§¦å‘æµæ§æ•ˆæœ</p>
<p><strong>å®éªŒ</strong>ï¼šå¯ä»¥ä½¿ç”¨<code>JMeter</code>æ¨¡æ‹Ÿå¹¶å‘è®¿é—®<code>/testB</code>ï¼Œå†è®¿é—®<code>/testA</code>ï¼Œå‘ç°<code>/tsetA</code>æŠ¥é”™äº†ï¼ˆæµæ§æ•ˆæœä¸ºå¿«é€Ÿå¤±è´¥ï¼‰</p>
<h4 id="â‘¢é“¾è·¯"><a href="#â‘¢é“¾è·¯" class="headerlink" title="â‘¢é“¾è·¯"></a>â‘¢é“¾è·¯</h4><p>å¤šä¸ªé“¾è·¯è°ƒç”¨ä¸€ä¸ªèµ„æºï¼Œå¯¹èµ„æºè¿›è¡Œä¿æŠ¤ï¼Œå¯¹æŸä¸ªæˆ–æŸäº›é“¾è·¯è¿›è¡Œé™æµï¼Œå½“è¢«è®¿é—®çš„æ¬¡æ•°è¶…è¿‡äº†è®¾å®šçš„é˜ˆå€¼ï¼Œå°±ä¼šæŠ¥é”™</p>
<p><strong>ä»£ç å®ç°</strong></p>
<ul>
<li><p>æ·»åŠ <code>OrderService</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@SentinelResource(&quot;getOrder&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;è®¿é—®getOrder&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨</strong>ï¼šsentinueé»˜è®¤æ˜¯å°†controllerä¸­çš„æ–¹æ³•è¯†åˆ«ä¸ºèµ„æºï¼Œé™¤æ­¤ä¹‹å¤–çš„è¦æƒ³è¢«è¯†åˆ«ä¸ºèµ„æºéœ€è¦æ·»åŠ <code>@SentinelResourceæ³¨è§£æ¥æ ‡æ³¨</code></p>
</li>
<li><p>ä¿®æ”¹controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlowLimitController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testA&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testA</span><span class="params">()</span> &#123;</span><br><span class="line">        orderService.getOrder();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;-------TestA------&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testB&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testB</span><span class="params">()</span> &#123;</span><br><span class="line">        orderService.getOrder();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;-------TestB------&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>&#x3D;&#x3D;ç¦æ­¢æ”¶æ•›URLå…¥å£å¤„çš„context&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ä»1.6.3 ç‰ˆæœ¬å¼€å§‹ï¼ŒSentinel Web fifilteré»˜è®¤æ”¶æ•›æ‰€æœ‰URLçš„å…¥å£contextï¼Œå› æ­¤é“¾è·¯é™æµä¸ç”Ÿæ•ˆã€‚</span><br><span class="line"></span><br><span class="line">1.7.0 ç‰ˆæœ¬å¼€å§‹ï¼ˆå¯¹åº”SCAçš„2.1.1.RELEASE)ï¼Œå®˜æ–¹åœ¨CommonFilter å¼•å…¥äº†</span><br><span class="line"></span><br><span class="line">WEB_CONTEXT_UNIFY å‚æ•°ï¼Œç”¨äºæ§åˆ¶æ˜¯å¦æ”¶æ•›contextã€‚å°†å…¶é…ç½®ä¸º false å³å¯æ ¹æ®ä¸åŒçš„URL è¿›è¡Œé“¾è·¯é™æµã€‚</span><br><span class="line"></span><br><span class="line">SCA 2.1.1.RELEASEä¹‹åçš„ç‰ˆæœ¬,å¯ä»¥é€šè¿‡é…ç½®spring.cloud.sentinel.web-context-unify=falseå³å¯å…³é—­æ”¶æ•›æˆ‘ä»¬å½“å‰ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯SpringCloud Alibaba 2.1.0.RELEASEï¼Œæ— æ³•å®ç°é“¾è·¯é™æµã€‚</span><br><span class="line"></span><br><span class="line">ç›®å‰å®˜æ–¹è¿˜æœªå‘å¸ƒSCA 2.1.2.RELEASEï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ä½¿ç”¨2.1.1.RELEASEï¼Œéœ€è¦å†™ä»£ç çš„å½¢å¼å®ç°</span><br></pre></td></tr></table></figure>
</li>
<li><p>è‡ªå®šä¹‰ web filter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FilterContextConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean <span class="title function_">sentinelFilterRegistration</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">FilterRegistrationBean</span> <span class="variable">registration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line">        registration.setFilter(<span class="keyword">new</span> <span class="title class_">CommonFilter</span>());</span><br><span class="line">        registration.addUrlPatterns(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">        <span class="comment">// å…¥å£èµ„æºå…³é—­èšåˆ</span></span><br><span class="line">        registration.addInitParameter(CommonFilter.WEB_CONTEXT_UNIFY, <span class="string">&quot;false&quot;</span>);</span><br><span class="line">        registration.setName(<span class="string">&quot;sentinelFilter&quot;</span>);</span><br><span class="line">        registration.setOrder(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> registration;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">      	<span class="comment"># å…³é—­sentinelåŸæœ¬çš„filterï¼Œä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>é…ç½®é™æµè§„åˆ™</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230315163310568.png" alt="image-20230315163310568"></p>
</li>
</ul>
<p><strong>æµ‹è¯•</strong></p>
<p>å¤šæ¬¡è®¿é—®<code>/testA</code>ï¼ŒæŠ¥é”™äº†ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬è¦è®¾ç½®ä¸€ä¸ª<code>fallback</code>æ–¹æ³•</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230315162243832.png" alt="image-20230315162243832"></p>
<h3 id="3-3-3-æµæ§æ•ˆæœ"><a href="#3-3-3-æµæ§æ•ˆæœ" class="headerlink" title="3.3.3 æµæ§æ•ˆæœ"></a>3.3.3 æµæ§æ•ˆæœ</h3><p>å½“ QPS è¶…è¿‡æŸä¸ªé˜ˆå€¼çš„æ—¶å€™ï¼Œåˆ™é‡‡å–æªæ–½è¿›è¡Œæµé‡æ§åˆ¶ã€‚æµé‡æ§åˆ¶çš„æ‰‹æ®µåŒ…æ‹¬ä¸‹é¢ 3 ç§ï¼Œå¯¹åº” <code>FlowRule</code> ä¸­çš„ <code>controlBehavior</code> å­—æ®µï¼š</p>
<ol>
<li><p>ç›´æ¥æ‹’ç»ï¼ˆ<code>RuleConstant.CONTROL_BEHAVIOR_DEFAULT</code>ï¼‰æ–¹å¼ã€‚è¯¥æ–¹å¼æ˜¯é»˜è®¤çš„æµé‡æ§åˆ¶æ–¹å¼ï¼Œå½“QPSè¶…è¿‡ä»»æ„è§„åˆ™çš„é˜ˆå€¼åï¼Œæ–°çš„è¯·æ±‚å°±ä¼šè¢«ç«‹å³æ‹’ç»ï¼Œæ‹’ç»æ–¹å¼ä¸ºæŠ›å‡º<code>FlowException</code>ã€‚è¿™ç§æ–¹å¼é€‚ç”¨äºå¯¹ç³»ç»Ÿå¤„ç†èƒ½åŠ›ç¡®åˆ‡å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚é€šè¿‡å‹æµ‹ç¡®å®šäº†ç³»ç»Ÿçš„å‡†ç¡®æ°´ä½æ—¶ã€‚å…·ä½“çš„ä¾‹å­å‚è§ <a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-basic/src/main/java/com/alibaba/csp/sentinel/demo/flow/FlowQpsDemo.java">FlowqpsDemo</a>ã€‚</p>
</li>
<li><p>å†·å¯åŠ¨ï¼ˆ<code>RuleConstant.CONTROL_BEHAVIOR_WARM_UP</code>ï¼‰æ–¹å¼ã€‚è¯¥æ–¹å¼ä¸»è¦ç”¨äºç³»ç»Ÿé•¿æœŸå¤„äºä½æ°´ä½çš„æƒ…å†µä¸‹ï¼Œå½“æµé‡çªç„¶å¢åŠ æ—¶ï¼Œç›´æ¥æŠŠç³»ç»Ÿæ‹‰å‡åˆ°é«˜æ°´ä½å¯èƒ½ç¬é—´æŠŠç³»ç»Ÿå‹å®ã€‚é€šè¿‡â€å†·å¯åŠ¨â€ï¼Œè®©é€šè¿‡çš„æµé‡ç¼“æ…¢å¢åŠ ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…é€æ¸å¢åŠ åˆ°é˜ˆå€¼ä¸Šé™ï¼Œç»™å†·ç³»ç»Ÿä¸€ä¸ªé¢„çƒ­çš„æ—¶é—´ï¼Œé¿å…å†·ç³»ç»Ÿè¢«å‹å®çš„æƒ…å†µã€‚å…·ä½“çš„ä¾‹å­å‚è§ <a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-basic/src/main/java/com/alibaba/csp/sentinel/demo/flow/WarmUpFlowDemo.java">WarmUpFlowDemo</a>ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šè¿™ç§æ–¹å¼åœ¨ä¸€æ®µæ—¶é—´ä¸è®¿é—®ä¹‹åå®ƒçš„é˜ˆå€¼å°±ä¼šé™ä¸º3ï¼Œå½“æœ‰æµé‡æ¥è®¿é—®æ—¶æ‰ä¼šæ…¢æ…¢æé«˜é˜ˆå€¼</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230315171108042.png" alt="image-20230315171108042"></p>
<p>é€šå¸¸å†·å¯åŠ¨çš„è¿‡ç¨‹ç³»ç»Ÿå…è®¸é€šè¿‡çš„ QPS æ›²çº¿å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\warmup.gif" alt="å†·å¯åŠ¨è¿‡ç¨‹ QPS æ›²çº¿"></p>
</li>
<li><p>åŒ€é€Ÿå™¨ï¼ˆ<code>RuleConstant.CONTROL_BEHAVIOR_RATE_LIMITER</code>ï¼‰æ–¹å¼ã€‚è¿™ç§æ–¹å¼ä¸¥æ ¼æ§åˆ¶äº†è¯·æ±‚é€šè¿‡çš„é—´éš”æ—¶é—´ï¼Œä¹Ÿå³æ˜¯è®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œå¯¹åº”çš„æ˜¯æ¼æ¡¶ç®—æ³•ã€‚å…·ä½“çš„ä¾‹å­å‚è§ <a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-basic/src/main/java/com/alibaba/csp/sentinel/demo/flow/PaceFlowDemo.java">PaceFlowDemo</a>ã€‚</p>
</li>
</ol>
<h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p><strong>ç›´æ¥å¤±è´¥æ–¹å¼</strong></p>
<p>è¶…è¿‡äº†è®¾å®šçš„é˜ˆå€¼å°±ä¼šç›´æ¥æŠ¥é”™</p>
<p><strong>Wran Upæ–¹å¼</strong></p>
<p>é…ç½®é™æµè§„åˆ™</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230315165740458.png" alt="image-20230315165740458"></p>
<p>åœ¨5ç§’å†…å¤šæ¬¡è®¿é—®<code>/testA</code>ï¼ˆç‹‚ç‚¹é¼ æ ‡ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°ä¸€å¼€å§‹ä¼šè¢«é™æµï¼Œéšç€å¯åŠ¨æ—¶é—´æ…¢æ…¢å°±æ¶ˆå¤±äº†</p>
<p><strong>æ’é˜Ÿç­‰å¾…æ–¹å¼</strong></p>
<p>ä¿®æ”¹<code>/testA</code>ï¼Œè®©ä»–æ‰§è¡Œä»¥æ­¤ä¼‘æ¯1ç§’ï¼Œæ¥ç€é…ç½®é™æµè§„åˆ™</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230315165016208.png" alt="image-20230315165016208"></p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230315165034910.png" alt="image-20230315165034910"></p>
<p>å¯ä»¥çœ‹åˆ°å¤„ç†è¯·æ±‚çš„æ—¶é—´æ˜¯1ç§’ä¸€ä¸ªï¼Œæ’é˜Ÿæ‰§è¡Œ</p>
<h2 id="3-4-ç†”æ–­é™çº§"><a href="#3-4-ç†”æ–­é™çº§" class="headerlink" title="3.4 ç†”æ–­é™çº§"></a>3.4 ç†”æ–­é™çº§</h2><h3 id="3-4-1-æ¦‚è¿°"><a href="#3-4-1-æ¦‚è¿°" class="headerlink" title="3.4.1 æ¦‚è¿°"></a>3.4.1 æ¦‚è¿°</h3><p>å’ŒHystrixä¸€æ ·ï¼ŒSentinelä¹Ÿæœ‰æœåŠ¡é™çº§å’Œç†”æ–­åŠŸèƒ½ã€‚ä¾èµ–æœåŠ¡ä¸ç¨³å®šå¯¼è‡´çš„å»¶æ—¶æˆ–è€…å¼‚å¸¸ä¼šå¯¼è‡´è°ƒç”¨æ–¹ç­‰å¾…æˆ–è€…é”™è¯¯ï¼Œæ‰€ä»¥éœ€è¦é˜²æ­¢è¿‡é•¿çš„è¶…æ—¶ç­‰å¾…ï¼Œä¾èµ–æœåŠ¡åœ¨è¶…è¿‡è®¾ç½®çš„é˜ˆå€¼å°±ç›´æ¥è¿”å›<code>fallback</code>æ–¹æ³•ï¼Œä»¥æ­¤æ¥é˜²æ­¢æœåŠ¡é›ªå´©ï¼Œé€šè¿‡ç†”æ–­æœºåˆ¶æ¥ä¿æŠ¤æœåŠ¡ä¸è¢«å·¨å¤§çš„æµé‡æå´©ã€‚</p>
<p>å’ŒHistrixçš„æ–­è·¯å™¨ä¸åŒï¼ŒSentinelæ²¡æœ‰åŠå¼€çŠ¶æ€çš„ï¼Œå®ƒåªæœ‰å¼€å’Œå…³ä¸¤ç§çŠ¶æ€ã€‚æœåŠ¡å¯ä»¥æ‰‹åŠ¨è®¾ç½®ç†”æ–­çš„æ—¶é—´ï¼Œå½“è¾¾åˆ°æŒ‡å®šä¹‹é—´æ‰ä¼šå¼€ã€‚</p>
<h3 id="3-4-2-ç†”æ–­ç­–ç•¥"><a href="#3-4-2-ç†”æ–­ç­–ç•¥" class="headerlink" title="3.4.2 ç†”æ–­ç­–ç•¥"></a>3.4.2 ç†”æ–­ç­–ç•¥</h3><p>Sentinel æä¾›ä»¥ä¸‹å‡ ç§ç†”æ–­ç­–ç•¥ï¼š</p>
<ul>
<li><p>**æ…¢è°ƒç”¨æ¯”ä¾‹ (<code>SLOW_REQUEST_RATIO</code>)**ï¼šé€‰æ‹©ä»¥æ…¢è°ƒç”¨æ¯”ä¾‹ä½œä¸ºé˜ˆå€¼ï¼Œéœ€è¦è®¾ç½®å…è®¸çš„æ…¢è°ƒç”¨ RTï¼ˆå³æœ€å¤§çš„å“åº”æ—¶é—´ï¼‰ï¼Œè¯·æ±‚çš„å“åº”æ—¶é—´å¤§äºè¯¥å€¼åˆ™ç»Ÿè®¡ä¸ºæ…¢è°ƒç”¨ã€‚å½“å•ä½ç»Ÿè®¡æ—¶é•¿ï¼ˆ<code>statIntervalMs</code>ï¼‰å†…è¯·æ±‚æ•°ç›®å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”æ…¢è°ƒç”¨çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚å“åº”æ—¶é—´å°äºè®¾ç½®çš„æ…¢è°ƒç”¨ RT åˆ™ç»“æŸç†”æ–­ï¼Œè‹¥å¤§äºè®¾ç½®çš„æ…¢è°ƒç”¨ RT åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322150302032.png" alt="image-20230322150302032"></p>
</li>
<li><p>**å¼‚å¸¸æ¯”ä¾‹ (<code>ERROR_RATIO</code>)**ï¼šå½“å•ä½ç»Ÿè®¡æ—¶é•¿ï¼ˆ<code>statIntervalMs</code>ï¼‰å†…è¯·æ±‚æ•°ç›®å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”å¼‚å¸¸çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚æˆåŠŸå®Œæˆï¼ˆæ²¡æœ‰é”™è¯¯ï¼‰åˆ™ç»“æŸç†”æ–­ï¼Œå¦åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚å¼‚å¸¸æ¯”ç‡çš„é˜ˆå€¼èŒƒå›´æ˜¯ <code>[0.0, 1.0]</code>ï¼Œä»£è¡¨ 0% - 100%ã€‚</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322150317609.png" alt="image-20230322150317609"></p>
</li>
<li><p>**å¼‚å¸¸æ•° (<code>ERROR_COUNT</code>)**ï¼šå½“å•ä½ç»Ÿè®¡æ—¶é•¿å†…çš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè‡ªåŠ¨è¿›è¡Œç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚æˆåŠŸå®Œæˆï¼ˆæ²¡æœ‰é”™è¯¯ï¼‰åˆ™ç»“æŸç†”æ–­ï¼Œå¦åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322150329730.png" alt="image-20230322150329730"></p>
</li>
</ul>
<h3 id="3-4-3-é™çº§è§„åˆ™"><a href="#3-4-3-é™çº§è§„åˆ™" class="headerlink" title="3.4.3 é™çº§è§„åˆ™"></a>3.4.3 é™çº§è§„åˆ™</h3><p><strong>ç†”æ–­é™çº§è§„åˆ™è¯´æ˜</strong></p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322003513526.png" alt="image-20230322003513526"></p>
<p>ç†”æ–­é™çº§è§„åˆ™ï¼ˆDegradeRuleï¼‰åŒ…å«ä¸‹é¢å‡ ä¸ªé‡è¦çš„å±æ€§ï¼š</p>
<table>
<thead>
<tr>
<th align="center">Field</th>
<th align="left">è¯´æ˜</th>
<th align="left">é»˜è®¤å€¼</th>
</tr>
</thead>
<tbody><tr>
<td align="center">resource</td>
<td align="left">èµ„æºåï¼Œå³è§„åˆ™çš„ä½œç”¨å¯¹è±¡</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">grade</td>
<td align="left">ç†”æ–­ç­–ç•¥ï¼Œæ”¯æŒæ…¢è°ƒç”¨æ¯”ä¾‹&#x2F;å¼‚å¸¸æ¯”ä¾‹&#x2F;å¼‚å¸¸æ•°ç­–ç•¥</td>
<td align="left">æ…¢è°ƒç”¨æ¯”ä¾‹</td>
</tr>
<tr>
<td align="center">count</td>
<td align="left">æ…¢è°ƒç”¨æ¯”ä¾‹æ¨¡å¼ä¸‹ä¸ºæ…¢è°ƒç”¨ä¸´ç•Œ RTï¼ˆè¶…å‡ºè¯¥å€¼è®¡ä¸ºæ…¢è°ƒç”¨ï¼‰ï¼›å¼‚å¸¸æ¯”ä¾‹&#x2F;å¼‚å¸¸æ•°æ¨¡å¼ä¸‹ä¸ºå¯¹åº”çš„é˜ˆå€¼</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">timeWindow</td>
<td align="left">ç†”æ–­æ—¶é•¿ï¼Œå•ä½ä¸º s</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">minRequestAmount</td>
<td align="left">ç†”æ–­è§¦å‘çš„æœ€å°è¯·æ±‚æ•°ï¼Œè¯·æ±‚æ•°å°äºè¯¥å€¼æ—¶å³ä½¿å¼‚å¸¸æ¯”ç‡è¶…å‡ºé˜ˆå€¼ä¹Ÿä¸ä¼šç†”æ–­ï¼ˆ1.7.0 å¼•å…¥ï¼‰</td>
<td align="left">5</td>
</tr>
<tr>
<td align="center">statIntervalMs</td>
<td align="left">ç»Ÿè®¡æ—¶é•¿ï¼ˆå•ä½ä¸º msï¼‰ï¼Œå¦‚ 60*1000 ä»£è¡¨åˆ†é’Ÿçº§ï¼ˆ1.8.0 å¼•å…¥ï¼‰</td>
<td align="left">1000 ms</td>
</tr>
<tr>
<td align="center">slowRatioThreshold</td>
<td align="left">æ…¢è°ƒç”¨æ¯”ä¾‹é˜ˆå€¼ï¼Œä»…æ…¢è°ƒç”¨æ¯”ä¾‹æ¨¡å¼æœ‰æ•ˆï¼ˆ1.8.0 å¼•å…¥ï¼‰</td>
<td align="left"></td>
</tr>
</tbody></table>
<p>&#x3D;&#x3D;æ³¨æ„ï¼šæœ€å°è¯·æ±‚æ•°ï¼ˆ<code>minRequestAmount</code>ï¼‰å’Œç»Ÿè®¡æ—¶é•¿ï¼ˆ<code>statIntervalMs</code>ï¼‰æ˜¯ä¸èƒ½åœ¨æ§åˆ¶å°ç›´æ¥ä¿®æ”¹çš„ï¼Œå¯åŠ¨æ§åˆ¶å°æ—¶æŒ‡å®šJVMå‚æ•°ä¿®æ”¹&#x3D;&#x3D;</p>
<h3 id="3-4-3-æ¡ˆä¾‹"><a href="#3-4-3-æ¡ˆä¾‹" class="headerlink" title="3.4.3 æ¡ˆä¾‹"></a>3.4.3 æ¡ˆä¾‹</h3><h4 id="æ…¢æ¯”ä¾‹è°ƒç”¨"><a href="#æ…¢æ¯”ä¾‹è°ƒç”¨" class="headerlink" title="æ…¢æ¯”ä¾‹è°ƒç”¨"></a>æ…¢æ¯”ä¾‹è°ƒç”¨</h4><p><code>/testA</code>æ–¹æ³•ä¸­è®¾ç½®çº¿ç¨‹ä¼‘çœ 5ç§’</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TimeUnit.SECONDS.sleep(<span class="number">6</span>);</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®ç†”æ–­è§„åˆ™</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322152319371.png" alt="image-20230322152319371"></p>
<p>è¯´æ˜ï¼š1ç§’å†…è¶…è¿‡äº”æ¬¡ç™¾åˆ†ç™¾æ¯”ä¾‹è¶…è¿‡RTï¼Œåˆ™æœåŠ¡å¼€å¯ç†”æ–­</p>
<p>æµ‹è¯•ï¼šä½¿ç”¨JMeterå¹¶å‘è¯·æ±‚</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322152613488.png" alt="image-20230322152613488"></p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322152453983.png" alt="image-20230322152453983"></p>
<h4 id="å¼‚å¸¸æ¯”ä¾‹"><a href="#å¼‚å¸¸æ¯”ä¾‹" class="headerlink" title="å¼‚å¸¸æ¯”ä¾‹"></a>å¼‚å¸¸æ¯”ä¾‹</h4><p>ä¿®æ”¹<code>/testA</code>ï¼Œåˆ¶é€ å¼‚å¸¸</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TimeUnit.SECONDS.sleep(1);</span></span><br><span class="line"><span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322153509301.png" alt="image-20230322153509301"></p>
<p>è¯´æ˜ï¼šè¯·æ±‚æ•°å¤§äºç­‰äº5ï¼Œ1ç§’å†…å‘ç”Ÿå¼‚å¸¸çš„æ¯”ä¾‹æ—¶ç™¾åˆ†ä¹‹äº”åï¼Œåˆ™æœåŠ¡ç†”æ–­</p>
<h4 id="å¼‚å¸¸æ•°"><a href="#å¼‚å¸¸æ•°" class="headerlink" title="å¼‚å¸¸æ•°"></a>å¼‚å¸¸æ•°</h4><p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322153707002.png" alt="image-20230322153707002"></p>
<p>è¯´æ˜ï¼šè¯·æ±‚æ•°å¤§äºç­‰äº5ï¼Œ1ç§’å†…å‘ç”Ÿ10æ¬¡å¼‚å¸¸ï¼Œåˆ™æœåŠ¡ç†”æ–­</p>
<h2 id="3-5-çƒ­ç‚¹å‚æ•°é™æµ"><a href="#3-5-çƒ­ç‚¹å‚æ•°é™æµ" class="headerlink" title="3.5 çƒ­ç‚¹å‚æ•°é™æµ"></a>3.5 çƒ­ç‚¹å‚æ•°é™æµ</h2><h3 id="3-5-1-ä»€ä¹ˆæ˜¯çƒ­ç‚¹å‚æ•°é™æµ"><a href="#3-5-1-ä»€ä¹ˆæ˜¯çƒ­ç‚¹å‚æ•°é™æµ" class="headerlink" title="3.5.1 ä»€ä¹ˆæ˜¯çƒ­ç‚¹å‚æ•°é™æµ"></a>3.5.1 ä»€ä¹ˆæ˜¯çƒ­ç‚¹å‚æ•°é™æµ</h3><p>çƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ï¼Œå‚æ•°å°±æ˜¯urlä¸Šçš„ä¼ è¾“ï¼Œçƒ­ç‚¹å‚æ•°å°±æ˜¯ç»å¸¸è®¿é—®çš„å‚æ•°ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>å•†å“ ID ä¸ºå‚æ•°ï¼Œç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…æœ€å¸¸è´­ä¹°çš„å•†å“ ID å¹¶è¿›è¡Œé™åˆ¶</li>
<li>ç”¨æˆ· ID ä¸ºå‚æ•°ï¼Œé’ˆå¯¹ä¸€æ®µæ—¶é—´å†…é¢‘ç¹è®¿é—®çš„ç”¨æˆ· ID è¿›è¡Œé™åˆ¶</li>
</ul>
<p>çƒ­ç‚¹å‚æ•°é™æµä¼šæ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµï¼Œçƒ­ç‚¹é™æµå’Œæµé‡é™æµä¸€æ ·ï¼Œä½†æ˜¯å®ƒæ¯”æµé‡é™æµçš„ç²’åº¦æ›´å°ï¼Œå®ƒæ˜¯å¯¹æŸä¸ªå‚æ•°è¿›è¡Œç›‘æ§é™æµ</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\sentinel-hot-param-overview-1.png" alt="Sentinel Parameter Flow Control"></p>
<p>Sentinel åˆ©ç”¨ LRU ç­–ç•¥ç»Ÿè®¡æœ€è¿‘æœ€å¸¸è®¿é—®çš„çƒ­ç‚¹å‚æ•°ï¼Œç»“åˆä»¤ç‰Œæ¡¶ç®—æ³•æ¥è¿›è¡Œå‚æ•°çº§åˆ«çš„æµæ§ã€‚</p>
<h3 id="3-5-2-çƒ­ç‚¹å‚æ•°è§„åˆ™"><a href="#3-5-2-çƒ­ç‚¹å‚æ•°è§„åˆ™" class="headerlink" title="3.5.2 çƒ­ç‚¹å‚æ•°è§„åˆ™"></a>3.5.2 çƒ­ç‚¹å‚æ•°è§„åˆ™</h3><p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322161737048.png" alt="image-20230322161737048"></p>
<p>çƒ­ç‚¹å‚æ•°è§„åˆ™ï¼ˆ<code>ParamFlowRule</code>ï¼‰ç±»ä¼¼äºæµé‡æ§åˆ¶è§„åˆ™ï¼ˆ<code>FlowRule</code>ï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th align="center">å±æ€§</th>
<th align="left">è¯´æ˜</th>
<th align="left">é»˜è®¤å€¼</th>
</tr>
</thead>
<tbody><tr>
<td align="center">resource</td>
<td align="left">èµ„æºåï¼Œå¿…å¡«</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">count</td>
<td align="left">é™æµé˜ˆå€¼ï¼Œå¿…å¡«</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">grade</td>
<td align="left">é™æµæ¨¡å¼</td>
<td align="left">QPS æ¨¡å¼</td>
</tr>
<tr>
<td align="center">durationInSec</td>
<td align="left">ç»Ÿè®¡çª—å£æ—¶é—´é•¿åº¦ï¼ˆå•ä½ä¸ºç§’ï¼‰ï¼Œ1.6.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ</td>
<td align="left">1s</td>
</tr>
<tr>
<td align="center">controlBehavior</td>
<td align="left">æµæ§æ•ˆæœï¼ˆæ”¯æŒå¿«é€Ÿå¤±è´¥å’ŒåŒ€é€Ÿæ’é˜Ÿæ¨¡å¼ï¼‰ï¼Œ1.6.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ</td>
<td align="left">å¿«é€Ÿå¤±è´¥</td>
</tr>
<tr>
<td align="center">maxQueueingTimeMs</td>
<td align="left">æœ€å¤§æ’é˜Ÿç­‰å¾…æ—¶é•¿ï¼ˆä»…åœ¨åŒ€é€Ÿæ’é˜Ÿæ¨¡å¼ç”Ÿæ•ˆï¼‰ï¼Œ1.6.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ</td>
<td align="left">0ms</td>
</tr>
<tr>
<td align="center">paramIdx</td>
<td align="left">çƒ­ç‚¹å‚æ•°çš„ç´¢å¼•ï¼Œå¿…å¡«ï¼Œå¯¹åº” <code>SphU.entry(xxx, args)</code> ä¸­çš„å‚æ•°ç´¢å¼•ä½ç½®</td>
<td align="left"></td>
</tr>
<tr>
<td align="center">paramFlowItemList</td>
<td align="left">å‚æ•°ä¾‹å¤–é¡¹ï¼Œå¯ä»¥é’ˆå¯¹æŒ‡å®šçš„å‚æ•°å€¼å•ç‹¬è®¾ç½®é™æµé˜ˆå€¼ï¼Œä¸å—å‰é¢ <code>count</code> é˜ˆå€¼çš„é™åˆ¶ã€‚<strong>ä»…æ”¯æŒåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ç±»å‹</strong></td>
<td align="left"></td>
</tr>
<tr>
<td align="center">clusterMode</td>
<td align="left">æ˜¯å¦æ˜¯é›†ç¾¤å‚æ•°æµæ§è§„åˆ™</td>
<td align="left"><code>false</code></td>
</tr>
<tr>
<td align="center">clusterConfig</td>
<td align="left">é›†ç¾¤æµæ§ç›¸å…³é…ç½®</td>
<td align="left"></td>
</tr>
</tbody></table>
<h3 id="3-5-3-åŸºæœ¬ä½¿ç”¨"><a href="#3-5-3-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="3.5.3 åŸºæœ¬ä½¿ç”¨"></a>3.5.3 åŸºæœ¬ä½¿ç”¨</h3><p>æ–°å¢æ¥å£æ–¹æ³•<code>testC</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testC&quot;)</span></span><br><span class="line"><span class="comment">// æ ‡è®°ä¸ºèµ„æº</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;testC&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testC</span><span class="params">(<span class="meta">@RequestParam(name = &quot;p1&quot;, required = false)</span> String p1,</span></span><br><span class="line"><span class="params">                    <span class="meta">@RequestParam(name = &quot;p2&quot;, required = false)</span> String p2)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;testC--------------&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨</strong>ï¼šå¿…é¡»è¦ä½¿ç”¨<code>@SentinelResource</code>æ ‡æ³¨æ–¹æ³•ï¼Œä¸ç„¶æ˜¯æ— æ•ˆçš„</p>
<p>é…ç½®çƒ­ç‚¹è§„åˆ™</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322162548732.png" alt="image-20230322162548732"></p>
<p>æµ‹è¯•ï¼Œè®¿é—®<code>http://localhost:8401/testC?p1=sdfds</code>ï¼Œç‹‚ç‚¹å°é¼ ~~~~ğŸ˜ˆğŸ˜ˆğŸ˜ˆ</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322162628794.png" alt="image-20230322162628794"></p>
<p><strong>ç»“æœ</strong>ï¼šæŠ¥é”™äº†ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰åšä»»ä½•çš„å¤„ç†ï¼Œéšæ„å®ƒé»˜è®¤æ˜¯ç›´æ¥æŠ¥é”™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®<code>fallback</code>æ–¹æ³•æ¥åšå‹å¥½æç¤ºï¼Œåé¢çš„ç« èŠ‚æˆ‘ä»¬ä¼šè®²åˆ°å¦‚ä½•è®¾ç½®<code>fallback</code>æ–¹æ³•</p>
<h3 id="3-5-4-å‚æ•°ä¾‹å¤–é¡¹"><a href="#3-5-4-å‚æ•°ä¾‹å¤–é¡¹" class="headerlink" title="3.5.4 å‚æ•°ä¾‹å¤–é¡¹"></a>3.5.4 å‚æ•°ä¾‹å¤–é¡¹</h3><p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322163110792.png" alt="image-20230322163110792"></p>
<p>å¯¹èµ„æºä¸­çš„å‚æ•°çš„å€¼è¿›è¡Œé…ç½®ï¼Œå½“è¿™ä¸ªå‚æ•°æ˜¯é…ç½®çš„å€¼æ—¶å°±ä¼šè§¦å‘å¯¹åº”çš„è§„åˆ™</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322163412065.png" alt="image-20230322163412065"></p>
<p><strong>è¯´æ˜</strong>ï¼šæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå‚æ•°ä¾‹å¤–é¡¹ï¼Œè¿™ä¸ªä¾‹å¤–é¡¹è¡¨ç¤ºå½“å‚æ•°å€¼ä¸º<code>a</code>æ—¶å®ƒçš„é™æµé˜ˆå€¼å˜ä¸º200ã€‚å½“è¿™ä¸ªå€¼ä¸æ˜¯<code>a</code>æ—¶å®ƒçš„é™æµé˜ˆå€¼å˜ä¸º<code>å•æœºé˜ˆå€¼</code></p>
<p><strong>æµ‹è¯•</strong>ï¼š</p>
<ul>
<li><p>å†æ¬¡è®¿é—®<code>http://localhost:8401/testC?p1=sdfds</code>ï¼Œè¿˜æ˜¯ä¸å˜ï¼Œå½“æˆ‘ä»¬1ç§’å†…è®¿é—®è¶…è¿‡ä¸¤æ¬¡å°±ä¼šæŠ¥é”™ã€‚</p>
</li>
<li><p>è®¿é—®<code>http://localhost:8401/testC?p1=a</code>ï¼Œç‹‚ç‚¹å°é¼ ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å®ƒå¹¶æ²¡æœ‰æŠ¥é”™ã€‚</p>
</li>
<li><p>å› ä¸ºæˆ‘ä»¬çš„å‚æ•°æ˜¯aï¼Œæ‰€ä»¥æ­¤æ—¶çš„èµ„æºé™æµé˜ˆå€¼æ˜¯200</p>
</li>
</ul>
<h2 id="3-6-ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤"><a href="#3-6-ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤" class="headerlink" title="3.6 ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤"></a>3.6 ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤</h2><p>ç³»ç»Ÿè§„åˆ™æ˜¯é’ˆå¯¹æ•´ä¸ªåº”ç”¨å±‚é¢çš„ï¼Œå½“æˆ‘ä»¬è®¾ç½®å…¶ä¸­ä¸€ä¸ªé…ç½®é¡¹è¾¾åˆ°å¯¹åº”é˜ˆå€¼æ—¶å°±ä¼šé™æµæ•´ä¸ªåº”ç”¨ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªåº”ç”¨ä¸å¯ç”¨ï¼Œå¯¹ç³»ç»Ÿè¿›è¡Œä¿æŠ¤ï¼Œå› ä¸ºä¸€æ—¦æœ‰è¿‡å¤šçš„æµé‡è¿›å•¦å°±ä¼šå¯¼è‡´è¯·æ±‚çš„<code>RT</code>å˜é•¿ï¼Œå› ä¸ºè¯·æ±‚è¿‡å¤šå¯¼è‡´å¤„ç†ä¸è¿‡æ¥å°±ä¼šè¿›è¡Œæ’é˜Ÿï¼Œè€Œæ’é˜Ÿè¶Šé•¿ï¼Œæ—¶å»¶ä¹Ÿå°±ä¼šå˜å¾—è¶Šé•¿ï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®å½“ç³»ç»Ÿè¾¾åˆ°ä¸€å®šç¨‹åº¦æ—¶å°±å¯¹ç³»ç»Ÿè¿›è¡Œä¿æŠ¤ã€‚</p>
<h3 id="3-6-1-ç³»ç»Ÿè§„åˆ™"><a href="#3-6-1-ç³»ç»Ÿè§„åˆ™" class="headerlink" title="3.6.1 ç³»ç»Ÿè§„åˆ™"></a>3.6.1 ç³»ç»Ÿè§„åˆ™</h3><p>ç³»ç»Ÿä¿æŠ¤è§„åˆ™æ˜¯ä»åº”ç”¨çº§åˆ«çš„å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œä»å•å°æœºå™¨çš„æ€»ä½“ Loadã€RTã€å…¥å£ QPS å’Œçº¿ç¨‹æ•°å››ä¸ªç»´åº¦ç›‘æ§åº”ç”¨æ•°æ®ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚</p>
<p>ç³»ç»Ÿä¿æŠ¤è§„åˆ™æ˜¯åº”ç”¨æ•´ä½“ç»´åº¦çš„ï¼Œè€Œä¸æ˜¯èµ„æºç»´åº¦çš„ï¼Œå¹¶ä¸”<strong>ä»…å¯¹å…¥å£æµé‡ç”Ÿæ•ˆ</strong>ã€‚å…¥å£æµé‡æŒ‡çš„æ˜¯è¿›å…¥åº”ç”¨çš„æµé‡ï¼ˆ<code>EntryType.IN</code>ï¼‰ï¼Œæ¯”å¦‚ Web æœåŠ¡æˆ– Dubbo æœåŠ¡ç«¯æ¥æ”¶çš„è¯·æ±‚ï¼Œéƒ½å±äºå…¥å£æµé‡ã€‚</p>
<p>ç³»ç»Ÿè§„åˆ™æ”¯æŒä»¥ä¸‹çš„é˜ˆå€¼ç±»å‹ï¼š</p>
<ul>
<li><strong>Load</strong>ï¼ˆä»…å¯¹ Linux&#x2F;Unix-like æœºå™¨ç”Ÿæ•ˆï¼‰ï¼šå½“ç³»ç»Ÿ load1 è¶…è¿‡é˜ˆå€¼ï¼Œä¸”ç³»ç»Ÿå½“å‰çš„å¹¶å‘çº¿ç¨‹æ•°è¶…è¿‡ç³»ç»Ÿå®¹é‡æ—¶æ‰ä¼šè§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚ç³»ç»Ÿå®¹é‡ç”±ç³»ç»Ÿçš„ <code>maxQps * minRt</code> è®¡ç®—å¾—å‡ºã€‚è®¾å®šå‚è€ƒå€¼ä¸€èˆ¬æ˜¯ <code>CPU cores * 2.5</code>ã€‚</li>
<li><strong>CPU usage</strong>ï¼ˆ1.5.0+ ç‰ˆæœ¬ï¼‰ï¼šå½“ç³»ç»Ÿ CPU ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆå–å€¼èŒƒå›´ 0.0-1.0ï¼‰ã€‚</li>
<li><strong>RT</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹³å‡ RT è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</li>
<li><strong>çº¿ç¨‹æ•°</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li>
<li><strong>å…¥å£ QPS</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„ QPS è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li>
</ul>
<h3 id="3-6-2-æ¡ˆä¾‹"><a href="#3-6-2-æ¡ˆä¾‹" class="headerlink" title="3.6.2 æ¡ˆä¾‹"></a>3.6.2 æ¡ˆä¾‹</h3><p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322164827108.png" alt="image-20230322164827108"></p>
<p>æ­¤æ—¶åº”ç”¨1ç§’å†…åªèƒ½å¤„ç†1æ¬¡è¯·æ±‚ã€‚</p>
<h2 id="3-7-SentinelResource-æ³¨è§£"><a href="#3-7-SentinelResource-æ³¨è§£" class="headerlink" title="3.7 @SentinelResource æ³¨è§£"></a>3.7 @SentinelResource æ³¨è§£</h2><h3 id="3-7-1-æ¦‚è¿°"><a href="#3-7-1-æ¦‚è¿°" class="headerlink" title="3.7.1 æ¦‚è¿°"></a>3.7.1 æ¦‚è¿°</h3><p>åœ¨3.5ç« æˆ‘ä»¬ä½¿ç”¨äº†<code>@SentinelResourceæ³¨è§£</code>æ¥æ ‡è®°èµ„æºï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰ç»™å®ƒè®¾ç½®ä»»ä½•å…œåº•æ–¹æ³•ï¼Œæ‰€ä»¥å½“è¯·æ±‚è¶…è¿‡è¿‡æˆ‘ä»¬è®¾å®šçš„é˜ˆå€¼å®ƒå°±ä¼šç›´æ¥æŠ¥é”™ï¼Œä½†æ˜¯è¿™å¯¹æˆ‘ä»¬çš„ç”¨æˆ·æ¥è¯´æ—¶ä¸å‹å¥½çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æœ‰å…œåº•æ–¹æ³•æ¥ç»™ç”¨æˆ·å‹å¥½æç¤ºã€‚</p>
<p><code>@SentinelResource</code> ç”¨äºå®šä¹‰èµ„æºï¼Œå¹¶æä¾›å¯é€‰çš„å¼‚å¸¸å¤„ç†å’Œ fallback é…ç½®é¡¹ã€‚ <code>@SentinelResource</code> æ³¨è§£åŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p>
<ul>
<li><p><code>value</code>ï¼šèµ„æºåç§°ï¼Œå¿…éœ€é¡¹ï¼ˆä¸èƒ½ä¸ºç©ºï¼‰</p>
</li>
<li><p><code>entryType</code>ï¼šentry ç±»å‹ï¼Œå¯é€‰é¡¹ï¼ˆé»˜è®¤ä¸º <code>EntryType.OUT</code>ï¼‰</p>
</li>
<li><p><code>blockHandler</code> &#x2F; <code>blockHandlerClass</code>: <code>blockHandler</code> å¯¹åº”å¤„ç† <code>BlockException</code> çš„å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ã€‚blockHandler å‡½æ•°è®¿é—®èŒƒå›´éœ€è¦æ˜¯ <code>public</code>ï¼Œè¿”å›ç±»å‹éœ€è¦ä¸åŸæ–¹æ³•ç›¸åŒ¹é…ï¼Œå‚æ•°ç±»å‹éœ€è¦å’ŒåŸæ–¹æ³•ç›¸åŒ¹é…å¹¶ä¸”æœ€ååŠ ä¸€ä¸ªé¢å¤–çš„å‚æ•°ï¼Œç±»å‹ä¸º <code>BlockException</code>ã€‚blockHandler å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®š <code>blockHandlerClass</code> ä¸ºå¯¹åº”çš„ç±»çš„ <code>Class</code> å¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æã€‚</p>
</li>
<li><p>fallbackï¼šfallback å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ï¼Œç”¨äºåœ¨æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™æä¾› fallback å¤„ç†é€»è¾‘ã€‚fallback å‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ˆé™¤äº†exceptionsToIgnoreé‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹ï¼‰è¿›è¡Œå¤„ç†ã€‚fallback å‡½æ•°ç­¾åå’Œä½ç½®è¦æ±‚ï¼š</p>
<ul>
<li>è¿”å›å€¼ç±»å‹å¿…é¡»ä¸åŸå‡½æ•°è¿”å›å€¼ç±»å‹ä¸€è‡´ï¼›</li>
<li>æ–¹æ³•å‚æ•°åˆ—è¡¨éœ€è¦å’ŒåŸå‡½æ•°ä¸€è‡´ï¼Œæˆ–è€…å¯ä»¥é¢å¤–å¤šä¸€ä¸ª <code>Throwable</code> ç±»å‹çš„å‚æ•°ç”¨äºæ¥æ”¶å¯¹åº”çš„å¼‚å¸¸ã€‚</li>
<li>fallback å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®š <code>fallbackClass</code> ä¸ºå¯¹åº”çš„ç±»çš„ <code>Class</code> å¯¹è±¡ï¼Œ<strong>æ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°</strong>ï¼Œå¦åˆ™æ— æ³•è§£æã€‚</li>
</ul>
</li>
<li><p>defaultFallback</p>
<p>ï¼ˆsince 1.6.0ï¼‰ï¼šé»˜è®¤çš„ fallback å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ï¼Œé€šå¸¸ç”¨äºé€šç”¨çš„ fallback é€»è¾‘ï¼ˆå³å¯ä»¥ç”¨äºå¾ˆå¤šæœåŠ¡æˆ–æ–¹æ³•ï¼‰ã€‚é»˜è®¤ fallback å‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€ä»¥ç±»å‹çš„å¼‚å¸¸ï¼ˆé™¤äº†exceptionsToIgnoreé‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹ï¼‰è¿›è¡Œå¤„ç†ã€‚è‹¥åŒæ—¶é…ç½®äº† fallbackheå’ŒdefaultFallbackï¼Œåˆ™åªæœ‰ fallback ä¼šç”Ÿæ•ˆã€‚defaultFallback å‡½æ•°ç­¾åè¦æ±‚ï¼š</p>
<ul>
<li>è¿”å›å€¼ç±»å‹å¿…é¡»ä¸åŸå‡½æ•°è¿”å›å€¼ç±»å‹ä¸€è‡´ï¼›</li>
<li>æ–¹æ³•å‚æ•°åˆ—è¡¨éœ€è¦ä¸ºç©ºï¼Œæˆ–è€…å¯ä»¥é¢å¤–å¤šä¸€ä¸ª <code>Throwable</code> ç±»å‹çš„å‚æ•°ç”¨äºæ¥æ”¶å¯¹åº”çš„å¼‚å¸¸ã€‚</li>
<li>defaultFallback å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®š <code>fallbackClass</code> ä¸ºå¯¹åº”çš„ç±»çš„ <code>Class</code> å¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æã€‚</li>
</ul>
</li>
<li><p><code>exceptionsToIgnore</code>ï¼ˆsince 1.6.0ï¼‰ï¼šç”¨äºæŒ‡å®šå“ªäº›å¼‚å¸¸è¢«æ’é™¤æ‰ï¼Œä¸ä¼šè®¡å…¥å¼‚å¸¸ç»Ÿè®¡ä¸­ï¼Œä¹Ÿä¸ä¼šè¿›å…¥ fallback é€»è¾‘ä¸­ï¼Œè€Œæ˜¯ä¼šåŸæ ·æŠ›å‡ºã€‚</p>
</li>
</ul>
<blockquote>
<p>  æ³¨ï¼š1.6.0 ä¹‹å‰çš„ç‰ˆæœ¬ fallback å‡½æ•°åªé’ˆå¯¹é™çº§å¼‚å¸¸ï¼ˆ<code>DegradeException</code>ï¼‰è¿›è¡Œå¤„ç†ï¼Œ<strong>ä¸èƒ½é’ˆå¯¹ä¸šåŠ¡å¼‚å¸¸è¿›è¡Œå¤„ç†</strong>ã€‚</p>
</blockquote>
<p>ç‰¹åˆ«åœ°ï¼Œè‹¥ blockHandler å’Œ fallback éƒ½è¿›è¡Œäº†é…ç½®ï¼Œåˆ™è¢«é™æµé™çº§è€ŒæŠ›å‡º <code>BlockException</code> æ—¶åªä¼šè¿›å…¥ <code>blockHandler</code> å¤„ç†é€»è¾‘ã€‚è‹¥æœªé…ç½® <code>blockHandler</code>ã€<code>fallback</code> å’Œ <code>defaultFallback</code>ï¼Œåˆ™è¢«é™æµé™çº§æ—¶ä¼šå°† <code>BlockException</code> <strong>ç›´æ¥æŠ›å‡º</strong>ã€‚</p>
<blockquote>
<p>  æ³¨æ„ï¼šæ³¨è§£æ–¹å¼åŸ‹ç‚¹ä¸æ”¯æŒ private æ–¹æ³•ã€‚</p>
</blockquote>
<p>&#x3D;&#x3D;ç®€å•ç‚¹æ¥è¯´å°±æ˜¯<code>fallback</code>å¤„ç†javaå¼‚å¸¸ï¼Œ<code>blockHandler</code>å¤„ç†é™æµé™çº§ã€‚ä¸¤ä¸ªä¸€èµ·è®¾ç½®æ—¶å‡ºç°å¼‚å¸¸å°±ä¼šå…ˆ<code>fallback</code>ï¼Œå½“å¼‚å¸¸æ•°æˆ–è€…å¼‚å¸¸æ¯”ä¾‹è¾¾åˆ°è®¾ç½®çš„é˜ˆå€¼æ—¶å°±ä¼šè§¦å‘<code>blockHandler</code>ã€‚&#x3D;&#x3D;</p>
<h3 id="3-8-1-ä½¿ç”¨"><a href="#3-8-1-ä½¿ç”¨" class="headerlink" title="3.8.1 ä½¿ç”¨"></a>3.8.1 ä½¿ç”¨</h3><p>æ–°å¢ä¸€ä¸ªæ¥å£<code>/testD</code>ï¼Œç»™å®ƒå¢åŠ é™æµè§„åˆ™è¿›è¡Œæµ‹è¯•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testD&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;testD&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testD</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;testD--------------&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="blockHandler"><a href="#blockHandler" class="headerlink" title="blockHandler"></a>blockHandler</h4><p>æ·»åŠ å…œåº•æ–¹æ³•ï¼Œæ³¨è§£å±æ€§<code>blockHandler</code>æŒ‡å®š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SentinelResource(value = &quot;testD&quot;, blockHandler = &quot;blockHandlerMethod&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¶…å‡ºé˜ˆå€¼å…œåº•æ–¹æ³•ï¼Œå®ƒä¸èƒ½ä¸ºprivate!!!</span></span><br><span class="line"><span class="comment">// Block å¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œå‚æ•°æœ€åå¤šä¸€ä¸ª BlockExceptionï¼Œå…¶ä½™ä¸åŸå‡½æ•°ä¸€è‡´.</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">blockHandlerMethod</span><span class="params">(BlockException ex)</span> &#123;</span><br><span class="line">    System.out.println(ex.getMessage());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;return blockHandlerMethod&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„å…œåº•æ–¹æ³•å’Œä¸šåŠ¡è€¦åˆåœ¨ä¸€èµ·äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è§£è€¦çš„æ–¹å¼ã€‚ä½¿ç”¨<code>blockHandlerClass</code>å±æ€§æ¥æŒ‡å®šå…œåº•çš„ç±»ï¼Œå†æŒ‡å®šç±»ä¸­å¯¹åº”çš„æ–¹æ³•ä½œä¸ºå…œåº•æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlockHandlerMethod</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">returnMethod01</span><span class="params">(BlockException exception)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;BlockHandlerMethod1 Method&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">returnMethod02</span><span class="params">(BlockException exception)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;BlockHandlerMethod2 Method&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testD&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;testD&quot;,</span></span><br><span class="line"><span class="meta">        // æŒ‡å®šå¤„ç†çš„ç±»</span></span><br><span class="line"><span class="meta">        blockHandlerClass = BlockHandlerMethod.class,</span></span><br><span class="line"><span class="meta">	    // æŒ‡å®šå…œåº•æ–¹æ³•</span></span><br><span class="line"><span class="meta">        blockHandler = &quot;returnMethod01&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testD</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;testD--------------&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼Œè®¾ç½®é™æµè§„åˆ™ï¼Œæ¥ç€ç‹‚ç‚¹å°é¼ </p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322210556648.png" alt="image-20230322210556648"></p>
<h4 id="fallback"><a href="#fallback" class="headerlink" title="fallback"></a>fallback</h4><p>å’Œ<code>blockHandler</code>ä¸åŒçš„æ˜¯<code>fallback</code>å¤„ç†çš„æ˜¯javaå¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ¶é€ å¼‚å¸¸</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span> / <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>å’Œ<code>blockHandler</code>ä¸€æ ·ï¼Œå®ƒä¹Ÿæ˜¯å¯ä»¥æŒ‡å®šå¤„ç†çš„ç±»å’Œå¤„ç†çš„æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FallbackMethod</span> &#123;</span><br><span class="line">	<span class="comment">// Fallback å‡½æ•°ï¼Œå‡½æ•°ç­¾åä¸åŸå‡½æ•°ä¸€è‡´æˆ–åŠ ä¸€ä¸ª Throwable ç±»å‹çš„å‚æ•°.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">fallbackMethod01</span><span class="params">(FlowException exception)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;fallbackMethod01 Method&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">   	<span class="comment">// Fallback å‡½æ•°ï¼Œå‡½æ•°ç­¾åä¸åŸå‡½æ•°ä¸€è‡´æˆ–åŠ ä¸€ä¸ª Throwable ç±»å‹çš„å‚æ•°.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">fallbackMethod02</span><span class="params">(FlowException exception)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;fallbackMethod02 Method&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testD&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;testD&quot;, fallbackClass = FallbackMethod.class, fallback = &quot;fallbackMethod01&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testD</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span> / <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;testD--------------&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼Œç‹‚ç‚¹å°é¼ ~~~</p>
<h4 id="ä¸¤ä¸ªä¸€èµ·ä½¿ç”¨"><a href="#ä¸¤ä¸ªä¸€èµ·ä½¿ç”¨" class="headerlink" title="ä¸¤ä¸ªä¸€èµ·ä½¿ç”¨"></a>ä¸¤ä¸ªä¸€èµ·ä½¿ç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testD&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;testD&quot;,</span></span><br><span class="line"><span class="meta">        blockHandlerClass = BlockHandlerMethod.class, blockHandler = &quot;returnMethod01&quot;,</span></span><br><span class="line"><span class="meta">        fallbackClass = FallbackMethod.class, fallback = &quot;fallbackMethod01&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testD</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span> / <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;testD--------------&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼Œç‹‚ç‚¹é¼ æ ‡~~~</p>
<p>ç»“æœï¼šä¸¤ä¸ªä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå…ˆæ˜¯å‡ºç°å¼‚å¸¸è¢«fallbackäº†ï¼Œæ¥ç€å°±å‡ºç°äº†é™æµçš„å…œåº•æ–¹æ³•è¿”å›ä¿¡æ¯ã€‚</p>
<h4 id="å¿½ç•¥å±æ€§"><a href="#å¿½ç•¥å±æ€§" class="headerlink" title="å¿½ç•¥å±æ€§"></a>å¿½ç•¥å±æ€§</h4><p>è®¾ç½®<code>exceptionsToIgnore</code>å±æ€§ï¼Œå½“å‡ºç°å±æ€§ä¸­æ ‡è®°çš„å¼‚å¸¸æ—¶å°±ä¼šä¸ç®¡ä»–ï¼Œè®©å®ƒé£ï¼Œå®ƒå°±ä¼šç›´æ¥è¢«æŠ›å‡ºå»</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322212842108.png" alt="image-20230322212842108"></p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230322213106605.png" alt="image-20230322213106605"></p>
<p>é£çš„æ›´é«˜~~~ğŸ˜ˆğŸ˜ˆğŸ˜ˆ</p>
<h2 id="3-8-æ•´åˆOpenfeign"><a href="#3-8-æ•´åˆOpenfeign" class="headerlink" title="3.8 æ•´åˆOpenfeign"></a>3.8 æ•´åˆOpenfeign</h2><h3 id="3-8-1-å¦‚ä½•æ•´åˆï¼Ÿ"><a href="#3-8-1-å¦‚ä½•æ•´åˆï¼Ÿ" class="headerlink" title="3.8.1 å¦‚ä½•æ•´åˆï¼Ÿ"></a>3.8.1 å¦‚ä½•æ•´åˆï¼Ÿ</h3><ul>
<li><p>ä¿®æ”¹yamlæ–‡ä»¶</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¿€æ´»Sentinelå¯¹Feignçš„æ”¯æŒ</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸»å¯åŠ¨ç±»æ·»åŠ <code>@EnableFeignClients</code>å¼€å¯</p>
</li>
</ul>
<h3 id="3-8-2-å·¥ç¨‹æ­å»º"><a href="#3-8-2-å·¥ç¨‹æ­å»º" class="headerlink" title="3.8.2 å·¥ç¨‹æ­å»º"></a>3.8.2 å·¥ç¨‹æ­å»º</h3><h4 id="æä¾›è€…"><a href="#æä¾›è€…" class="headerlink" title="æä¾›è€…"></a>æä¾›è€…</h4><ul>
<li><p>æ¨¡å—<code>cloudalibaba-provider-payment9003</code></p>
</li>
<li><p>POM</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>YAML</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9003</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸»å¯åŠ¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain9003</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">            SpringApplication.run(PaymentMain9003.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸šåŠ¡ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;Long, Payment&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        hashMap.put(<span class="number">1L</span>,<span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">1L</span>,<span class="string">&quot;28a8c1e3bc2742d8848569891fb42181&quot;</span>));</span><br><span class="line">        hashMap.put(<span class="number">2L</span>,<span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">2L</span>,<span class="string">&quot;bba8c1e3bc2742d8848569891ac32182&quot;</span>));</span><br><span class="line">        hashMap.put(<span class="number">3L</span>,<span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">3L</span>,<span class="string">&quot;6ua8c1e3bc2742d8848569891xt92183&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/paymentSql/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">paymentSql</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> hashMap.get(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;from mysql serverPortï¼š&quot;</span> + serverPort, payment);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>æµ‹è¯•è®¿é—®æ²¡é—®é¢˜è¡¨ç¤ºæˆåŠŸ~~~</p>
<h4 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h4><ul>
<li><p>æ¨¡å—<code>cloudalibaba-consumer-nacos-order84</code></p>
</li>
<li><p>POM</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud openfeign --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba sentinel --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>YAML</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">84</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-order-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="comment">#é…ç½®Sentinel dashboardåœ°å€</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span></span><br><span class="line">        <span class="comment">#é»˜è®¤8719ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ,ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¿€æ´»Sentinelå¯¹Feignçš„æ”¯æŒ</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸»å¯åŠ¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span>     <span class="comment">// å¼€å¯Feignæ”¯æŒ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderNacosMain84</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">            SpringApplication.run(OrderNacosMain84.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸šåŠ¡ç±»</p>
<ul>
<li><p>PaymentController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/paymentSql/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">paymentSql</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (id.equals(<span class="number">4L</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;æ²¡æœ‰è¯¥id&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> paymentService.paymentSql(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>PaymentService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;nacos-payment-provider&quot;, fallback = PaymentFallbackService.class)</span><span class="comment">// è°ƒç”¨ä¸­å…³é—­9003æœåŠ¡æä¾›è€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/paymentSql/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">paymentSql</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>PaymentFallbackService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentFallbackService</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">paymentSql</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>&lt;&gt;(<span class="number">444</span>, <span class="string">&quot;è¯·æ±‚äººæ•°è¿‡å¤šï¼Œè¯·é”€åé‡è¯•~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>è®¿é—®<code>http://localhost:84/paymentSql/1</code>ï¼Œå‡ºç°æ•°æ®è¡¨ç¤ºæˆåŠŸ</p>
<p>è®¿é—®<code>http://localhost:84/paymentSql/4</code>ï¼Œå®ƒä¼šç›´æ¥æŠ¥é”™ï¼Œ<code>OpenFeign</code>å¯¹ä¸æ˜¯å®ƒèƒ½å¤„ç†çš„å¼‚å¸¸ä¼šç›´æ¥æŠ›å‡ºå»ï¼Œä¸ä¼šå¯¹å®ƒfallback</p>
<p>åœæ­¢æä¾›è€…å·¥ç¨‹ï¼Œå†æ¬¡è®¿é—®ï¼Œå®ƒå°±ä¼šç›´æ¥è¿”å›fallbackæ–¹æ³•ã€‚</p>
<h2 id="3-9-è§„åˆ™æŒä¹…åŒ–"><a href="#3-9-è§„åˆ™æŒä¹…åŒ–" class="headerlink" title="3.9 è§„åˆ™æŒä¹…åŒ–"></a>3.9 è§„åˆ™æŒä¹…åŒ–</h2><h3 id="3-9-1-è§„åˆ™æŒä¹…åŒ–ï¼Ÿ"><a href="#3-9-1-è§„åˆ™æŒä¹…åŒ–ï¼Ÿ" class="headerlink" title="3.9.1 è§„åˆ™æŒä¹…åŒ–ï¼Ÿ"></a>3.9.1 è§„åˆ™æŒä¹…åŒ–ï¼Ÿ</h3><p>å½“æˆ‘ä»¬çš„æœåŠ¡é‡æ–°å¯åŠ¨ï¼Œæˆ‘ä»¬è®¾ç½®çš„è§„åˆ™å°±æˆ·å…¨éƒ¨æ²¡æœ‰äº†ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬æ¯æ¬¡é‡å¯æœåŠ¡éƒ½è¦é‡å†™è®¾ç½®ä¸€éï¼Œè¿™æ˜¯ä¸ªè´¹åŠ²çš„äº‹æƒ…ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥å°±è§„åˆ™æŒä¹…åŒ–ï¼Œé‚£åº”è¯¥æŒä¹…åŒ–åˆ°å“ªå‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯æŒä¹…åŒ–åˆ°nacosä¸­ï¼Œnaocså®ƒå¯ä»¥æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬æ¯æ¬¡å¯åŠ¨æœåŠ¡å¹¶è®¿é—®èµ„æºçš„æ—¶å€™å°±å°†æˆ‘ä»¬çš„è§„åˆ™é‡æ–°å†™å…¥åˆ°sentinelä¸­ã€‚</p>
<h3 id="3-9-2-æ€ä¹ˆåš"><a href="#3-9-2-æ€ä¹ˆåš" class="headerlink" title="3.9.2 æ€ä¹ˆåš"></a>3.9.2 æ€ä¹ˆåš</h3><ol>
<li><p>é¡¹ç›®ä¸­æ·»åŠ ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å†™å…¥è§„åˆ™åˆ°nacos</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230323142030712.png" alt="image-20230323142030712"></p>
<p>æ³¨æ„ï¼šè§„åˆ™æŒä¹…åŒ–æ˜¯æ²¡æœ‰<code>.yaml</code>åç¼€çš„</p>
<p>é…ç½®å†…å®¹è§£æï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;resource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/testA&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;limitApp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;grade&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;strategy&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;controlBehavior&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;clusterMode&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>key</th>
<th>value</th>
</tr>
</thead>
<tbody><tr>
<td>resource</td>
<td>èµ„æºåç§°</td>
</tr>
<tr>
<td>limitApp</td>
<td>æ¥æºåº”ç”¨</td>
</tr>
<tr>
<td>grade</td>
<td>é˜ˆå€¼ç±»å‹ï¼Œ0è¡¨ç¤ºçº¿ç¨‹æ•°ï¼Œ1è¡¨ç¤ºQPS</td>
</tr>
<tr>
<td>count</td>
<td>å•æœºé˜ˆå€¼</td>
</tr>
<tr>
<td>strategy</td>
<td>æµæ§æ¨¡å¼ï¼Œ0è¡¨ç¤ºç›´æ¥ï¼Œ1è¡¨ç¤ºå…³è”ï¼Œ2è¡¨ç¤ºé“¾è·¯</td>
</tr>
<tr>
<td>controlBehavior</td>
<td>æµæ§æ•ˆæœï¼Œ0è¡¨ç¤ºå¿«é€Ÿå¤±è´¥ï¼Œ1è¡¨ç¤ºWarm Upï¼Œ2è¡¨ç¤ºæ’é˜Ÿç­‰å¾…</td>
</tr>
<tr>
<td>clusterMode</td>
<td>æ˜¯å¦é›†ç¾¤</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
<li><p>æŒ‡å®šè§„åˆ™</p>
<p>åœ¨é¡¹ç›®çš„yamlæ–‡ä»¶ä¸­æŒ‡å®šè¦ä½¿ç”¨çš„è§„åˆ™</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">ds1:</span></span><br><span class="line">          <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">            <span class="attr">dataId:</span> <span class="string">cloudalibaba-sentinel-service</span></span><br><span class="line">            <span class="attr">groupId:</span> <span class="string">DEFAULT_GROUP</span></span><br><span class="line">            <span class="attr">data-type:</span> <span class="string">json</span></span><br><span class="line">            <span class="attr">rule-type:</span> <span class="string">flow</span>		<span class="comment"># è§„åˆ™ç±»å‹ flowè¡¨ç¤ºæ˜¯æµæ§è§„åˆ™</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="3-9-3-æµ‹è¯•"><a href="#3-9-3-æµ‹è¯•" class="headerlink" title="3.9.3 æµ‹è¯•"></a>3.9.3 æµ‹è¯•</h3><p>é…ç½®å®Œæˆä¹‹åæˆ‘ä»¬è¦å¯åŠ¨æœåŠ¡ï¼Œå½“å‰æµ‹è¯•ä½¿ç”¨çš„æ˜¯8401æœåŠ¡ã€‚</p>
<p>é‡å¯æœåŠ¡åæŸ¥çœ‹sentinelæ§åˆ¶å°ï¼Œæ­¤æ—¶è¿˜æ˜¯ç©ºçš„ï¼Œéœ€è¦æˆ‘ä»¬å…ˆè®¿é—®ä¸€ä¸‹æœåŠ¡æ¥å£å®ƒæ‰ä¼šæœ‰æ˜¾ç¤ºã€‚</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230323143057398.png" alt="image-20230323143057398"></p>
<p>å¯ä»¥çœ‹åˆ°æŒä¹…åŒ–æˆåŠŸäº†ã€‚æ¥ä¸‹æ¥ç‹‚ç‚¹å°é¼ ï¼Œçœ‹ä¸€ä¸‹è®¾ç½®çš„è§„åˆ™æ˜¯å¦èµ·æ•ˆ</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230323143130708.png" alt="image-20230323143130708"></p>
<p>æ²¡æœ‰é—®é¢˜ã€‚nice~~~ğŸ˜ğŸ˜ğŸ˜</p>
<h1 id="å››ã€Seata"><a href="#å››ã€Seata" class="headerlink" title="å››ã€Seata"></a>å››ã€Seata</h1><p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\TB1qTjWw.T1gK0jSZFhXXaAtVXa-4802-1285.png" alt="img"></p>
<h2 id="4-1-æ¦‚è¿°"><a href="#4-1-æ¦‚è¿°" class="headerlink" title="4.1 æ¦‚è¿°"></a>4.1 æ¦‚è¿°</h2><h3 id="4-1-1-æ˜¯ä»€ä¹ˆ"><a href="#4-1-1-æ˜¯ä»€ä¹ˆ" class="headerlink" title="4.1.1 æ˜¯ä»€ä¹ˆ"></a>4.1.1 æ˜¯ä»€ä¹ˆ</h3><p>Seata æ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚Seata å°†ä¸ºç”¨æˆ·æä¾›äº† ATã€TCCã€SAGA å’Œ XA äº‹åŠ¡æ¨¡å¼ï¼Œä¸ºç”¨æˆ·æ‰“é€ ä¸€ç«™å¼çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚</p>
<p><strong>å®˜ç½‘</strong>ï¼š<code>https://seata.io/zh-cn/index.html</code></p>
<p><strong>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹ç‰©å‘¢ï¼Ÿ</strong></p>
<p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå¾€å¾€ä¸€ä¸ªæœåŠ¡ä¸­å¯èƒ½è°ƒç”¨å¤šä¸ªæœåŠ¡ï¼Œè€Œå•ä¸ªæœåŠ¡ä¸­å¯ä»¥ä½¿ç”¨<code>@Transactiona</code>æ¥å¤„ç†äº‹ç‰©ï¼Œä½†æ˜¯å®ƒä¸èƒ½æ§åˆ¶è°ƒç”¨çš„äº‹ç‰©ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ•´ä¸ªè°ƒç”¨ä¸­æœ‰ä¸€ä¸ªè°ƒç”¨å‡ºç°äº†é”™è¯¯ï¼Œå®ƒåªä¼šå›æ»šå½“å‰è°ƒç”¨æ–¹ï¼Œè€Œè°ƒç”¨çš„æœåŠ¡æ˜¯æ²¡æœ‰å›æ»šçš„ï¼Œè¿™å°±ä¼šå¯¼è‡´äº‹ç‰©ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</p>
<p>æ¯”å¦‚ï¼šåœ¨AæœåŠ¡ä¸­å…ˆæ˜¯è°ƒç”¨BæœåŠ¡ï¼Œç„¶åå†è°ƒç”¨CæœåŠ¡ï¼Œåœ¨è°ƒç”¨CæœåŠ¡çš„è¿‡ç¨‹ä¸­CæœåŠ¡å‘ç”Ÿäº†å¼‚å¸¸ï¼Œå¹¶å°†ä¿¡æ¯è¿”å›ç»™äº†AæœåŠ¡ï¼ŒAæœåŠ¡å‘ç°åè¿›è¡Œäº†å›æ»šï¼Œä½†æ˜¯BæœåŠ¡æ˜¯æ²¡æœ‰è¿›è¡Œå›æ»šçš„ï¼Œå› ä¸ºå®ƒæ˜¯æ‰§è¡ŒæˆåŠŸçš„ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¯¹äºä»¥ä¸Šçš„é—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦æœ‰ä¸€ä¸ªä¸œè¥¿æ¥ä¿è¯æ€»çš„äº‹ç‰©ï¼Œè¦ä¹ˆåŒæ—¶éƒ½æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶éƒ½å¤±è´¥ã€‚è€Œseataå°±æ˜¯ç”¨æ¥è§£å†³åˆ†å¸ƒå¼äº‹ç‰©çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚</p>
<h3 id="4-1-2-æœ¯è¯­"><a href="#4-1-2-æœ¯è¯­" class="headerlink" title="4.1.2 æœ¯è¯­"></a>4.1.2 æœ¯è¯­</h3><p>ä¸‹é¢æ˜¯ä¸€æ¬¡äº‹ç‰©çš„è°ƒåº¦å›¾</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\145942191-7a2d469f-94c8-4cd2-8c7e-46ad75683636.png" alt="image"></p>
<p><strong>å®˜æ–¹æœ¯è¯­</strong>ï¼š</p>
<ul>
<li><p>TC (Transaction Coordinator) - äº‹åŠ¡åè°ƒè€…</p>
<p>ç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p>
</li>
<li><p>TM (Transaction Manager) - äº‹åŠ¡ç®¡ç†å™¨&#96;</p>
<p>å®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼šå¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</p>
</li>
<li><p>RM (Resource Manager) - èµ„æºç®¡ç†å™¨</p>
<p>ç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p>
</li>
</ul>
<p><strong>è‡ªæˆ‘ç†è§£</strong>ï¼š</p>
<ul>
<li>TCå¯ä»¥ç†è§£ä¸ºæ˜¯æ•´ä¸ªäº‹ç‰©çš„æ€»æ§åˆ¶ï¼Œæ§åˆ¶å…¨å±€çš„äº‹ç‰©å›æ»šå’Œæäº¤ï¼Œä¹Ÿå°±æ˜¯<code>seata server</code></li>
<li>TMå¯ä»¥ç†è§£ä¸ºäº‹ç‰©å¼€å¯æ”¾ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªäº‹ç‰©çš„å…¥å£ï¼Œæ¯”å¦‚AæœåŠ¡è°ƒç”¨Bã€CæœåŠ¡ï¼Œé‚£ä¹ˆAå°±æ˜¯<code>TM</code>ï¼Œä¹Ÿå°±æ˜¯æ ‡æ³¨<code>@GlobalTansactional</code>æ³¨è§£çš„æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ç§°å®ƒä¸ºäº‹ç‰©çš„å‘èµ·è€…</li>
<li>RMå¯ä»¥ç†è§£ä¸ºæ¯ä¸ªæœåŠ¡ä¸Šå’ŒTCæ‰“äº¤é“çš„èµ„æºç®¡ç†å™¨ï¼ŒTCå‘Šè¯‰ä»–ä»¬å›æ»šæˆ–è€…æäº¤ï¼Œæ‰€ä»¥ä»–ä»¬æ˜¯æ‰§è¡Œè€…ï¼ŒTCæ˜¯ç®¡ç†è€…ï¼ŒTCä¹Ÿå¯ä»¥å«åšäº‹ç‰©çš„å‚ä¸è€…</li>
</ul>
<h2 id="4-2-æ­å»ºseata-server"><a href="#4-2-æ­å»ºseata-server" class="headerlink" title="4.2 æ­å»ºseata server"></a>4.2 æ­å»ºseata server</h2><p><strong>ä¸‹è½½åœ°å€</strong>ï¼š<code>https://seata.io/zh-cn/blog/download.html</code></p>
<p><strong>æ•°æ®åº“</strong></p>
<ul>
<li><p>åˆ›å»ºseataæ•°æ®åº“</p>
</li>
<li><p>å¯¼å…¥sqlè„šæœ¬åˆ›å»ºè¡¨ï¼Œsqlè¡¨çš„ä½ç½®åœ¨å®‰è£…åŒ…çš„<code>script\server\db</code>ç›®å½•ä¸‹</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230327103900744.png" alt="image-20230327103900744"></p>
</li>
</ul>
<p><strong>é…ç½®server</strong></p>
<p>é…ç½®æ–‡ä»¶åœ¨å®‰è£…åŒ…çš„<code>conf</code>ç›®å½•ä¸‹ï¼Œä½ç‰ˆæœ¬çš„<code>conf</code>ç›®å½•ä¸‹æ˜¯<code>.conf</code>æ–‡ä»¶ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯<code>1.6.1</code>ç‰ˆæœ¬ï¼Œé…ç½®æ–‡ä»¶ä½¿ç”¨çš„<code>.yml</code>æ–‡ä»¶æ›¿æ¢äº†<code>.conf</code>æ–‡ä»¶</p>
<p>ä¿®æ”¹seataæ¨¡å—ä¸­çš„<code>registry</code>ã€<code>conf</code>ã€<code>store</code>æ¨¡å—ï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºæ³¨å†Œã€é…ç½®ä¸­å¿ƒçš„é…ç½®å’Œæ•°æ®æºçš„é…ç½®ã€‚</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">seata:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="comment"># support: nacos, consul, apollo, zk, etcd3</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="attr">group:</span> <span class="string">SEATA_GROUP</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">context-path:</span></span><br><span class="line">      <span class="comment">##if use MSE Nacos with auth, mutex with username/password attribute</span></span><br><span class="line">      <span class="comment">#access-key:</span></span><br><span class="line">      <span class="comment">#secret-key:</span></span><br><span class="line">      <span class="attr">data-id:</span> <span class="string">seataServer.yml</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="comment"># support: nacos, eureka, redis, zk, consul, etcd3, sofa</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">nacos</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">application:</span> <span class="string">seata-server</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">group:</span> <span class="string">SEATA_GROUP</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="attr">cluster:</span> <span class="string">&quot;default&quot;</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="attr">store:</span></span><br><span class="line">    <span class="comment"># support: file ã€ db ã€ redis</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">db</span></span><br><span class="line">    <span class="attr">db:</span></span><br><span class="line">      <span class="attr">datasource:</span> <span class="string">druid</span></span><br><span class="line">      <span class="attr">db-type:</span> <span class="string">mysql</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.10.10:3306/seata?rewriteBatchedStatements=true</span></span><br><span class="line">      <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">abc123</span></span><br><span class="line">      <span class="attr">min-conn:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">max-conn:</span> <span class="number">100</span></span><br><span class="line">      <span class="comment"># å¯¹åº”çš„å››ä¸ªè¡¨åå­—</span></span><br><span class="line">      <span class="attr">global-table:</span> <span class="string">global_table</span></span><br><span class="line">      <span class="attr">branch-table:</span> <span class="string">branch_table</span></span><br><span class="line">      <span class="attr">lock-table:</span> <span class="string">lock_table</span></span><br><span class="line">      <span class="attr">distributed-lock-table:</span> <span class="string">distributed_lock</span></span><br><span class="line">      <span class="attr">query-limit:</span> <span class="number">1000</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®å®Œæˆåå¯åŠ¨æœåŠ¡å³å¯</p>
<p>&#x3D;&#x3D;æ³¨æ„ï¼šå¦‚æœæ˜¯è¦æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼Œéœ€è¦å…ˆå¯åŠ¨æ³¨å†Œä¸­å¿ƒï¼Œåœ¨æœ¬ç¤ºä¾‹ä¸­ä½¿ç”¨çš„æ˜¯nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œæ‰€ä»¥è¦å…ˆå¯åŠ¨nacosï¼Œå†å¯åŠ¨seata server&#x3D;&#x3D;</p>
<h2 id="4-3-å…¥é—¨æ¡ˆä¾‹"><a href="#4-3-å…¥é—¨æ¡ˆä¾‹" class="headerlink" title="4.3 å…¥é—¨æ¡ˆä¾‹"></a>4.3 å…¥é—¨æ¡ˆä¾‹</h2><h3 id="4-3-1-ç”¨ä¾‹æ¦‚è¿°"><a href="#4-3-1-ç”¨ä¾‹æ¦‚è¿°" class="headerlink" title="4.3.1 ç”¨ä¾‹æ¦‚è¿°"></a>4.3.1 ç”¨ä¾‹æ¦‚è¿°</h3><p>ç”¨æˆ·è´­ä¹°å•†å“çš„ä¸šåŠ¡é€»è¾‘ã€‚æ•´ä¸ªä¸šåŠ¡é€»è¾‘ç”±3ä¸ªå¾®æœåŠ¡æä¾›æ”¯æŒï¼š</p>
<ul>
<li>ä»“å‚¨æœåŠ¡ï¼šå¯¹ç»™å®šçš„å•†å“æ‰£é™¤ä»“å‚¨æ•°é‡ã€‚</li>
<li>è®¢å•æœåŠ¡ï¼šæ ¹æ®é‡‡è´­éœ€æ±‚åˆ›å»ºè®¢å•ã€‚</li>
<li>å¸æˆ·æœåŠ¡ï¼šä»ç”¨æˆ·å¸æˆ·ä¸­æ‰£é™¤ä½™é¢ã€‚</li>
</ul>
<p><strong>è°ƒç”¨è§„åˆ™</strong>ï¼šè®¢å•æœåŠ¡ -&gt; ä»“å‚¨æœåŠ¡ -&gt; è´¦æˆ·æœåŠ¡</p>
<p><strong>ä¸šåŠ¡æµç¨‹</strong>ï¼šåˆ›å»ºè®¢å•-&gt;ä¿®æ”¹ä»“åº“æ•°é‡-&gt;ä¿®æ”¹è´¦æˆ·é‡‘é¢-&gt;ä¿®æ”¹è®¢å•çŠ¶æ€</p>
<h3 id="4-3-2-æœåŠ¡æ­å»º"><a href="#4-3-2-æœåŠ¡æ­å»º" class="headerlink" title="4.3.2 æœåŠ¡æ­å»º"></a>4.3.2 æœåŠ¡æ­å»º</h3><h4 id="â‘ åˆ›åº“å’Œåˆ›è¡¨"><a href="#â‘ åˆ›åº“å’Œåˆ›è¡¨" class="headerlink" title="â‘ åˆ›åº“å’Œåˆ›è¡¨"></a>â‘ åˆ›åº“å’Œåˆ›è¡¨</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE seata_order;</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE seata_storage;</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE seata_account;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºè¡¨ï¼Œå¯¹åº”è¡¨åˆ›å»ºåœ¨å¯¹åº”åº“ä¸‹</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_order (</span><br><span class="line">  `id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  `user_id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·id&#x27;</span>,</span><br><span class="line">  `product_id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;äº§å“id&#x27;</span>,</span><br><span class="line">  `count` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ•°é‡&#x27;</span>,</span><br><span class="line">  `money` <span class="type">DECIMAL</span>(<span class="number">11</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é‡‘é¢&#x27;</span>,</span><br><span class="line">  `status` <span class="type">INT</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è®¢å•çŠ¶æ€ï¼š0ï¼šåˆ›å»ºä¸­ï¼›1ï¼šå·²å®Œç»“&#x27;</span> </span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">7</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_order;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_storage (</span><br><span class="line"> `id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line"> `product_id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;äº§å“id&#x27;</span>,</span><br><span class="line"> `total` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ€»åº“å­˜&#x27;</span>,</span><br><span class="line"> `used` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å·²ç”¨åº“å­˜&#x27;</span>,</span><br><span class="line"> `residue` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å‰©ä½™åº“å­˜&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">2</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> seata_storage.t_storage(`id`, `product_id`, `total`, `used`, `residue`)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;100&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;100&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_storage;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_account (</span><br><span class="line">  `id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `user_id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·id&#x27;</span>,</span><br><span class="line">  `total` <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ€»é¢åº¦&#x27;</span>,</span><br><span class="line">  `used` <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å·²ç”¨ä½™é¢&#x27;</span>,</span><br><span class="line">  `residue` <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;å‰©ä½™å¯ç”¨é¢åº¦&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">2</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> seata_account.t_account(`id`, `user_id`, `total`, `used`, `residue`)  <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1000&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1000&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t_account;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;ä¸‹é¢è¿™å¼ è¡¨æ˜¯æ¯ä¸ªè¡¨éƒ½è¦åˆ›å»ºçš„è¡¨&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- the table to store seata xid data</span></span><br><span class="line"><span class="comment">-- 0.7.0+ add context</span></span><br><span class="line"><span class="comment">-- you must to init this sql for you business databese. the seata server not need it.</span></span><br><span class="line"><span class="comment">-- æ­¤è„šæœ¬å¿…é¡»åˆå§‹åŒ–åœ¨ä½ å½“å‰çš„ä¸šåŠ¡æ•°æ®åº“ä¸­ï¼Œç”¨äºAT æ¨¡å¼XIDè®°å½•ã€‚ä¸serverç«¯æ— å…³ï¼ˆæ³¨ï¼šä¸šåŠ¡æ•°æ®åº“ï¼‰</span></span><br><span class="line"><span class="comment">-- æ³¨æ„æ­¤å¤„0.3.0+ å¢åŠ å”¯ä¸€ç´¢å¼• ux_undo_log</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> `undo_log`;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `undo_log` (</span><br><span class="line">  `id` <span class="type">BIGINT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `branch_id` <span class="type">BIGINT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `xid` <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `context` <span class="type">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `rollback_info` LONGBLOB <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_status` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_created` DATETIME <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_modified` DATETIME <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `ext` <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>

<p>ç»“æœå¦‚å›¾</p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230327105252938.png" alt="image-20230327105252938"></p>
<h4 id="â‘¡orderæœåŠ¡"><a href="#â‘¡orderæœåŠ¡" class="headerlink" title="â‘¡orderæœåŠ¡"></a>â‘¡orderæœåŠ¡</h4><p><strong>ä¸šåŠ¡</strong>ï¼šåˆ›å»ºè®¢å•è¡¨å’Œä¿®æ”¹è®¢å•çŠ¶æ€</p>
<p>1.<code>seata-order-service2001</code>æ¨¡å—</p>
<p>2.POM</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--nacos--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--seata--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--feign--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web-actuator--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mysql-druid--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.37<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.YAML</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">2001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">seata-order-service</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">alibaba:</span></span><br><span class="line">      <span class="attr">seata:</span></span><br><span class="line">        <span class="comment"># æŒ‡å®šäº‹ç‰©åˆ†ç»„ - è¿™ä¸ªè¦å’Œnaocså¯¹åº”çš„åˆ†ç»„ç›¸åŒ</span></span><br><span class="line">        <span class="attr">tx-service-group:</span> <span class="string">fsp-tx-group</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.10.10:3306/seata_order</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">abc123</span></span><br><span class="line"></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">io:</span></span><br><span class="line">      <span class="attr">seata:</span> <span class="string">info</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapperLocations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.xiaozhi.springcloud.domain</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>4.é…ç½®æ–‡ä»¶</p>
<p>è¯´æ˜ï¼šspring-cloud-alibaba-seata åœ¨ 2.2.0.RELEASE ç‰ˆæœ¬å‰ ä¾èµ–çš„æ˜¯seata-all è‹¥ç»§ç»­ä½¿ç”¨ä½ç‰ˆæœ¬çš„ spring-cloud-alibaba-seata å¯ä»¥ä½¿ç”¨é«˜ç‰ˆæœ¬çš„ seata-all å–ä»£å†…ç½®çš„ seata-all ç‰ˆæœ¬ï¼›</p>
<p>ä½¿ç”¨ä½ç‰ˆæœ¬çš„ spring-cloud-alibaba-seata éœ€è¦åœ¨ resource ç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶<code>registry.conf</code></p>
<p>ä¸‹è½½åœ°å€ï¼š<code>https://github.com/seata/seata/blob/develop/script/client/conf/registry.conf</code></p>
<p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230327112755346.png" alt="image-20230327112755346"></p>
<p>5.å®ä½“ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonResult</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String  message;</span><br><span class="line">    <span class="keyword">private</span> T       data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CommonResult</span><span class="params">(Integer code, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(code,message,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long productId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BigDecimal money;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¢å•çŠ¶æ€ï¼š0ï¼šåˆ›å»ºä¸­ï¼›1ï¼šå·²å®Œç»“</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6.Mapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºè®¢å•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">create</span><span class="params">(Order order)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹è®¢å•é‡‘é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> Long userId, <span class="meta">@Param(&quot;status&quot;)</span> Integer status)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>xmlç•¥</p>
<p>7.service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StorageService storageService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AccountService accountService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;======= åˆ›å»ºè®¢å•å¼€å§‹ ======&quot;</span>);</span><br><span class="line">        orderMapper.create(order);</span><br><span class="line">        log.info(<span class="string">&quot;======= è¿œç¨‹è°ƒç”¨æ‰£å‡åº“å­˜å¼€å§‹ ======&quot;</span>);</span><br><span class="line">        storageService.decrease(order.getProductId(), order.getCount());</span><br><span class="line">        log.info(<span class="string">&quot;======= è¿œç¨‹è°ƒç”¨æ‰£å‡åº“å­˜ç»“æŸ ======&quot;</span>);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;======= è¿œç¨‹è°ƒç”¨æ‰£å‡é‡‘é¢å¼€å§‹ ======&quot;</span>);</span><br><span class="line">        accountService.decrease(order.getUserId(), order.getMoney());</span><br><span class="line">        log.info(<span class="string">&quot;======= è¿œç¨‹è°ƒç”¨æ‰£å‡é‡‘é¢ç»“æŸ ======&quot;</span>);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;======= ä¿®æ”¹è®¢å•çŠ¶æ€å¼€å§‹ ======&quot;</span>);</span><br><span class="line">        orderMapper.update(order.getUserId(), <span class="number">1</span>);</span><br><span class="line">        log.info(<span class="string">&quot;======= ä¿®æ”¹è®¢å•çŠ¶æ€ç»“æŸ ======&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;======= ä¸‹å•ç»“æŸ ======&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>8.controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºè®¢å•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/order/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">( Order order)</span> &#123;</span><br><span class="line">        orderService.create(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;è®¢å•åˆ›å»ºæˆåŠŸ!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>9.config</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&#123;&quot;com.atguigu.springcloud.alibaba.dao&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> XIAOZHI</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨Seataå¯¹æ•°æ®æºè¿›è¡Œä»£ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProxyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;mybatis.mapperLocations&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mapperLocations;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">druidDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProxy <span class="title function_">dataSourceProxy</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProxy</span>(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactoryBean</span><span class="params">(DataSourceProxy dataSourceProxy)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">sqlSessionFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        sqlSessionFactoryBean.setDataSource(dataSourceProxy);</span><br><span class="line">        sqlSessionFactoryBean.setMapperLocations(<span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>().getResources(mapperLocations));</span><br><span class="line">        sqlSessionFactoryBean.setTransactionFactory(<span class="keyword">new</span> <span class="title class_">SpringManagedTransactionFactory</span>());</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>10.å¯åŠ¨ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span><span class="comment">// å–æ¶ˆæ•°æ®æºçš„è‡ªåŠ¨åˆ›å»º</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeataOrderMainApp2001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SeataOrderMainApp2001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="â‘¢storageå’ŒaccountæœåŠ¡"><a href="#â‘¢storageå’ŒaccountæœåŠ¡" class="headerlink" title="â‘¢storageå’ŒaccountæœåŠ¡"></a>â‘¢storageå’ŒaccountæœåŠ¡</h4><p>è¿™ä¸¤ä¸ªæœåŠ¡æ­å»ºçœç•¥ï¼Œéƒ½æ˜¯å°†å­—æ®µçš„å€¼è¿›è¡Œæ‰£å‡ï¼Œé…ç½®å’ŒOrderæœåŠ¡ä¸€æ ·</p>
<ul>
<li><p>StorageMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;decrease&quot;</span>&gt;</span></span><br><span class="line">    update `t_storage`</span><br><span class="line">    set `used` = `used` + #&#123;count&#125;,</span><br><span class="line">    `residue` = `residue` - #&#123;count&#125;</span><br><span class="line">    where `product_id` = #&#123;productId&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>AccountMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;decrease&quot;</span>&gt;</span></span><br><span class="line">    update `t_account`</span><br><span class="line">    set residue = residue - #&#123;money&#125;,</span><br><span class="line">    used = used + #&#123;money&#125;</span><br><span class="line">    where `user_id` = #&#123;userId&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>è¯¦ç»†è¯·è§ï¼š&#96;&#96;</p>
<h3 id="4-3-3-æµ‹è¯•"><a href="#4-3-3-æµ‹è¯•" class="headerlink" title="4.3.3 æµ‹è¯•"></a>4.3.3 æµ‹è¯•</h3><p>æ­¤æ—¶æˆ‘ä»¬è¿˜æ²¡æœ‰å¯¹ OrderService åšåˆ†å¸ƒå¼äº‹ç‰©ç®¡ç†ï¼Œæˆ‘ä»¬è®© AccountService å»¶æ—¶5ç§’ï¼ŒOpenFeignè°ƒç”¨é»˜è®¤è¶…æ—¶æ—¶é—´æ˜¯1ç§’ï¼Œæ‰€ä»¥åˆ›å»ºè®¢å•è‚¯å®šæ˜¯å¤±è´¥çš„ã€‚æŸ¥çœ‹æ•°æ®åº“å‘ç°è®¢å•æˆåŠŸåˆ›å»ºäº†ï¼Œè¯æ˜äº†æœ¬æ¬¡è°ƒç”¨æ²¡æœ‰åšåˆ†å¸ƒå¼äº‹ç‰©ç®¡ç†ï¼Œæ²¡æœ‰ä¿è¯ä¸€è‡´æ€§ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»™ OrderService åŠ ä¸Šåˆ†å¸ƒå¼äº‹ç‰©æ³¨è§£<code>@GlobalTransactional</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GlobalTransactional(name = &quot;fsp-create-orde&quot;, rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createOrder</span><span class="params">(Order order)</span> &#123;</span><br></pre></td></tr></table></figure>

<p>é‡æ–°å¯åŠ¨å†æ¬¡æµ‹è¯•ï¼ŒOpenFeign è°ƒç”¨æŠ¥é”™ï¼ŒæŸ¥çœ‹æ•°æ®åº“çœ‹æ˜¯å¦åˆ›å»ºè®¢å•å’Œä¿®æ”¹é‡‘é¢å’Œåº“å­˜ï¼Œå‘ç°å¹¶æ²¡æœ‰ä¿®æ”¹ï¼Œåˆ†å¸ƒå¼äº‹ç‰©ç®¡ç†æˆåŠŸ~~~ã€‚</p>
<h2 id="4-4-åŸç†"><a href="#4-4-åŸç†" class="headerlink" title="4.4 åŸç†"></a>4.4 åŸç†</h2><h3 id="4-4-1-ATæ¨¡å¼"><a href="#4-4-1-ATæ¨¡å¼" class="headerlink" title="4.4.1 ATæ¨¡å¼"></a>4.4.1 ATæ¨¡å¼</h3><h4 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h4><ul>
<li>åŸºäºæ”¯æŒæœ¬åœ° ACID äº‹åŠ¡çš„å…³ç³»å‹æ•°æ®åº“ã€‚</li>
<li>Java åº”ç”¨ï¼Œé€šè¿‡ JDBC è®¿é—®æ•°æ®åº“ã€‚</li>
</ul>
<h4 id="æ•´ä½“æœºåˆ¶"><a href="#æ•´ä½“æœºåˆ¶" class="headerlink" title="æ•´ä½“æœºåˆ¶"></a>æ•´ä½“æœºåˆ¶</h4><p>ä¸¤é˜¶æ®µæäº¤åè®®çš„æ¼”å˜ï¼š</p>
<ul>
<li>ä¸€é˜¶æ®µï¼šä¸šåŠ¡æ•°æ®å’Œå›æ»šæ—¥å¿—è®°å½•åœ¨åŒä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­æäº¤ï¼Œé‡Šæ”¾æœ¬åœ°é”å’Œè¿æ¥èµ„æºã€‚</li>
<li>äºŒé˜¶æ®µï¼š<ul>
<li>æäº¤å¼‚æ­¥åŒ–ï¼Œéå¸¸å¿«é€Ÿåœ°å®Œæˆã€‚</li>
<li>å›æ»šé€šè¿‡ä¸€é˜¶æ®µçš„å›æ»šæ—¥å¿—è¿›è¡Œåå‘è¡¥å¿ã€‚</li>
</ul>
</li>
</ul>
<h4 id="å·¥ä½œæœºåˆ¶"><a href="#å·¥ä½œæœºåˆ¶" class="headerlink" title="å·¥ä½œæœºåˆ¶"></a>å·¥ä½œæœºåˆ¶</h4><p><img src="D:\å­¦ä¹ ç¬”è®°\img\img01\image-20230327184724199.png" alt="image-20230327184724199"></p>
<p>ä»¥ä¸€ä¸ªç¤ºä¾‹æ¥è¯´æ˜æ•´ä¸ª AT åˆ†æ”¯çš„å·¥ä½œè¿‡ç¨‹ã€‚</p>
<p>ä¸šåŠ¡è¡¨ï¼š<code>product</code></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Key</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>bigint(20)</td>
<td>PRI</td>
</tr>
<tr>
<td>name</td>
<td>varchar(100)</td>
<td></td>
</tr>
<tr>
<td>since</td>
<td>varchar(100)</td>
<td></td>
</tr>
</tbody></table>
<p>AT åˆ†æ”¯äº‹åŠ¡çš„ä¸šåŠ¡é€»è¾‘ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> product <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;GTS&#x27;</span> <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;TXC&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h5 id="ä¸€é˜¶æ®µ"><a href="#ä¸€é˜¶æ®µ" class="headerlink" title="ä¸€é˜¶æ®µ"></a>ä¸€é˜¶æ®µ</h5><p>è¿‡ç¨‹ï¼š</p>
<ol>
<li>è§£æ SQLï¼šå¾—åˆ° SQL çš„ç±»å‹ï¼ˆUPDATEï¼‰ï¼Œè¡¨ï¼ˆproductï¼‰ï¼Œæ¡ä»¶ï¼ˆwhere name &#x3D; â€˜TXCâ€™ï¼‰ç­‰ç›¸å…³çš„ä¿¡æ¯ã€‚</li>
<li>æŸ¥è¯¢å‰é•œåƒï¼šæ ¹æ®è§£æå¾—åˆ°çš„æ¡ä»¶ä¿¡æ¯ï¼Œç”ŸæˆæŸ¥è¯¢è¯­å¥ï¼Œå®šä½æ•°æ®ã€‚</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id, name, since <span class="keyword">from</span> product <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;TXC&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°å‰é•œåƒï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>since</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>TXC</td>
<td>2014</td>
</tr>
</tbody></table>
<ol>
<li>æ‰§è¡Œä¸šåŠ¡ SQLï¼šæ›´æ–°è¿™æ¡è®°å½•çš„ name ä¸º â€˜GTSâ€™ã€‚</li>
<li>æŸ¥è¯¢åé•œåƒï¼šæ ¹æ®å‰é•œåƒçš„ç»“æœï¼Œé€šè¿‡ <strong>ä¸»é”®</strong> å®šä½æ•°æ®ã€‚</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id, name, since <span class="keyword">from</span> product <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°åé•œåƒï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>since</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>GTS</td>
<td>2014</td>
</tr>
</tbody></table>
<ol>
<li>æ’å…¥å›æ»šæ—¥å¿—ï¼šæŠŠå‰åé•œåƒæ•°æ®ä»¥åŠä¸šåŠ¡ SQL ç›¸å…³çš„ä¿¡æ¯ç»„æˆä¸€æ¡å›æ»šæ—¥å¿—è®°å½•ï¼Œæ’å…¥åˆ° <code>UNDO_LOG</code> è¡¨ä¸­ã€‚</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;branchId&quot;</span><span class="punctuation">:</span> <span class="number">641789253</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;undoItems&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;afterImage&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;id&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GTS&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;since&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2014&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;tableName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;product&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;beforeImage&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;id&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;TXC&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;since&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2014&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;tableName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;product&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;sqlType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UPDATE&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;xid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xid:xxx&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>æäº¤å‰ï¼Œå‘ TC æ³¨å†Œåˆ†æ”¯ï¼šç”³è¯· <code>product</code> è¡¨ä¸­ï¼Œä¸»é”®å€¼ç­‰äº 1 çš„è®°å½•çš„ <strong>å…¨å±€é”</strong> ã€‚</li>
<li>æœ¬åœ°äº‹åŠ¡æäº¤ï¼šä¸šåŠ¡æ•°æ®çš„æ›´æ–°å’Œå‰é¢æ­¥éª¤ä¸­ç”Ÿæˆçš„ UNDO LOG ä¸€å¹¶æäº¤ã€‚</li>
<li>å°†æœ¬åœ°äº‹åŠ¡æäº¤çš„ç»“æœä¸ŠæŠ¥ç»™ TCã€‚</li>
</ol>
<h5 id="äºŒé˜¶æ®µ-å›æ»š"><a href="#äºŒé˜¶æ®µ-å›æ»š" class="headerlink" title="äºŒé˜¶æ®µ-å›æ»š"></a>äºŒé˜¶æ®µ-å›æ»š</h5><ol>
<li>æ”¶åˆ° TC çš„åˆ†æ”¯å›æ»šè¯·æ±‚ï¼Œå¼€å¯ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œæ‰§è¡Œå¦‚ä¸‹æ“ä½œã€‚</li>
<li>é€šè¿‡ XID å’Œ Branch ID æŸ¥æ‰¾åˆ°ç›¸åº”çš„ UNDO LOG è®°å½•ã€‚</li>
<li>æ•°æ®æ ¡éªŒï¼šæ‹¿ UNDO LOG ä¸­çš„åé•œä¸å½“å‰æ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ‰ä¸åŒï¼Œè¯´æ˜æ•°æ®è¢«å½“å‰å…¨å±€äº‹åŠ¡ä¹‹å¤–çš„åŠ¨ä½œåšäº†ä¿®æ”¹ã€‚è¿™ç§æƒ…å†µï¼Œéœ€è¦æ ¹æ®é…ç½®ç­–ç•¥æ¥åšå¤„ç†ï¼Œè¯¦ç»†çš„è¯´æ˜åœ¨å¦å¤–çš„æ–‡æ¡£ä¸­ä»‹ç»ã€‚</li>
<li>æ ¹æ® UNDO LOG ä¸­çš„å‰é•œåƒå’Œä¸šåŠ¡ SQL çš„ç›¸å…³ä¿¡æ¯ç”Ÿæˆå¹¶æ‰§è¡Œå›æ»šçš„è¯­å¥ï¼š</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> product <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;TXC&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ol>
<li>æäº¤æœ¬åœ°äº‹åŠ¡ã€‚å¹¶æŠŠæœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œç»“æœï¼ˆå³åˆ†æ”¯äº‹åŠ¡å›æ»šçš„ç»“æœï¼‰ä¸ŠæŠ¥ç»™ TCã€‚</li>
</ol>
<h5 id="äºŒé˜¶æ®µ-æäº¤"><a href="#äºŒé˜¶æ®µ-æäº¤" class="headerlink" title="äºŒé˜¶æ®µ-æäº¤"></a>äºŒé˜¶æ®µ-æäº¤</h5><ol>
<li>æ”¶åˆ° TC çš„åˆ†æ”¯æäº¤è¯·æ±‚ï¼ŒæŠŠè¯·æ±‚æ”¾å…¥ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„é˜Ÿåˆ—ä¸­ï¼Œé©¬ä¸Šè¿”å›æäº¤æˆåŠŸçš„ç»“æœç»™ TCã€‚</li>
<li>å¼‚æ­¥ä»»åŠ¡é˜¶æ®µçš„åˆ†æ”¯æäº¤è¯·æ±‚å°†å¼‚æ­¥å’Œæ‰¹é‡åœ°åˆ é™¤ç›¸åº” UNDO LOG è®°å½•ã€‚</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://dd-xiaozhi.github.io/dd">John Doe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://dd-xiaozhi.github.io/dd/2024/10/25/Spring%20Cloud%20Alibaba/">https://dd-xiaozhi.github.io/dd/2024/10/25/Spring%20Cloud%20Alibaba/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/dd/tags/test/">test</a></div><div class="post-share"><div class="social-share" data-image="/dd/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/dd/2024/10/25/Shiro/" title="Shiro"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Shiro</div></div><div class="info-2"><div class="info-item-1">ä¸€ã€ç®€ä»‹ 1ã€ä»€ä¹ˆæ˜¯Shiroä¸€ä¸ªç®€å•æ˜“ç”¨çš„å®‰å…¨ç®¡ç†æ¡†æ¶ï¼Œç”¨æ¥åšæƒé™ç®¡ç†ï¼ŒjavaSEå’ŒjavaEEéƒ½å¯ä»¥ä½¿ç”¨ï¼Œè¿˜å¯ä»¥ç”¨äºç¬¬ä¸‰æ–¹è¯­è¨€ 2ã€shiroæ•´ä½“æ¶æ„  Subjectï¼šä¸»ä½“ï¼Œå¯ä»¥çœ‹åˆ°ä¸»ä½“å¯ä»¥æ˜¯ä»»ä½•å¯ä»¥ä¸åº”ç”¨äº¤äº’çš„ â€œç”¨æˆ·â€ï¼Œå¯ä»¥æ˜¯ç¨‹åºã€ç”¨æˆ·ï¼› SecurityManagerï¼šshiroçš„æ ¸å¿ƒï¼Œè´Ÿè´£è®¤è¯ã€æˆæƒã€ä¼šè¯ã€ç¼“å­˜çš„ç®¡ç† Authenticatorï¼šè®¤è¯å™¨ï¼Œè´Ÿè´£ä¸»ä½“è®¤è¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ‰©å±•ç‚¹ï¼Œå¦‚æœç”¨æˆ·è§‰å¾— Shiro é»˜è®¤çš„ä¸å¥½ï¼Œå¯ä»¥è‡ªå®šä¹‰å®ç°ï¼›å…¶éœ€è¦è®¤è¯ç­–ç•¥ï¼ˆAuthentication Strategyï¼‰ï¼Œå³ä»€ä¹ˆæƒ…å†µä¸‹ç®—ç”¨æˆ·è®¤è¯é€šè¿‡äº†ï¼› Authorizerï¼šæˆæƒå™¨ï¼Œæˆ–è€…è®¿é—®æ§åˆ¶å™¨ï¼Œç”¨æ¥å†³å®šä¸»ä½“æ˜¯å¦æœ‰æƒé™è¿›è¡Œç›¸åº”çš„æ“ä½œï¼›å³æ§åˆ¶ç€ç”¨æˆ·èƒ½è®¿é—®åº”ç”¨ä¸­çš„å“ªäº›åŠŸèƒ½ï¼› Realmï¼šåŸŸï¼Œå¯ä»¥æœ‰ 1 ä¸ªæˆ–å¤šä¸ª Realmï¼Œå¯ä»¥è®¤ä¸ºå®ƒæ˜¯å®‰å…¨æ•°æ®æºï¼Œé€šè¿‡å®ƒæˆ‘ä»¬æ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æ˜¯æ‹¥æœ‰è®¿é—®æƒé™ï¼Œä¿å­˜å¯¹åº”çš„éªŒè¯ä¿¡æ¯ï¼Œæ¯”å¦‚webç™»å½•ï¼Œä¿å­˜çš„æ˜¯æˆ‘ä»¬çš„ç”¨æˆ·åå’Œå¯†ç ä¿¡æ¯ï¼Œé€šè¿‡è¿™ä¸ªæˆ‘ä»¬åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰ç™»å½•ç½‘ç«™çš„æƒé™ï¼› SessionManagerï¼šå¦‚æœå†™è¿‡ Servlet å°±åº”è¯¥çŸ¥é“ Session...</div></div></div></a><a class="pagination-related" href="/dd/2024/10/25/MyBatis/" title="MyBatis"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">MyBatis</div></div><div class="info-2"><div class="info-item-1">MyBatisç®€ä»‹ç¯å¢ƒè¯´æ˜ jdk 8 + MySQL 5.7.19 maven-3.6.1 IDEA  å­¦ä¹ å‰éœ€è¦æŒæ¡ï¼š  JDBC MySQL Java åŸºç¡€ Maven Junit  ä»€ä¹ˆæ˜¯MyBatis MyBatis æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ MyBatis é¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†çš„è¿‡ç¨‹ MyBatis å¯ä»¥ä½¿ç”¨ç®€å•çš„ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸç”Ÿä¿¡æ¯ï¼Œå°†æ¥å£å’Œ Java çš„ å®ä½“ç±» ã€Plain Old Java Objects,æ™®é€šçš„ Javaå¯¹è±¡ã€‘æ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•ã€‚ MyBatis æœ¬æ˜¯apacheçš„ä¸€ä¸ªå¼€æºé¡¹ç›®ibatis, 2010å¹´è¿™ä¸ªé¡¹ç›®ç”±apache è¿ç§»åˆ°äº†google codeï¼Œå¹¶ä¸”æ”¹åä¸ºMyBatis ã€‚ 2013å¹´11æœˆè¿ç§»åˆ°Github . Mybatiså®˜æ–¹æ–‡æ¡£ : http://www.mybatis.org/mybatis-3/zh/index.html GitHub :...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/dd/2024/10/25/Dubbo/" title="Dubbo"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-25</div><div class="info-item-2">Dubbo</div></div><div class="info-2"><div class="info-item-1">ä¸€ã€åŸºç¡€çŸ¥è¯†1ã€åˆ†å¸ƒå¼åŸºç¡€ç†è®º1.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿåˆ†å¸ƒå¼ç³»ç»Ÿå°±æ˜¯ç”±å¤šä¸ªè®¡ç®—æœºæä¾›æœåŠ¡ç»„æˆçš„ç³»ç»Ÿ éšç€äº’è”ç½‘çš„å‘å±•ï¼Œç½‘ç«™åº”ç”¨çš„è§„æ¨¡ä¸æ–­æ‰©å¤§ï¼Œå¸¸è§„çš„å‚ç›´åº”ç”¨æ¶æ„å·²ç»æ— æ³•åº”ä»˜ï¼Œåˆ†å¸ƒå¼æ¶æ„ä¸æµåŠ¨è®¡ç®—æ¶æ„åŠ¿åœ¨å¿…è¡Œï¼Œè¿˜éœ€ä¸€ä¸ªæ²»ç†ç³»ç»Ÿæ¥å¯¹åº”ç”¨è¿›è¡Œç®¡ç† 1.2...</div></div></div></a><a class="pagination-related" href="/dd/2024/10/25/IDEA/" title="IDEA"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-25</div><div class="info-item-2">IDEA</div></div><div class="info-2"><div class="info-item-1">å¿«æ·é”®ä½¿ç”¨ç³»ç»Ÿå¿«æ·é”®   ctrl + alt + ç©ºæ ¼ æç¤ºä¿¡æ¯    ctrl + alt + v ç›¸å½“äºEcelipseé‡Œé¢çš„ctr+1ï¼Œæ˜¾ç¤ºå·¦è¾¹çš„å†…å®¹   alt + n æŠ›å¼‚å¸¸   ctrl + o æŸ¥çœ‹å…³ç³»   ctrl + shift + T æŸ¥çœ‹æ–‡æ¡£   ctrl + alt + T åŒ…èµ·æ¥   ctrl + alt + L æ ¼å¼åŒ–   alt + ins è‡ªåŠ¨ç”Ÿæˆgetå’Œsetæ–¹æ³•ç­‰   ctrl + r æœç´¢å…³é”®å­—ã€æ›¿æ¢   ctrl + f æœç´¢å…³é”®å­—   ctrl +   H æ˜¾ç¤ºå‡ºHierarchyï¼ˆç»§æ‰¿æ ‘ï¼‰   ctrl + shift + u è½¬æ¢å¤§å°å†™   ctrl + shift + I é¢„è§ˆæŸä¸ªç±»ã€æŸä¸ªæ–¹æ³•ã€æŸä¸ªå­—æ®µã€æŸä¸ªå˜é‡çš„ä»£ç    ctrl + alt + B æˆ– ctrl + alt + é¼ æ ‡å·¦é”® è·³è½¬å®ç°ç±»   F11 æ·»åŠ ä¹¦ç­¾   TODO å¾…å®Œæˆ   ctrl + alt + shift + U æŸ¥çœ‹ä¾èµ–å…³ç³»   ctrl + alt + U æŸ¥çœ‹ä¾èµ–å…³ç³»ï¼ˆåªæœ‰æŸ¥çœ‹åŠŸèƒ½ï¼‰   ctrl + F12 æŸ¥çœ‹ç±»çš„æ‰€æœ‰æ–¹æ³•   ctrl...</div></div></div></a><a class="pagination-related" href="/dd/2024/10/25/Maven/" title="Maven"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-25</div><div class="info-item-2">Maven</div></div><div class="info-2"><div class="info-item-1">ä¸€ã€Mavenæ¦‚è¿°å’Œå®‰è£…1ã€æ¦‚è¿°â€‹	æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œé¡¹ç›®æ¶æ„ç®¡ç†å·¥å…· ç›®å‰é˜¶æ®µï¼šè‡ªåŠ¨å¯¼å…¥jaråŒ…ï¼Œè§£å†³å¯¼jaråŒ…çš„å·¥ä½œ æ ¸å¿ƒæ€æƒ³ï¼šçº¦å®šå¤§äºé…ç½®  æœ‰çº¦æŸï¼Œä¸è¦å»è¿å  Mavenä¼šè§„å®šå¥½å¦‚ä½•å»ç¼–å†™æˆ‘ä»¬çš„javaä»£ç ï¼Œå¿…é¡»æŒ‰ç…§è¿™ä¸ªè§„èŒƒæ¥ï¼› 2ã€å®‰è£…å®˜ç½‘ï¼šhttps://maven.apache.org/  ä¸‹è½½æ–‡ä»¶åè§£å‹å³å¯ ç›®å½•ç»“æ„binï¼šå¯æ‰§è¡Œæ–‡ä»¶ bootï¼šéœ€è¦å¯åŠ¨çš„ä¸€äº›é€‰é¡¹ï¼ŒjaråŒ… confï¼šé…ç½®æ–‡ä»¶ libï¼šä¾èµ– é…ç½®ç¯å¢ƒå˜é‡ M2_HOME			mavenç›®å½•ä¸‹çš„binç›®å½• MAVEN_HOME     mavençš„ç›®å½• åœ¨ç³»ç»Ÿçš„pathä¸­å‘¢é…ç½® %MAVEN_HOME%\bin  è¯´æ˜ï¼šä¸ºä»€ä¹ˆè¦åˆ›å»ºä¸¤ä¸ªï¼ŒæŒ‰ç…§è§„èŒƒæ¥ é€šè¿‡mvn...</div></div></div></a><a class="pagination-related no-desc" href="/dd/2024/10/25/JVM/" title="JVM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-25</div><div class="info-item-2">JVM</div></div></div></a><a class="pagination-related" href="/dd/2024/10/25/Git&GitHub&Gitee/" title="Git&amp;GitHub&amp;Gitee"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-25</div><div class="info-item-2">Git&amp;GitHub&amp;Gitee</div></div><div class="info-2"><div class="info-item-1">gitæ¦‚è¿°Git æ˜¯ä¸€ä¸ªå…è´¹çš„ã€å¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå¯ä»¥å¿«é€Ÿé«˜æ•ˆåœ°å¤„ç†ä»å°å‹åˆ°å¤§å‹çš„å„ç§é¡¹ç›®ã€‚Git æ˜“äºå­¦ä¹ ï¼Œå åœ°é¢ç§¯å°ï¼Œæ€§èƒ½æå¿«ã€‚ å®ƒå…·æœ‰å»‰ä»·çš„æœ¬åœ°åº“ï¼Œæ–¹ä¾¿çš„æš‚å­˜åŒºåŸŸå’Œå¤šä¸ªå·¥ä½œæµåˆ†æ”¯ç­‰ç‰¹æ€§ã€‚ å…¶æ€§èƒ½ä¼˜äº Subversionã€ CVSã€ Perforce å’Œ ClearCase ç­‰ç‰ˆæœ¬æ§åˆ¶å·¥å…·ã€‚ ä»€ä¹ˆæ˜¯ç‰ˆæœ¬æ§åˆ¶ï¼Ÿç‰ˆæœ¬æ§åˆ¶æ˜¯ä¸€ç§è®°å½•æ–‡ä»¶å†…å®¹å˜åŒ–ï¼Œä»¥ä¾¿å°†æ¥æŸ¥é˜…ç‰¹å®šç‰ˆæœ¬ä¿®è®¢æƒ…å†µçš„ç³»ç»Ÿã€‚ç‰ˆæœ¬æ§åˆ¶å…¶å®æœ€é‡è¦çš„æ˜¯å¯ä»¥è®°å½•æ–‡ä»¶ä¿®æ”¹å†å²è®°å½•ï¼Œä»è€Œè®©ç”¨æˆ·èƒ½å¤ŸæŸ¥çœ‹å†å²ç‰ˆæœ¬ï¼Œæ–¹ä¾¿ç‰ˆæœ¬åˆ‡æ¢ã€‚   ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬æ§åˆ¶æˆ‘ä»¬ä»ä¸ªäººè¿‡åº¦åˆ°å›¢é˜Ÿï¼Œå›¢é˜Ÿä¹‹é—´è¿›è¡Œåä½œ  æ¯”å¦‚ä¸¤ä¸ªäººæ¥è¿›è¡Œåˆä½œï¼Œç¬¬ä¸€ä¸ªäººä¸Šä¼ äº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä»¬ç¬¬äºŒä¸ªäººå°±æ˜¯è¦åœ¨ç¬¬ä¸€ä¸ªç‰ˆæœ¬æ¥è¿›è¡Œä¿®æ”¹å½¢æˆç¬¬äºŒä¸ªç‰ˆæœ¬ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥è¿›è¡Œæ›´å¥½çš„åˆä½œ ç‰ˆæœ¬æ§åˆ¶å·¥å…·é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·   é›†ä¸­åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè¯¸å¦‚ CVSã€ SVN ç­‰ ...</div></div></div></a><a class="pagination-related" href="/dd/2024/10/25/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" title="Javaå¹¶å‘ç¼–ç¨‹"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-25</div><div class="info-item-2">Javaå¹¶å‘ç¼–ç¨‹</div></div><div class="info-2"><div class="info-item-1">ä¸€ã€æ¦‚è¿°1ã€è¿›ç¨‹ä¸çº¿ç¨‹1.1 è¿›ç¨‹ç¨‹åºç”±æŒ‡ä»¤å’Œæ•°æ®ç»„æˆï¼Œæ•°æ®è¦è¿›è¡Œè¯»å†™ï¼Œå°±å¿…é¡»å°†æŒ‡ä»¤åŠ è½½åˆ° CPU ï¼Œæ•°æ®è®°è½½åˆ°å†…å­˜ä¸­ï¼Œåœ¨æŒ‡ä»¤çš„è¿è¡Œè¿‡ç¨‹ä¸­è¿˜éœ€è¦ç”¨åˆ°ç£ç›˜ã€ç½‘ç»œç­‰è®¾å¤‡ã€‚è¿™äº›åŠ è½½æŒ‡ä»¤ã€ç®¡ç†å†…å­˜å’Œç®¡ç† IO çš„æ“ä½œ ç”±è¿›ç¨‹æ¥å®Œæˆ ç¨‹åºè¿è¡Œä»ç£ç›˜ä¸­åŠ è½½ä»£ç åˆ°å†…å­˜ä¸­ï¼Œè¿™å°±å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹å¯ä»¥è§†ä¸ºç¨‹åºçš„ä¸€ä¸ªå®ä¾‹ï¼Œæœ‰äº›ç¨‹åºåªèƒ½ç”±ä¸€ä¸ªå®ä¾‹ï¼Œæœ‰äº›ç¨‹åºå¯ä»¥æœ‰å¤šä¸ªå®åŠ›ï¼Œçœ‹è¿™ä¸ªç¨‹åºæ˜¯å¦æ”¯æŒå¤šå®ä¾‹ 1.2 çº¿ç¨‹ä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œé€šè¿‡çº¿ç¨‹æ¥æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚çº¿ç¨‹å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤å®¹å™¨ï¼Œå°†ä¸€æ¡æ¡çš„æŒ‡ä»¤æŒ‰ç…§ä¸€å®šé¡ºåºäº¤ç»™ CPU è¯»å–å’Œæ‰§è¡Œã€‚å®ƒæœ¬èº«æ˜¯ä¸å…·å¤‡æ‰§è¡Œçš„èƒ½åŠ›çš„ã€‚   åœ¨Javaä¸­ï¼Œçº¿ç¨‹æ˜¯æœ€å°çš„è°ƒåº¦å•ä½ï¼Œè¿›ç¨‹ä½œä¸ºèµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‚åœ¨ windows ä¸­è¿›ç¨‹æ˜¯ä¸æ´»åŠ¨çš„ï¼Œå®ƒåªæ˜¯å……å½“äº†çº¿ç¨‹å®¹å™¨çš„èº«ä»½ 1.3 ä¸¤è€…å¯¹æ¯” è¿›ç¨‹åŸºæœ¬ç›¸å¯¹ç‹¬ç«‹ï¼Œçº¿ç¨‹åœ¨è¿›ç¨‹å†…ï¼Œæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå­é›† è¿›ç¨‹å†…çš„çº¿ç¨‹èµ„æºå…±äº« è¿›ç¨‹é—´é€šä¿¡è¾ƒä¸ºå¤æ‚ åŒä¸€å°è®¡ç®—æœºçš„è¿›ç¨‹é€šä¿¡ç§°ä¸º...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/dd/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/dd/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">John Doe</div><div class="author-info-description"></div><div class="site-data"><a href="/dd/archives/"><div class="headline">Articles</div><div class="length-num">27</div></a><a href="/dd/tags/"><div class="headline">Tags</div><div class="length-num">1</div></a><a href="/dd/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">ä¸€ã€æ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-Spring-Cloud-Alibaba%E4%B8%BA%E4%BB%80%E4%B9%88%E5%87%BA%E7%8E%B0"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 Spring Cloud Alibabaä¸ºä»€ä¹ˆå‡ºç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 æ˜¯ä»€ä¹ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 ä¸»è¦åŠŸèƒ½*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-%E7%BB%84%E4%BB%B6"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2 ç»„ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-%E6%96%87%E6%A1%A3"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.2.3 æ–‡æ¡£</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Nacos"><span class="toc-number">2.</span> <span class="toc-text">äºŒã€Nacos</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E6%A6%82%E8%BF%B0%E5%92%8C%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 æ¦‚è¿°å’Œå®‰è£…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1 æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2 å®‰è£…</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 æœåŠ¡æ³¨å†Œä¸­å¿ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 æœåŠ¡æä¾›è€…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 æœåŠ¡æ¶ˆè´¹è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85%E5%B7%A5%E7%A8%8B"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">æ¶ˆè´¹è€…å·¥ç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">è´Ÿè½½å‡è¡¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-%E5%90%84%E5%A4%A7%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E7%9A%84%E6%AF%94%E8%BE%83"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.2.3 å„å¤§æ³¨å†Œä¸­å¿ƒçš„æ¯”è¾ƒ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 æœåŠ¡é…ç½®ä¸­å¿ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.3.1 å·¥ç¨‹æ­å»º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.3.2 é…ç½®æ–‡ä»¶åŒ¹é…è§„åˆ™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE"><span class="toc-number">2.3.3.</span> <span class="toc-text">2.3.3 ä¸‰ç§æ–¹å¼åŠ è½½é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Data-Id"><span class="toc-number">2.3.3.1.</span> <span class="toc-text">Data Id</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Group"><span class="toc-number">2.3.3.2.</span> <span class="toc-text">Group</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Namespace"><span class="toc-number">2.3.3.3.</span> <span class="toc-text">Namespace</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E9%9B%86%E7%BE%A4%E4%B8%8E%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 é›†ç¾¤ä¸æŒä¹…åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3"><span class="toc-number">2.4.1.</span> <span class="toc-text">2.4.1 å®˜æ–¹æ–‡æ¡£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-nacos%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">2.4.2.</span> <span class="toc-text">2.4.2 nacosæŒä¹…åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-3-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="toc-number">2.4.3.</span> <span class="toc-text">2.4.3 ç”Ÿäº§ç¯å¢ƒé›†ç¾¤æ­å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E4%BF%AE%E6%94%B9nacos%E9%85%8D%E7%BD%AE"><span class="toc-number">2.4.3.1.</span> <span class="toc-text">â‘ ä¿®æ”¹nacosé…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8"><span class="toc-number">2.4.3.2.</span> <span class="toc-text">â‘¡åˆ›å»ºæ•°æ®åº“è¡¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2%E4%BF%AE%E6%94%B9nginx%E9%85%8D%E7%BD%AE"><span class="toc-number">2.4.3.3.</span> <span class="toc-text">â‘¢ä¿®æ”¹nginxé…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A3%E6%B5%8B%E8%AF%95"><span class="toc-number">2.4.3.4.</span> <span class="toc-text">â‘£æµ‹è¯•</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81Sentinel"><span class="toc-number">3.</span> <span class="toc-text">ä¸‰ã€Sentinel</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-Sentinel%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 Sentinelä»‹ç»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E5%AE%83%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1 å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-Sentinel-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">3.1.2.</span> <span class="toc-text">3.1.2 Sentinel åŸºæœ¬æ¦‚å¿µ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-Sentinel%E5%85%A5%E9%97%A8"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 Sentinelå…¥é—¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E5%AE%89%E8%A3%85Sentinel%E6%8E%A7%E5%88%B6%E5%8F%B0"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 å®‰è£…Sentinelæ§åˆ¶å°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E6%B5%8B%E8%AF%95%E5%B7%A5%E7%A8%8B"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 æµ‹è¯•å·¥ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E6%90%AD%E5%BB%BA"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">â‘ æ­å»º</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E6%B5%8B%E8%AF%95"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">â‘¡æµ‹è¯•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 æµé‡æ§åˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1 æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E6%B5%81%E6%8E%A7%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2 æµæ§æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E7%9B%B4%E6%8E%A5"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">â‘ ç›´æ¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E5%85%B3%E8%81%94"><span class="toc-number">3.3.2.2.</span> <span class="toc-text">â‘¡å…³è”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2%E9%93%BE%E8%B7%AF"><span class="toc-number">3.3.2.3.</span> <span class="toc-text">â‘¢é“¾è·¯</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-%E6%B5%81%E6%8E%A7%E6%95%88%E6%9E%9C"><span class="toc-number">3.3.3.</span> <span class="toc-text">3.3.3 æµæ§æ•ˆæœ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">3.3.3.1.</span> <span class="toc-text">æµ‹è¯•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 ç†”æ–­é™çº§</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">3.4.1.</span> <span class="toc-text">3.4.1 æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-%E7%86%94%E6%96%AD%E7%AD%96%E7%95%A5"><span class="toc-number">3.4.2.</span> <span class="toc-text">3.4.2 ç†”æ–­ç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-3-%E9%99%8D%E7%BA%A7%E8%A7%84%E5%88%99"><span class="toc-number">3.4.3.</span> <span class="toc-text">3.4.3 é™çº§è§„åˆ™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-3-%E6%A1%88%E4%BE%8B"><span class="toc-number">3.4.4.</span> <span class="toc-text">3.4.3 æ¡ˆä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%85%A2%E6%AF%94%E4%BE%8B%E8%B0%83%E7%94%A8"><span class="toc-number">3.4.4.1.</span> <span class="toc-text">æ…¢æ¯”ä¾‹è°ƒç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E6%AF%94%E4%BE%8B"><span class="toc-number">3.4.4.2.</span> <span class="toc-text">å¼‚å¸¸æ¯”ä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E6%95%B0"><span class="toc-number">3.4.4.3.</span> <span class="toc-text">å¼‚å¸¸æ•°</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 çƒ­ç‚¹å‚æ•°é™æµ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-1-%E4%BB%80%E4%B9%88%E6%98%AF%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81"><span class="toc-number">3.5.1.</span> <span class="toc-text">3.5.1 ä»€ä¹ˆæ˜¯çƒ­ç‚¹å‚æ•°é™æµ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-2-%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E8%A7%84%E5%88%99"><span class="toc-number">3.5.2.</span> <span class="toc-text">3.5.2 çƒ­ç‚¹å‚æ•°è§„åˆ™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-3-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">3.5.3.</span> <span class="toc-text">3.5.3 åŸºæœ¬ä½¿ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-4-%E5%8F%82%E6%95%B0%E4%BE%8B%E5%A4%96%E9%A1%B9"><span class="toc-number">3.5.4.</span> <span class="toc-text">3.5.4 å‚æ•°ä¾‹å¤–é¡¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E4%BF%9D%E6%8A%A4"><span class="toc-number">3.6.</span> <span class="toc-text">3.6 ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-1-%E7%B3%BB%E7%BB%9F%E8%A7%84%E5%88%99"><span class="toc-number">3.6.1.</span> <span class="toc-text">3.6.1 ç³»ç»Ÿè§„åˆ™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-2-%E6%A1%88%E4%BE%8B"><span class="toc-number">3.6.2.</span> <span class="toc-text">3.6.2 æ¡ˆä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-SentinelResource-%E6%B3%A8%E8%A7%A3"><span class="toc-number">3.7.</span> <span class="toc-text">3.7 @SentinelResource æ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">3.7.1.</span> <span class="toc-text">3.7.1 æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-1-%E4%BD%BF%E7%94%A8"><span class="toc-number">3.7.2.</span> <span class="toc-text">3.8.1 ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#blockHandler"><span class="toc-number">3.7.2.1.</span> <span class="toc-text">blockHandler</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fallback"><span class="toc-number">3.7.2.2.</span> <span class="toc-text">fallback</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%A4%E4%B8%AA%E4%B8%80%E8%B5%B7%E4%BD%BF%E7%94%A8"><span class="toc-number">3.7.2.3.</span> <span class="toc-text">ä¸¤ä¸ªä¸€èµ·ä½¿ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%BD%E7%95%A5%E5%B1%9E%E6%80%A7"><span class="toc-number">3.7.2.4.</span> <span class="toc-text">å¿½ç•¥å±æ€§</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-8-%E6%95%B4%E5%90%88Openfeign"><span class="toc-number">3.8.</span> <span class="toc-text">3.8 æ•´åˆOpenfeign</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-1-%E5%A6%82%E4%BD%95%E6%95%B4%E5%90%88%EF%BC%9F"><span class="toc-number">3.8.1.</span> <span class="toc-text">3.8.1 å¦‚ä½•æ•´åˆï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-2-%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA"><span class="toc-number">3.8.2.</span> <span class="toc-text">3.8.2 å·¥ç¨‹æ­å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E4%BE%9B%E8%80%85"><span class="toc-number">3.8.2.1.</span> <span class="toc-text">æä¾›è€…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">3.8.2.2.</span> <span class="toc-text">æ¶ˆè´¹è€…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-1"><span class="toc-number">3.8.2.3.</span> <span class="toc-text">æµ‹è¯•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-9-%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">3.9.</span> <span class="toc-text">3.9 è§„åˆ™æŒä¹…åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-9-1-%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%9F"><span class="toc-number">3.9.1.</span> <span class="toc-text">3.9.1 è§„åˆ™æŒä¹…åŒ–ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-9-2-%E6%80%8E%E4%B9%88%E5%81%9A"><span class="toc-number">3.9.2.</span> <span class="toc-text">3.9.2 æ€ä¹ˆåš</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-9-3-%E6%B5%8B%E8%AF%95"><span class="toc-number">3.9.3.</span> <span class="toc-text">3.9.3 æµ‹è¯•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Seata"><span class="toc-number">4.</span> <span class="toc-text">å››ã€Seata</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 æ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">4.1.1.</span> <span class="toc-text">4.1.1 æ˜¯ä»€ä¹ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E6%9C%AF%E8%AF%AD"><span class="toc-number">4.1.2.</span> <span class="toc-text">4.1.2 æœ¯è¯­</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E6%90%AD%E5%BB%BAseata-server"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 æ­å»ºseata server</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 å…¥é—¨æ¡ˆä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-1-%E7%94%A8%E4%BE%8B%E6%A6%82%E8%BF%B0"><span class="toc-number">4.3.1.</span> <span class="toc-text">4.3.1 ç”¨ä¾‹æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-2-%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA"><span class="toc-number">4.3.2.</span> <span class="toc-text">4.3.2 æœåŠ¡æ­å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E5%88%9B%E5%BA%93%E5%92%8C%E5%88%9B%E8%A1%A8"><span class="toc-number">4.3.2.1.</span> <span class="toc-text">â‘ åˆ›åº“å’Œåˆ›è¡¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1order%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.3.2.2.</span> <span class="toc-text">â‘¡orderæœåŠ¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2storage%E5%92%8Caccount%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.3.2.3.</span> <span class="toc-text">â‘¢storageå’ŒaccountæœåŠ¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-3-%E6%B5%8B%E8%AF%95"><span class="toc-number">4.3.3.</span> <span class="toc-text">4.3.3 æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E5%8E%9F%E7%90%86"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-1-AT%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.4.1.</span> <span class="toc-text">4.4.1 ATæ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%8F%90"><span class="toc-number">4.4.1.1.</span> <span class="toc-text">å‰æ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E6%9C%BA%E5%88%B6"><span class="toc-number">4.4.1.2.</span> <span class="toc-text">æ•´ä½“æœºåˆ¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="toc-number">4.4.1.3.</span> <span class="toc-text">å·¥ä½œæœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E9%98%B6%E6%AE%B5"><span class="toc-number">4.4.1.3.1.</span> <span class="toc-text">ä¸€é˜¶æ®µ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8C%E9%98%B6%E6%AE%B5-%E5%9B%9E%E6%BB%9A"><span class="toc-number">4.4.1.3.2.</span> <span class="toc-text">äºŒé˜¶æ®µ-å›æ»š</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8C%E9%98%B6%E6%AE%B5-%E6%8F%90%E4%BA%A4"><span class="toc-number">4.4.1.3.3.</span> <span class="toc-text">äºŒé˜¶æ®µ-æäº¤</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/dd/2024/10/25/Dubbo/" title="Dubbo">Dubbo</a><time datetime="2024-10-24T17:53:53.000Z" title="Created 2024-10-25 01:53:53">2024-10-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/dd/2024/10/25/IDEA/" title="IDEA">IDEA</a><time datetime="2024-10-24T17:53:53.000Z" title="Created 2024-10-25 01:53:53">2024-10-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/dd/2024/10/25/Maven/" title="Maven">Maven</a><time datetime="2024-10-24T17:53:53.000Z" title="Created 2024-10-25 01:53:53">2024-10-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/dd/2024/10/25/JVM/" title="JVM">JVM</a><time datetime="2024-10-24T17:53:53.000Z" title="Created 2024-10-25 01:53:53">2024-10-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/dd/2024/10/25/Git&amp;GitHub&amp;Gitee/" title="Git&amp;GitHub&amp;Gitee">Git&amp;GitHub&amp;Gitee</a><time datetime="2024-10-24T17:53:53.000Z" title="Created 2024-10-25 01:53:53">2024-10-25</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By John Doe</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/dd/js/utils.js"></script><script src="/dd/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>